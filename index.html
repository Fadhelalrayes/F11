<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>الطقس — بسيط وعملي</title>
<meta name="description" content="طقس الآن، الساعات القادمة، و5 أيام.">
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;800&display=swap" rel="stylesheet">

<style>
  :root{ --bg:#fafafa; --card:#fff; --ink:#111; --muted:#6b7280; --border:#ece6cc; --shadow:0 8px 24px rgba(0,0,0,.06); --accent:linear-gradient(90deg,#d4af37,#ffdf7f);}
  *{box-sizing:border-box}
  body{margin:0; background:var(--bg); color:var(--ink); font-family:"Tajawal",system-ui,-apple-system,Segoe UI,Roboto,sans-serif;}
  .wrap{max-width:900px; margin:auto; padding:16px; display:grid; gap:14px}
  .card{background:var(--card); border:1px solid var(--border); border-radius:14px; box-shadow:var(--shadow); padding:14px}
  h1{margin:0; font-size:1.3rem; font-weight:800; background:var(--accent); -webkit-background-clip:text; background-clip:text; color:transparent}
  .row{display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap}
  .loc{font-weight:800}
  .sub{color:var(--muted); font-size:.92rem}
  .now{display:flex; align-items:center; gap:12px}
  .now img{width:60px; height:60px}
  .now .t{font-size:2rem; font-weight:800}
  .grid{display:grid; gap:10px}
  @media(min-width:720px){ .grid{grid-template-columns:1fr 1fr} }
  .mini{display:grid; grid-template-columns:repeat(4,1fr); gap:8px}
  @media(max-width:480px){ .mini{grid-template-columns:repeat(2,1fr)} }
  .chip{border:1px solid var(--border); border-radius:12px; padding:10px; text-align:center}
  .chip .l{color:var(--muted); font-size:.86rem}
  .chip .v{font-weight:800}
  .secTitle{margin:0 0 10px; text-align:center; font-weight:800; background:var(--accent); -webkit-background-clip:text; background-clip:text; color:transparent}
  .hours, .days{display:grid; gap:8px; grid-template-columns:repeat(6,1fr)}
  @media(max-width:860px){ .hours{grid-template-columns:repeat(4,1fr)} .days{grid-template-columns:repeat(3,1fr)} }
  @media(max-width:520px){ .hours{grid-template-columns:repeat(3,1fr)} .days{grid-template-columns:repeat(2,1fr)} }
  .item{border:1px solid var(--border); border-radius:12px; padding:8px; text-align:center}
  .item img{width:36px; height:36px}
  .muted{color:var(--muted); font-size:.9rem}
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="row">
        <h1>الطقس — بسيط وعملي</h1>
        <div class="sub" id="dateLbl">—</div>
      </div>
    </div>

    <div class="card">
      <div class="row">
        <div>
          <div class="loc" id="place">—</div>
          <div class="sub" id="tzLbl">—</div>
        </div>
        <div class="sub" id="upd">آخر تحديث —</div>
      </div>

      <div class="grid" style="margin-top:8px">
        <div class="now">
          <img id="iconNow" alt="" />
          <div>
            <div class="t" id="tNow">—°</div>
            <div id="condNow" class="muted">—</div>
          </div>
        </div>
        <div class="mini">
          <div class="chip"><div class="l">أعلى/أدنى</div><div class="v"><span id="hi">—</span>° / <span id="lo">—</span>°</div></div>
          <div class="chip"><div class="l">الرطوبة</div><div class="v"><span id="hum">—</span>%</div></div>
          <div class="chip"><div class="l">الرياح</div><div class="v"><span id="wind">—</span> كم/س</div></div>
          <div class="chip"><div class="l">الإحساس</div><div class="v"><span id="feels">—</span>°</div></div>
        </div>
      </div>
    </div>

    <div class="card">
      <h3 class="secTitle">الساعات القادمة</h3>
      <div id="hours" class="hours"></div>
    </div>

    <div class="card">
      <h3 class="secTitle">توقع 5 أيام</h3>
      <div id="days" class="days"></div>
    </div>
  </div>

<script>
/* ===== مفتاح OpenWeather ===== */
const OWM_KEY = "71679af819486daabc9848ad1dec6c05";

/* ===== عناصر ===== */
const qs = id=>document.getElementById(id);
const placeEl=qs('place'), tzEl=qs('tzLbl'), updEl=qs('upd'), iconNow=qs('iconNow');
const tNow=qs('tNow'), condNow=qs('condNow'), hiEl=qs('hi'), loEl=qs('lo');
const humEl=qs('hum'), windEl=qs('wind'), feelsEl=qs('feels');
const hoursEl=qs('hours'), daysEl=qs('days'), dateLbl=qs('dateLbl');

const kmh = ms => Math.round(ms*3.6);
const fmtDate = (d,tz) => new Intl.DateTimeFormat('ar',{timeZone:tz, weekday:'long', year:'numeric', month:'long', day:'numeric'}).format(d);
const fmtTime = (ts,tz) => new Intl.DateTimeFormat('ar',{timeZone:tz, hour:'2-digit'}).format(new Date(ts*1000));

/* ===== API ===== */
async function getOneCall(lat,lon){
  const u=`https://api.openweathermap.org/data/2.5/onecall?lat=${lat}&lon=${lon}&appid=${OWM_KEY}&units=metric&lang=ar`;
  const r=await fetch(u); return r.json();
}
async function reverseName(lat,lon){
  const u=`https://api.openweathermap.org/geo/1.0/reverse?lat=${lat}&lon=${lon}&limit=1&appid=${OWM_KEY}`;
  const r=await fetch(u); const j=await r.json(); return j?.[0];
}

/* ===== عرض البيانات ===== */
function fillNow(data, place){
  const cur=data.current, d0=data.daily[0];
  const w=cur.weather[0];
  placeEl.textContent = place || "موقعك";
  tzEl.textContent = "المنطقة الزمنية: "+data.timezone;
  dateLbl.textContent = fmtDate(new Date(), data.timezone);
  updEl.textContent="آخر تحديث "+new Intl.DateTimeFormat('ar',{timeStyle:'short'}).format(new Date());
  tNow.textContent=Math.round(cur.temp)+"°";
  condNow.textContent=w.description;
  iconNow.src=`https://openweathermap.org/img/wn/${w.icon}@2x.png`;
  hiEl.textContent=Math.round(d0.temp.max);
  loEl.textContent=Math.round(d0.temp.min);
  humEl.textContent=cur.humidity;
  windEl.textContent=kmh(cur.wind_speed);
  feelsEl.textContent=Math.round(cur.feels_like);
}
function fillHours(hourly,tz){
  hoursEl.innerHTML=hourly.slice(0,6).map(h=>{
    const w=h.weather[0];
    return `<div class="item">
      <div class="muted">${fmtTime(h.dt,tz)}</div>
      <img src="https://openweathermap.org/img/wn/${w.icon}.png" alt="${w.description}">
      <div><strong>${Math.round(h.temp)}°</strong></div>
      <div class="muted">${Math.round((h.pop||0)*100)}%</div>
    </div>`;
  }).join("");
}
function fillDays(daily,tz){
  daysEl.innerHTML=daily.slice(0,5).map(d=>{
    const w=d.weather[0];
    const dn=new Intl.DateTimeFormat('ar',{timeZone:tz, weekday:'short'}).format(new Date(d.dt*1000));
    return `<div class="item">
      <div class="muted">${dn}</div>
      <img src="https://openweathermap.org/img/wn/${w.icon}.png" alt="${w.description}">
      <div><strong>${Math.round(d.temp.max)}°</strong> / <span class="muted">${Math.round(d.temp.min)}°</span></div>
      <div class="muted">${w.description}</div>
    </div>`;
  }).join("");
}

/* ===== تحميل ===== */
async function refresh(lat,lon){
  try{
    const data=await getOneCall(lat,lon);
    const rev=await reverseName(lat,lon);
    const place = rev ? `${rev.local_names?.ar||rev.name}، ${rev.country}` : "موقعك";
    fillNow(data,place);
    fillHours(data.hourly,data.timezone);
    fillDays(data.daily,data.timezone);
  }catch(e){updEl.textContent="تعذّر جلب البيانات";}
}

/* ===== تشغيل ===== */
navigator.geolocation.getCurrentPosition(
  pos=>refresh(pos.coords.latitude,pos.coords.longitude),
  ()=>refresh(26.2235,50.5876) // افتراضي: المنامة
);
</script>
</body>
</html>
