<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>ุงูุฃุจุฑุงุฌ ูุงูุงุณุชุจุตุงุฑ โ ูุฑุงุกุฉ ุงูุทุงูุน ุงูุนูููุฉ</title>
<meta name="description" content="ูุฑุงุกุงุช ููููุฉ ุชูุจุคูุฉ ุญุงุณูุฉ ุจุตูุงุบุฉ ุนุฑูุงู" />
<meta name="robots" content="index, follow" />
<meta name="theme-color" content="#0b0d12" />
<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">

<style>
  :root{
    --bg:#0b0d12; --fg:#f7f7f7; --muted:#bdbdbd;
    --brand:#ffd54a; --card:#141823; --stroke:#242a36; --accent:#5ad1ff;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:var(--bg); color:var(--fg);
    font-family:"Cairo",system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
    line-height:1.9; overflow-x:hidden;
  }
  body::before, body::after{ content:""; position:fixed; inset:0; pointer-events:none; z-index:-2; }
  body::before{
    background:
      radial-gradient(1200px 600px at 50% -10%, #1b2140 0%, rgba(27,33,64,0) 60%),
      radial-gradient(800px 500px at 80% 120%, #1a2336 0%, rgba(26,35,54,0) 60%),
      linear-gradient(180deg, #0b0d12 0%, #0e1320 55%, #0b0d12 100%);
  }
  body::after{
    background:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="240" height="240" viewBox="0 0 240 240"><g fill="%23ffffff" opacity="0.30"><circle cx="20" cy="30" r="1.2"/><circle cx="80" cy="60" r="0.8"/><circle cx="140" cy="20" r="1"/><circle cx="200" cy="90" r="1.1"/><circle cx="110" cy="140" r="0.9"/><circle cx="40" cy="190" r="1.2"/><circle cx="210" cy="200" r="0.9"/></g></svg>') repeat;
    background-size:240px 240px; animation: twinkle 6s ease-in-out infinite; opacity:.26;
  }
  header{ text-align:center; padding:18px 16px 10px; background:rgba(11,13,18,.75); backdrop-filter:saturate(140%) blur(6px); border-bottom:1px solid var(--stroke); }
  .title{ margin:0; font-weight:700; line-height:1.2; font-size: clamp(28px,5vw,46px); color:var(--brand);}
  .subtitle{ color:var(--muted); font-size:14px; margin-top:6px }
  .seer-wrap{display:flex; justify-content:center; margin:10px 0 8px}
  .seer{ width:min(520px, 88vw); height:auto; filter: drop-shadow(0 14px 30px rgba(0,0,0,.4)); }

  .container{max-width:1000px;margin:0 auto;padding:18px 16px}
  .card{ background:rgba(20,24,35,.92); border:1px solid var(--stroke); border-radius:18px; padding:22px; margin:16px 0; box-shadow:0 18px 40px rgba(0,0,0,.35) }
  h2{color:var(--brand); margin:10px 0 8px; text-align:center}
  label{display:block; margin:10px 0 6px; color:#eaeaea; font-size:15px}

  input,select,button{
    width:100%; padding:12px 14px; border-radius:12px; border:1px solid var(--stroke);
    background:#0f1320; color:#f7f7f7; font-size:16px; outline:none;
  }
  input:focus, select:focus{border-color:var(--brand); box-shadow:0 0 0 3px rgba(255,213,74,.15)}
  .grid{display:grid; grid-template-columns:1fr 1fr; gap:12px}
  @media (max-width:640px){ .grid{grid-template-columns:1fr} }

  .btn{ border:0; background:linear-gradient(135deg, var(--brand), #ffb300); color:#221; font-weight:700; cursor:pointer; transition:transform .08s ease }
  .btn:active{transform:scale(.99)}
  .ghost{background:transparent; border:1px solid var(--brand); color:var(--brand)}
  .center{display:grid; place-items:center; text-align:center}
  .hidden{display:none !important}

  .topic-grid{display:grid; grid-template-columns:repeat(2,1fr); gap:14px}
  @media (max-width:640px){ .topic-grid{grid-template-columns:1fr} }
  .topic{padding:18px; border:1px dashed var(--brand); border-radius:14px; background:#0f1320; cursor:pointer; text-align:center}
  .topic:hover{background:#12172a}
  .topic span{display:block; color:#cfd8dc; font-size:14px; margin-top:4px}

  .result{ font-size:19px; text-align:justify; }
  .result p{ margin:10px 0; }
  .result .lead{font-weight:700}
  .chip{display:inline-flex; align-items:center; gap:8px; padding:6px 12px; border-radius:999px; border:1px solid var(--stroke); background:#0f1320; color:#fff; font-size:14px}
  .z-emoji{font-size:20px}
  .quota{margin-top:8px; font-size:13px; color:#cfd8dc; text-align:center}
  .muted{color:#bdbdbd}

  .notice{ margin:10px auto 0; padding:12px 14px; border-radius:12px; border:1px solid #3a2a2a; background:#1a1010; color:#ffd0d0; font-size:14px; max-width:820px; }
  .notice.ok{background:#0f1a14; border-color:#234832; color:#c9ffd9}

  footer{ padding:24px 16px; text-align:center; color:#cfd8dc; border-top:1px solid var(--stroke); display:flex; flex-direction:column; gap:10px; align-items:center }
  .socials{display:flex; gap:12px; flex-wrap:wrap; justify-content:center}
  .socials button{ width:36px; height:36px; display:inline-grid; place-items:center; border-radius:10px; border:1px solid var(--stroke); background:#0f1320; cursor:pointer }
  .socials svg{width:18px;height:18px; fill:#cfd8dc}

  .ring-wrap{height:220px; display:grid; place-items:center}
  .ring{width:110px; height:110px; border-radius:50%; border:6px solid rgba(255,255,255,.08); border-top-color:var(--brand); animation:spin 1.0s linear infinite}
  @keyframes spin{to{transform:rotate(360deg)}}

  /* ููุทุจุงุนุฉ */
  #printDoc{ display:none; }
  #printDoc .paper{ background:#0b0d12; color:#f7f7f7; border:1px solid #2a3550; border-radius:16px; padding:18px; }
  #printDoc h1{ color:#ffd54a; margin:0 0 6px; text-align:center; font-size:26px; }
  #printDoc h2{ color:#ffd54a; font-size:20px; text-align:center; margin:6px 0 10px; }
  #printDoc .meta{ display:grid; grid-template-columns:repeat(2,1fr); gap:8px; margin:10px 0 12px; }
  #printDoc .meta div{ background:#0f1320; border:1px solid #2a3550; border-radius:10px; padding:10px; font-size:14px; }
  #printDoc .reading{ font-size:18px; line-height:1.9; text-align:justify; }
  #printDoc .brandline{ text-align:center; color:#bdbdbd; font-size:12px; margin-top:12px }
  @media print {
    @page{ size:A4; margin:14mm; }
    * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
    header, main > *, footer, .overlay { display:none !important; }
    #printDoc{ display:block !important; }
  }
</style>
</head>
<body>

<header>
  <h1 class="title">ุงูุฃุจุฑุงุฌ ูุงูุงุณุชุจุตุงุฑ</h1>
  <p class="subtitle">ูุฑุงุกุงุช ููููุฉ ุชูุจุคูุฉ ุญุงุณูุฉ ุจุตูุงุบุฉ ุนุฑูุงู</p>
  <div class="seer-wrap" aria-hidden="true">
    <svg class="seer" viewBox="0 0 800 260" xmlns="http://www.w3.org/2000/svg"><defs><radialGradient id="g1" cx="50%" cy="50%" r="60%"><stop offset="0%" stop-color="#7fd3ff" stop-opacity="0.95"/><stop offset="60%" stop-color="#5ea8ff" stop-opacity="0.35"/><stop offset="100%" stop-color="#1f2a48" stop-opacity="0.0"/></radialGradient></defs><circle cx="400" cy="130" r="70" fill="url(#g1)"/></svg>
  </div>
</header>

<main class="container">

  <div id="globalNotice" class="notice hidden" role="alert"></div>

  <!-- ุงูุฎุทูุฉ 1 -->
  <section id="step1" class="card center">
    <h2>ุฃุฏุฎู ุจูุงูุงุชู ูุจุฏุก ุงููุฑุงุกุฉ</h2>
    <div class="grid" style="max-width:760px; margin:10px auto 0;">
      <div>
        <label for="gender">ุงูุฌูุณ</label>
        <select id="gender" required><option value="">ุงุฎุชุฑ</option><option>ุฐูุฑ</option><option>ุฃูุซู</option></select>
        <div class="notice hidden" id="e_gender">ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ุงูุฌูุณ.</div>
      </div>
      <div>
        <label for="status">ุงูุญุงูุฉ ุงูุงุฌุชูุงุนูุฉ</label>
        <select id="status" required>
          <option value="">ุงุฎุชุฑ</option>
          <option>ุฃุนุฒุจ/ุนุฒุจุงุก</option><option>ูุชุฒูุฌ/ูุชุฒูุฌุฉ</option>
          <option>ูููุตู/ูููุตูุฉ</option><option>ูุฎุทูุจ/ูุฎุทูุจุฉ</option>
        </select>
        <div class="notice hidden" id="e_status">ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ุงูุญุงูุฉ ุงูุงุฌุชูุงุนูุฉ.</div>
      </div>
      <div>
        <label for="work">ุงููุถุน ุงููููู</label>
        <select id="work" required>
          <option value="">ุงุฎุชุฑ</option>
          <option>ุฃุนูู</option><option>ุนุงุทู</option><option>ุทุงูุจ</option>
        </select>
        <div class="notice hidden" id="e_work">ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ุงููุถุน ุงููููู.</div>
      </div>
      <div>
        <label for="birthdate">ุชุงุฑูุฎ ุงููููุงุฏ</label>
        <input id="birthdate" type="date" required>
        <div class="notice hidden" id="e_birthdate">ุงูุฑุฌุงุก ุฅุฏุฎุงู ุชุงุฑูุฎ ุงููููุงุฏ.</div>
      </div>
    </div>
    <div style="margin-top:16px;">
      <button class="btn" id="startBtn" style="min-width:220px">ุงุจุฏุฃ ุงููุฑุงุกุฉ</button>
    </div>
    <div class="quota" id="quotaInfo"></div>
  </section>

  <!-- ุงูุชุธุงุฑ -->
  <section id="stepLoading" class="card hidden center" aria-live="polite">
    <div class="ring-wrap"><div class="ring" aria-hidden="true"></div></div>
    <h2>ุฌุงุฑู ุงูุงุณุชุจุตุงุฑโฆ</h2>
    <p class="muted">ุซูุงูู ููููุฉ ูุชุธูุฑ ุงููุจูุกุฉ.</p>
  </section>

  <!-- ุงุฎุชูุงุฑ ุงูููุถูุน -->
  <section id="stepTopics" class="card hidden center">
    <h2>ุงุฎุชุฑ ููุถูุน ูุฑุงุกุชู</h2>
    <div id="zodiacBadge" style="margin:8px 0 14px"></div>
    <div class="topic-grid" style="max-width:820px; margin:10px auto 0;">
      <button class="topic" data-topic="love">ุงูุญุจ โค๏ธ<span>ุงูุนูุงูุฉุ ุงูุชูุงููุ ุงููุตุงูุญุฉ</span></button>
      <button class="topic" data-topic="health">ุงูุตุญุฉ ๐<span>ุงููููุ ุงูุทุงูุฉุ ุงูุฅููุงุน</span></button>
      <button class="topic" data-topic="career">ุงููููุฉ ูุงููุงู ๐ผ<span>ุงููุฑุตุ ุงููุฑุงุฑุงุชุ ุงูููู</span></button>
      <button class="topic" data-topic="general">ุนุงู / ุฏุฑุงุณู โจ<span>ุจูุตูุชู ููุฐุง ุงูุฃุณุจูุน</span></button>
    </div>
    <div class="quota" id="quotaInfoTopics"></div>
  </section>

  <!-- ุงููุชูุฌุฉ -->
  <section id="stepResult" class="card hidden">
    <div style="display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap">
      <h2 id="resultTitle" style="margin:0">ุงูุฅุดุงุฑุงุช ุงูุธุงูุฑุฉ</h2>
      <div class="chip" id="userEcho"><span class="z-emoji" id="zEmoji">โ</span><span id="zName">โ</span></div>
    </div>
    <article id="resultText" class="result" style="margin-top:10px"></article>
    <p id="omen" class="muted" style="margin-top:12px; font-size:15px"></p>

    <div style="display:flex; gap:10px; margin-top:16px; flex-wrap:wrap; justify-content:center">
      <button class="ghost" id="topicsBtn">ุงุฎุชูุงุฑ ููุถูุน ุขุฎุฑ</button>
      <button class="ghost" id="restartBtn">ุฅุนุงุฏุฉ ุงูุจุฏุก</button>
      <button class="btn" id="printBtn" title="ุชุญููู PDF">ุชุญููู PDF</button>
    </div>
    <div class="quota" id="quotaInfoResult" style="margin-top:10px"></div>
  </section>

</main>

<footer>
  <div>ยฉ <span id="year"></span> ุงูุฃุจุฑุงุฌ ูุงูุงุณุชุจุตุงุฑ</div>
</footer>

<!-- ูุงูุฐุฉ ุงูุญุฏ ุงููููู -->
<div class="overlay" id="overlayLimit" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,.7); justify-content:center; align-items:center; z-index:20">
  <div class="modal" style="background:var(--card); border:1px solid var(--stroke); border-radius:14px; padding:18px; max-width:520px; margin:16px; text-align:center">
    <h3 style="color:var(--brand); margin-top:0">ูุตูุช ุฅูู ุงูุญุฏ ุงููููู</h3>
    <p>ุงููุชุงุญ: <strong>15 ูุฑุงุกุฉ</strong> ูู 24 ุณุงุนุฉ.</p>
    <p class="quota"><span id="countdown">00:00:00</span> ุญุชู ุงูุชุฌุฏูุฏ</p>
    <div class="actions" style="display:flex; gap:10px; justify-content:center; margin-top:10px">
      <button class="ghost" id="closeLimit">ุญุณููุง</button>
    </div>
  </div>
</div>

<!-- ูุงูุจ PDF -->
<div id="printDoc" aria-hidden="true">
  <div class="paper">
    <h1>ุงูุฃุจุฑุงุฌ ูุงูุงุณุชุจุตุงุฑ</h1>
    <h2>ูุฑุงุกุฉ ุงูุทุงูุน ุงูุนูููุฉ</h2>
    <div class="meta" id="printMeta"></div>
    <div class="reading" id="printReading"></div>
    <div class="brandline">โ ูุณุชุฎุฑุฌ ุขูู ูู ุตูุญุฉ ุงูุงุณุชุจุตุงุฑ โ</div>
  </div>
</div>

<script>
  /* ุณูุฉ ุงูููุชุฑ */
  document.getElementById("year").textContent = new Date().getFullYear();

  const $ = s=>document.querySelector(s);

  /* ูุทุงูุงุช ุงูุฃุจุฑุงุฌ */
  const ZODIAC = [
    {name:"ุงูุญูู",   emoji:"โ๏ธ", from:[3,21],  to:[4,19]},
    {name:"ุงูุซูุฑ",   emoji:"โ๏ธ", from:[4,20],  to:[5,20]},
    {name:"ุงูุฌูุฒุงุก", emoji:"โ๏ธ", from:[5,21],  to:[6,20]},
    {name:"ุงูุณุฑุทุงู", emoji:"โ๏ธ", from:[6,21],  to:[7,22]},
    {name:"ุงูุฃุณุฏ",   emoji:"โ๏ธ", from:[7,23],  to:[8,22]},
    {name:"ุงูุนุฐุฑุงุก", emoji:"โ๏ธ", from:[8,23],  to:[9,22]},
    {name:"ุงูููุฒุงู", emoji:"โ๏ธ", from:[9,23],  to:[10,22]},
    {name:"ุงูุนูุฑุจ",  emoji:"โ๏ธ", from:[10,23], to:[11,21]},
    {name:"ุงูููุณ",   emoji:"โ๏ธ", from:[11,22], to:[12,21]},
    {name:"ุงูุฌุฏู",   emoji:"โ๏ธ", from:[12,22], to:[1,19]},
    {name:"ุงูุฏูู",   emoji:"โ๏ธ", from:[1,20],  to:[2,18]},
    {name:"ุงูุญูุช",   emoji:"โ๏ธ", from:[2,19],  to:[3,20]}
  ];
  function getZodiac(dt){
    if(!dt) return {name:"โ", emoji:"โ"};
    const d=new Date(dt); if(isNaN(d)) return {name:"โ", emoji:"โ"};
    const m=d.getMonth()+1, day=d.getDate();
    for(const z of ZODIAC){
      const [fm,fd]=z.from,[tm,td]=z.to;
      const inSame=(m===fm && day>=fd)||(m===tm && day<=td);
      const inWrap=(fm>tm)&&((m===fm && day>=fd)||(m===tm && day<=td)||(m>fm || m<tm));
      if((fm<tm && inSame)||(fm>tm && inWrap)) return z;
    } return {name:"โ", emoji:"โ"};
  }

  /* ุฎุงูุงุช ูุจูุฆูุฉ ุฃูููุฉ (ูุง ุฑููุฒ ุชูููุฉ) */
  const LUCKY_COLORS = ["ุงูุฃุฒุฑู ุงููููู","ุงูุฃุฎุถุฑ ุงูุฒูุฑุฏู","ุงูุนููุงุจู","ุงูุฐูุจู","ุงูุฑูุงุฏู ุงูุฏุงูุฆ","ุงูุชุฑููุงุฒ"];
  const LUCKY_SLOTS  = ["ุจูู ุงูุชุงุณุนุฉ ูุงูุญุงุฏูุฉ ุนุดุฑุฉ ุตุจุงุญูุง","ุนูุฏ ุงูุบุฑูุจ","ุจุนุฏ ุงูุธูุฑ ูุจุงุดุฑุฉ","ููููุง ูุจู ููุชุตู ุงูููู","ูู ุฃูู ุณุงุนุฉ ูู ุงูููู"];
  function pick(a){ return a[Math.floor(Math.random()*a.length)]; }

  const DESCRIPTORS = [
    "ุตุฑูุญ ูุฎูุท ุงููุฏ ุจุงููุตูุญุฉ","ูุงุฏุฆ ุซู ุญุงุฏู ุนูุฏ ุงููุฑุงุฑ","ูุคุฌูู ูุซูุฑูุง ููุทูุจ ุฃุนุฐุงุฑูุง ุทูููุฉ",
    "ูุซูุฑ ุงูููุงู ูููู ุงููุนู","ููุทูู ูููู ุจุงุฑุฏ","ุนููู ูุฏุนูู ุจุงููุนู ูุง ุจุงููุนุฏ"
  ];

  const TEMPLATES = {
    love: [
      "ุงูููุจ ููุณุชุฏุนู ุงูููู ุฅูู ุงุฎุชุจุงุฑ ูุถุฌ. ุงููุนู ุงูููุฑุฑ ูุซุจุช ูุง ูุนุฌุฒ ุนูู ุงูููุงู. ุฎูุงู ุงุซูุชูู ูุณุจุนูู ุณุงุนุฉ ูุธูุฑ ุซุจุงุช ุดุฎุตู ูุงุญุฏ ุจูุถูุญ.",
      "ุจุงุจ ูุตุงูุญุฉ ูุงุจู ูููุชุญ ุจุฌููุฉ ูุตูุฑุฉ ูุญุฏุฏุฉ. ูุง ุชูุทูู ุงูุดุฑุญุ ูู ูุง ููุฒู ูุงุชุฑู ุงูุจุงุจ ูุนูู ุนููู.",
      "ุดุจุญ ุบูุฑุฉ ููุชุฑุจ ุนุจุฑ ุทุฑูู ุซุงูุซ. ุฃุญุท ุญุฏูุฏู ุจุงููุฏูุก ูุง ุจุงูุงููุนุงูุ ูุงูุญุฏูุฏ ุงููุงุถุญุฉ ุฃูุงู ูุง ูุณูุฉ.",
      "ููุงุก ุนุงุจุฑ ูููุธ ููุฑุฉ ูุฏููุฉุ ูููู ูุญุชุงุฌ ุฏููููุง ุนูู ุงูุงุณุชูุฑุงุฑูุฉ ูุจู ุฃู ุชูุทูู ุงุณููุง."
    ],
    career: [
      "ูุงูุฐุฉ ุนูู ูุตูุฑุฉ ุงูููุฌ ููููุง ุญุงุณูุฉ. ุฃูุฌุฒ ูู ููุณ ุงูููู ุฎุทูุฉ ููููุณุฉุ ูุงูุฃุซุฑ ุงูุฃูู ูุณุจู ุงูุณูุนุฉ.",
      "ุณุทุฑ ุฏููู ูู ูุฑูุฉ ูุจูุฑุฉ ูุฎุชุจุฆ ูู ุงูุนูู. ูุฑุงุฌุนุชู ุงูุขู ุชููุน ุชุฃุฎูุฑูุง ูุฒุนุฌูุง ูุงุญููุง.",
      "ูุฑุตุฉ ุฌุงูุจูุฉ ุชูุจุฑ ุจูุง ุถุฌูุฌ. ุงุจุฏุฃ ุตุบูุฑูุงุ ุซุจูุช ุงูุฌูุฏุฉุ ุซู ูุณูุน ุญูู ูููู ุงูููุฒุงู ุฅููู.",
      "ุดุฑูู ูุญุชูู ูุจุฏู ูุงูุนูุง ูููู ูุบุทู ุงูุชูุงุตูู. ุฃุฎุฑุฌ ุงูุจููุฏ ุฅูู ุงูุถูุก ูุจู ุฃู ุชูููุน."
    ],
    health: [
      "ุงูููู ููุนุงุฏ ุถุจุทู ุญูู ูุฎู ุงูุถูุก ุณุงุนุฉ ูุงููุฉ ูุจู ุงูููุนุฏ. ุตูุงุก ุงูุฐูู ูุฑุชูุน ุชุฏุฑูุฌููุง ุฎูุงู ููููู.",
      "ุชูุชูุฑ ุงูุธูุฑ ูุงููุชููู ุฅูุฐุงุฑ ูุจูุฑ. ุฏูููุฉ ุชูุฏูุฏ ุจูู ุงููููุงุช ุชููุน ูุฌุนูุง ูุชุฑุงูููุง.",
      "ุงููุงุก ููููุฏ ุงูุทุฑููุ ูุงููุดู ุงููุงุฏุฆ ูููู ุดุชุงุช ุงูุชุฑููุฒ ูุจููุฉ ุงูุฃุณุจูุน.",
      "ุงุจุชุนุฏ ุงูููู ุนู ุงูุถุฌูุฌ ุงูุงุฌุชูุงุนูุ ูุซูู ุงูููุงู ูุณุชููู ุทุงูุชู ุฃูุซุฑ ููุง ุชุชููุน."
    ],
    general: [
      "ุฎุจุฑ ุณุงุฑ ููุชุฑุจ ุจุฎุทูุงุช ูุตูุฑุฉ ูุฃูู ูุนููุถ ุทูู ุงูุงูุชุธุงุฑ. ูุง ุชุชุฑุงุฌุน ุนูุฏ ุงูุจุงุจ ุงูุฃุฎูุฑ.",
      "ุฑุณุงูุฉ ููุชุถุจุฉ ุชุบููุฑ ุงุชุฌุงู ุงูุฃุณุจูุน. ุญูู ูุฃุชู ุงูุฅููุงูุ ุงูุชุจ ูุงุฑุณูู ูู ููุณ ุงููุญุธุฉ.",
      "ูุจูุบ ูุชูุณุท ูุธูุฑ ุจูุง ููุนุงุฏ ููุณุฏู ุซุบุฑุฉ ูุฏููุฉ. ูุง ุชูุณุฑู ุจุนุฏู ุจููููู.",
      "ุดุฎุต ูุฎุชุจุฑ ุญุฏูุฏู ุจูุฏูุก. ุงูุตุฑุงูุฉ ุงููุทููุฉ ูู ุฏุฑุนู ุงูููู."
    ]
  };

  function bank(topic){
    const base=TEMPLATES[topic]||TEMPLATES.general, list=[];
    let id=1;
    for(const t of base){
      const d = t.replace("{desc}", pick(DESCRIPTORS));
      list.push({id:`${topic}-${id++}`, text:d});
      list.push({id:`${topic}-${id++}`, text:d}); // ุฒูุงุฏุฉ ุชูููุน ูุน ุฎูุท ูุงุญู
    }
    while(list.length<24){ list.push({id:`${topic}-${id++}`,text:pick(base)}); }
    return list.sort(()=>Math.random()-0.5).slice(0,24);
  }

  const BANK = {
    love: bank("love"),
    career: bank("career"),
    health: bank("health"),
    general: bank("general")
  };

  /* ุญูุธ/ุชุญููู */
  function saveForm(){ localStorage.setItem("istibsar_form", JSON.stringify({
    gender: $("#gender").value||"", status: $("#status").value||"", work: $("#work").value||"", birthdate: $("#birthdate").value||""
  })); }
  function loadForm(){ try{ const d=JSON.parse(localStorage.getItem("istibsar_form")||"{}");
    if(d.gender) $("#gender").value=d.gender; if(d.status) $("#status").value=d.status;
    if(d.work) $("#work").value=d.work; if(d.birthdate) $("#birthdate").value=d.birthdate;
  }catch(e){} }

  ["gender","status","work","birthdate"].forEach(id=>{
    const el=$("#"+id);
    el.addEventListener("input", saveForm);
    el.addEventListener("change", ()=>{ saveForm(); if(id==="birthdate") updateZodiacUI(); });
  });

  let currentSign={name:"โ", emoji:"โ"};
  function updateZodiacUI(){
    const bd=$("#birthdate").value; currentSign=getZodiac(bd);
    $("#zodiacBadge").innerHTML=`<div class="chip"><span class="z-emoji">${currentSign.emoji}</span><span>ุจุฑุฌู: ${currentSign.name}</span></div>`;
    $("#zEmoji").textContent=currentSign.emoji; $("#zName").textContent=currentSign.name;
  }

  /* ููุชุง */
  const MAX_READS=15;
  function getQuota(){ const raw=localStorage.getItem("istibsar_quota"), now=Date.now(); if(!raw) return {count:0, resetAt:null};
    try{ const q=JSON.parse(raw); if(q.resetAt && now>q.resetAt) return {count:0, resetAt:null}; return q; }catch(e){ return {count:0, resetAt:null}; } }
  function setQuota(q){ localStorage.setItem("istibsar_quota", JSON.stringify(q)); }
  function incQuota(){ const q=getQuota(); const now=Date.now(); const resetAt=q.resetAt||(now+24*60*60*1000); const next={count:(q.count||0)+1, resetAt}; setQuota(next); return next; }
  function remainingQuota(){ const q=getQuota(); return Math.max(0, MAX_READS-(q.count||0)); }
  function fmtRemaining(ms){ if(ms<=0) return "00:00:00"; const s=Math.floor(ms/1000), h=String(Math.floor(s/3600)).padStart(2,"0"), m=String(Math.floor((s%3600)/60)).padStart(2,"0"), sc=String(s%60).padStart(2,"0"); return `${h}:${m}:${sc}`; }
  function updateQuotaUI(){ const rem=remainingQuota(); const q=getQuota(); const base=`ุงููุชุจูู ุงูููู: ${rem} / ${MAX_READS}`+(q.resetAt?` โ ุชุฌุฏูุฏ ุฎูุงู ${fmtRemaining(q.resetAt - Date.now())}`:""); ["quotaInfo","quotaInfoTopics","quotaInfoResult"].forEach(id=>{ const el=document.getElementById(id); if(el) el.textContent=base; }); }
  function showLimitOverlay(){ const q=getQuota(); if(!q.resetAt) return; document.getElementById("overlayLimit").style.display="flex"; (function tick(){ const left=q.resetAt-Date.now(); document.getElementById("countdown").textContent=fmtRemaining(left); if(left<=0){ document.getElementById("overlayLimit").style.display="none"; setQuota({count:0, resetAt:null}); updateQuotaUI(); } else { requestAnimationFrame(tick); } })(); }

  /* ุฅุดุนุงุฑ */
  function showGlobal(msg, ok=false){
    const n=$("#globalNotice"); n.textContent=msg; n.classList.toggle("ok", ok); n.classList.remove("hidden");
    setTimeout(()=>{ n.classList.add("hidden"); n.classList.remove("ok"); }, 3200);
  }

  /* ุชุญูู ุงูุฅุฏุฎุงู */
  function validateForm(){
    let ok=true; const g=$("#gender").value.trim(), s=$("#status").value.trim(), w=$("#work").value.trim(), b=$("#birthdate").value.trim();
    ["e_gender","e_status","e_work","e_birthdate"].forEach(id=>$("#"+id).classList.add("hidden"));
    if(!g){ $("#e_gender").classList.remove("hidden"); ok=false; }
    if(!s){ $("#e_status").classList.remove("hidden"); ok=false; }
    if(!w){ $("#e_work").classList.remove("hidden"); ok=false; }
    if(!b){ $("#e_birthdate").classList.remove("hidden"); ok=false; }
    if(!ok){ showGlobal("ุฃููู ุงูุจูุงูุงุช ูููุชุงุจุนุฉ."); }
    return ok;
  }

  /* ููุน ุงูุชูุฑุงุฑ */
  function userKey(){
    const form = JSON.stringify({g:$("#gender").value||"", s:$("#status").value||"", w:$("#work").value||"", b:$("#birthdate").value||""});
    let h=2166136261>>>0; for(let i=0;i<form.length;i++){ h^=form.charCodeAt(i); h=Math.imul(h,16777619); }
    return h.toString(16);
  }
  function getUsed(topic){
    const key = `istibsar_used_${userKey()}_${topic}`;
    try{ return new Set(JSON.parse(localStorage.getItem(key) || "[]")); }catch(_){ return new Set(); }
  }
  function addUsed(topic, id){
    const key = `istibsar_used_${userKey()}_${topic}`;
    const s = getUsed(topic); s.add(id);
    localStorage.setItem(key, JSON.stringify([...s]));
  }
  function pickVariant(topic){
    const list = BANK[topic] || BANK.general;
    const used = getUsed(topic);
    const pool = list.filter(v=> !used.has(v.id));
    if(pool.length===0){ localStorage.removeItem(`istibsar_used_${userKey()}_${topic}`); return list[Math.floor(Math.random()*list.length)]; }
    return pool[Math.floor(Math.random()*pool.length)];
  }

  /* ุชูุฑูุนุงุช ุญุณุจ ุงูุญุงูุฉ (ุจุฃุณููุจ ุนุฑูุงู) */
  function loveBranch(status){
    const map = {
      "ูุชุฒูุฌ/ูุชุฒูุฌุฉ": [
        "ูุฑุงุฑ ูุงุถุญ ููููู ุงูุชุฐุจุฐุจ ุงููุตูุฑ. ุญุฏูุฏ ุดุฑุทูุง ูุงุญุฏูุง ูุงูุชุฒู ุจูุ ูุณุชุธูุฑ ุงูุงุณุชุฌุงุจุฉ ูุจู ูุณุงุก ุงูููู ุงูุซุงูุซ.",
        "ุดุฎุต ุซุงูุซ ููุชุฑุจ ุจูุจุงูุฉ. ุฃุบูู ุซุบูุฑ ุงูุฎุตูุตูุฉุ ูุฅูุง ุฎุฑุฌ ุงูุญุฏูุซ ูู ุงููุฏ.",
        "ุฌูุณุฉ ูุตุงุฑุญุฉ ุจูุง ููุงุทุนุงุช ุชููุธูู ูจููช ูู ุณูุก ุงูููู ุงูุญุงูู."
      ],
      "ูุฎุทูุจ/ูุฎุทูุจุฉ": [
        "ุงุชูุงู ุนููู ุนูู ุงููุงู ูุงูููุช ูุญุณู ุงูุชุฑุฏุฏ ูููุณุฑูุน ุงูุฎุทูุฉ ุงูุฑุณููุฉ.",
        "ุบูุฑุฉ ุฎูููุฉ ูู ุทุฑู ูุฑูุจุ ูุง ุชูุณุฑู ูู ุงูุชูุงุตูู ุงูุขู.",
        "ููุนุฏ ูุงุญุฏ ูุญุณูุจ ููุดู ุฌุฏููุฉ ุงูุทุฑู ุงูุขุฎุฑ ููุฑูุง."
      ],
      "ุฃุนุฒุจ/ุนุฒุจุงุก": [
        "ูุงูุฐุฉ ุชุนุงุฑู ูุฑูุจุฉ ุนุจุฑ ุณูุงู ูููู ุฃู ุฏุฑุงุณู. ูุง ุชุนูุฏ ุณุฑูุนูุงุ ุฑุงูุจ ุงูุซุจุงุช ุฃุณุจูุนูุง.",
        "ุงูุฌุฐุงุจ ุณุฑูุน ูุดุฎุต ุตุฑูุญ ูุฎูุท ุงููุฏ ุจุงููุตูุญุฉ. ุงุฎุชุจุฑู ุจุณุคุงููู ูุญุฏูุฏูู ุซู ูุฑูุฑ.",
        "ุฑุณุงูุฉ ูุตูุฑุฉ ุณุชูุชุญ ุจุงุจ ุญุฏูุซ ุฌุฏูุฏุ ุฑุฏูู ุงูุณุฑูุน ูุตูุน ุงููุชูุฌุฉ."
      ],
      "ูููุตู/ูููุตูุฉ": [
        "ูุฐู ุงูุฃูุงู ุชุตูุญ ูุฅุบูุงู ูุธูู. ูุง ุชุนุฏ ูุฃุณุฆูุฉ ุจูุง ุฌูุงุจ.",
        "ูุฌู ูุงุฏุฆ ูุฏุฎู ุจุชูุตูุฉ ุตุฏูู. ุงููุญ ุงูุชุฌุฑุจุฉ ูุณุงุญุฉ ูุตูุฑุฉ ููุท.",
        "ุงูุญููู ูุฌููู ุงููุฏูู. ุงูุฒู ุงูููุงุฆุน ูุงุชุฑู ุงููุฒุงุฌ ููููุช."
      ]
    };
    return map[status] || map["ุฃุนุฒุจ/ุนุฒุจุงุก"];
  }

  function careerBranch(work){
    const map = {
      "ุฃุนูู": [
        "ูููุฉ ูุตูุฑุฉ ุงูููุนุฏ ุชูุธูุฑ ุงุณูู ูู ุงูููุงู ุงูุตุญูุญ. ุฃูุฌุฒ ูุณูุฏุฉ ุงููููุ ููุง ุชุคุฌูู.",
        "ุณุทุฑ ุตุบูุฑ ูู ุนูุฏ ุฃู ุฑุณุงูุฉ ูุญุชุงุฌ ูุฑุงุกุฉ ุซุงููุฉ. ููุฏูู ููุชูุง ููุงููุง ูุงุญููุง.",
        "ุฃุซุฑ ุนูู ูุฏูู ูุนูุฏ ุจุชูุตูุฉ ูุงุถุญุฉ. ุงููุชุงุจุนุฉ ุงูุณุฑูุนุฉ ุชููู ุงูุฏุงุฆุฑุฉ."
      ],
      "ุนุงุทู": [
        "ูุณุงุฑุงู ุงูููู: ููุงุฑุฉ ุตุบูุฑุฉ ุชูุตูุน ูู ุณุงุนุฉุ ูุฑุณุงูุฉ ููุฌููุฉ ุฅูู ุฌูุฉ ูุญุฏุฏุฉ.",
        "ุดุจูุฉ ูุฑูุจุฉ ุชูุฏูู ุจุงุจูุง ูุงุญุฏูุง ูุนูุงููุง. ุชุญุฏูุซ ูุจู ุฃู ุชูุฑุณู ุงูุณูุฑุฉ.",
        "ุงูุงูุชุธุงุฑ ุงูุตุงูุช ููุฏู ุงููุชุฑุฉ. ูุจูุฑ ูุชุงุฆุฌ ุตุบูุฑุฉ ููููุฉุ ูุณุชุฒุญู ุงูุญุธูุธ."
      ],
      "ุทุงูุจ": [
        "ุฌูุณุฉ ุชุฑููุฒ ุฎูุณูู ุฏูููุฉ ุชุชุจุนูุง ูุฑุงุฌุนุฉ ุนุดุฑ ุฏูุงุฆู ุชุฑูุน ุงูุฏุฑุฌุฉ ูู ุงูุงูุชุญุงู ุงููุงุฏู.",
        "ูุดุฑูุน ูุตูุฑ ูุณุจู ุงูุงูุชุญุงู ูุนููุถ ุชุฐุจุฐุจูุง ุณุงุจููุง ูููุธูุฑ ุฌุฏูุชู.",
        "ุฒููู ูุซูุฑ ุงูููุงู ูููู ุงููุนู ูุญุงูู ุชุดุชูุชู. ุงูุฒู ุฌุฏููู ุงูููุชูุจ."
      ]
    };
    return map[work] || map["ุฃุนูู"];
  }

  function composeReading(topic){
    const main = pickVariant(topic); addUsed(topic, main.id);
    const blocks = [];
    const lucky = `ููู ุงูุญุธ: ${pick(LUCKY_COLORS)}. ูุงูุฐุฉ ููููุฉ: ${pick(LUCKY_SLOTS)}. ุฑูู ุจุงุฑุฒ ุงูููู: ${Math.floor(3+Math.random()*7)}.`;

    // ุงูุชุชุงุญูุฉ ุญุงุณูุฉ
    blocks.push(`<p class="lead">${main.text}</p>`);

    const status = ($("#status").value || "").trim();
    const work   = ($("#work").value   || "").trim();

    if(topic==="love"){
      const b = loveBranch(status);
      const a = pick(b); let c; do{ c=pick(b); }while(c===a);
      blocks.push(`<p>${a}</p>`, `<p>${c}</p>`);
      blocks.push(`<p><strong>ุชุญุฐูุฑ ูุจุงุดุฑ:</strong> ูุง ุชููุญ ุณุฑููุง ุดุฎุตูููุง ููู ูุง ููุฏูู ูุนููุง ูุงุถุญูุง. ุงุฎุชุจุฑ ููุง ุชุชุนูู.</p>`);
    }
    if(topic==="career"){
      const b = careerBranch(work);
      const a = pick(b); let c; do{ c=pick(b); }while(c===a);
      blocks.push(`<p>${a}</p>`, `<p>${c}</p>`);
      blocks.push(`<p><strong>ุชุญุฐูุฑ ูููู:</strong> ุฑููู ุตุบูุฑ ูู ูุณุชูุฏ ูุจูุฑ ููุฑูุฑ ูุชูุฌุฉ ุฃุณุจูุน ูุงูู. ุฑุงุฌุนู ูุจู ุงูุฎููุณ.</p>`);
    }
    if(topic==="health"){
      const pack = TEMPLATES.health;
      const a = pick(pack); let c; do{ c=pick(pack); }while(c===a);
      blocks.push(`<p>${a}</p>`, `<p>${c}</p>`);
      blocks.push(`<p><strong>ุชูุจูู:</strong> ูููู ุงูุญุฏูุซ ุงูุซููู ุจุนุฏ ุงููุบูุจุ ููุจุท ุงูููู ููุตุนุฏ ุงูุตุฏุงุน.</p>`);
    }
    if(topic==="general"){
      const pack = TEMPLATES.general;
      const a = pick(pack); let c; do{ c=pick(pack); }while(c===a);
      blocks.push(`<p>${a}</p>`, `<p>${c}</p>`);
      blocks.push(`<p><strong>ุจูุตูุฉ ุงูุฃุณุจูุน:</strong> ุงูุชุจ ุงููุฑุงุฑ ูู ุณุทุฑูู ูุฎุฐ ุฎุทูุฉ ูุงุญุฏุฉ ุงูุขู.</p>`);
    }

    // ุณุทุฑ ุญุธ ุฃููู
    blocks.push(`<p class="muted">${lucky}</p>`);
    return blocks.join("");
  }

  /* ูุงุฌูุฉ */
  function echoUser(){
    const g=$("#gender").value||"โ", s=$("#status").value||"โ", w=$("#work").value||"โ", b=$("#birthdate").value||"โ";
    $("#userEcho").innerHTML=`<span class="z-emoji">${currentSign.emoji}</span> ${currentSign.name} โข ${g} โข ${s} โข ${w} โข ${b}`;
  }
  function show(el){ el.classList.remove("hidden"); }
  function hide(el){ el.classList.add("hidden"); }

  function startFlow(){
    if(!validateForm()) return;
    hide($("#step1")); show($("#stepLoading"));
    setTimeout(()=>{ hide($("#stepLoading")); show($("#stepTopics")); updateZodiacUI(); updateQuotaUI(); }, 700);
  }

  function runTopic(topic){
    if(remainingQuota()<=0){ updateQuotaUI(); showLimitOverlay(); return; }
    hide($("#stepTopics")); show($("#stepLoading"));
    setTimeout(()=>{
      hide($("#stepLoading")); show($("#stepResult"));
      incQuota(); updateQuotaUI(); echoUser();
      const titleMap = {love:"ูุฑุงุกุฉ ุงูุญุจ", health:"ูุฑุงุกุฉ ุงูุตุญุฉ", career:"ูุฑุงุกุฉ ุงููููุฉ ูุงููุงู", general:"ูุฑุงุกุฉ ุนุงูุฉ/ุฏุฑุงุณูุฉ"};
      document.getElementById("resultTitle").textContent = titleMap[topic] || "ุงูุฅุดุงุฑุงุช ุงูุธุงูุฑุฉ";
      document.getElementById("resultText").innerHTML = composeReading(topic);
      document.getElementById("omen").textContent =
        ["ุชูููุช ุงูุฑุฏ ูุตู ุงููููู. ูุง ุชุคุฌู ุงูููู.","ุฎุทูุฉ ุตุบูุฑุฉ ุงูุขู ุชุณุฑูุน ุฎุจุฑูุง ููุชุธุฑูุง.","ูุถูุญู ูุญุณู ุงูุทุฑููุ ูุงูุบููุถ ูุทููู."][Math.floor(Math.random()*3)];
    }, 650);
  }

  document.getElementById("startBtn").addEventListener("click", startFlow);
  document.querySelectorAll(".topic").forEach(btn=> btn.addEventListener("click", ()=> runTopic(btn.dataset.topic)));
  document.getElementById("topicsBtn").addEventListener("click", ()=>{ hide($("#stepResult")); show($("#stepTopics")); updateQuotaUI(); });
  document.getElementById("restartBtn").addEventListener("click", ()=>{ hide($("#stepResult")); hide($("#stepTopics")); show($("#step1")); window.scrollTo({top:0, behavior:"smooth"}); updateQuotaUI(); });

  /* PDF */
  function buildPrintDoc(){
    const meta=document.getElementById("printMeta"), reading=document.getElementById("printReading");
    const g=$("#gender").value||"โ", s=$("#status").value||"โ", w=$("#work").value||"โ", b=$("#birthdate").value||"โ";
    const now=new Date(); const when=now.toLocaleString('ar', {hour12:false});
    meta.innerHTML = `
      <div>ุงูุจุฑุฌ: ${currentSign.emoji} ${currentSign.name}</div>
      <div>ุงูุฌูุณ: ${g}</div>
      <div>ุงูุญุงูุฉ ุงูุงุฌุชูุงุนูุฉ: ${s}</div>
      <div>ุงููุถุน ุงููููู: ${w}</div>
      <div>ุชุงุฑูุฎ ุงููููุงุฏ: ${b}</div>
      <div>ุชุงุฑูุฎ ุงูุฅุตุฏุงุฑ: ${when}</div>
    `;
    reading.innerHTML = document.getElementById("resultText").innerHTML;
  }
  document.getElementById("printBtn").addEventListener("click", ()=>{
    if(document.getElementById("stepResult").classList.contains("hidden")){ showGlobal("ุฃููู ุงููุฑุงุกุฉ ุฃูููุง ุซู ุญููู PDF."); return; }
    buildPrintDoc(); window.print();
  });

  /* ุชููุฆุฉ */
  (function init(){
    updateZodiacUI(); loadForm(); updateZodiacUI(); updateQuotaUI();
  })();
</script>
</body>
</html>
