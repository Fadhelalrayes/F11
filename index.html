<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Ø§Ù„Ø®Ø³ÙˆÙ ÙˆØ§Ù„ÙƒØ³ÙˆÙ â€“ Ø§Ù„ØªÙ‚Ø§ÙˆÙŠÙ… ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù…</title>
<link href="https://fonts.googleapis.com/css2?family=Reem+Kufi:wght@600&family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root{
    /* Ù„ÙˆØ­Ø© Ø£Ø®Ø¶Ø± Ù…Ø°Ù‡Ø¨ ÙØ§ØªØ­ */
    --ink:#062b22;
    --muted:#5f6b63;
    --bg:#f7faf8;
    --border:#e6efe6;
    --accent:#0ea55a;
    --gold:#c9a44b;
    --shadow:0 10px 24px rgba(6,43,34,.08);
    --box-grad:linear-gradient(135deg,#f3fff6 0%,#f9fff2 45%,#fffdf5 100%);
    --chip-grad:linear-gradient(135deg,#f1fff7,#fffef6);
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);font-family:"Tajawal",sans-serif;color:var(--ink);padding:16px;}
  .container{width:min(1100px,100%);margin:auto;display:flex;flex-direction:column;gap:16px}

  .topClock{display:flex;justify-content:space-between;align-items:center;font-size:.95rem;font-weight:800;color:#0b4d2e}
  .brand{font-family:"Reem Kufi",sans-serif;color:var(--gold)}

  .hero{background:#fff;border:1px solid var(--border);border-radius:18px;box-shadow:var(--shadow);padding:18px;text-align:center;background-image:var(--box-grad)}
  .heroTitle{margin:0;font-family:"Reem Kufi",sans-serif;font-size:1.5rem;color:#0a3d2a}

  .locationBox{background:#fff;border:1px solid var(--border);border-radius:14px;box-shadow:var(--shadow);padding:12px 14px;display:flex;justify-content:space-between;align-items:center}
  .place{font-weight:900}
  .changeBtn{background:#f3fff7;border:1px solid var(--border);padding:6px 12px;border-radius:999px;font-weight:800;cursor:pointer}

  /* ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø­Ø¯Ø« Ø§Ù„Ù‚Ø§Ø¯Ù… (ÙØ§Ø®Ø±) */
  .nextBox{background:#fff;border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow);padding:16px;display:grid;gap:10px;position:relative;overflow:hidden}
  .nextBox:before{content:"";position:absolute;inset:-30% -30% auto auto;width:240px;height:240px;background:radial-gradient(closest-side,#e9fced,transparent 70%);transform:rotate(25deg)}
  .nextHdr{display:flex;justify-content:center;gap:8px;align-items:center}
  .chipGold{border:1px solid #eadcba;background:linear-gradient(135deg,#fffaf0,#fff);color:#8a6a11;padding:6px 12px;border-radius:999px;font-weight:900;font-size:.9rem}
  .nextTitle{font-weight:900;color:#0b3b2f;text-align:center}
  .nextRow{display:flex;justify-content:space-between;align-items:center;font-weight:800}
  .nextName{font-size:1.05rem}
  .nextAt{font-variant-numeric:tabular-nums}
  .countdown{display:flex;justify-content:center;gap:10px;font-weight:900;font-size:1.6rem;letter-spacing:.5px;direction:ltr}
  .cd-seg{min-width:2ch;text-align:center;padding:.25rem .65rem;border:1px solid var(--border);border-radius:12px;background:#f8fff9;box-shadow:inset 0 0 0 1px #eef6ef}
  .note{font-size:.9rem;color:var(--muted);text-align:center}

  .infoRow{display:grid;grid-template-columns:1fr 1fr;gap:16px}
  @media(max-width:720px){.infoRow{grid-template-columns:1fr}}

  .chip{background:#fff;border:1px solid var(--border);border-radius:12px;box-shadow:var(--shadow);padding:12px;display:flex;align-items:center;gap:12px;background-image:var(--chip-grad)}
  .ico{width:36px;height:36px;display:grid;place-items:center;border-radius:10px;background:#ecfff2;font-size:1.05rem;border:1px solid #e6f6ea}
  .stack{display:flex;flex-direction:column}
  .label{font-size:.85rem;color:var(--muted);font-weight:800}
  .value{font-weight:900;font-size:1rem;font-variant-numeric:tabular-nums}

  .card{background:#fff;border:1px solid var(--border);border-radius:12px;box-shadow:var(--shadow);padding:12px}
  .card h3{margin:0 0 10px;font-size:1rem;font-weight:900;text-align:center;color:#0a3d2a}
  table{width:100%;border-collapse:collapse}
  th,td{padding:12px;border-bottom:1px solid #f0f3f0;font-size:1rem}
  th{background:#fbfff8;font-weight:900}
  td.name{text-align:right;font-weight:800}
  td.time{text-align:left;font-weight:900}
  tr.next td{background:linear-gradient(90deg,#10b9811a,transparent)}

  /* ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø£Ø­ÙƒØ§Ù… */
  .fiqh{background:#fff;border:1px solid var(--border);border-radius:12px;box-shadow:var(--shadow);padding:14px}
  .fiqh h3{margin:0 0 10px;text-align:center}
  .fiqh ul{margin:0;padding:0 1.1rem}
  .fiqh li{margin:.4rem 0}

  footer{text-align:center;margin-top:8px}
  .credit{color:#084d39;font-weight:900}

  /* Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª */
  .modal{position:fixed;inset:0;display:none;place-items:center;background:rgba(6,43,34,.28);z-index:60}
  .modal.open{display:grid}
  .box{width:min(520px,96%);background:#fff;border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow);padding:16px}
  .rowCtrl{display:flex;gap:10px;align-items:center;margin:8px 0}
  .rowCtrl label{width:110px;color:var(--muted);font-weight:800}
  select{flex:1;padding:12px;border-radius:12px;border:1px solid var(--border);font-weight:800}
  .actions{display:flex;gap:10px;margin-top:12px}
  .btn{border:1px solid var(--border);border-radius:10px;padding:.55rem .9rem;font-weight:900;cursor:pointer;background:#fff}
  .btn.primary{background:#ecfff2}
  a.src{color:#0a6f4b;text-decoration:none;border-bottom:1px dashed #a9cdbb}
</style>
</head>
<body>
  <div class="container">
    <div class="topClock">
      <div class="brand">ğŸŒ’ Ø§Ù„Ø®Ø³ÙˆÙ ÙˆØ§Ù„ÙƒØ³ÙˆÙ</div>
      <div class="topClock" id="topClock">--:-- --</div>
    </div>

    <section class="hero">
      <h1 class="heroTitle">ØªÙˆØ§Ø±ÙŠØ® Ø®Ø³ÙˆÙ Ø§Ù„Ù‚Ù…Ø± ÙˆÙƒØ³ÙˆÙ Ø§Ù„Ø´Ù…Ø³ (ØªØ­Ø¯Ù‘ÙØ« Ø³Ù†ÙˆÙŠÙ‘Ù‹Ø§)</h1>
    </section>

    <div class="locationBox">
      <div class="place" id="place">Ø§Ù„Ù…Ù†Ø§Ù…Ø©ØŒ Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†</div>
      <button class="changeBtn" id="openPicker" type="button">ØªØºÙŠÙŠØ±</button>
    </div>

    <!-- Ø§Ù„Ø­Ø¯Ø« Ø§Ù„Ù‚Ø§Ø¯Ù… + Ø¹Ø¯Ø§Ø¯ -->
    <section class="nextBox" id="nextBox">
      <div class="nextHdr">
        <span class="chipGold">Ø§Ù„Ø­Ø¯Ø« Ø§Ù„Ù‚Ø§Ø¯Ù…</span>
      </div>
      <div class="nextRow">
        <span class="nextName" id="nextName">--</span>
        <span class="nextAt" id="nextAt">--:--:--</span>
      </div>
      <div class="countdown" aria-live="polite">
        <span class="cd-seg" id="cdH">00</span><span>:</span>
        <span class="cd-seg" id="cdM">00</span><span>:</span>
        <span class="cd-seg" id="cdS">00</span>
      </div>
      <div class="note" id="nextNote"></div>
    </section>

    <section class="infoRow">
      <div class="chip">
        <div class="ico">ğŸ—“</div>
        <div class="stack"><div class="label">Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ</div><div class="value" id="greg">--</div></div>
      </div>
      <div class="chip">
        <div class="ico">ğŸŒ</div>
        <div class="stack"><div class="label">Ø§Ù„ØªÙˆÙ‚ÙŠØª Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶</div><div class="value" id="tzLabel">Asia/Bahrain (Ù…Ø­Ù„ÙŠ)</div></div>
      </div>
    </section>

    <!-- Ø¬Ø¯ÙˆÙ„ Ø®Ø³ÙˆÙ/ÙƒØ³ÙˆÙ Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø§Ù… -->
    <section class="card">
      <h3>Ø£Ø­Ø¯Ø§Ø« Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø§Ù…</h3>
      <table>
        <thead><tr><th>Ø§Ù„Ø­Ø¯Ø«</th><th>ÙŠØ¨Ø¯Ø£</th><th>Ø§Ù„Ø£Ø¹Ø¸Ù…</th><th>ÙŠÙ†ØªÙ‡ÙŠ</th></tr></thead>
        <tbody id="eventsBody"><tr><td colspan="4">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„â€¦</td></tr></tbody>
      </table>
      <div class="note" style="margin-top:8px">
        Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø£ØµÙ„ÙŠØ© Ø¨Ø§Ù„Ù€UTC Ù…Ù† Ù…ØµØ§Ø¯Ø± ÙÙ„ÙƒÙŠØ© (NASA/Timeanddate/EclipseWise)ØŒ ØªÙØ­ÙˆÙ‘ÙÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¥Ù„Ù‰ Ù…Ù†Ø·Ù‚ØªÙƒ.
      </div>
    </section>

    <!-- Ø§Ù„Ø£Ø­ÙƒØ§Ù… ÙˆØ§Ù„ÙƒÙŠÙÙŠØ© -->
    <section class="fiqh">
      <h3>Ø§Ù„Ø£Ø­ÙƒØ§Ù… Ø§Ù„Ø´Ø±Ø¹ÙŠØ© Ø§Ù„Ù…Ø®ØªØµØ±Ø© ÙˆØµÙ„Ø§Ø© Ø§Ù„Ø¢ÙŠØ§Øª</h3>
      <ul>
        <li><b>ØªØ¬Ø¨ ØµÙ„Ø§Ø© Ø§Ù„Ø¢ÙŠØ§Øª</b> Ø¹Ù†Ø¯ Ø§Ù„ÙƒØ³ÙˆÙÙŠÙ† (Ø§Ù„Ø´Ù…Ø³ ÙˆØ§Ù„Ù‚Ù…Ø±) Ù…Ù† <b>Ø§Ø¨ØªØ¯Ø§Ø¡ Ø§Ù„Ø­Ø¯Ø« Ø¥Ù„Ù‰ ØªÙ…Ø§Ù… Ø§Ù„Ø§Ù†Ø¬Ù„Ø§Ø¡</b>ØŒ ÙˆÙ„Ùˆ ÙƒØ§Ù† Ø¬Ø²Ø¦ÙŠÙ‹Ø§.</li>
        <li><b>Ø§Ù„ÙˆÙ‚Øª:</b> ØªØ¨Ø¯Ø£ Ù…Ù† Ø¸Ù‡ÙˆØ± Ø§Ù„Ø¢ÙŠØ© ÙˆØªØ³ØªÙ…Ø± Ø¥Ù„Ù‰ Ø§Ù„Ø§Ù†Ø¬Ù„Ø§Ø¡ Ø§Ù„ØªØ§Ù…ØŒ ÙˆØ§Ù„Ø£ÙˆÙ„Ù‰ Ø¹Ø¯Ù… Ø§Ù„ØªØ£Ø®ÙŠØ± Ø¥Ù„Ù‰ Ø§Ù„Ø´Ø±ÙˆØ¹ ÙÙŠ Ø§Ù„Ø§Ù†Ø¬Ù„Ø§Ø¡.</li>
        <li><b>Ø§Ù„ÙƒÙŠÙÙŠØ© Ø§Ù„Ù…Ø®ØªØµØ±Ø©:</b> Ø±ÙƒØ¹ØªØ§Ù†ØŒ ÙÙŠ ÙƒÙ„ Ø±ÙƒØ¹Ø© <b>Ø®Ù…Ø³Ø© Ø±ÙƒÙˆØ¹Ø§Øª</b>Ø› ÙŠÙ‚Ø±Ø£ Ø§Ù„ÙØ§ØªØ­Ø© ÙˆØ³ÙˆØ±Ø© ØªØ§Ù…Ø© Ø«Ù… ÙŠØ±ÙƒØ¹ØŒ ÙˆÙŠÙƒØ±Ù‘Ø± Ø°Ù„Ùƒ Ø®Ù…Ø³ Ù…Ø±Ø§ØªØŒ Ø«Ù… Ø³Ø¬Ø¯ØªØ§Ù†ØŒ Ø«Ù… ÙŠÙ‚ÙˆÙ… Ù„Ù„Ø±ÙƒØ¹Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© Ø¹Ù„Ù‰ Ù†ÙØ³ Ø§Ù„Ù†Ø­Ùˆ Ø«Ù… Ø§Ù„ØªØ´Ù‡Ù‘Ø¯ ÙˆØ§Ù„Ø³Ù„Ø§Ù…. ÙˆÙŠØ¬ÙˆØ² ØªÙˆØ²ÙŠØ¹ Ø³ÙˆØ±Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø±ÙƒÙˆØ¹Ø§Øª Ø§Ù„Ø®Ù…Ø³Ø©.</li>
        <li><b>Ø°ÙˆÙˆ Ø§Ù„Ø£Ø¹Ø°Ø§Ø± Ù…Ù† Ø§Ù„Ù†Ø³Ø§Ø¡:</b> Ù„Ø§ ØªØµØ­ Ø§Ù„ØµÙ„Ø§Ø© Ù…Ù†Ù‡Ù† Ø­Ø§Ù„ Ø§Ù„Ø¹Ø°Ø± (ÙƒØ§Ù„Ø­ÙŠØ¶)ØŒ <b>ÙˆÙ„Ø§ ÙŠØ¬Ø¨ Ø¹Ù„ÙŠÙ‡Ù† Ø§Ù„Ù‚Ø¶Ø§Ø¡</b> Ù„Ù…Ø§ ÙÙÙˆØª Ø­Ø§Ù„ Ø§Ù„Ø¹Ø°Ø±.</li>
      </ul>
      <div class="note" style="margin-top:6px">
        Ù…Ø£Ø®ÙˆØ° Ù…Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø±Ø³Ù…ÙŠ Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ (Ù‚Ø³Ù… ØµÙ„Ø§Ø© Ø§Ù„Ø¢ÙŠØ§ØªØŒ Ø§Ù„Ù…Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ù†ØªØ®Ø¨Ø©/Ø§Ù„Ø§Ø³ØªÙØªØ§Ø¡Ø§Øª). Ø±Ø§Ø¬Ø¹ Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙØ­Ø©: <a class="src" href="https://www.sistani.org/arabic/qa/0551/" target="_blank" rel="noopener">ÙƒÙŠÙÙŠØ© ÙˆÙˆÙ‚Øª Ø§Ù„ØµÙ„Ø§Ø©</a>ØŒ <a class="src" href="https://www.sistani.org/arabic/book/13/597/" target="_blank" rel="noopener">Ø£Ø­ÙƒØ§Ù… Ø§Ù„Ø­ÙŠØ¶/Ø§Ù„Ù‚Ø¶Ø§Ø¡</a>. 
      </div>
    </section>

    <section class="card">
      <h3>Ù…ØµØ§Ø¯Ø± ÙÙ„ÙƒÙŠØ©</h3>
      <ul style="margin:0;padding:0 1.1rem">
        <li><a class="src" href="https://science.nasa.gov/eclipses/future-eclipses/" target="_blank" rel="noopener">NASA â€“ Future Eclipses</a></li>
        <li><a class="src" href="https://eclipse.gsfc.nasa.gov/SEdecade/SEdecade2021.html" target="_blank" rel="noopener">NASA GSFC â€“ Solar Eclipses 2021â€“2030</a></li>
        <li><a class="src" href="https://eclipse.gsfc.nasa.gov/LEdecade/LEdecade2021.html" target="_blank" rel="noopener">NASA GSFC â€“ Lunar Eclipses 2021â€“2030</a></li>
        <li><a class="src" href="https://www.timeanddate.com/eclipse/2025" target="_blank" rel="noopener">Timeanddate â€“ Eclipses 2025</a></li>
      </ul>
    </section>

    <footer><span class="credit">Ø¨Ø±Ù…Ø¬Ø© ÙˆØªØ·ÙˆÙŠØ± ÙØ§Ø¶Ù„ Ø§Ù„Ø±ÙŠØ³</span></footer>
  </div>

  <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
  <div class="modal" id="modal">
    <div class="box">
      <div class="rowCtrl"><label>Ø§Ù„Ø¨Ù„Ø¯</label><select id="countrySel"></select></div>
      <div class="rowCtrl"><label>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label><select id="citySel"></select></div>
      <div class="actions">
        <button class="btn primary" id="savePlace" type="button">Ø­ÙØ¸</button>
        <button class="btn" id="cancelPlace" type="button">Ø¥Ù„ØºØ§Ø¡</button>
      </div>
    </div>
  </div>

<script>
/* ========================= Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø§Ù…Ø© ========================= */
const MAP=[
 {ar:"Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†",en:"Bahrain",tz:"Asia/Bahrain",cities:[
   {ar:"Ø§Ù„Ù…Ù†Ø§Ù…Ø©",en:"Manama"},{ar:"Ø§Ù„Ù…Ø­Ø±Ù‚",en:"Muharraq"},{ar:"Ù…Ø¯ÙŠÙ†Ø© Ø¹ÙŠØ³Ù‰",en:"Isa Town"},
   {ar:"Ù…Ø¯ÙŠÙ†Ø© Ø­Ù…Ø¯",en:"Hamad Town"},{ar:"Ø³ØªØ±Ø©",en:"Sitra"},{ar:"Ø³Ø§Ø±",en:"Saar"},
   {ar:"Ø§Ù„Ø¯Ø±Ø§Ø²",en:"Draz"},{ar:"Ø¬Ø¯Ø­ÙØµ",en:"Jidhafs"}
 ]},
 {ar:"Ù„Ø¨Ù†Ø§Ù†",en:"Lebanon",tz:"Asia/Beirut",cities:[{ar:"Ø¨ÙŠØ±ÙˆØª",en:"Beirut"},{ar:"Ø·Ø±Ø§Ø¨Ù„Ø³",en:"Tripoli"},{ar:"ØµÙŠØ¯Ø§",en:"Sidon"}]},
 {ar:"Ø§Ù„Ø¹Ø±Ø§Ù‚",en:"Iraq",tz:"Asia/Baghdad",cities:[{ar:"Ø¨ØºØ¯Ø§Ø¯",en:"Baghdad"},{ar:"Ø§Ù„Ø¨ØµØ±Ø©",en:"Basrah"},{ar:"Ø£Ø±Ø¨ÙŠÙ„",en:"Erbil"}]},
 {ar:"Ø¥ÙŠØ±Ø§Ù†",en:"Iran",tz:"Asia/Tehran",cities:[{ar:"Ø·Ù‡Ø±Ø§Ù†",en:"Tehran"},{ar:"Ù…Ø´Ù‡Ø¯",en:"Mashhad"},{ar:"Ø£ØµÙÙ‡Ø§Ù†",en:"Isfahan"}]},
 {ar:"Ø§Ù„ÙƒÙˆÙŠØª",en:"Kuwait",tz:"Asia/Kuwait",cities:[{ar:"Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„ÙƒÙˆÙŠØª",en:"Kuwait City"},{ar:"Ø­ÙˆÙ„ÙŠ",en:"Hawalli"},{ar:"Ø§Ù„Ø£Ø­Ù…Ø¯ÙŠ",en:"Al Ahmadi"}]},
 {ar:"Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©",en:"Saudi Arabia",tz:"Asia/Riyadh",cities:[{ar:"Ø§Ù„Ø±ÙŠØ§Ø¶",en:"Riyadh"},{ar:"Ø¬Ø¯Ø©",en:"Jeddah"},{ar:"Ø§Ù„Ø¯Ù…Ø§Ù…",en:"Dammam"},{ar:"Ù…ÙƒØ©",en:"Mecca"},{ar:"Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©",en:"Medina"}]}
];
const DEFAULT={countryEn:"Bahrain",countryAr:"Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†",cityEn:"Manama",cityAr:"Ø§Ù„Ù…Ù†Ø§Ù…Ø©",tz:"Asia/Bahrain"};
let current = JSON.parse(localStorage.getItem("eclipse_place")||"null") || {...DEFAULT};

/* Ø³Ø§Ø¹Ø© Ø£Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© */
function updateClock(){
  const fmt=new Intl.DateTimeFormat('ar',{timeZone:current.tz,hour:'2-digit',minute:'2-digit',second:'2-digit',hour12:true});
  topClock.textContent=fmt.format(new Date());
}
setInterval(updateClock,1000); updateClock();

/* ÙˆÙ‚Øª/ØªØ§Ø±ÙŠØ® Ø¬Ù…ÙŠÙ„ */
function ymdInTZ(date, tz){
  const p=new Intl.DateTimeFormat('en-CA',{timeZone:tz,year:'numeric',month:'2-digit',day:'2-digit'}).formatToParts(date);
  return {Y:p.find(x=>x.type==='year').value, M:p.find(x=>x.type==='month').value, D:p.find(x=>x.type==='day').value};
}
function fmtLocal(dt, tz){
  return new Intl.DateTimeFormat('ar',{timeZone:tz,weekday:'long',year:'numeric',month:'long',day:'numeric',hour:'2-digit',minute:'2-digit',second:'2-digit',hour12:true}).format(dt);
}
function fmtDateBox(){
  greg.textContent=new Intl.DateTimeFormat('ar',{timeZone:current.tz,weekday:'long',year:'numeric',month:'long',day:'numeric'}).format(new Date());
  document.getElementById('tzLabel').textContent = current.tz+" (Ù…Ø­Ù„ÙŠ)";
}

/* ========================= Ø¨ÙŠØ§Ù†Ø§Øª ÙÙ„ÙƒÙŠØ© (UTC) =========================
   Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª Ù…Ù† NASA/Timeanddate/EclipseWise/ÙˆÙŠÙƒÙŠØ¨ÙŠØ¯ÙŠØ§:
   - 2025 Mar 13â€“14 (Lunar Total): P1 03:57:09.4, U1 05:09:22.6, U2 06:25:57.5, Gr 06:58:44.5, U3 07:32:01.5, U4 08:48:18.5, P4 10:00:31.9  [Sources: NASA/Science + Wikipedia]
   - 2025 Mar 29 (Solar Partial): First 08:51:52.5, Greatest 10:48:36.1, Last 12:44:54.0       [Source: Wikipedia + NASA/Science event page]
   - 2025 Sep 07 (Lunar Total): P1 15:28:21, U1 16:27:02, U2 17:30:41, Gr 18:11:43, U3 18:52:47, U4 19:56:26, P4 20:55:00 [Wikipedia]
   - 2025 Sep 21 (Solar Partial): First 17:30:51.3, Greatest 19:43:04.2, Last 21:54:55.1      [Wikipedia]
   ÙŠÙ…ÙƒÙ† Ø§Ù„ØªÙˆØ³Ø¹Ø© Ø¨Ø¥Ø¶Ø§ÙØ© Ø³Ù†ÙˆØ§Øª Ù„Ø§Ø­Ù‚Ø© ÙÙŠ Ø§Ù„Ù…ØµÙÙˆÙØ© Ù†ÙØ³Ù‡Ø§.
*/
const ECLIPSES_UTC = [
  {
    id:"2025-03-14-LUNAR-TOTAL",
    type:"Ø®Ø³ÙˆÙ Ù‚Ù…Ø±ÙŠ ÙƒÙ„ÙŠ",
    dateUTC:"2025-03-14",
    contactsUTC:{
      start:"2025-03-14T03:57:09.4Z",   // P1
      max:"2025-03-14T06:58:44.5Z",     // Greatest
      end:"2025-03-14T10:00:31.9Z"      // P4
    },
    details:[
      ["Ø¨Ø¯Ø§ÙŠØ© Ø´Ø¨Ù‡ Ø§Ù„Ø¸Ù„ (P1)","2025-03-14T03:57:09.4Z"],
      ["Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¬Ø²Ø¦ÙŠ (U1)","2025-03-14T05:09:22.6Z"],
      ["Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ÙƒÙ„ÙŠ (U2)","2025-03-14T06:25:57.5Z"],
      ["Ø§Ù„Ø£Ø¹Ø¸Ù…","2025-03-14T06:58:44.5Z"],
      ["Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙƒÙ„ÙŠ (U3)","2025-03-14T07:32:01.5Z"],
      ["Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¬Ø²Ø¦ÙŠ (U4)","2025-03-14T08:48:18.5Z"],
      ["Ù†Ù‡Ø§ÙŠØ© Ø´Ø¨Ù‡ Ø§Ù„Ø¸Ù„ (P4)","2025-03-14T10:00:31.9Z"]
    ],
    sources:[
      "https://science.nasa.gov/solar-system/moon/what-you-need-to-know-about-the-march-2025-total-lunar-eclipse/",
      "https://en.wikipedia.org/wiki/March_2025_lunar_eclipse"
    ]
  },
  {
    id:"2025-03-29-SOLAR-PARTIAL",
    type:"ÙƒØ³ÙˆÙ Ø´Ù…Ø³ÙŠ Ø¬Ø²Ø¦ÙŠ",
    dateUTC:"2025-03-29",
    contactsUTC:{
      start:"2025-03-29T08:51:52.5Z",
      max:"2025-03-29T10:48:36.1Z",
      end:"2025-03-29T12:44:54.0Z"
    },
    details:[
      ["Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ÙƒØ³ÙˆÙ (Ø§ØªØµØ§Ù„ Ø£ÙˆÙ„)","2025-03-29T08:51:52.5Z"],
      ["Ø§Ù„Ø£Ø¹Ø¸Ù…","2025-03-29T10:48:36.1Z"],
      ["Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙƒØ³ÙˆÙ (Ø§ØªØµØ§Ù„ Ø£Ø®ÙŠØ±)","2025-03-29T12:44:54.0Z"]
    ],
    sources:[
      "https://science.nasa.gov/eclipses/future-eclipses/mar-29-2025-eclipse/",
      "https://en.wikipedia.org/wiki/Solar_eclipse_of_March_29,_2025"
    ]
  },
  {
    id:"2025-09-07-LUNAR-TOTAL",
    type:"Ø®Ø³ÙˆÙ Ù‚Ù…Ø±ÙŠ ÙƒÙ„ÙŠ",
    dateUTC:"2025-09-07",
    contactsUTC:{
      start:"2025-09-07T15:28:21Z",
      max:"2025-09-07T18:11:43Z",
      end:"2025-09-07T20:55:00Z"
    },
    details:[
      ["Ø¨Ø¯Ø§ÙŠØ© Ø´Ø¨Ù‡ Ø§Ù„Ø¸Ù„ (P1)","2025-09-07T15:28:21Z"],
      ["Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¬Ø²Ø¦ÙŠ (U1)","2025-09-07T16:27:02Z"],
      ["Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ÙƒÙ„ÙŠ (U2)","2025-09-07T17:30:41Z"],
      ["Ø§Ù„Ø£Ø¹Ø¸Ù…","2025-09-07T18:11:43Z"],
      ["Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙƒÙ„ÙŠ (U3)","2025-09-07T18:52:47Z"],
      ["Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¬Ø²Ø¦ÙŠ (U4)","2025-09-07T19:56:26Z"],
      ["Ù†Ù‡Ø§ÙŠØ© Ø´Ø¨Ù‡ Ø§Ù„Ø¸Ù„ (P4)","2025-09-07T20:55:00Z"]
    ],
    sources:[
      "https://en.wikipedia.org/wiki/September_2025_lunar_eclipse"
    ]
  },
  {
    id:"2025-09-21-SOLAR-PARTIAL",
    type:"ÙƒØ³ÙˆÙ Ø´Ù…Ø³ÙŠ Ø¬Ø²Ø¦ÙŠ",
    dateUTC:"2025-09-21",
    contactsUTC:{
      start:"2025-09-21T17:30:51.3Z",
      max:"2025-09-21T19:43:04.2Z",
      end:"2025-09-21T21:54:55.1Z"
    },
    details:[
      ["Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ÙƒØ³ÙˆÙ (Ø§ØªØµØ§Ù„ Ø£ÙˆÙ„)","2025-09-21T17:30:51.3Z"],
      ["Ø§Ù„Ø£Ø¹Ø¸Ù…","2025-09-21T19:43:04.2Z"],
      ["Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙƒØ³ÙˆÙ (Ø§ØªØµØ§Ù„ Ø£Ø®ÙŠØ±)","2025-09-21T21:54:55.1Z"]
    ],
    sources:[
      "https://en.wikipedia.org/wiki/Solar_eclipse_of_September_21,_2025"
    ]
  }
];

/* Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„ÙˆÙ‚Øª */
function toLocalParts(iso, tz){
  const d=new Date(iso);
  const f=new Intl.DateTimeFormat('en-CA',{timeZone:tz,year:'numeric',month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit',second:'2-digit',hour12:true});
  const p=f.formatToParts(d);
  const obj=Object.fromEntries(p.map(x=>[x.type,x.value]));
  return {d, str:`${obj.weekday?obj.weekday+"ØŒ ":""}${obj.year}-${obj.month}-${obj.day} ${obj.hour}:${obj.minute}:${obj.second} ${obj.dayPeriod||""}`.trim()};
}
function toLocalNice(iso, tz){
  return new Intl.DateTimeFormat('ar',{timeZone:tz,year:'numeric',month:'long',day:'numeric',hour:'2-digit',minute:'2-digit',second:'2-digit',hour12:true}).format(new Date(iso));
}

/* Ø§Ø®ØªÙŠØ§Ø± Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø¬Ø§Ø±ÙŠØ© */
function currentYearEclipses(){
  const Y=(new Date()).getUTCFullYear();
  return ECLIPSES_UTC.filter(e=>e.dateUTC.startsWith(String(Y)));
}

/* ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØµÙÙˆÙ */
function renderYearTable(){
  const rows=currentYearEclipses().map(e=>{
    const s=toLocalNice(e.contactsUTC.start,current.tz);
    const m=toLocalNice(e.contactsUTC.max,current.tz);
    const en=toLocalNice(e.contactsUTC.end,current.tz);
    return `<tr>
      <td class="name">${e.type} â€“ ${new Date(e.dateUTC).toLocaleDateString('ar',{year:'numeric',month:'long',day:'numeric'})}</td>
      <td class="time">${s}</td>
      <td class="time">${m}</td>
      <td class="time">${en}</td>
    </tr>`;
  }).join('');
  eventsBody.innerHTML = rows || `<tr><td colspan="4">Ù„Ø§ Ø£Ø­Ø¯Ø§Ø« Ù…Ø³Ø¬Ù‘Ù„Ø© Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø³Ù†Ø©.</td></tr>`;
}

/* Ø§Ù„Ø­Ø¯Ø« Ø§Ù„Ù‚Ø§Ø¯Ù… + Ø¹Ø¯Ù‘Ø§Ø¯ */
let cdTimer=null;
function nextEvent(){
  const now=new Date();
  const all=ECLIPSES_UTC.slice().sort((a,b)=>new Date(a.contactsUTC.start)-new Date(b.contactsUTC.start));
  return all.find(e=>new Date(e.contactsUTC.start)>now) || all[all.length-1]; // Ø¥Ù† Ø§Ù†ØªÙ‡Øª Ø¬Ù…ÙŠØ¹Ù‡Ø§ Ø£Ø¹Ø±Ø¶ Ø¢Ø®Ø± ÙˆØ§Ø­Ø¯
}
function updateNextBox(){
  const ev=nextEvent();
  if(!ev){ nextName.textContent="--"; nextAt.textContent="--:--:--"; return; }
  nextName.textContent = ev.type + " â€“ " + new Date(ev.dateUTC).toLocaleDateString('ar',{year:'numeric',month:'long',day:'numeric'});
  nextAt.textContent = toLocalNice(ev.contactsUTC.start, current.tz);
  nextNote.textContent = "Ø§Ù„Ø¹Ø¯Ù‘Ø§Ø¯ Ø­ØªÙ‰ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø­Ø¯Ø« (Ø¨Ø¯Ø§ÙŠØ© Ø´Ø¨Ù‡ Ø§Ù„Ø¸Ù„/Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ø£ÙˆÙ„ Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹).";

  if(cdTimer) clearInterval(cdTimer);
  cdTimer = setInterval(()=>tickCountdown(new Date(ev.contactsUTC.start), ev),1000);
  tickCountdown(new Date(ev.contactsUTC.start), ev);
}
function setCD(ms){
  ms = Math.max(0, ms|0);
  let s = Math.floor(ms/1000);
  const h = Math.floor(s/3600); s%=3600;
  const m = Math.floor(s/60); s%=60;
  cdH.textContent = String(h).padStart(2,'0');
  cdM.textContent = String(m).padStart(2,'0');
  cdS.textContent = String(s).padStart(2,'0');
}
function tickCountdown(targetUTC){
  const now=new Date();
  const diff = targetUTC - now;
  setCD(diff);
  if(diff<=0){ clearInterval(cdTimer); renderAll(); }
}

/* Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ */
const modal=document.getElementById("modal");
const openPicker=document.getElementById("openPicker");
const cancelPlace=document.getElementById("cancelPlace");
const savePlace=document.getElementById("savePlace");
const countrySel=document.getElementById("countrySel");
const citySel=document.getElementById("citySel");

function populateCities(countryEn){
  const c=MAP.find(x=>x.en===countryEn);
  citySel.innerHTML=(c?.cities||[]).map(m=>`<option value="${m.en}">${m.ar}</option>`).join("");
}
function openModal(){
  countrySel.innerHTML=MAP.map(c=>`<option value="${c.en}">${c.ar}</option>`).join("");
  countrySel.value=current.countryEn;
  populateCities(countrySel.value);
  citySel.value=current.cityEn;
  modal.classList.add("open");
  document.body.style.overflow='hidden';
}
function closeModal(){ modal.classList.remove("open"); document.body.style.overflow=''; }
openPicker.addEventListener("click",openModal);
cancelPlace.addEventListener("click",closeModal);
modal.addEventListener("click",(e)=>{ if(e.target===modal) closeModal(); });
countrySel.addEventListener("change",()=>populateCities(countrySel.value));
savePlace.addEventListener("click",()=>{
  const c=MAP.find(x=>x.en===countrySel.value);
  const m=(c?.cities||[]).find(x=>x.en===citySel.value);
  if(c&&m){
    current={countryEn:c.en,countryAr:c.ar,cityEn:m.en,cityAr:m.ar,tz:c.tz};
    localStorage.setItem("eclipse_place",JSON.stringify(current));
  }
  closeModal();
  renderAll();
});

/* ØªØ´ØºÙŠÙ„ */
function renderAll(){
  place.textContent=`${current.cityAr}ØŒ ${current.countryAr}`;
  fmtDateBox();
  renderYearTable();
  updateNextBox();
}
renderAll();
</script>
</body>
</html>
