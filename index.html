<!DOCTYPE html><html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>الكتابة على الصور • أداة ويب احترافية</title>
  <!-- خط عربي لطيف -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;800&display=swap" rel="stylesheet">
  <!-- html2canvas للتصدير كصورة -->
  <script defer src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <style>
    :root{
      --bg:#0f172a;          /* slate-900 */
      --card:#111827;        /* gray-900 */
      --muted:#1f2937;       /* gray-800 */
      --accent:#06b6d4;      /* cyan-500 */
      --text:#e5e7eb;        /* gray-200 */
      --text-dim:#9ca3af;    /* gray-400 */
      --success:#22c55e;     /* green-500 */
      --danger:#ef4444;      /* red-500 */
      --warning:#f59e0b;     /* amber-500 */
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; background:linear-gradient(145deg,#0b1227,#0f172a 40%,#0b1227);
      color:var(--text); font-family:'Cairo', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      min-height:100svh; display:flex; flex-direction:column; gap:18px;
    }
    header{
      padding:18px 22px; display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:12px;
    }
    .brand{display:flex; align-items:center; gap:12px; font-weight:800; letter-spacing:.3px}
    .brand .logo{width:38px; height:38px; border-radius:12px; background:conic-gradient(from 200deg, var(--accent), #7c3aed, #22d3ee, var(--accent)); box-shadow:var(--shadow)}
    .brand small{color:var(--text-dim); font-weight:600; display:block; margin-top:-6px}.toolbar{
  display:flex; flex-wrap:wrap; gap:10px; align-items:center;
  background:rgba(17,24,39,.6); backdrop-filter: blur(10px); border:1px solid rgba(255,255,255,.06);
  padding:10px; border-radius:var(--radius); box-shadow:var(--shadow);
}
.tool{display:flex; align-items:center; gap:8px; background:var(--muted); border:1px solid rgba(255,255,255,.06); padding:8px 10px; border-radius:14px}
label{color:var(--text-dim); font-size:.92rem}
input[type="file"], select, input[type="color"], input[type="number"], input[type="text"]{
  background:#0b1020; color:var(--text); border:1px solid rgba(255,255,255,.1); padding:8px 10px; border-radius:10px; outline:none;
}
input[type="range"]{accent-color:var(--accent)}
button{
  background:linear-gradient(180deg, #13c2d6, #0891b2); color:white; border:none; border-radius:12px; padding:10px 14px; font-weight:700; cursor:pointer; box-shadow:var(--shadow); transition:transform .05s ease;
}
button:hover{transform:translateY(-1px)}
button.ghost{background:#111827; border:1px solid rgba(255,255,255,.08); color:var(--text)}
button.success{background:linear-gradient(180deg, #22c55e, #16a34a)}
button.danger{background:linear-gradient(180deg, #ef4444, #dc2626)}

main{display:grid; grid-template-columns:380px 1fr; gap:18px; padding:0 22px 22px; flex:1}
@media(max-width:1024px){ main{grid-template-columns:1fr} }

.side{
  background:rgba(17,24,39,.6); border:1px solid rgba(255,255,255,.06); border-radius:var(--radius); padding:16px; box-shadow:var(--shadow);
  display:flex; flex-direction:column; gap:12px;
}
.group{background:var(--card); border:1px solid rgba(255,255,255,.06); border-radius:14px; padding:12px}
.group h3{margin:0 0 10px; font-size:1rem; color:#d1d5db}

/* لوح العمل */
.stage-wrap{position:relative; background:rgba(255,255,255,.02); border:1px dashed rgba(255,255,255,.2); border-radius:var(--radius); padding:10px; display:flex; align-items:center; justify-content:center; min-height:60svh}
.stage{position:relative; background:#000; min-width:300px; min-height:200px; border-radius:12px; overflow:hidden; box-shadow:var(--shadow); user-select:none}
.stage::after{content:""; position:absolute; inset:0; pointer-events:none; background:radial-gradient(1200px 600px at 30% -20%, rgba(255,255,255,.06), transparent 60%)}
.bg{position:absolute; inset:0; background-size:contain; background-repeat:no-repeat; background-position:center}

/* مربع النص */
.text-box{
  position:absolute; min-width:160px; min-height:60px; padding:10px 12px; border:1px solid rgba(255,255,255,.18); border-radius:12px;
  background:rgba(0,0,0,.35); color:white; outline:none; cursor:move; resize:both; overflow:auto;
  box-shadow:0 6px 18px rgba(0,0,0,.35);
  line-height:1.6; word-break:break-word; -webkit-user-modify: read-write-plaintext-only;
}
.text-box:focus{border-color:var(--accent); box-shadow:0 0 0 2px rgba(6,182,212,.35)}
.text-box.justify{ text-align:justify; text-align-last:justify }
.text-box.center{ text-align:center }
.text-box.right{ text-align:right }
.text-box.left{ text-align:left }

.chip{display:inline-flex; align-items:center; gap:6px; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12); padding:6px 10px; border-radius:999px; font-size:.9rem; color:#cbd5e1}
.row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
.spacer{flex:1}

footer{padding:10px 22px 22px; color:var(--text-dim); font-size:.9rem}

  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo"></div>
      <div>
        <div>الكتابة على الصور</div>
        <small>رفع صورة • إضافة نص • محاذاة الأطراف • تصدير PNG</small>
      </div>
    </div>
    <div class="toolbar">
      <div class="tool">
        <label for="file">حمّل صورة</label>
        <input id="file" type="file" accept="image/*">
      </div>
      <div class="tool row">
        <label>الحجم</label>
        <input id="canvasW" type="number" value="1080" min="200" style="width:90px">×
        <input id="canvasH" type="number" value="1080" min="200" style="width:90px">
        <button id="applySize" class="ghost">تطبيق</button>
      </div>
      <div class="tool row">
        <label>خلفية</label>
        <input id="bgColor" type="color" value="#000000">
        <button id="fitCover" class="ghost">ملء (Cover)</button>
        <button id="fitContain" class="ghost">احتواء (Contain)</button>
      </div>
      <div class="tool row">
        <button id="addText">إضافة نص</button>
        <button id="export" class="success">تصدير PNG</button>
        <button id="clear" class="danger">تفريغ</button>
      </div>
    </div>
  </header>  <main>
    <aside class="side" id="panel">
      <div class="group">
        <h3>خصائص النص المحدد</h3>
        <div class="row" style="margin-bottom:8px">
          <label>حجم الخط</label>
          <input id="fontSize" type="range" min="12" max="120" value="36">
          <span class="chip" id="fontSizeVal">36px</span>
        </div>
        <div class="row">
          <label>السمك</label>
          <select id="fontWeight">
            <option value="300">رفيع</option>
            <option value="400">عادي</option>
            <option value="600" selected>سميك</option>
            <option value="800">عريض جدًا</option>
          </select>
          <label>الخط</label>
          <select id="fontFamily">
            <option value="'Cairo', sans-serif" selected>Cairo</option>
            <option value="Arial, sans-serif">Arial</option>
            <option value="'Times New Roman', serif">Times</option>
            <option value="Tahoma, sans-serif">Tahoma</option>
            <option value="'Scheherazade New', serif">Scheherazade (عربي)</option>
          </select>
        </div>
        <div class="row" style="margin-top:8px">
          <label>اللون</label>
          <input id="fontColor" type="color" value="#ffffff">
          <label>ظل</label>
          <input id="shadow" type="checkbox" checked>
          <span class="chip">حد (Outline)</span>
          <input id="outline" type="checkbox">
        </div>
        <div class="row" style="margin-top:8px">
          <label>الاتجاه</label>
          <select id="dirSelect">
            <option value="rtl" selected>يمين ← يسار (RTL)</option>
            <option value="ltr">يسار ← يمين (LTR)</option>
          </select>
          <label>المحاذاة</label>
          <div class="row">
            <button class="ghost" data-align="right">يمين</button>
            <button class="ghost" data-align="center">وسط</button>
            <button class="ghost" data-align="left">يسار</button>
            <button class="ghost" data-align="justify">محاذاة الأطراف</button>
          </div>
        </div>
      </div>
      <div class="group">
        <h3>تلميحات</h3>
        <ul style="margin:0; padding-inline-start:18px; color:#cbd5e1; line-height:1.9">
          <li>اسحب مربعات النص لتغيير موضعها، واسحب الزاوية لتمديد الحجم.</li>
          <li>استخدم “محاذاة الأطراف” لجعل النص ممتدًا بين الحافتين (حتى السطر الأخير).</li>
          <li>عند التصدير، نحول لوحة العمل كاملة إلى صورة PNG بدقة المعاينة.</li>
        </ul>
      </div>
    </aside><section class="stage-wrap">
  <div id="stage" class="stage" style="width:1080px; height:1080px">
    <div class="bg" id="bg"></div>
  </div>
</section>

  </main>  <footer>
    صُنعت بحب ♥️ — يناسب التصاميم العربية والإنجليزية، ويدعم المحاذاة الكاملة للنص.
  </footer><script>
  const fileInput   = document.getElementById('file');
  const stage       = document.getElementById('stage');
  const bgLayer     = document.getElementById('bg');
  const canvasW     = document.getElementById('canvasW');
  const canvasH     = document.getElementById('canvasH');
  const applySize   = document.getElementById('applySize');
  const bgColor     = document.getElementById('bgColor');
  const fitCover    = document.getElementById('fitCover');
  const fitContain  = document.getElementById('fitContain');
  const addTextBtn  = document.getElementById('addText');
  const exportBtn   = document.getElementById('export');
  const clearBtn    = document.getElementById('clear');

  // Controls for selected text box
  const fontSize    = document.getElementById('fontSize');
  const fontSizeVal = document.getElementById('fontSizeVal');
  const fontWeight  = document.getElementById('fontWeight');
  const fontFamily  = document.getElementById('fontFamily');
  const fontColor   = document.getElementById('fontColor');
  const shadow      = document.getElementById('shadow');
  const outline     = document.getElementById('outline');
  const dirSelect   = document.getElementById('dirSelect');
  const alignBtns   = [...document.querySelectorAll('[data-align]')];

  let fitMode = 'contain';
  let selected = null; // current selected text-box

  // Helpers
  function px(n){return `${n}px`}
  function setSize(){
    stage.style.width  = px(+canvasW.value);
    stage.style.height = px(+canvasH.value);
  }
  function updateBG(){
    stage.style.background = bgColor.value;
    bgLayer.style.backgroundSize = (fitMode === 'cover') ? 'cover' : 'contain';
  }

  // Image upload
  fileInput.addEventListener('change', e => {
    const file = e.target.files?.[0];
    if(!file) return;
    const url = URL.createObjectURL(file);
    bgLayer.style.backgroundImage = `url('${url}')`;
  });

  // Size & BG
  applySize.addEventListener('click', setSize);
  bgColor.addEventListener('input', updateBG);
  fitCover.addEventListener('click', ()=>{ fitMode='cover'; updateBG(); });
  fitContain.addEventListener('click', ()=>{ fitMode='contain'; updateBG(); });
  updateBG();

  // Create a new draggable, resizable text box
  function createTextBox(text='اكتب هنا…'){
    const box = document.createElement('div');
    box.className = 'text-box right';
    box.contentEditable = 'true';
    box.spellcheck = false;
    box.style.top = '40px';
    box.style.right = '40px';
    box.style.width = '360px';
    box.innerText = text;
    stage.appendChild(box);
    selectBox(box);

    // Focus styling
    box.addEventListener('pointerdown', ()=> selectBox(box));

    // Dragging logic
    let dragging = false, startX=0, startY=0, startLeft=0, startTop=0;
    box.addEventListener('pointerdown', (ev)=>{
      if(ev.target.closest('input,select,button')) return;
      dragging = true; box.setPointerCapture(ev.pointerId);
      const rect = box.getBoundingClientRect();
      startX = ev.clientX; startY = ev.clientY;
      // compute current position relative to stage (LTR values)
      const sRect = stage.getBoundingClientRect();
      startLeft = rect.left - sRect.left; startTop = rect.top - sRect.top;
      ev.preventDefault();
    });
    box.addEventListener('pointermove', (ev)=>{
      if(!dragging) return;
      const dx = ev.clientX - startX; const dy = ev.clientY - startY;
      let newLeft = startLeft + dx; let newTop = startTop + dy;
      // clamp
      newLeft = Math.max(-box.offsetWidth/2, Math.min(newLeft, stage.clientWidth - box.offsetWidth/2));
      newTop  = Math.max(0, Math.min(newTop, stage.clientHeight - 20));
      box.style.left = px(newLeft);
      box.style.top  = px(newTop);
      box.style.right = 'auto'; // switch to explicit left while dragging
    });
    box.addEventListener('pointerup', ()=>{ dragging=false; });

    return box;
  }

  // Selection & property binding
  function selectBox(el){
    selected?.classList.remove('active');
    selected = el;
    if(!selected) return;
    selected.focus();
    // Sync controls
    const cs = getComputedStyle(selected);
    fontSize.value   = parseInt(cs.fontSize) || 36; fontSizeVal.textContent = cs.fontSize || '—';
    fontWeight.value = cs.fontWeight;
    fontFamily.value = cs.fontFamily.includes('Cairo') ? "'Cairo', sans-serif" : cs.fontFamily;
    fontColor.value  = rgbToHex(cs.color);
    shadow.checked   = !!selected.dataset.shadow;
    outline.checked  = !!selected.dataset.outline;
    dirSelect.value  = selected.getAttribute('dir') || 'rtl';

    // Align state (class)
  }

  // Color helpers
  function rgbToHex(rgb){
    if(!rgb) return '#ffffff';
    const m = rgb.match(/rgb(\d+),\s*(\d+),\s*(\d+)/);
    if(!m) return '#ffffff';
    return '#'+[m[1],m[2],m[3]].map(x=>('0'+parseInt(x).toString(16)).slice(-2)).join('');
  }

  // Apply property changes
  fontSize.addEventListener('input', ()=>{ if(!selected) return; selected.style.fontSize = px(fontSize.value); fontSizeVal.textContent = px(fontSize.value); });
  fontWeight.addEventListener('change', ()=>{ if(!selected) return; selected.style.fontWeight = fontWeight.value; });
  fontFamily.addEventListener('change', ()=>{ if(!selected) return; selected.style.fontFamily = fontFamily.value; });
  fontColor.addEventListener('input', ()=>{ if(!selected) return; selected.style.color = fontColor.value; });
  dirSelect.addEventListener('change', ()=>{ if(!selected) return; selected.setAttribute('dir', dirSelect.value); });

  shadow.addEventListener('change', ()=>{
    if(!selected) return;
    if(shadow.checked){ selected.style.textShadow = '0 2px 10px rgba(0,0,0,.6)'; selected.dataset.shadow = '1'; }
    else { selected.style.textShadow = 'none'; delete selected.dataset.shadow; }
  });

  outline.addEventListener('change', ()=>{
    if(!selected) return;
    if(outline.checked){
      // محاكاة حد عبر ظلال متعددة
      selected.style.textShadow = (selected.style.textShadow && selected.style.textShadow!=='none' ? selected.style.textShadow+',' : '')+
        '-1px 0 #000, 1px 0 #000, 0 -1px #000, 0 1px #000';
      selected.dataset.outline='1';
    } else {
      // إزالة الحدود مع الحفاظ على الظل الناعم إن كان مُفعّلًا
      selected.style.textShadow = shadow.checked ? '0 2px 10px rgba(0,0,0,.6)' : 'none';
      delete selected.dataset.outline;
    }
  });

  alignBtns.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(!selected) return;
      const mode = btn.dataset.align;
      selected.classList.remove('left','center','right','justify');
      if(mode==='justify') selected.classList.add('justify');
      else selected.classList.add(mode);
    });
  });

  // Add & clear
  addTextBtn.addEventListener('click', ()=> createTextBox());
  clearBtn.addEventListener('click', ()=>{
    [...stage.querySelectorAll('.text-box')].forEach(n=>n.remove());
    bgLayer.style.backgroundImage='';
  });

  // Export PNG via html2canvas
  exportBtn.addEventListener('click', async ()=>{
    exportBtn.disabled = true; exportBtn.textContent = 'جارٍ التصدير…';
    try{
      const canvas = await html2canvas(stage, {backgroundColor:null, useCORS:true, scale:2});
      const url = canvas.toDataURL('image/png');
      const a = document.createElement('a');
      a.href = url; a.download = 'design.png'; a.click();
    }catch(err){
      alert('تعذّر التصدير: '+ err.message);
    }finally{
      exportBtn.disabled = false; exportBtn.textContent = 'تصدير PNG';
    }
  });

  // Init with one text box
  createTextBox('عنوان جذاب هنا\nسطر ثانٍ يمكن محاذاته للأطراف');
</script></body>
</html>
