<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- SEO, Security, Social Media Headers -->
    <title>دليل الصلاة الشامل | تعلم الصلاة ومواقيتها وفق المذهب الجعفري</title>
    <meta name="description" content="دليلك الشامل لتعلم الصلاة وأحكامها (الطهارة، الوضوء، التيمم، السهو) مع مواقيت الصلاة اليومية الدقيقة لمنطقتك، وفقاً لفتاوى سماحة السيد السيستاني (دام ظله).">
    <meta name="keywords" content="مواقيت الصلاة, تعليم الصلاة, كيفية الصلاة, المذهب الجعفري, السيد السيستاني, أحكام الصلاة, التيمم, السهو, الطهارة, الوضوء, قضاء الصلاة, فقه, شيعة">
    <meta name="author" content="فاضل الريس">
    <link rel="canonical" href="https://your-domain.com/salah-guide.html">
    <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
    <meta name="theme-color" content="#003366">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com; img-src 'self' https: data:; connect-src 'self' https://api.aladhan.com; frame-ancestors 'none'; form-action 'none'; base-uri 'self';">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta name="referrer-policy" content="strict-origin-when-cross-origin">
    <meta property="og:title" content="دليل الصلاة الشامل | تعلم الصلاة ومواقيتها وفق المذهب الجعفري">
    <meta property="og:description" content="دليل مبسط لتعلم الصلاة وأحكامها مع مواقيت الصلاة اليومية الدقيقة لمنطقتك.">
    <meta property="og:image" content="https://images.unsplash.com/photo-1584335319462-a3c6a3885165?q=80&w=2070&auto=format&fit=crop">
    <meta property="og:url" content="https://your-domain.com/salah-guide.html">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="ar_AR">
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Article",
      "mainEntityOfPage": { "@type": "WebPage", "@id": "https://your-domain.com/salah-guide.html" },
      "headline": "دليل الصلاة الشامل: تعلم الصلاة ومواقيتها وفق المذهب الجعفري (فتاوى السيد السيستاني)",
      "image": "https://images.unsplash.com/photo-1584335319462-a3c6a3885165?q=80&w=2070&auto=format&fit=crop",
      "author": { "@type": "Person", "name": "فاضل الريس" },
      "publisher": { "@type": "Organization", "name": "دليل الصلاة الجعفرية" }
    }
    </script>

    <!-- Fonts and Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

    <style>
        :root { 
            --primary-color: #003366;
            --secondary-color: #5A7D7C;
            --background-color: #FFFFFF;
            --light-bg-color: #F9F7F3;
            --text-color: #3E3E3E; 
            --heading-color: #003366; 
            --white-color: #FFFFFF; 
            --quote-bg-color: #F1F5F9;
            --border-color: #EAEAEA;
        }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        html { scroll-behavior: smooth; }
        body { 
            font-family: 'Tajawal', sans-serif; 
            margin: 0; 
            line-height: 1.9; 
            background-color: var(--background-color); 
            color: var(--text-color); 
            font-weight: 400; 
            font-size: clamp(16px, 1.2vw, 18px);
        }
        .container { max-width: 1100px; margin: 0 auto; padding: 0 25px; }
        h2 { font-size: clamp(2rem, 5vw, 2.6rem); text-align: center; margin-bottom: 50px; }
        h3 { font-size: clamp(1.5rem, 4vw, 1.8rem); }
        h4 { font-size: clamp(1.2rem, 3vw, 1.4rem); color: var(--secondary-color); }
        section { 
            padding: clamp(60px, 8vw, 90px) 0; 
            animation: fadeIn 1s ease-out both;
        }

        .main-header { 
            background-color: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.05); 
            padding: 15px 0; 
            position: sticky; 
            top: 0; 
            z-index: 1000; 
        }
        .main-header .container { display: flex; justify-content: space-between; align-items: center; gap: 20px; flex-wrap: wrap; }
        .logo { font-size: clamp(1.4rem, 3vw, 1.7rem); font-weight: 800; color: var(--primary-color); text-decoration: none; white-space: nowrap; flex-shrink: 0; }
        .logo span { color: var(--secondary-color); }
        .main-nav { display: flex; align-items: center; justify-content: center; flex-grow: 1; gap: clamp(15px, 3vw, 35px); }
        .main-nav a { color: var(--primary-color); text-decoration: none; font-weight: 500; transition: color 0.3s; font-size: clamp(0.9rem, 2vw, 1.05rem); white-space: nowrap; }
        .main-nav a:hover { color: var(--secondary-color); }
        
        .hero {
            position: relative;
            width: 100%;
            padding: clamp(80px, 12vh, 150px) 0;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            overflow: hidden;
        }
        .hero::before {
            content: '';
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-image: linear-gradient(to top, rgba(255, 255, 255, 0.8) 0%, rgba(255, 255, 255, 0.3) 70%), url('https://images.unsplash.com/photo-1584335319462-a3c6a3885165?q=80&w=2070&auto=format&fit=crop');
            background-size: cover;
            background-position: center 30%;
            z-index: -1;
        }
        
        .hero-title-box {
            background: rgba(255, 255, 255, 0.5);
            border: 1px solid rgba(0, 51, 102, 0.15);
            padding: clamp(20px, 4vw, 30px) clamp(30px, 6vw, 60px);
            border-radius: 12px;
            backdrop-filter: blur(6px);
            box-shadow: 0 5px 25px rgba(0, 51, 102, 0.1);
            margin-bottom: 30px;
        }
        .hero h1 {
            font-size: clamp(2.2rem, 6vw, 3rem);
            font-weight: 800;
            margin: 0;
            text-shadow: none;
            color: var(--heading-color);
        }
        
        .prayer-times-widget {
            background: rgba(255, 255, 255, 0.85);
            border: 1px solid rgba(0, 51, 102, 0.1);
            padding: 20px 25px;
            border-radius: 20px;
            backdrop-filter: blur(15px);
            box-shadow: 0 8px 30px rgba(0, 51, 102, 0.1);
            max-width: 450px;
            margin: 0 auto;
        }
        .widget-header {
            text-align: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px dashed var(--border-color);
        }
        .widget-header #date-display { font-size: 1rem; font-weight: 500; color: var(--text-color); }
        .widget-header #countdown-display { font-size: 1.2rem; font-weight: 700; color: var(--primary-color); margin-top: 8px; min-height: 22px; }
        .prayer-times-list { list-style: none; padding: 0; margin: 0; }
        .prayer-time-row { display: flex; justify-content: space-between; align-items: center; padding: 14px 5px; border-bottom: 1px dashed var(--border-color); }
        .prayer-time-row:last-child { border-bottom: none; }
        .prayer-name { font-size: 1.1rem; font-weight: 500; color: var(--text-color); }
        .prayer-time { font-size: 1.1rem; font-weight: 700; color: var(--primary-color); direction: ltr; }
        #widget-message { text-align: center; color: var(--primary-color); font-weight: 500; padding: 20px; }

        .content-section .container { max-width: 900px; }
        .content-section.alternate-bg { background-color: var(--light-bg-color); }
        .content-section h3 { margin-top: 40px; margin-bottom: 20px; border-bottom: 2px solid var(--secondary-color); padding-bottom: 10px; }
        .content-section p, .content-section ul, .content-section ol { text-align: justify; }
        .content-section ul, .content-section ol { list-style-type: none; padding-right: 20px; }
        .content-section ul li, .content-section ol li { position: relative; padding-right: 30px; margin-bottom: 15px; }
        .content-section ul li::before { content: '\f00c'; font-family: 'Font Awesome 6 Free'; font-weight: 900; color: var(--secondary-color); position: absolute; right: 0; top: 5px; }
        .content-section ol { counter-reset: item; }
        .content-section ol li::before { content: counter(item); counter-increment: item; background: var(--secondary-color); color: white; border-radius: 50%; width: 24px; height: 24px; display: inline-block; text-align: center; line-height: 24px; font-size: 0.9rem; position: absolute; right: 0; top: 5px; }
        
        .hadith-quote {
            position: relative;
            background-color: var(--quote-bg-color);
            border-right: 5px solid var(--secondary-color);
            padding: 30px 35px;
            margin: 40px 0;
            border-radius: 8px;
            overflow: hidden;
        }
        .hadith-quote::before {
            content: '“';
            position: absolute;
            top: -10px;
            left: 10px;
            font-size: 100px;
            font-weight: 800;
            color: rgba(0, 51, 102, 0.07);
            line-height: 1;
            z-index: 1;
        }
        .hadith-quote p {
            margin: 0;
            font-size: 1.2rem;
            font-weight: 500;
            color: #334155;
            position: relative;
            z-index: 2;
        }
        .hadith-quote .source {
            display: block;
            text-align: left;
            font-style: normal;
            font-weight: 500;
            margin-top: 15px;
            color: #64748B;
            font-size: 0.95rem;
            position: relative;
            z-index: 2;
        }
        
        .main-footer { background-color: var(--primary-color); color: var(--white-color); text-align: center; padding: 40px 20px; }
        .main-footer p { margin: 0; opacity: 0.9; }
        .footer-credit { margin-top: 15px; font-size: 1.1rem; }
        .footer-credit a { color: #a9cce3; text-decoration: none; font-weight: 700; transition: color 0.3s; }
        .footer-credit a:hover { color: var(--white-color); }
        .citation { font-size: 0.85rem; color: #777; display: block; margin-top: 20px; text-align: left; }

        .back-to-top { position: fixed; bottom: 25px; left: 25px; background: var(--primary-color); color: var(--white-color); width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; text-decoration: none; opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s, transform 0.3s; transform: translateY(20px); z-index: 1000; }
        .back-to-top.visible { opacity: 0.8; visibility: visible; transform: translateY(0); }
        .back-to-top:hover { opacity: 1; }

        @media (max-width: 768px) { 
            .main-header .container { justify-content: center; } 
            .main-nav { overflow-x: auto; padding-bottom: 10px; }
        }
    </style>
</head>
<body>

    <header class="main-header">
        <div class="container">
            <a href="#" class="logo">دليل الصلاة <span>الجعفرية</span></a>
            <nav class="main-nav">
                <a href="#preliminaries">مقدمات الصلاة</a>
                <a href="#how-to-pray">كيفية الصلاة</a>
                <a href="#prayer-times">أوقات الصلاة</a>
                <a href="#prayer-rulings">أحكام الصلاة</a>
                <a href="#missed-prayers">قضاء الفوائت</a>
            </nav>
        </div>
    </header>

    <main>
        <section id="hero" class="hero">
            <div class="container">
                <div class="hero-title-box">
                    <h1>دليلك الشامل لتعلم الصلاة</h1>
                </div>
                
                <div class="prayer-times-widget">
                    <div class="widget-header">
                        <div id="date-display"></div>
                        <div id="countdown-display"></div>
                    </div>
                    <ul id="prayer-times-list" class="prayer-times-list">
                        <!-- Prayer times will be loaded here by JavaScript -->
                    </ul>
                    <p id="widget-message">جاري طلب تحديد الموقع لجلب المواقيت...</p>
                </div>
            </div>
        </section>

        <section id="preliminaries" class="content-section">
            <div class="container">
                <h2>مقدمات الصلاة</h2>
                <p>قبل الشروع في الصلاة، يجب على المصلي أن يحقق شروطاً أساسية لا تصح الصلاة بدونها. هذه الشروط هي بمثابة تهيئة البدن والروح للوقوف بين يدي الله تعالى.</p>
                
                <div class="hadith-quote">
                    <p>"أوّل ما يُحاسَبُ به العبدُ الصلاة، فإن قُبِلَت قُبِلَ ما سواها، وإن رُدَّت رُدَّ ما سواها."</p>
                    <span class="source">عن الإمام الصادق (عليه السلام) - الكافي، ج 3، ص 268.</span>
                </div>

                <h3>1. الطهارة (الوضوء والغسل):</h3>
                <p>وهي شرط أساسي، وتشمل الطهارة من الحدث (بالوضوء أو الغسل) والطهارة من الخبث (إزالة النجاسة عن البدن واللباس).</p>
                <ul>
                    <li><strong>الوضوء:</strong> يجب على غير المتوضئ أن يتوضأ للصلاة. والوضوء هو غسل الوجه واليدين من المرفقين إلى أطراف الأصابع، ومسح مقدم الرأس والقدمين.</li>
                    <li><strong>الغسل:</strong> يجب في حالات معينة كالجنابة، وهو يغني عن الوضوء.</li>
                </ul>
                
                <h4>التيمم: بديل الطهارة المائية</h4>
                <p>التيمم هو طهارة ترابية يلجأ إليها المكلف عند تعذر استخدام الماء. ومسوغاته الأساسية هي:</p>
                <ul>
                    <li>عدم وجدان الماء الكافي للوضوء أو الغسل.</li>
                    <li>عدم إمكانية الوصول إلى الماء.</li>
                    <li>الخوف من ضرر عند استعمال الماء لمرض ونحوه.</li>
                    <li>الحرج والمشقة الشديدة في تحصيل الماء أو استعماله.</li>
                </ul>
                <p><strong>كيفية التيمم:</strong></p>
                <ol>
                    <li>ضرب باطن الكفين معاً على ما يصح التيمم به (كالتراب الطاهر أو الصخر).</li>
                    <li>مسح تمام الجبهة والجبينين بالكفين من منبت الشعر إلى طرف الأنف الأعلى والحاجبين.</li>
                    <li>مسح تمام ظاهر الكف اليمنى بباطن الكف اليسرى.</li>
                    <li>مسح تمام ظاهر الكف اليسرى بباطن الكف اليمنى.</li>
                </ol>

                <h3>2. القبلة:</h3>
                <p>يجب على المصلي التوجه نحو الكعبة المشرفة في مكة المكرمة. من كان بعيداً، يكفيه التوجه نحو جهتها.</p>
                
                <h3>3. لباس المصلي:</h3>
                <p>هناك شروط للباس الذي تصح فيه الصلاة: الطهارة، الإباحة (غير مغصوب)، وألا يكون من أجزاء الميتة أو ما لا يؤكل لحمه (على الأحوط)، وألا يكون حريراً خالصاً أو ذهباً للرجال.</p>
                 <span class="citation">المصدر: موقع مكتب سماحة السيد السيستاني (دام ظله)، منهاج الصالحين والمسائل المنتخبة.</span>
            </div>
        </section>

        <section id="how-to-pray" class="content-section alternate-bg">
            <div class="container">
                <h2>كيفية الصلاة</h2>
                <p>الصلاة هي عمود الدين، وفيما يلي بيان لواجباتها الأساسية دون المستحبات، لتكون صلاتك صحيحة ومقبولة بإذن الله.</p>
                <h3>واجبات الصلاة:</h3>
                <ul>
                    <li><strong>النية:</strong> وهي القصد القلبي لأداء صلاة معينة قربةً إلى الله تعالى، ولا يلزم التلفظ بها.</li>
                    <li><strong>تكبيرة الإحرام:</strong> قول "الله أكبر" في بداية الصلاة مع استقرار البدن.</li>
                    <li><strong>القيام:</strong> الوقوف منتصباً أثناء تكبيرة الإحرام والقراءة قبل الركوع.</li>
                    <li><strong>القراءة:</strong> قراءة سورة الحمد وسورة كاملة أخرى في الركعتين الأولى والثانية. في الركعتين الثالثة والرابعة، يتخير المصلي بين قراءة سورة الحمد وحدها أو التسبيحات الأربع.</li>
                    <li><strong>الركوع:</strong> الانحناء بعد القراءة حتى تصل أطراف الأصابع إلى الركبة، وقول الذكر الواجب.</li>
                    <li><strong>السجود:</strong> وضع المساجد السبعة (الجبهة، الكفان، الركبتان، وإبهاما القدمين) على ما يصح السجود عليه، وقول الذكر الواجب.</li>
                    <li><strong>التشهد:</strong> الجلوس بعد السجدة الثانية من الركعة الثانية والركعة الأخيرة وقول التشهد.</li>
                    <li><strong>التسليم:</strong> وهو آخر أجزاء الصلاة.</li>
                    <li><strong>الترتيب والموالاة:</strong> أداء أفعال الصلاة بالترتيب المذكور دون فاصل زمني طويل بينها.</li>
                </ul>
                <span class="citation">المصدر: موقع مكتب سماحة السيد السيستاني (دام ظله)، منهاج الصالحين والمسائل المنتخبة.</span>
            </div>
        </section>

        <section id="prayer-times" class="content-section">
            <div class="container">
                <h2>أوقات الصلاة</h2>
                <p>لكل صلاة من الفرائض اليومية وقت محدد شرعاً، والالتزام به شرط لصحتها أداءً.</p>
                <h3>أوقات الفرائض اليومية:</h3>
                <ul>
                    <li><strong>صلاة الصبح:</strong> وقتها من طلوع الفجر الصادق إلى طلوع الشمس.</li>
                    <li><strong>صلاتا الظهر والعصر:</strong> وقتهما من زوال الشمس (منتصف النهار) إلى المغرب الشرعي. تختص صلاة الظهر بأول الوقت بمقدار أدائها، وتختص صلاة العصر بآخر الوقت بمقدار أدائها، وما بينهما وقت مشترك لهما.</li>
                    <li><strong>صلاتا المغرب والعشاء:</strong> وقتهما للمختار من المغرب الشرعي (بعد ذهاب الحمرة المشرقية) إلى منتصف الليل. تختص صلاة المغرب بأول الوقت بمقدار أدائها، وتختص العشاء بآخر الوقت بمقدار أدائها، وما بينهما وقت مشترك.</li>
                </ul>
                <h3>أوقات الفضيلة:</h3>
                <ul>
                    <li><strong>فضيلة الظهر:</strong> من الزوال حتى بلوغ ظل الشاخص مثله.</li>
                    <li><strong>فضيلة العصر:</strong> من بلوغ الظل مثله إلى بلوغه مثلين.</li>
                    <li><strong>فضيلة المغرب:</strong> لغير المسافر، من المغرب الشرعي إلى ذهاب الشفق (الحمرة المغربية).</li>
                    <li><strong>فضيلة العشاء:</strong> من ذهاب الشفق إلى ثلث الليل.</li>
                </ul>
                 <span class="citation">المصدر: موقع مكتب سماحة السيد السيستاني (دام ظله)، منهاج الصالحين، والاستفتاءات.</span>
            </div>
        </section>

        <section id="prayer-rulings" class="content-section alternate-bg">
            <div class="container">
                <h2>أحكام الصلاة (الشك والسهو)</h2>
                <p>قد يطرأ على المصلي الشك أو السهو أثناء صلاته، وقد بيّن الفقهاء أحكاماً خاصة لمعالجة هذه الحالات لضمان صحة الصلاة.</p>
                <h3>أحكام الشكوك:</h3>
                <ul>
                    <li><strong>الشكوك التي تبطل الصلاة:</strong> الشك في عدد ركعات صلاة الصبح والمغرب، والشك في الركعتين الأوليين من الصلوات الرباعية يبطل الصلاة إذا لم يترجح ظن المصلي لأحد الطرفين.</li>
                    <li><strong>الشكوك التي لا تبطل الصلاة:</strong> هناك شكوك لها علاج، مثل الشك بين الثلاث والأربع، حيث يبني المصلي على الأكثر (الأربع) ثم يأتي بركعة احتياط.</li>
                    <li><strong>كثير الشك:</strong> من يكثر شكه في الصلاة لا يعتني بشكه ويبني على وقوع الفعل المشكوك فيه، إلا إذا كان هذا البناء مفسداً للصلاة.</li>
                </ul>
                <h3>أحكام السهو:</h3>
                <p>السهو في الصلاة قد يوجب الإتيان بسجدتي السهو أو قضاء الجزء المنسي.</p>
                <ul>
                    <li><strong>سجود السهو:</strong> يجب الإتيان بسجدتي السهو لعدة أمور، منها: الكلام سهواً، والتسليم في غير موضعه، ونسيان التشهد، والشك بين الركعة الرابعة والخامسة بعد إكمال السجدتين. كيفية سجود السهو هي نية ثم سجدتان، في كل سجدة ذكر معين (مثل: بسم الله وبالله، السلام عليك أيها النبي ورحمة الله وبركاته)، ثم تشهد وتسليم.</li>
                    <li><strong>قضاء الأجزاء المنسية:</strong> من نسي سجدة واحدة أو أكثر ولم يمكن تداركها في الصلاة، يجب عليه قضاؤها بعد الصلاة مباشرة، ثم الإتيان بسجود السهو لنسيان السجدة.</li>
                </ul>
                <span class="citation">المصدر: موقع مكتب سماحة السيد السيستاني (دام ظله)، الوجيز في أحكام العبادات والمسائل المنتخبة.</span>
            </div>
        </section>

        <section id="missed-prayers" class="content-section">
            <div class="container">
                <h2>كيفية قضاء الصلوات الفائتة</h2>
                <p>من فاتته فريضة يومية عمداً أو سهواً أو لأي سبب آخر، يجب عليه قضاؤها خارج وقتها.</p>
                <h3>أحكام القضاء:</h3>
                <ul>
                    <li><strong>وقت القضاء:</strong> يجوز قضاء الصلوات الفائتة في أي وقت من ليل أو نهار.</li>
                    <li><strong>كيفية القضاء:</strong> ما فات في الحضر يُقضى تماماً، وما فات في السفر يُقضى قصراً.</li>
                    <li><strong>الترتيب في القضاء:</strong> لا يجب الترتيب في قضاء الصلوات الفائتة، إلا بين الصلوات المترتبة في أصلها كالظهر والعصر من نفس اليوم.</li>
                    <li><strong>عدم معرفة عدد الفوائت:</strong> إذا لم يعلم المكلف بعدد الصلوات التي فاتته، يجوز له الاقتصار على قضاء القدر المتيقن الذي يعلم بفواته.</li>
                </ul>
                <span class="citation">المصدر: موقع مكتب سماحة السيد السيستاني (دام ظله)، منهاج الصالحين.</span>
            </div>
        </section>
    </main>

    <footer class="main-footer">
        <div class="container">
            <p>&copy; 2025 دليل الصلاة الجعفرية.</p>
            <p class="footer-credit">
                إعداد ومراجعة: 
                <a href="https://wa.me/97333375858" target="_blank" rel="noopener noreferrer">فاضل الريس</a>
            </p>
        </div>
    </footer>

    <a href="#" class="back-to-top" aria-label="العودة إلى الأعلى"><i class="fas fa-arrow-up"></i></a>

    <script>
        // Back to top button
        const backToTopButton = document.querySelector('.back-to-top');
        window.addEventListener('scroll', () => {
            if (window.scrollY > 300) {
                backToTopButton.classList.add('visible');
            } else {
                backToTopButton.classList.remove('visible');
            }
        });

        // Prayer Times Widget Logic
        document.addEventListener('DOMContentLoaded', () => {
            const prayerList = document.getElementById('prayer-times-list');
            const widgetMessage = document.getElementById('widget-message');
            const dateDisplay = document.getElementById('date-display');
            const countdownDisplay = document.getElementById('countdown-display');
            let countdownInterval;

            const createTimeRow = (label, time) => {
                return `<li class="prayer-time-row"><div class="prayer-name">${label}</div><div class="prayer-time">${time}</div></li>`;
            };

            const parseTimeToDate = (timeStr) => {
                const [time, modifier] = timeStr.split(' ');
                let [hours, minutes] = time.split(':');
                hours = parseInt(hours, 10);
                if (modifier && modifier.toLowerCase() === 'م' && hours !== 12) {
                    hours += 12;
                }
                if (modifier && modifier.toLowerCase() === 'ص' && hours === 12) { // Midnight case (12 AM)
                    hours = 0;
                }
                const date = new Date();
                date.setHours(hours, parseInt(minutes, 10), 0, 0);
                return date;
            };

            const startCountdown = (prayerTimes) => {
                if (countdownInterval) clearInterval(countdownInterval);

                countdownInterval = setInterval(() => {
                    const now = new Date();
                    let nextPrayerName = null;
                    let nextPrayerTime = null;

                    // Find the next prayer for today
                    for (const prayer of prayerTimes) {
                        if (prayer.time > now) {
                            nextPrayerName = prayer.name;
                            nextPrayerTime = prayer.time;
                            break;
                        }
                    }

                    // If all prayers for today are done, next is Fajr of tomorrow
                    if (!nextPrayerName) {
                        nextPrayerName = prayerTimes[0].name;
                        nextPrayerTime = new Date(prayerTimes[0].time);
                        nextPrayerTime.setDate(nextPrayerTime.getDate() + 1);
                    }

                    const diff = nextPrayerTime - now;
                    const hours = Math.floor(diff / (1000 * 60 * 60));
                    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((diff % (1000 * 60)) / 1000);

                    countdownDisplay.textContent = `الوقت المتبقي لآذان ${nextPrayerName}: ${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                }, 1000);
            };

            const getPrayerTimes = (latitude, longitude) => {
                const date = new Date();
                const year = date.getFullYear();
                const month = date.getMonth() + 1;
                const day = date.getDate();
                // Method 2: Ja'fari (Shia Ithna-Ashari)
                const url = `https://api.aladhan.com/v1/calendar/${year}/${month}?latitude=${latitude}&longitude=${longitude}&method=2`;

                fetch(url)
                    .then(response => response.json())
                    .then(data => {
                        if
                        const todayData = data.data[day - 1];
                        const timings = todayData.timings;
                        const hijriDate = todayData.date.hijri;

                        // Display Dates
                        const gregorianDateStr = new Intl.DateTimeFormat('ar-EG-u-nu-latn', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }).format(date);
                        const hijriDateStr = `${hijriDate.day} ${hijriDate.month.ar} ${hijriDate.year} هـ`;
                        dateDisplay.innerHTML = `${gregorianDateStr}<br>${hijriDateStr}`;

                        // Correct Maghrib time (add ~10-15 minutes to Sunset)
                        const sunsetTime = parseTimeToDate(timings.Sunset.split(' ')[0]);
                        sunsetTime.setMinutes(sunsetTime.getMinutes() + 14); // Adding 14 minutes as a safe average
                        const maghribHour = sunsetTime.getHours();
                        const maghribMinute = sunsetTime.getMinutes();
                        const ampm = maghribHour >= 12 ? 'م' : 'ص';
                        const formattedMaghribHour = ((maghribHour + 11) % 12 + 1);
                        const correctedMaghrib = `${formattedMaghribHour.toString().padStart(2, '0')}:${maghribMinute.toString().padStart(2, '0')} ${ampm}`;

                        const prayerTimesMap = [
                            { name: 'الفجر', time: timings.Fajr.split(' ')[0] },
                            { name: 'الشروق', time: timings.Sunrise.split(' ')[0] },
                            { name: 'الظهر', time: timings.Dhuhr.split(' ')[0] },
                            { name: 'الغروب', time: timings.Sunset.split(' ')[0] },
                            { name: 'المغرب', time: correctedMaghrib },
                            { name: 'منتصف الليل', time: timings.Midnight.split(' ')[0] }
                        ];

                        prayerList.innerHTML = ''; // Clear previous list
                        const prayerTimesForCountdown = [];

                        prayerTimesMap.forEach(p => {
                            const time24 = p.time;
                            const [hour, minute] = time24.split(':');
                            const d = new Date();
                            d.setHours(parseInt(hour), parseInt(minute), 0, 0);
                            
                            const ampm = d.getHours() >= 12 ? 'م' : 'ص';
                            const formattedHour = ((d.getHours() + 11) % 12 + 1);
                            const formattedTime = `${formattedHour.toString().padStart(2, '0')}:${minute} ${ampm}`;

                            prayerList.innerHTML += createTimeRow(p.name, formattedTime);
                            
                            // Prepare for countdown
                            if (p.name !== 'الشروق' && p.name !== 'الغروب' && p.name !== 'منتصف الليل') {
                                 prayerTimesForCountdown.push({ name: p.name, time: parseTimeToDate(formattedTime) });
                            }
                        });
                        
                        prayerTimesForCountdown.sort((a, b) => a.time - b.time);
                        startCountdown(prayerTimesForCountdown);
                        widgetMessage.style.display = 'none';

                    } else {
                        widgetMessage.textContent = 'حدث خطأ أثناء جلب مواقيت الصلاة.';
                    }
                })
                .catch(error => {
                    console.error('Error fetching prayer times:', error);
                    widgetMessage.textContent = 'لا يمكن الاتصال بخادم المواقيت. يرجى التحقق من اتصالك بالإنترنت.';
                });
        };

        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    getPrayerTimes(position.coords.latitude, position.coords.longitude);
                },
                (error) => {
                    console.error("Geolocation error:", error);
                    widgetMessage.textContent = 'يرجى السماح بالوصول إلى الموقع لعرض مواقيت الصلاة.';
                }
            );
        } else {
            widgetMessage.textContent = 'المتصفح لا يدعم خدمة تحديد المواقع.';
        }
    });
</script>

</body>
</html>
