<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CV â€” Ù…Ù†Ø´Ø¦ Ø³ÙŠØ±Ø© Ø°Ø§ØªÙŠØ© Ø¨Ø³ÙŠØ· ÙˆÙ…ØªØ¬Ø§ÙˆØ¨ (Ø¹Ø±Ø¨ÙŠ/English)</title>

<!-- Ø®Ø·ÙˆØ· Ø§Ø­ØªØ±Ø§ÙÙŠØ© ØªØ¯Ø¹Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆØ§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© -->
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@400;600;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
  /* ============ ØªØµÙ…ÙŠÙ… Ø°Ù‡Ø¨ÙŠ/Ø£Ø¨ÙŠØ¶ Ù…Ø¹ Ù„Ù…Ø³Ø§Øª Ø§Ø­ØªØ±Ø§ÙÙŠØ© ============ */
  :root{
    --gold:#D4AF37;           /* Ø°Ù‡Ø¨ÙŠØ© Ø£Ù†ÙŠÙ‚Ø© */
    --gold-2:#c8a23a;         /* Ø¯Ø±Ø¬Ø© Ø£ØºÙ…Ù‚ Ù„Ù„Ù‡ÙˆÙØ± */
    --ink:#0f172a;            /* Ù†Øµ Ø£Ø³Ø§Ø³ÙŠ */
    --muted:#6b7280;          /* Ù†Øµ Ø«Ø§Ù†ÙˆÙŠ */
    --paper:#ffffff;          /* Ø®Ù„ÙÙŠØ© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
    --bg:#faf9f6;             /* Ø®Ù„ÙÙŠØ© Ø¹Ø§Ù…Ø© Ø¯Ø§ÙØ¦Ø© */
    --border:#ece7da;         /* Ø­Ø¯ Ù…Ø­Ø§ÙŠØ¯ Ù…Ø§Ø¦Ù„ Ù„Ù„Ø°Ù‡Ø¨ÙŠ */
    --shadow:0 10px 24px rgba(15,23,42,.06);
    --radius:16px;
  }
  *,*::before,*::after{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;background:var(--bg);color:var(--ink);
    font-family:"IBM Plex Sans Arabic","Inter",system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,sans-serif;
    -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  }

  /* ===== ØªØ®Ø·ÙŠØ· Ù…ØªØ¬Ø§ÙˆØ¨ Ø¨Ø³ÙŠØ·: Ø¹Ù…ÙˆØ¯ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø§ØªÙØŒ Ø¹Ù…ÙˆØ¯Ø§Ù† Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ø£ÙˆØ³Ø¹ ===== */
  .container{
    max-width:1200px;margin-inline:auto;padding:16px;
    display:grid;gap:16px;grid-template-columns:1fr;
  }
  @media(min-width:992px){
    .container{grid-template-columns:420px 1fr}
  }

  /* ===== Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ (Ø£Ø³Ù‡Ù„ Ù…Ø§ ÙŠÙƒÙˆÙ†) ===== */
  .panel{
    background:var(--paper);border:1px solid var(--border);border-radius:var(--radius);
    box-shadow:var(--shadow);padding:16px;
  }
  .panel h1{
    margin:0 0 8px;font-weight:700;font-size:1.35rem;
    letter-spacing:.2px
  }
  .sub{
    margin:0 0 12px;color:var(--muted);font-size:.95rem
  }

  /* Ø´Ø±ÙŠØ· Ø®Ø·ÙˆØ§Øª Ø¨Ø³ÙŠØ· Ù„Ø³Ù‡ÙˆÙ„Ø© Ø§Ù„ØªÙ†Ù‚Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø§ØªÙ */
  .steps{
    display:flex;gap:6px;flex-wrap:wrap;margin-bottom:10px
  }
  .step{
    flex:1;min-width:120px;text-align:center;padding:.6rem .8rem;cursor:pointer;
    border:1px solid var(--border);border-radius:12px;background:#fff;font-weight:700
  }
  .step.active{border-color:var(--gold);box-shadow:0 0 0 2px #0000, inset 0 0 0 999px rgba(212,175,55,.06)}
  .sections > .section{display:none}
  .sections > .section.active{display:block}

  /* Ø­Ù‚ÙˆÙ„ Ù…Ø¨Ø³Ø·Ø© Ø¨Ù…Ù„ØµÙ‚ Ø¹Ø§Ø¦Ù… */
  .field{position:relative;margin:12px 0}
  .input, .textarea, .select{
    width:100%;padding:14px 12px;border:1px solid var(--border);border-radius:12px;background:#fff;font-weight:600
  }
  .textarea{min-height:96px;resize:vertical}
  .label{
    position:absolute;inset-inline-start:12px;top:50%;transform:translateY(-50%);
    background:#fff;padding:0 6px;color:#8b8b8b;font-weight:600;pointer-events:none;transition:.15s ease;
  }
  .input:focus + .label, .textarea:focus + .label, .input:not(:placeholder-shown)+.label, .textarea:not(:placeholder-shown)+.label{
    top:-8px;font-size:.78rem;color:var(--gold)
  }

  /* Ø´Ø¨ÙƒØ§Øª Ø³Ù‡Ù„Ø© */
  .row{display:grid;gap:10px}
  @media(min-width:600px){ .row.cols-2{grid-template-columns:1fr 1fr} }
  @media(min-width:800px){ .row.cols-3{grid-template-columns:1fr 1fr 1fr} }

  /* Ø£Ø²Ø±Ø§Ø± ÙƒØ¨ÙŠØ±Ø© Ù„Ù…Ø³/Ù…Ø­Ù…ÙˆÙ„ */
  .btn{
    border:1px solid var(--border);background:#fff;border-radius:12px;padding:.75rem 1rem;font-weight:800;cursor:pointer
  }
  .btn.gold{background:linear-gradient(180deg,#f9eac0,#f5d774);border-color:#e7c96a}
  .btn.gold:hover{filter:saturate(1.05) brightness(1.01)}
  .btn.ghost{background:#fff}
  .btn.icon{display:inline-flex;align-items:center;gap:8px}

  /* Ø´Ø±ÙŠØ· ØªØµØ¯ÙŠØ± Ù„Ø§ØµÙ‚ Ø£Ø³ÙÙ„ Ø§Ù„Ø´Ø§Ø´Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø§ØªÙ */
  .sticky-actions{
    position:sticky;bottom:0;background:#fff;border:1px solid var(--border);
    border-radius:14px;padding:10px;display:flex;gap:8px;flex-wrap:wrap;justify-content:space-between;margin-top:12px
  }
  .hint{color:var(--muted);font-size:.85rem}

  /* ===== Ù…Ø¹Ø§ÙŠÙ†Ø© CV Ù…ØªØ¬Ø§ÙˆØ¨Ø© ===== */
  .preview{
    background:var(--paper);border:1px solid var(--border);border-radius:var(--radius);
    box-shadow:var(--shadow);padding:0;overflow:hidden
  }
  .cv{
    width:100%;max-width:900px;margin:auto;padding:18px 18px 24px;
  }
  @media(min-width:992px){
    .cv{padding:26px 30px}
  }

  .cv-head{display:grid;gap:14px;grid-template-columns:1fr 120px;align-items:center}
  .cv-name{margin:0;font-size:1.5rem;font-weight:700;letter-spacing:.2px}
  .cv-role{margin:2px 0 6px;font-weight:700;color:#5b4a11}
  .cv-photo{width:120px;height:120px;border-radius:14px;border:2px solid var(--gold);object-fit:cover;background:#f1f1f1;justify-self:end}
  .cv-summary{color:#374151;line-height:1.8;white-space:pre-line}
  .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
  .chip{
    display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border:1px solid var(--border);border-radius:999px;background:#fff;font-weight:700
  }

  .cv-grid{display:grid;gap:16px;margin-top:16px}
  @media(min-width:820px){ .cv-grid{grid-template-columns:1.15fr .85fr} }

  .sec-title{
    font-weight:800;margin:0 0 8px;display:inline-block;padding-bottom:4px;
    border-bottom:3px solid var(--gold);letter-spacing:.3px
  }
  .item{margin:10px 0}
  .item .top{display:flex;justify-content:space-between;font-weight:700}
  .item .meta{color:#6b7280;font-weight:600}
  .item .desc{margin-top:6px;color:#374151;white-space:pre-line}
  .tags{display:flex;flex-wrap:wrap;gap:8px;margin-top:6px}
  .tag{padding:6px 10px;border-radius:999px;background:#fff;border:1px dashed var(--gold);font-weight:700}

  /* Ø·Ø¨Ø§Ø¹Ø©: A4 Ù†Ø¸ÙŠÙØ© */
  @media print{
    body{background:#fff}
    .container{display:block}
    .panel{display:none}
    .preview{border:none;box-shadow:none}
    .cv{max-width:none;padding:0}
    @page{size:A4;margin:12mm}
  }
</style>
</head>
<body>

<div class="container">
  <!-- ========== Ù„ÙˆØ­Ø© Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ø³Ø·Ø© ÙˆÙ…ØªØ¬Ø§ÙˆØ¨Ø© ========== -->
  <section class="panel" id="formPanel">
    <h1>Ù…Ù†Ø´Ø¦ Ø³ÙŠØ±Ø© Ø°Ø§ØªÙŠØ© â€” Ø¨Ø³ÙŠØ· ÙˆÙ…ØªØ¬Ø§ÙˆØ¨</h1>
    <p class="sub">Ø§Ù…Ù„Ø£ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø¨Ø³Ø±Ø¹Ø©. ÙŠØ¯Ø¹Ù… Ø¹Ø±Ø¨ÙŠ/English ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§. Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø°Ù‡Ø¨ÙŠØ©/Ø¨ÙŠØ¶Ø§Ø¡ Ù…Ø¹ Ù…Ø¸Ù‡Ø± Ø§Ø­ØªØ±Ø§ÙÙŠ.</p>

    <!-- Ø®Ø·ÙˆØ§Øª Ù„Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø³Ø±ÙŠØ¹ (Ø³Ù‡Ù„Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø§ØªÙ) -->
    <div class="steps" role="tablist" aria-label="Ø®Ø·ÙˆØ§Øª Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø³ÙŠØ±Ø©">
      <button class="step active" data-step="basic" role="tab">Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ§Øª</button>
      <button class="step" data-step="exp" role="tab">Ø§Ù„Ø®Ø¨Ø±Ø§Øª</button>
      <button class="step" data-step="edu" role="tab">Ø§Ù„ØªØ¹Ù„ÙŠÙ…/Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª</button>
      <button class="step" data-step="more" role="tab">Ø§Ù„Ù…Ø²ÙŠØ¯</button>
    </div>

    <div class="sections">
      <!-- Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ§Øª -->
      <div class="section active" id="sec-basic">
        <div class="row cols-2">
          <div class="field">
            <input class="input" id="name" placeholder=" " />
            <label class="label" for="name">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ / Full Name</label>
          </div>
          <div class="field">
            <input class="input" id="role" placeholder=" " />
            <label class="label" for="role">Ø§Ù„Ù…Ø³Ù…Ù‘Ù‰ / Title</label>
          </div>
        </div>

        <div class="field">
          <textarea class="textarea" id="summary" placeholder=" "></textarea>
          <label class="label" for="summary">Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ù‡Ù†ÙŠ / Professional Summary (Ø³Ø·Ø±ÙŠÙ† Ø¥Ù„Ù‰ 4)</label>
        </div>

        <div class="row cols-2">
          <div class="field">
            <input class="input" id="email" placeholder=" " />
            <label class="label" for="email">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ / Email</label>
          </div>
          <div class="field">
            <input class="input" id="phone" placeholder=" " />
            <label class="label" for="phone">Ø§Ù„Ù‡Ø§ØªÙ / Phone</label>
          </div>
        </div>

        <div class="row cols-2">
          <div class="field">
            <input class="input" id="location" placeholder=" " />
            <label class="label" for="location">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©ØŒ Ø§Ù„Ø¯ÙˆÙ„Ø© / City, Country</label>
          </div>
          <div class="field">
            <input class="input" id="linkedin" placeholder=" " />
            <label class="label" for="linkedin">LinkedIn</label>
          </div>
        </div>

        <div class="row cols-2">
          <div class="field">
            <input class="input" id="website" placeholder=" " />
            <label class="label" for="website">Website / Portfolio</label>
          </div>
          <div class="field">
            <select class="select" id="uiLang">
              <option value="ar" selected>ÙˆØ§Ø¬Ù‡Ø© Ø¹Ø±Ø¨ÙŠØ© (RTL)</option>
              <option value="en">English UI (LTR)</option>
            </select>
          </div>
        </div>

        <div class="row cols-2" style="align-items:center">
          <div class="field">
            <input class="input" id="accent" type="color" value="#D4AF37" />
            <label class="label" for="accent">Ù„ÙˆÙ† Ø§Ù„Ù„Ù…Ø³Ø© (Accent)</label>
          </div>
          <div class="field">
            <input class="input" id="photo" type="file" accept="image/*" />
            <label class="label" for="photo">ØµÙˆØ±Ø© Ø´Ø®ØµÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
          </div>
        </div>
      </div>

      <!-- Ø§Ù„Ø®Ø¨Ø±Ø§Øª -->
      <div class="section" id="sec-exp">
        <div id="expList"></div>
        <button class="btn icon gold" type="button" id="addExp">â• Ø¥Ø¶Ø§ÙØ© Ø®Ø¨Ø±Ø©</button>
      </div>

      <!-- Ø§Ù„ØªØ¹Ù„ÙŠÙ… ÙˆØ§Ù„Ù…Ù‡Ø§Ø±Ø§Øª -->
      <div class="section" id="sec-edu">
        <div id="eduList"></div>
        <button class="btn icon gold" type="button" id="addEdu">â• Ø¥Ø¶Ø§ÙØ© ØªØ¹Ù„ÙŠÙ…</button>

        <div class="field" style="margin-top:12px">
          <input class="input" id="skills" placeholder=" " />
          <label class="label" for="skills">Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª (Ø§ÙƒØªØ¨Ù‡Ø§ Ø¨ÙÙˆØ§ØµÙ„) â€” Skills (comma separated)</label>
        </div>

        <div class="row cols-2">
          <div class="field">
            <input class="input" id="lang1" placeholder=" " />
            <label class="label" for="lang1">Ø§Ù„Ù„ØºØ© Ø§Ù„Ø£ÙˆÙ„Ù‰ â€” Language</label>
          </div>
          <div class="field">
            <input class="input" id="lang1lvl" placeholder=" " />
            <label class="label" for="lang1lvl">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ â€” Level</label>
          </div>
        </div>
        <div class="row cols-2">
          <div class="field">
            <input class="input" id="lang2" placeholder=" " />
            <label class="label" for="lang2">Ø§Ù„Ù„ØºØ© Ø§Ù„Ø«Ø§Ù†ÙŠØ© â€” Language</label>
          </div>
          <div class="field">
            <input class="input" id="lang2lvl" placeholder=" " />
            <label class="label" for="lang2lvl">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ â€” Level</label>
          </div>
        </div>
      </div>

      <!-- Ø§Ù„Ù…Ø²ÙŠØ¯: Ù…Ø´Ø§Ø±ÙŠØ¹/Ø´Ù‡Ø§Ø¯Ø§Øª + ØªØµØ¯ÙŠØ± -->
      <div class="section" id="sec-more">
        <div id="projList"></div>
        <button class="btn icon gold" type="button" id="addProj">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±ÙˆØ¹</button>

        <div style="height:8px"></div>

        <div id="certList"></div>
        <button class="btn icon gold" type="button" id="addCert">â• Ø¥Ø¶Ø§ÙØ© Ø´Ù‡Ø§Ø¯Ø©</button>

        <div class="sticky-actions">
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <button class="btn gold" id="pdfAR" type="button">â¬‡ï¸ PDF (Ø¹Ø±Ø¨ÙŠ)</button>
            <button class="btn gold" id="pdfEN" type="button">â¬‡ï¸ PDF (English)</button>
            <button class="btn ghost" id="docAR" type="button">â¬‡ï¸ Word (AR)</button>
            <button class="btn ghost" id="docEN" type="button">â¬‡ï¸ Word (EN)</button>
          </div>
          <button class="btn" id="clearAll" type="button">Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
        </div>
        <div class="hint">Ù†ØµÙŠØ­Ø©: Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø§ØªÙØŒ Ø³ÙŠØ¸Ù‡Ø± Ø´Ø±ÙŠØ· Ø§Ù„ØªØµØ¯ÙŠØ± Ø¯Ø§Ø¦Ù…Ù‹Ø§ Ø£Ø³ÙÙ„ Ø§Ù„Ù‚Ø³Ù… Ù„Ø³Ù‡ÙˆÙ„Ø© Ø§Ù„ÙˆØµÙˆÙ„.</div>
      </div>
    </div>
  </section>

  <!-- ========== Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© (Ù…Ø±Ù†Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø§ØªÙ) ========== -->
  <section class="preview" aria-label="Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø³ÙŠØ±Ø©">
    <div class="cv" id="cv">
      <div class="cv-head">
        <div>
          <h2 class="cv-name" id="cvName">Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„ / Your Name</h2>
          <div class="cv-role" id="cvRole">Ø§Ù„Ù…Ø³Ù…Ù‘Ù‰ / Title</div>
          <div class="cv-summary" id="cvSummary">Ø§ÙƒØªØ¨ Ù…Ù„Ø®ØµÙ‹Ø§ Ù‚ØµÙŠØ±Ù‹Ø§ Ø¹Ù† Ø®Ø¨Ø±ØªÙƒ.\nWrite a brief professional summary.</div>
        </div>
        <img class="cv-photo" id="cvPhoto" alt="" style="display:none"/>
      </div>

      <div class="chips" id="cvChips">
        <span class="chip" id="cEmail" style="display:none">âœ‰ï¸ <b></b></span>
        <span class="chip" id="cPhone" style="display:none">ğŸ“ <b></b></span>
        <span class="chip" id="cLoc"   style="display:none">ğŸ“ <b></b></span>
        <span class="chip" id="cLn"    style="display:none">ğŸ”— <b>LinkedIn</b></span>
        <span class="chip" id="cWeb"   style="display:none">ğŸŒ <b>Website</b></span>
      </div>

      <div class="cv-grid">
        <div>
          <h3 class="sec-title" id="hExp">Ø§Ù„Ø®Ø¨Ø±Ø§Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</h3>
          <div id="cvExp" class="items"></div>

          <h3 class="sec-title" id="hProj" style="margin-top:12px">Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</h3>
          <div id="cvProj" class="items"></div>
        </div>
        <div>
          <h3 class="sec-title" id="hEdu">Ø§Ù„ØªØ¹Ù„ÙŠÙ…</h3>
          <div id="cvEdu" class="items"></div>

          <h3 class="sec-title" id="hSkills" style="margin-top:12px">Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª</h3>
          <div class="tags" id="cvSkills"><span class="tag">HTML</span><span class="tag">CSS</span></div>

          <h3 class="sec-title" id="hLang" style="margin-top:12px">Ø§Ù„Ù„ØºØ§Øª</h3>
          <div id="cvLangs" class="items"></div>

          <h3 class="sec-title" id="hCert" style="margin-top:12px">Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª</h3>
          <div id="cvCerts" class="items"></div>
        </div>
      </div>
    </div>
  </section>
</div>

<script>
/* ===== Ø£Ø¯ÙˆØ§Øª Ø³Ø±ÙŠØ¹Ø© ===== */
const $=s=>document.querySelector(s);
const $$=s=>Array.from(document.querySelectorAll(s));
const fmtRange=(a,b)=>[a,b].filter(Boolean).join(" â€” ");
const bullets=t=>(t||'').split(/\r?\n/).filter(x=>x.trim()).map(x=>'â€¢ '+x.trim()).join('\n');

/* ===== ØªØ¨Ø³ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ù… (Ø®Ø·ÙˆØ© ÙˆØ§Ø­Ø¯Ø© ÙƒÙ„ Ù…Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø§ØªÙ) ===== */
const sections = {
  basic: $('#sec-basic'),
  exp: $('#sec-exp'),
  edu: $('#sec-edu'),
  more: $('#sec-more')
};
$$('.step').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    $$('.step').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    const key = btn.dataset.step;
    Object.values(sections).forEach(s=>s.classList.remove('active'));
    sections[key].classList.add('active');
    window.scrollTo({top:0, behavior:'smooth'});
  });
});

/* ===== Ø±Ø¨Ø· Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¨Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© (Ø³Ù‡Ù„ ÙˆÙˆØ§Ø¶Ø­) ===== */
const state = {
  ui:'ar',
  name:'', role:'', summary:'',
  email:'', phone:'', location:'', linkedin:'', website:'',
  accent:'#D4AF37',
  exp:[], edu:[], proj:[], cert:[],
  langs:[]
};
const bind = (id, key, cb=render)=>$(id).addEventListener('input', e=>{ state[key]=e.target.value; cb(); });

bind('#name','name');
bind('#role','role');
bind('#summary','summary');
bind('#email','email');
bind('#phone','phone');
bind('#location','location');
bind('#linkedin','linkedin');
bind('#website','website');
bind('#accent','accent', ()=>{
  document.documentElement.style.setProperty('--gold', state.accent || '#D4AF37');
  render();
});

$('#uiLang').addEventListener('change', e=>{
  state.ui = e.target.value;
  document.documentElement.dir = state.ui==='ar' ? 'rtl' : 'ltr';
  document.documentElement.lang = state.ui;
  // ØªØ±Ø¬Ù…Ø§Øª Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ÙÙ‚Ø· (Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙŠØ¨Ù‚Ù‰ ÙƒÙ…Ø§ ÙƒØªØ¨Ù‡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…)
  const T = state.ui==='ar' ? {
    exp:'Ø§Ù„Ø®Ø¨Ø±Ø§Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ©', proj:'Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹', edu:'Ø§Ù„ØªØ¹Ù„ÙŠÙ…', skills:'Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª', lang:'Ø§Ù„Ù„ØºØ§Øª', cert:'Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª'
  } : {
    exp:'Experience', proj:'Projects', edu:'Education', skills:'Skills', lang:'Languages', cert:'Certificates'
  };
  $('#hExp').textContent=T.exp; $('#hProj').textContent=T.proj; $('#hEdu').textContent=T.edu;
  $('#hSkills').textContent=T.skills; $('#hLang').textContent=T.lang; $('#hCert').textContent=T.cert;
  render();
});

/* ===== ØµÙˆØ±Ø© Ø´Ø®ØµÙŠØ© Ù…Ø¨Ø³Ø·Ø© ===== */
$('#photo').addEventListener('change', e=>{
  const f = e.target.files?.[0]; if(!f) return;
  const reader = new FileReader();
  reader.onload = ev => {
    $('#cvPhoto').src = ev.target.result;
    $('#cvPhoto').style.display='block';
  };
  reader.readAsDataURL(f);
});

/* ===== Ø¹Ù†Ø§ØµØ± Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ© ØµØºÙŠØ±Ø© ÙˆØ³Ù‡Ù„Ø© (Ø¨Ø·Ø§Ù‚Ø§Øª Ø¨Ø³ÙŠØ·Ø©) ===== */
function mkCard(title){
  const wrap = document.createElement('div');
  wrap.className='panel';
  wrap.style.padding='12px';
  wrap.style.margin='8px 0';
  wrap.innerHTML = `
    <div class="row cols-2">
      <div class="field"><input class="input" placeholder=" " /><label class="label">${title} / Title</label></div>
      <div class="field"><input class="input" placeholder=" " /><label class="label">Ø§Ù„Ø¬Ù‡Ø© / Company</label></div>
    </div>
    <div class="row cols-3">
      <div class="field"><input class="input" placeholder=" " /><label class="label">Ù…Ù† / From</label></div>
      <div class="field"><input class="input" placeholder=" " /><label class="label">Ø¥Ù„Ù‰ / To</label></div>
      <div class="field"><input class="input" placeholder=" " /><label class="label">Ø§Ù„Ù…ÙˆÙ‚Ø¹ / Location</label></div>
    </div>
    <div class="field"><textarea class="textarea" placeholder=" "></textarea><label class="label">ÙˆØµÙ / Description (Ø³Ø·Ø± Ù„ÙƒÙ„ Ù†Ù‚Ø·Ø©)</label></div>
    <div style="display:flex;gap:8px;justify-content:flex-end">
      <button type="button" class="btn">Ø­Ø°Ù</button>
    </div>`;
  return wrap;
}

function mkSmallCard(title){
  const wrap = document.createElement('div');
  wrap.className='panel';
  wrap.style.padding='12px';
  wrap.style.margin='8px 0';
  wrap.innerHTML = `
    <div class="row cols-2">
      <div class="field"><input class="input" placeholder=" " /><label class="label">${title} / Name</label></div>
      <div class="field"><input class="input" placeholder=" " /><label class="label">Ø§Ù„Ø¬Ù‡Ø© / Issuer</label></div>
    </div>
    <div class="row cols-2">
      <div class="field"><input class="input" placeholder=" " /><label class="label">Ø§Ù„Ø³Ù†Ø© / Year</label></div>
      <div class="field"><input class="input" placeholder=" " /><label class="label">Ø±Ø§Ø¨Ø· (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) / Link</label></div>
    </div>
    <div style="display:flex;gap:8px;justify-content:flex-end">
      <button type="button" class="btn">Ø­Ø°Ù</button>
    </div>`;
  return wrap;
}

const expList = $('#expList');
const eduList = $('#eduList');
const projList = $('#projList');
const certList = $('#certList');

function addHandlers(container, storeArr, renderTo){
  container.addEventListener('click', e=>{
    if(e.target.matches('.btn') && e.target.textContent.includes('Ø­Ø°Ù')){
      const idx = Array.from(container.children).indexOf(e.target.closest('.panel'));
      container.children[idx]?.remove();
      storeArr.splice(idx,1);
      renderTo();
    }
  });
  container.addEventListener('input', ()=>{
    storeArr.length = 0;
    Array.from(container.children).forEach(card=>{
      const ins = card.querySelectorAll('input,textarea');
      storeArr.push({
        title:ins[0].value, org:ins[1].value, from:ins[2].value, to:ins[3].value, place:ins[4].value, desc:ins[5]?.value || ''
      });
    });
    renderTo();
  });
}

$('#addExp').addEventListener('click', ()=>{
  expList.appendChild(mkCard('Ø§Ù„Ù…Ø³Ù…Ù‘Ù‰'));
  state.exp.push({}); render();
});
$('#addEdu').addEventListener('click', ()=>{
  const card = mkCard('Ø§Ù„Ø¯Ø±Ø¬Ø© / Degree'); // Ù†Ø¹ÙŠØ¯ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†ÙØ³ Ø§Ù„Ù‚Ø§Ù„Ø¨
  eduList.appendChild(card);
  state.edu.push({}); render();
});
$('#addProj').addEventListener('click', ()=>{
  const card = mkCard('Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ / Project');
  projList.appendChild(card);
  state.proj.push({}); render();
});
$('#addCert').addEventListener('click', ()=>{
  certList.appendChild(mkSmallCard('Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© / Certificate'));
  state.cert.push({}); render();
});

addHandlers(expList, state.exp, render);
addHandlers(eduList, state.edu, render);
addHandlers(projList, state.proj, render);
addHandlers(certList, state.cert, render);

/* ===== Ø±Ø¨Ø· Ù„ØºØ§Øª Ø¨Ø³ÙŠØ·Ø© ===== */
function renderLanguages(){
  const arr=[];
  const l1 = $('#lang1').value?.trim(), l1l = $('#lang1lvl').value?.trim();
  const l2 = $('#lang2').value?.trim(), l2l = $('#lang2lvl').value?.trim();
  if(l1) arr.push([l1,l1l]); if(l2) arr.push([l2,l2l]);
  const box = $('#cvLangs'); box.innerHTML='';
  if(arr.length===0){ box.innerHTML='<div class="item"><div class="meta">â€”</div></div>'; return; }
  arr.forEach(([n,l])=>{
    box.insertAdjacentHTML('beforeend', `<div class="item"><div class="top"><div>${n}</div><div class="meta">${l||''}</div></div></div>`);
  });
}
$('#lang1').addEventListener('input', renderLanguages);
$('#lang1lvl').addEventListener('input', renderLanguages);
$('#lang2').addEventListener('input', renderLanguages);
$('#lang2lvl').addEventListener('input', renderLanguages);

/* ===== Ø±Ù†Ø¯Ø± Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© (Ø³Ø±ÙŠØ¹ ÙˆØ®ÙÙŠÙ) ===== */
function setChip(id, val, label){
  const el=$(id); if(!el) return;
  if(val){ el.style.display='inline-flex'; el.querySelector('b').textContent = label || val; }
  else{ el.style.display='none'; }
}
function render(){
  // Ø£Ø³Ù…Ø§Ø¡ ÙˆØ¹Ù†Ø§ÙˆÙŠÙ†
  $('#cvName').textContent = state.name || 'Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„ / Your Name';
  $('#cvRole').textContent = state.role || 'Ø§Ù„Ù…Ø³Ù…Ù‘Ù‰ / Title';
  $('#cvSummary').textContent = state.summary || 'Ø§ÙƒØªØ¨ Ù…Ù„Ø®ØµÙ‹Ø§ Ù‚ØµÙŠØ±Ù‹Ø§ Ø¹Ù† Ø®Ø¨Ø±ØªÙƒ.\nWrite a brief professional summary.';

  // Ø±Ù‚Ø§Ø¦Ù‚ ØªÙˆØ§ØµÙ„
  setChip('#cEmail', state.email);
  setChip('#cPhone', state.phone);
  setChip('#cLoc',   state.location);
  setChip('#cLn',    state.linkedin, 'LinkedIn');
  setChip('#cWeb',   state.website,  'Website');

  // Ø®Ø¨Ø±Ø§Øª
  const cvExp = $('#cvExp'); cvExp.innerHTML='';
  if(state.exp.length===0) cvExp.innerHTML='<div class="item"><div class="meta">â€”</div></div>';
  state.exp.forEach(x=>{
    cvExp.insertAdjacentHTML('beforeend', `
      <div class="item">
        <div class="top"><div>${x.title||''}${x.org?` â€” ${x.org}`:''}</div><div class="meta">${fmtRange(x.from||'',x.to||'')}</div></div>
        <div class="meta">${x.place||''}</div>
        <div class="desc">${bullets(x.desc||'')}</div>
      </div>
    `);
  });

  // ØªØ¹Ù„ÙŠÙ…
  const cvEdu = $('#cvEdu'); cvEdu.innerHTML='';
  if(state.edu.length===0) cvEdu.innerHTML='<div class="item"><div class="meta">â€”</div></div>';
  state.edu.forEach(x=>{
    cvEdu.insertAdjacentHTML('beforeend', `
      <div class="item">
        <div class="top"><div>${x.title||''}${x.org?` â€” ${x.org}`:''}</div><div class="meta">${fmtRange(x.from||'',x.to||'')}</div></div>
        <div class="meta">${x.place||''}</div>
        <div class="desc">${bullets(x.desc||'')}</div>
      </div>
    `);
  });

  // Ù…Ø´Ø§Ø±ÙŠØ¹
  const cvProj = $('#cvProj'); cvProj.innerHTML='';
  if(state.proj.length===0) cvProj.innerHTML='<div class="item"><div class="meta">â€”</div></div>';
  state.proj.forEach(x=>{
    const link = (x.place && x.place.startsWith('http')) ? ` â€” <a href="${x.place}" target="_blank" rel="noopener" style="color:var(--gold);font-weight:800">Link</a>` : '';
    cvProj.insertAdjacentHTML('beforeend', `
      <div class="item">
        <div class="top"><div>${x.title||''}</div><div class="meta">${x.org||''}</div></div>
        <div class="desc">${bullets(x.desc||'')}${link}</div>
      </div>
    `);
  });

  // Ù…Ù‡Ø§Ø±Ø§Øª
  const tags = ( ($('#skills').value||'').split(',').map(s=>s.trim()).filter(Boolean) );
  const cvSkills = $('#cvSkills'); cvSkills.innerHTML='';
  if(tags.length===0){ cvSkills.innerHTML='<span class="tag">â€”</span>'; }
  else tags.forEach(t=>cvSkills.insertAdjacentHTML('beforeend', `<span class="tag">${t}</span>`));

  // Ø´Ù‡Ø§Ø¯Ø§Øª
  const cvCerts = $('#cvCerts'); cvCerts.innerHTML='';
  if(state.cert.length===0) cvCerts.innerHTML='<div class="item"><div class="meta">â€”</div></div>';
  state.cert.forEach(x=>{
    cvCerts.insertAdjacentHTML('beforeend', `
      <div class="item">
        <div class="top"><div>${x.title||''}</div><div class="meta">${x.from||''}</div></div>
        <div class="meta">${x.org||''}</div>
      </div>
    `);
  });
}
render();

/* ===== Ù…Ø²Ø§Ù…Ù†Ø© Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒ ===== */
function syncArray(container, arr){
  arr.length = 0;
  Array.from(container.children).forEach(card=>{
    const ins = card.querySelectorAll('input,textarea');
    arr.push({
      title:ins[0]?.value||'', org:ins[1]?.value||'',
      from:ins[2]?.value||'', to:ins[3]?.value||'',
      place:ins[4]?.value||'', desc:ins[5]?.value||''
    });
  });
  render();
}
[expList,eduList,projList,certList].forEach(c=>{
  c.addEventListener('input', ()=>{
    if(c===expList) syncArray(expList,state.exp);
    if(c===eduList) syncArray(eduList,state.edu);
    if(c===projList) syncArray(projList,state.proj);
    if(c===certList) syncArray(certList,state.cert);
  });
});

/* ===== ØªØµØ¯ÙŠØ± PDF/Word (Ø¹Ø±Ø¨ÙŠ/Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ) ===== */
// Ù†Ø­Ø¶Ø± Ù†Ø³Ø®Ø© Ù†Ø¸ÙŠÙØ© Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©/Ø§Ù„ØªÙ†Ø²ÙŠÙ„
function makeCV(lang='ar'){
  const cv = $('#cv').cloneNode(true);
  cv.setAttribute('lang', lang);
  cv.setAttribute('dir', lang==='ar'?'rtl':'ltr');
  return `
<!DOCTYPE html>
<html lang="${lang}" dir="${lang==='ar'?'rtl':'ltr'}">
<head>
<meta charset="utf-8">
<title>CV</title>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@400;600;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{--gold:${getComputedStyle(document.documentElement).getPropertyValue('--gold').trim()||'#D4AF37'}}
  body{margin:0;font-family:"IBM Plex Sans Arabic","Inter",sans-serif;color:#0f172a}
  a{color:var(--gold)}
  .cv{padding:18px 18px 24px}
  .cv-head{display:grid;gap:14px;grid-template-columns:1fr 120px;align-items:center}
  .cv-name{margin:0;font-size:1.5rem;font-weight:700}
  .cv-role{margin:2px 0 6px;font-weight:700;color:#5b4a11}
  .cv-photo{width:120px;height:120px;border-radius:14px;border:2px solid var(--gold);object-fit:cover}
  .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
  .chip{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border:1px solid #ece7da;border-radius:999px;background:#fff;font-weight:700}
  .cv-grid{display:grid;gap:16px;margin-top:16px}
  @media(min-width:820px){ .cv-grid{grid-template-columns:1.15fr .85fr} }
  .sec-title{font-weight:800;margin:0 0 8px;display:inline-block;padding-bottom:4px;border-bottom:3px solid var(--gold)}
  .item{margin:10px 0}.item .top{display:flex;justify-content:space-between;font-weight:700}
  .item .meta{color:#6b7280;font-weight:600}.item .desc{margin-top:6px;color:#374151;white-space:pre-line}
  .tags{display:flex;flex-wrap:wrap;gap:8px;margin-top:6px}
  .tag{padding:6px 10px;border-radius:999px;background:#fff;border:1px dashed var(--gold);font-weight:700}
  @page{size:A4;margin:12mm}
</style>
</head>
<body>${cv.outerHTML}
<script>window.onload=()=>setTimeout(()=>window.print(),200);<\/script>
</body></html>`;
}

function exportPDF(lang='ar'){
  const w = window.open('', '_blank');
  w.document.open(); w.document.write( makeCV(lang) ); w.document.close();
}

function exportDOC(lang='ar'){
  const html = makeCV(lang).replace(/<script>[^]*<\/script>/,''); // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø³ÙƒØ±Ø¨Øª Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
  const blob = new Blob([html], {type:'application/msword'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  const fname = (state.name || (lang==='ar'?'Ø³ÙŠØ±Ø©_Ø°Ø§ØªÙŠØ©':'CV')).replace(/\s+/g,'_');
  a.href=url; a.download=`${fname}-${lang.toUpperCase()}.doc`; document.body.appendChild(a); a.click(); a.remove();
  URL.revokeObjectURL(url);
}

$('#pdfAR').onclick = ()=>exportPDF('ar');
$('#pdfEN').onclick = ()=>exportPDF('en');
$('#docAR').onclick = ()=>exportDOC('ar');
$('#docEN').onclick = ()=>exportDOC('en');

/* Ù…Ø³Ø­ Ø³Ø±ÙŠØ¹ */
$('#clearAll').onclick = ()=>{
  if(!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ')) return;
  ['name','role','summary','email','phone','location','linkedin','website','skills','lang1','lang1lvl','lang2','lang2lvl'].forEach(id=>{
    const el = document.getElementById(id); if(el) el.value='';
  });
  [expList,eduList,projList,certList].forEach(c=>c.innerHTML='');
  Object.assign(state,{name:'',role:'',summary:'',email:'',phone:'',location:'',linkedin:'',website:'',exp:[],edu:[],proj:[],cert:[]});
  $('#cvPhoto').src=''; $('#cvPhoto').style.display='none';
  render(); renderLanguages();
};

/* ØªØ¹Ø¨Ø¦Ø© Ø£Ù…Ø«Ù„Ø© Ø®ÙÙŠÙØ© (ØªØ³Ø§Ø¹Ø¯Ùƒ ØªØ¨Ø¯Ø£ ÙÙˆØ±Ø§Ù‹) */
(function demo(){
  $('#name').value='ÙØ§Ø¶Ù„ Ø§Ù„Ø±ÙŠØ³ / Fadhel Al-Rayes';
  $('#role').value='Frontend Developer / Ù…Ø·ÙˆÙ‘Ø± ÙˆØ§Ø¬Ù‡Ø§Øª';
  $('#summary').value='Ù…Ø·ÙˆÙ‘Ø± ÙˆØ§Ø¬Ù‡Ø§Øª ÙŠØ±ÙƒØ² Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¯Ø§Ø¡ ÙˆØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù….\nFrontend dev focused on UX & performance.';
  $('#email').value='you@example.com';
  $('#phone').value='+973 3x xxx xxx';
  $('#location').value='Ø§Ù„Ù…Ù†Ø§Ù…Ø©ØŒ Ø§Ù„Ø¨Ø­Ø±ÙŠÙ† / Manama, Bahrain';
  $('#linkedin').value='linkedin.com/in/username';
  $('#website').value='your-portfolio.com';
  $('#skills').value='HTML, CSS, JavaScript, React, Git, Figma';

  // Ø¥Ø¶Ø§ÙØ© Ø¨Ø·Ø§Ù‚Ø© Ø®Ø¨Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø· ÙƒØ¨Ø¯Ø§ÙŠØ©
  $('#addExp').click();
  const firstExp = expList.querySelector('.panel');
  const ins = firstExp.querySelectorAll('input,textarea');
  ins[0].value='Frontend Developer';
  ins[1].value='Modern Tech Co.';
  ins[2].value='09/2022';
  ins[3].value='Present';
  ins[4].value='Manama, Bahrain';
  ins[5].value='Built interactive dashboards.\nImproved performance by 35%.';
  syncArray(expList,state.exp);

  // ØªØ¹Ù„ÙŠÙ…
  $('#addEdu').click();
  const eIns = eduList.querySelectorAll('input,textarea');
  eIns[0].value='B.Sc. Computer Science';
  eIns[1].value='University of Bahrain';
  eIns[2].value='2018';
  eIns[3].value='2022';
  eIns[4].value='GPA 3.6';
  eIns[5].value='Capstone: Task tracking system.';
  syncArray(eduList,state.edu);

  // Ù„ØºØ§Øª
  $('#lang1').value='Arabic'; $('#lang1lvl').value='Fluent';
  $('#lang2').value='English'; $('#lang2lvl').value='Advanced';
  renderLanguages();
  render();
})();
</script>
</body>
</html>
