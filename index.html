<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>مناسك الحج وفق رأي السيد القائد</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@500;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#ffffff; --text:#0f172a; --muted:#6b7280; --edge:#e6e2cc;
    --gold1:#f9f4e7; --gold2:#e3c179; --gold3:#c9a144;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font-family:'Cairo',system-ui}
  header{
    background:linear-gradient(135deg,var(--gold1),var(--gold2) 60%,var(--gold3));
    color:#3b2b09;text-align:center;padding:18px;border-bottom:2px solid var(--gold3);font-weight:700
  }
  .wrap{max-width:780px;margin:0 auto;padding:18px}
  .answer-box{
    background:#fffaf1;border:1px solid var(--edge);border-radius:14px;padding:16px;min-height:140px;line-height:1.9
  }
  .ref{margin-top:8px;font-size:.9rem;color:#6b5d3a}
  .form{margin-top:22px}
  label{display:block;font-weight:700;margin:0 0 6px}
  input[type="text"]{
    width:100%;padding:14px;border:1px solid var(--edge);border-radius:12px;font-size:1rem;outline:none
  }
  input:focus{border-color:var(--gold3);box-shadow:0 0 0 3px #c9a14433}
  .btn{
    margin-top:10px;width:100%;
    background:linear-gradient(135deg,var(--gold2),var(--gold3));
    border:none;color:#fff;font-weight:700;padding:12px 18px;border-radius:12px;cursor:pointer;font-size:1rem
  }
  .btn:hover{filter:brightness(.98)}
  footer{margin:22px auto 18px;text-align:center;color:#7b6a42;font-size:.95rem}
  mark{background:#fff0c2;padding:0 .2em;border-radius:.25em}
  ul{margin:0 1rem 0 0}
</style>
</head>
<body>
  <header>مناسك الحج وفق رأي السيد القائد</header>

  <div class="wrap">
    <!-- الجواب في الأعلى -->
    <div id="ans" class="answer-box">الجواب سيظهر هنا…</div>
    <div id="ansRef" class="ref">مرجع: — — المصدر: كتيّب أحكام الحج (leader.ir)</div>

    <!-- السؤال في الأسفل + زر الإرسال تحته -->
    <form id="form" class="form">
      <label for="q">السؤال</label>
      <input id="q" type="text" placeholder="اكتب سؤالك هنا… مثل: ما حكم تغطية وجه المرأة في الإحرام؟">
      <button type="submit" class="btn">إرسال</button>
    </form>
  </div>

  <footer>برمجة وتطوير : فاضل الريس</footer>

  <!-- قاعدة المعارف الموسَّعة (يمكنك زيادتها بحرية) -->
  <script id="KB" type="application/json">[
    /* ====== أحكام الوجوب والاستطاعة ====== */
    {"qid":"M001","question":"ما حكم ترك الحج لمن كان مستطيعًا؟","keys":["ترك الحج","كبيرة","فوري"],"answer":"ترك الحج مع تحقق الشروط ومع العلم بالوجوب من الكبائر، والحج فوريٌّ بعد حصول الاستطاعة فلا يجوز التأخير بلا عذر.","ref":"مسألة 1"},
    {"qid":"M002","question":"ما شروط وجوب حجة الإسلام؟","keys":["شروط الوجوب","العاقل","البالغ","المستطيع","الفورية"],"answer":"تجب حجة الإسلام مرة واحدة على العاقل البالغ المستطيع وهي فورية بعد تحقق الاستطاعة.","ref":"مسائل 23–26"},
    {"qid":"M003","question":"ما أقسام الحج وما وظيفة البعيد عن مكة؟","keys":["التمتع","الإفراد","القران","البعيد","90 كم"],"answer":"أقسام الحج: التمتع والإفراد والقِران. وظيفة من يبعد عن مكة قرابة 90 كم (٤٨ ميلًا شرعيًا) هي التمتع غالبًا.","ref":"مسائل 2–7"},
    {"qid":"M004","question":"ما هي الاستطاعة المالية؟","keys":["الزاد والراحلة","نفقة العيال","الرجوع إلى الكفاية","ضروريات"],"answer":"تتحقق بامتلاك الزاد والراحلة، ونفقة العيال مدة السفر، وحفظ ضروريات المعيشة، مع الرجوع إلى الكفاية بعد الحج.","ref":"مسائل 34–55"},
    {"qid":"M005","question":"هل الاقتراض يحقق الاستطاعة؟","keys":["اقتراض"],"answer":"لا يثبت وجوب الحج بمجرد إمكان الاقتراض ابتداءً، نعم لو اقترض وصار واجدًا لمؤنة الحج وجب عليه الإتيان به.","ref":"مسألة 49"},
    {"qid":"M006","question":"الدَّين الحال ومطالبة الدائن؟","keys":["دين حال","مطالبة"],"answer":"مع مطالبة الدائن لا تتحقق الاستطاعة حتى تبرأ الذمة أو يأذن الدائن؛ وإلا فلا يجب الحج حينئذ.","ref":"مسألة 44"},
    {"qid":"M007","question":"بيع الضروريات كالمسكن والسيارة؟","keys":["بيع المسكن","سيارة"],"answer":"لا يجب بيع الضروريات الموافقة للشأن لتحصيل الاستطاعة، ويعتبر الرجوع إلى الكفاية.","ref":"مسألة 52"},
    {"qid":"M008","question":"الاستطاعة البدنية والأمنية والزمانية؟","keys":["بدنية","أمن الطريق","زمانية"],"answer":"البدنية: القدرة بلا حرج، الأمنية: أمن الطريق وسلامة النفس والمال، الزمانية: سعة الوقت لإدراك الأعمال دون عسر شديد.","ref":"مسائل 66–70"},
    {"qid":"M009","question":"العجز البدني الدائم والاستنابة؟","keys":["استنابة","عجز"],"answer":"مع تحقق الاستطاعة المالية والعجز البدني الدائم تجب الاستنابة في الحج.","ref":"مسألة 70"},

    /* ====== المواقيت والإحرام ====== */
    {"qid":"M010","question":"ما هي المواقيت؟","keys":["مسجد الشجرة","وادي العقيق","الجحفة","يلملم","قرن المنازل","محاذاة"],"answer":"المواقيت: مسجد الشجرة، وادي العقيق (المسلخ/الغمرة/ذات عرق)، الجحفة، يلملم، قرن المنازل، ومحاذاتها لمن لم يمر بميقات.","ref":"مسائل 100–106"},
    {"qid":"M011","question":"من كان في مكة وأراد عمرة مفردة من أين يُحرم؟","keys":["أدنى الحل","التنعيم","الحديبية","الجعرانة"],"answer":"ميقات العمرة المفردة لمن كان في مكة: أدنى الحل، والأفضل التنعيم أو الحديبية أو الجعرانة.","ref":"مسألة 111"},
    {"qid":"M012","question":"بماذا ينعقد الإحرام وما صيغة التلبية؟","keys":["التلبية","صيغة"],"answer":"ينعقد الإحرام بالتلبية. الصيغة الواجبة: «لبيك اللهم لبيك، لبيك لا شريك لك لبيك».","ref":"مسائل 132–135"},

    /* ====== محرمات الإحرام العامة ====== */
    {"qid":"M013","question":"محرمات الإحرام إجمالًا؟","keys":["محرمات الإحرام","22"],"answer":"منها: لبس المخيط للرجال، تغطية رأس الرجل ووجه المرأة، التظليل للرجال نهارًا حال السير، الطيب، النظر في المرآة بقصد الزينة، الحناء، التدهين، إزالة الشعر، الكحل، تقليم الأظفار، إخراج الدم، الفسوق، الجدال، قتل هوام البدن، صيد البر، الجماع، عقد النكاح، الاستمناء… مع تفاصيل وكفارات في أبوابها.","ref":"مسائل 159–161"},
    {"qid":"M014","question":"لبس المخيط (رجال/نساء)؟","keys":["لبس المخيط","قفازات"],"answer":"يحرم على الرجال لبس المخيط كالقميص والسراويل… ويجوز للنساء لبس المخيط، لكن لا يلبسن القفازات ولا يغطين الوجه بالقناع.","ref":"مسائل 162–170"},
    {"qid":"M015","question":"التظليل للمحرم نهارًا؟","keys":["تظليل","نهارًا"],"answer":"يحرم على الرجل حال السير نهارًا أن يظلّل نفسه بسقف ونحوه؛ ويختلف الحكم ليلًا أو في غير السير، وتلزم الفدية عند الاضطرار.","ref":"مسألة 168"},
    {"qid":"M016","question":"استعمال الطيب؟","keys":["طيب","عطر"],"answer":"يحرم استعمال الطيب وشمّه بقصد التلذذ، وتجب الكفارة على التعمد، ويُفصّل في السهو وأنواع الروائح.","ref":"مسألة 171"},
    {"qid":"M017","question":"التدهين بالدهن؟","keys":["تدهين"],"answer":"يُمنع مع الطيب، ويُرخّص للتداوي أو دفع الضرر على تفصيل وقد تلزم فدية.","ref":"مسألة 173"},
    {"qid":"M018","question":"إزالة الشعر وتقليم الأظفار؟","keys":["حلق","قص"],"answer":"يحرم عمدًا إزالة الشعر وقص الأظفار وتجب الكفارة بحسب المورد.","ref":"مسألة 175"},
    {"qid":"M019","question":"عقد النكاح في الإحرام؟","keys":["عقد النكاح"],"answer":"محرم وباطل لو وقع حال الإحرام.","ref":"مسألة 182"},
    {"qid":"M020","question":"الجماع قبل طواف النساء؟","keys":["جماع","طواف النساء"],"answer":"محرم حتى يأتي بطواف النساء وصلاته، وتترتب كفارات مخصوصة.","ref":"مسألة 185"},
    {"qid":"M021","question":"صيد البر للمحرم؟","keys":["صيد","الحرم"],"answer":"يحرم صيد البر على المحرم وفي الحرم، والكفارة بحسب النوع والحال.","ref":"مسألة 190"},

    /* ====== الأعمال (عمرة التمتع والحج) ====== */
    {"qid":"M022","question":"أعمال عمرة التمتع؟","keys":["عمرة التمتع","أعمال"],"answer":"1) الإحرام من الميقات 2) الطواف 3) صلاة الطواف 4) السعي بين الصفا والمروة 5) التقصير.","ref":"مسألة 13"},
    {"qid":"M023","question":"أعمال حج التمتع مجملًا؟","keys":["حج التمتع","أعمال"],"answer":"الإحرام من مكة → الوقوف بعرفات → الوقوف بالمشعر → رمي جمرة العقبة → الهدي → الحلق/التقصير → طواف الحج وصلاته → السعي → طواف النساء وصلاته → المبيت بمنى ورمي الجمار.","ref":"مسألة 15"},
    {"qid":"M024","question":"ترتيب أعمال يوم العيد؟","keys":["يوم العيد","الترتيب"],"answer":"بعد المشعر: رمي جمرة العقبة → الذبح (الهدي) → الحلق/التقصير، ثم طواف الحج وصلاته والسعي، ثم طواف النساء وصلاته.","ref":"مسألة 260"},
    {"qid":"M025","question":"المبيت بمنى؟","keys":["المبيت"],"answer":"واجب ليلة 11 و12، وللمتأخر ليلة 13. يسقط لعذر مع فدية بحسب الموارد المنصوصة.","ref":"مسألة 240"},
    {"qid":"M026","question":"وقت رمي الجمار؟","keys":["الرمي","الوقت"],"answer":"جمرة العقبة يوم العيد، والجمار الثلاث أيام التشريق؛ الأفضل النهار ويجوز للمعذور ليلًا على تفصيل.","ref":"مسألة 245"},
    {"qid":"M027","question":"من لم يجد الهدي؟","keys":["عدم الوجدان","الصوم"],"answer":"ينتقل إلى الصوم: ثلاثة أيام في الحج وسبعة إذا رجع إلى أهله على الترتيب المذكور.","ref":"مسألة 250"},
    {"qid":"M028","question":"الاستنابة في الرمي؟","keys":["استنابة","الرمي"],"answer":"تصح للعاجز أو من فيه حرج شديد، مع نية النيابة ومراعاة الترتيب.","ref":"مسألة 255"},
    {"qid":"M029","question":"تقديم بعض الأعمال على بعض؟","keys":["تقديم","ترتيب"],"answer":"الأصل الترتيب، ومع العذر توجد رخص منظَّمة كالتقديم لبعض الأعمال وفق الضوابط.","ref":"مسألة 265"},
    {"qid":"M030","question":"نسيان أعمال العمرة؟","keys":["نسيان","تدارك","ركن"],"answer":"يُرجع إلى الركنية: الطواف والسعي ركنان؛ وغيرهما يتدارك أو تلزم فدية على حسب المورد.","ref":"مسألة 270"},
    {"qid":"M031","question":"أفسد الحج بالجماع قبل الوقوف؟","keys":["إفساد","جماع"],"answer":"يُتمّ الحج وتجب الإعادة في العام القادم مع الهدي، والتفصيل بحسب الموضع والزمان.","ref":"مسألة 280"},
    {"qid":"M032","question":"فاته الوقوف بعرفات؟","keys":["فاته عرفات","اضطراري"],"answer":"إن أدرك الوقوف الاضطراري جزءًا من ليلة العيد بالمشعر صحّ الحج، وإلا فيأتي حكم البطلان والتحلل بعمرة على تفصيل.","ref":"مسألة 201"},
    {"qid":"M033","question":"العدول من التمتع إلى الإفراد؟","keys":["عدول","إفراد","ضيق الوقت"],"answer":"يجوز عند ضيق الوقت عن إدراك عمرة التمتع والحج معًا؛ وتكون الوظيفة حج الإفراد مع عمرة مفردة بعده.","ref":"مسألة 210"},

    /* ====== مسائل النساء (موسعة) ====== */
    {"qid":"W001","question":"لباس المرأة في الإحرام؟","keys":["لباس المرأة","حجاب","قناع","قفازات"],"answer":"يجوز للمرأة لبس المخيط الساتر غير المزخرف، ولا تغطي وجهها بالقناع، ولا تلبس القفازات، ويجوز ستر الرأس والشعر بالغطاء المعتاد بلا طيب.","ref":"مسألة 170"},
    {"qid":"W002","question":"تغطية وجه المرأة في الإحرام؟","keys":["تغطية الوجه","النقاب","قناع"],"answer":"لا يجوز للمرأة تغطية وجهها بالقناع أو النقاب حال الإحرام؛ ويجوز إسدال الغطاء على الوجه من دون لصوق إذا احتاجت مع الاحتياط في عدم التغطية المباشرة.","ref":"مسألة 170 وما بعدها"},
    {"qid":"W003","question":"الحناء والكحل والزينة للمرأة المحرمة؟","keys":["زينة","حناء","كحل","مكياج"],"answer":"الزينة بقصد التزيّن للناس ممنوعة للمحرم/المحرمة كالحناء والكحل إذا كان بقصد الزينة، وتُجتنب العطور والطيب في أدوات التجميل.","ref":"محظورات الإحرام"},
    {"qid":"W004","question":"المرأة حاضت قبل الإحرام، ماذا تفعل؟","keys":["حيض قبل الإحرام"],"answer":"إن أمكنها الطهر قبل خروج وقت الإحرام تُحرم وتؤدي المناسك؛ ومع تعذّر الطهر وضيق الوقت تُحرِم وتعمل بوظيفتها في الطواف والسعي وفق أحكام الحيض المذكورة لاحقًا.","ref":"مسائل النساء/الإحرام"},
    {"qid":"W005","question":"حاضت أثناء الطواف؟","keys":["حيض أثناء الطواف"],"answer":"تقطع الطواف وتنتظر الطهر لإتمامه ثم تُصلّي صلاة الطواف وتتم الأعمال. ومع ضيق الوقت تُرجَع إلى أحكامها: كالتوكيل في الطواف أو العدول بحسب موارده المقررة.","ref":"مسألة 220"},
    {"qid":"W006","question":"حاضت بعد السعي وقبل طواف الحج؟","keys":["حيض قبل طواف الحج"],"answer":"تنتظر الطهر لتأتي بطواف الحج وصلاته، ومع ضيق الوقت تُعمل بالرخص المنظمة (كالاستنابة أو البقاء حتى الطهر إن أمكن).","ref":"مسائل النساء/الطواف"},
    {"qid":"W007","question":"حاضت قبل طواف النساء؟","keys":["حيض قبل طواف النساء"],"answer":"لا تحل الأزواج حتى يؤتى بطواف النساء وصلاته؛ فإن لم تطهر وضاق الوقت تُستنيب من يطوف عنها ثم تصلي عند الطهر على تفصيل الباب.","ref":"مسألة 230 وما بعدها"},
    {"qid":"W008","question":"أحكام المستحاضة في الطواف والصلاة؟","keys":["استحاضة","صغرى","وسطى","كبرى"],"answer":"تجري أحكام الاستحاضة (الوضوء/الأغسال) بحسب صغرى أو وسطى أو كبرى، فتُؤدّي الطواف وصلاته بعد الإتيان بما يلزمها من وضوء/غُسل وربط ونحوه.","ref":"مسائل الطهارة للمستحاضة"},
    {"qid":"W009","question":"أحكام النفساء؟","keys":["نفاس","نفساء"],"answer":"النفساء كالحائض لا تأتي بالطواف والصلاة حتى تطهر؛ ومع ضيق الوقت تُرجَع إلى أحكام النيابة أو التأخير وفق الضوابط.","ref":"مسائل النساء/النفاس"},
    {"qid":"W010","question":"حكم لمس الطيب أو التعطر للمرأة؟","keys":["طيب المرأة"],"answer":"يحرم عليها كالمحرم الرجل استعمال الطيب وشمه بقصد التلذذ، وتفصيل الكفارات في بابه.","ref":"مسألة 171"},
    {"qid":"W011","question":"لباس القدمين للمرأة في الإحرام؟","keys":["الجوارب","الخف"],"answer":"يجوز للمرأة لبس الجوارب والخف، بخلاف الرجل حيث لا يستر ظهر القدم بما يغطيه على التفصيل.","ref":"باب اللباس"},
    {"qid":"W012","question":"الستر والطهارة لصلاة الطواف للمرأة؟","keys":["صلاة الطواف للمرأة"],"answer":"يشترط للصلاة والطواف الطهارة وستر ما يجب ستره شرعًا من دون زينة ولا طيب، وتعمل المستحاضة بأحكامها الخاصة قبل الصلاة.","ref":"باب صلاة الطواف"},
    {"qid":"W013","question":"هل يجوز إسدال الخمار على الوجه اتقاءً للرجال؟","keys":["إسدال الخمار","الحجاب"],"answer":"يجوز الإسدال من غير تغطية مباشرة للوجه (من دون لصوق) عند الحاجة، والأَولى تركه ما أمكن تجنبًا لشبهة التغطية.","ref":"مسألة تغطية الوجه"},
    {"qid":"W014","question":"أحكام قص الأظفار وقصّ الشعر للمرأة المحرمة؟","keys":["قص أظفار","قص شعر المرأة"],"answer":"يحرم على المحرمة كالمحرم إزالة الشعر أو تقليم الأظفار عمدًا، وتجب الكفارة بحسب المورد.","ref":"مسألة 175"},

    /* ====== تفاصيل إضافية شائعة ====== */
    {"qid":"D001","question":"عدد أشواط الطواف والسعي؟","keys":["عدد الأشواط","الطواف","السعي"],"answer":"الطواف سبعة أشواط ابتداءً من الحجر، والسعي سبعة أشواط مبتدئًا بالصفا ختمًا بالمروة.","ref":"باب الطواف/السعي"},
    {"qid":"D002","question":"ترك شوط من الطواف نسيانًا؟","keys":["ترك شوط","نسيان"],"answer":"قبل تمام أربعة أشواط يُستأنف الطواف، وبعد تجاوز النصف يُتدارك على تفصيل ثم تُصلّى صلاة الطواف.","ref":"باب الطواف"},
    {"qid":"D003","question":"قطع السعي والرجوع؟","keys":["قطع السعي","موالاة"],"answer":"يبني من موضع القطع ما دامت الموالاة العرفية محفوظة، وإلا أعاده على تفصيل.","ref":"باب السعي"},
    {"qid":"D004","question":"المحاذاة لمن لا يمر بميقات؟","keys":["محاذاة","ميقات"],"answer":"من لم يمر بميقات يُحرم عند محاذاته على وفق مسار الطريق (برًّا/جوًّا) بالاعتماد على أهل الخبرة.","ref":"مسألة المحاذاة"},
    {"qid":"D005","question":"الإحرام قبل الميقات؟","keys":["قبل الميقات"],"answer":"لا ينعقد قبل الميقات، بل يجب أن يقع الإحرام في الميقات أو عند المحاذاة الصحيحة وإلا أعاد.","ref":"باب المواقيت"},
    {"qid":"D006","question":"التوكيل في الهدي والذبح؟","keys":["توكل","هدي"],"answer":"يجوز التوكيل مع استحضار نية القربة، ويُراعى موضع الذبح وحدوده وشروط الهدي.","ref":"باب الهدي"},
    {"qid":"D007","question":"سقوط المبيت لأهل الأعذار؟","keys":["سقوط المبيت","فدية"],"answer":"يسقط لعذر كالعاملين أو أصحاب الضرورة على تفصيل، وتجب فدية غالبًا.","ref":"باب المبيت"},
    {"qid":"D008","question":"رمي الليل للمعذور؟","keys":["رمي ليلًا","عذر"],"answer":"الأصل النهار، ويجوز للمعذور الرمي ليلًا مع مراعاة الترتيب والعدد.","ref":"باب الرمي"},
    {"qid":"D009","question":"نسي صلاة الطواف؟","keys":["صلاة الطواف","نسي"],"answer":"يأتي بها متى تذكّر ولو بعد أيام، مع مراعاة مكانها وزمانها المذكورين في الباب.","ref":"باب صلاة الطواف"},
    {"qid":"D010","question":"ترك السعي ثم تذكّره بعد أيام؟","keys":["ترك السعي"],"answer":"يقضيه متى تذكّر ما دام التدارك ممكنًا، ومع التعذر يُنظر في حكم الاستنابة أو العود بحسب الحال.","ref":"باب السعي"}
  ]</script>

  <script>
    const KB = JSON.parse(document.getElementById('KB').textContent||'[]');

    // تطبيع عربي + مرادفات خفيفة لتحسين الدقة
    const SYNS = new Map(Object.entries({
      "حيض":"الحيض,حائض,المرأة حاضت,حاضت",
      "استحاضة":"مستحاضة,الاستحاضة,دم مستمر",
      "نفاس":"نفساء,النفاس",
      "تظليل":"مظلة,مظلة السيارة,الشمس",
      "طواف النساء":"طواف النسا,طواف النِساء,طواف الوداع(خاطئ)",
      "الهدي":"ذبح,أضحية(خاطئ),النحر",
      "محاذاة":"موازاة,محاذي,طائرة,خط الجو"
    }));

    function norm(s){return (s||'').toLowerCase()
      .replace(/[\u064B-\u065F]/g,'').replace(/[\u200f\u200e\ufeff]/g,'')
      .replace(/[ـ]/g,'').replace(/[^\u0600-\u06FFa-z0-9 ]+/g,' ')
      .replace(/\s+/g,' ').trim();}

    function expandQuery(q){
      let out = norm(q);
      for (const [k,v] of SYNS.entries()){
        if(out.includes(k)) out += ' ' + v;
      }
      return out;
    }

    function toks(s){return s.split(/[^\\u0600-\\u06FFa-z0-9]+/).filter(Boolean)}

    // فهرسة مع وزنٍ أعلى لمفاتيح entry.keys ثم السؤال ثم الجواب
    const INDEX = KB.map((e,i)=>{
      return {
        i,
        tKeys: new Set((e.keys||[]).map(norm)),
        tQ: new Set(toks(norm(e.question||''))),
        tA: new Set(toks(norm(e.answer||'')))
      };
    });

    function score(q){
      const qs = new Set(toks(expandQuery(q)));
      let best = [], topScore = 0;
      for(const E of INDEX){
        let s = 0;
        qs.forEach(w=>{
          if(E.tKeys.has(w)) s += 6;
          if(E.tQ.has(w))    s += 3;
          if(E.tA.has(w))    s += 1;
        });
        if(s>0){
          if(s>topScore){ topScore=s; best=[E.i]; }
          else if(s===topScore){ best.push(E.i); }
        }
      }
      // إن كان التطابق ضعيف جدًا نعتبره غير كافٍ
      return {ids: best, score: topScore};
    }

    function hi(text,q){
      let t=text; toks(norm(q)).forEach(w=>{
        if(!w) return;
        try{ t=t.replace(new RegExp('('+w+')','gi'),'<mark>$1</mark>'); }catch(_){}
      }); return t;
    }

    function setAnswer(html, ref){
      document.getElementById('ans').innerHTML = html;
      document.getElementById('ansRef').textContent = `مرجع: ${ref||'—'} — المصدر: كتيّب أحكام الحج (leader.ir)`;
    }

    function answer(q){
      const {ids, score} = score(q);
      if(score < 4){ // عتبة دقة أعلى
        setAnswer('لم أعثر على مسألة دقيقة لهذه الصياغة. جرّب كلمات مفتاحية مثل: <mark>طواف النساء</mark>، <mark>الاستحاضة</mark>، <mark>التظليل</mark>، <mark>المحاذاة</mark>…','—');
        return;
      }
      // ندمج أفضل 1–2 نتيجة إذا كانتا متقاربتين
      const top = ids.slice(0,2).map(i=>KB[i]);
      const blocks = top.map((e,idx)=>`<b>${idx? 'جواب مكمل' : 'الجواب'}:</b><br>${hi(e.answer,q)}<div class="ref">مرجع: ${e.ref}</div>`);
      setAnswer(blocks.join('<hr>'), top.map(e=>e.ref).join(' ، '));
    }

    document.getElementById('form').addEventListener('submit', (e)=>{
      e.preventDefault();
      const q = document.getElementById('q').value.trim();
      if(!q) return;
      answer(q);
    });
  </script>
</body>
</html>
