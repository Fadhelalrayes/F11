<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>المِسْبَحة</title>

  <!-- احترافي وخفيف -->
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg1:#6a11cb;
      --bg2:#8e54e9;
      --card:rgba(255,255,255,.14);
      --card-border:rgba(255,255,255,.28);
      --text:#fff;
      --muted:rgba(255,255,255,.75);
      --accent:#fff;
      --ring:#ffffff;
      --shadow: 0 10px 35px rgba(0,0,0,.25);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:"Tajawal",system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,sans-serif;
      color:var(--text);
      background: radial-gradient(1000px 700px at 80% 0%, rgba(255,255,255,.09), transparent 55%),
                  linear-gradient(160deg,var(--bg1),var(--bg2));
      display:grid;
      place-items:center;
    }

    .app{
      width:min(740px,94vw);
      margin:auto;
      padding:28px 24px 34px;
      background:linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
      border:1px solid var(--card-border);
      border-radius:28px;
      box-shadow:var(--shadow);
      backdrop-filter: blur(10px);
    }

    .top{
      display:flex; align-items:center; gap:14px; justify-content:space-between;
      margin-bottom:12px;
    }
    .title{
      font-weight:800; letter-spacing:.3px; font-size:28px;
    }
    .reset{
      border:1px solid var(--card-border);
      background: var(--card);
      color:var(--text);
      padding:10px 14px;
      border-radius:14px;
      cursor:pointer; font-weight:600;
      transition:transform .06s ease;
    }
    .reset:active{ transform:scale(.98) }

    .tabs{
      display:flex; gap:10px; margin:14px 0 22px;
    }
    .tab{
      flex:1;
      padding:14px 12px;
      border:1px solid var(--card-border);
      background:var(--card);
      border-radius:16px;
      color:var(--muted);
      font-weight:700;
      text-align:center;
      cursor:pointer;
      user-select:none;
      transition: all .2s ease;
    }
    .tab.active{
      color:var(--accent);
      background: rgba(255,255,255,.18);
      box-shadow: inset 0 0 0 2px rgba(255,255,255,.25);
    }

    /* لوحة الذكر */
    .panel{ display:none }
    .panel.active{ display:block }

    .phrase{
      text-align:center;
      font-size:40px;
      font-weight:800;
      margin:10px 0 6px;
    }
    .sub{
      text-align:center;
      color:var(--muted);
      font-size:14px;
      margin-bottom:14px;
    }

    .stats{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      margin: 6px auto 18px;
      max-width:520px;
    }
    .stat{
      background: var(--card);
      border:1px solid var(--card-border);
      border-radius:16px;
      padding:12px 16px;
      display:flex; align-items:center; justify-content:space-between;
      font-size:20px; font-weight:800;
    }
    .stat small{ color:var(--muted); font-weight:600; font-size:12px; letter-spacing:.2px }

    /* زر العد + الحلقة المتحركة */
    .ring-wrap{
      width:min(420px,88vw); aspect-ratio:1/1;
      margin: 8px auto 6px; position:relative;
    }
    .ring{
      --p:0; /* 0..1 */
      position:absolute; inset:0;
      border-radius:50%;
      background:
        radial-gradient(closest-side, transparent 70%, rgba(255,255,255,.08) 71% 72%, transparent 73%),
        conic-gradient(var(--ring) calc(var(--p)*1turn), rgba(255,255,255,.22) 0);
      filter: drop-shadow(0 20px 25px rgba(0,0,0,.25));
      display:grid; place-items:center;
      padding:18px;
    }
    .btn{
      width:72%; height:72%;
      display:grid; place-items:center;
      border-radius:32px;
      border:1px solid var(--card-border);
      background:#ffffff;
      color:#5a39c6;
      font-weight:800; font-size:42px;
      letter-spacing:.6px;
      box-shadow: 0 18px 40px rgba(0,0,0,.24), inset 0 0 0 2px rgba(106,17,203,.04);
      cursor:pointer;
      user-select:none;
      transition: transform .06s ease, box-shadow .15s ease;
    }
    .btn:active{ transform: scale(.985) }
    .btn:focus-visible{ outline: 4px solid rgba(255,255,255,.55) }

    .inputs{
      display:grid; gap:10px;
      grid-template-columns: 1fr 160px;
      max-width:620px; margin:8px auto 4px;
    }
    .in{
      background:var(--card); border:1px solid var(--card-border);
      border-radius:12px; padding:12px 14px;
      color:var(--text); font-weight:700; width:100%;
    }
    .in::placeholder{ color: rgba(255,255,255,.6) }

    .footer{
      margin-top:18px; color:var(--muted); text-align:center; font-weight:600
    }
    .footer b{color:#fff}

    @media (max-width:520px){
      .phrase{font-size:34px}
      .btn{font-size:36px}
      .stat{font-size:18px}
    }
  </style>
</head>
<body>

  <main class="app" role="application" aria-label="المسبحة">
    <div class="top">
      <div class="title">المسبحة</div>
      <button class="reset" id="resetAll" type="button" title="إعادة التعيين">إعادة التعيين ↺</button>
    </div>

    <div class="tabs" role="tablist" aria-label="الوضع">
      <button class="tab active" id="tab-zahra" role="tab" aria-selected="true">تسبيح الزهراء</button>
      <button class="tab" id="tab-open" role="tab" aria-selected="false">التسبيح المفتوح</button>
    </div>

    <!-- تسبيح الزهراء -->
    <section id="panel-zahra" class="panel active" role="tabpanel" aria-labelledby="tab-zahra">
      <div class="phrase" id="zh-phrase">الله أكبر</div>
      <div class="sub" id="zh-step-info">المرحلة 1 من 3</div>

      <div class="stats" aria-live="polite">
        <div class="stat">
          <small>العد الحالي</small>
          <span id="zh-count">0 / 34</span>
        </div>
        <div class="stat">
          <small>الإجمالي اليومي</small>
          <span id="zh-total">0</span>
        </div>
      </div>

      <div class="ring-wrap">
        <div class="ring" id="zh-ring" style="--p:0">
          <button class="btn" id="zh-btn" type="button" aria-label="اضغط للذكر">إضغط</button>
        </div>
      </div>
    </section>

    <!-- التسبيح المفتوح -->
    <section id="panel-open" class="panel" role="tabpanel" aria-labelledby="tab-open">
      <div class="phrase"><span id="op-current-text">سبحان الله</span></div>
      <div class="sub">يمكنك تعديل الذكر والهدف</div>

      <div class="inputs">
        <input id="op-text" class="in" type="text" placeholder="اكتب الذكر هنا…" />
        <input id="op-target" class="in" type="number" min="0" step="1" placeholder="هدف (اختياري: 33/99…)" />
      </div>

      <div class="stats" aria-live="polite">
        <div class="stat"><small>العد الحالي</small><span id="op-count">0</span></div>
        <div class="stat">
          <small>الهدف</small><span id="op-show-target">∞</span>
        </div>
      </div>

      <div class="ring-wrap">
        <div class="ring" id="op-ring" style="--p:0">
          <button class="btn" id="op-btn" type="button" aria-label="اضغط للذكر">إضغط</button>
        </div>
      </div>

      <div class="top" style="margin-top:12px">
        <button class="reset" id="op-dec" type="button" title="إنقاص 1">− إنقاص</button>
        <button class="reset" id="op-reset" type="button" title="تصفير">تصفير</button>
      </div>
    </section>

    <div class="footer">برمجة وتطوير : <b>فاضل الريس</b></div>
  </main>

  <script>
    /* أدوات عامة */
    const vibrate = (ms=12)=>{ try{ navigator.vibrate && navigator.vibrate(ms);}catch(e){} };
    const save = (k,v)=> localStorage.setItem(k, JSON.stringify(v));
    const load = (k,def)=> {
      try{ const v = JSON.parse(localStorage.getItem(k)); return (v??def); }
      catch{ return def; }
    };

    /* تبويب */
    const tabs = {
      zahra: { tab: document.getElementById('tab-zahra'), panel: document.getElementById('panel-zahra') },
      open : { tab: document.getElementById('tab-open'),  panel: document.getElementById('panel-open')  }
    };
    function setTab(which){
      for(const k in tabs){
        const on = (k===which);
        tabs[k].tab.classList.toggle('active', on);
        tabs[k].tab.setAttribute('aria-selected', on);
        tabs[k].panel.classList.toggle('active', on);
      }
      save('tasbih_active_tab', which);
    }
    tabs.zahra.tab.onclick = ()=> setTab('zahra');
    tabs.open.tab.onclick  = ()=> setTab('open');
    setTab(load('tasbih_active_tab','zahra'));

    // ====== تسبيح الزهراء (34/33/33) ======
    const ZSEQ = [
      { text:'الله أكبر', target:34 },
      { text:'الحمد لله', target:33 },
      { text:'سبحان الله', target:33 }
    ];
    const zh = {
      phrase: document.getElementById('zh-phrase'),
      stepInfo: document.getElementById('zh-step-info'),
      countLbl: document.getElementById('zh-count'),
      totalLbl: document.getElementById('zh-total'),
      ring: document.getElementById('zh-ring'),
      btn: document.getElementById('zh-btn')
    };
    let zhState = load('tasbih_zahra_state', {step:0, count:0, total:0});
    function zhRender(){
      const step = ZSEQ[zhState.step];
      if(!step){
        zh.phrase.textContent = 'تَمَّ التسبيح 👌';
        zh.stepInfo.textContent = 'ابدأ دورة جديدة';
        zh.countLbl.textContent = '0 / 0';
        zh.ring.style.setProperty('--p', 1);
        return;
      }
      zh.phrase.textContent = step.text;
      zh.stepInfo.textContent = `المرحلة ${zhState.step+1} من ${ZSEQ.length}`;
      zh.countLbl.textContent = `${zhState.count} / ${step.target}`;
      zh.totalLbl.textContent = zhState.total;
      zh.ring.style.setProperty('--p', Math.min(1, zhState.count / step.target));
    }
    function zhTick(delta=1){
      const step = ZSEQ[zhState.step];
      if(!step){ zhState = {step:0, count:0, total:zhState.total}; save('tasbih_zahra_state', zhState); zhRender(); return; }
      zhState.count += delta;
      if(zhState.count < 0) zhState.count = 0;
      if(zhState.count >= step.target){
        zhState.total += step.target;
        zhState.step += 1;
        zhState.count = 0;
        // عند نهاية الدورة كلها
        if(zhState.step >= ZSEQ.length){
          vibrate(50);
          zhState.step = ZSEQ.length; // يوقف على "تمّ"
        } else {
          vibrate(30);
        }
      }else{
        vibrate(10);
      }
      save('tasbih_zahra_state', zhState);
      zhRender();
    }
    zh.btn.onclick = ()=> zhTick(1);
    // دعم لوحة المفاتيح
    zh.btn.addEventListener('keydown', e=>{
      if(e.code==='Space' || e.code==='Enter'){ e.preventDefault(); zhTick(1); }
      if(e.code==='Backspace'){ e.preventDefault(); zhTick(-1); }
    });
    zhRender();

    // ====== التسبيح المفتوح ======
    const op = {
      textIn: document.getElementById('op-text'),
      targetIn: document.getElementById('op-target'),
      currentText: document.getElementById('op-current-text'),
      countLbl: document.getElementById('op-count'),
      showTarget: document.getElementById('op-show-target'),
      ring: document.getElementById('op-ring'),
      btn: document.getElementById('op-btn'),
      dec: document.getElementById('op-dec'),
      reset: document.getElementById('op-reset')
    };
    let opState = load('tasbih_open_state', {text:'سبحان الله', target:0, count:0});
    function opRender(){
      op.currentText.textContent = opState.text || '—';
      op.countLbl.textContent = opState.count;
      op.textIn.value = opState.text;
      op.targetIn.value = opState.target || '';
      op.showTarget.textContent = opState.target>0 ? opState.target : '∞';
      let p = 0;
      if(opState.target>0) p = Math.min(1, opState.count / opState.target);
      op.ring.style.setProperty('--p', p);
    }
    function opTick(delta=1){
      opState.count += delta;
      if(opState.count<0) opState.count=0;
      const reached = opState.target>0 && opState.count>=opState.target;
      vibrate(reached?45:10);
      save('tasbih_open_state', opState);
      opRender();
    }
    op.btn.onclick = ()=> opTick(1);
    op.dec.onclick = ()=> opTick(-1);
    op.reset.onclick = ()=> { opState.count=0; save('tasbih_open_state',opState); opRender(); };

    op.textIn.addEventListener('input', e=>{
      opState.text = e.target.value.trim();
      save('tasbih_open_state', opState);
      opRender();
    });
    op.targetIn.addEventListener('input', e=>{
      const v = parseInt(e.target.value,10);
      opState.target = (Number.isFinite(v) && v>0) ? v : 0;
      save('tasbih_open_state', opState);
      opRender();
    });
    opRender();

    // إعادة التعيين الكلي
    document.getElementById('resetAll').onclick = ()=>{
      if(confirm('هل تريد تصفير كل العدادات؟')){
        zhState = {step:0, count:0, total:0};
        opState = {text:'سبحان الله', target:0, count:0};
        save('tasbih_zahra_state', zhState);
        save('tasbih_open_state', opState);
        vibrate(60);
        zhRender(); opRender();
      }
    };
  </script>
</body>
</html>
