<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <!-- Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© â€” ÙˆÙÙ‚ Ø§Ù„Ù…Ø°Ù‡Ø¨ Ø§Ù„Ø¬Ø¹ÙØ±ÙŠ (Ø§Ù„Ø§Ø«Ù†Ø§ Ø¹Ø´Ø±ÙŠ) Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Aladhan API (Ø·Ø±ÙŠÙ‚Ø© Jafari/Leva Institute) -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <title>Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© â€” Ø§Ù„Ù…Ø°Ù‡Ø¨ Ø§Ù„Ø¬Ø¹ÙØ±ÙŠ</title>
  <meta name="description" content="Ù…ÙˆÙ‚Ø¹ Ø¨Ø³ÙŠØ· ÙˆØ§Ø­ØªØ±Ø§ÙÙŠ Ù„Ø¹Ø±Ø¶ Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© ÙˆÙÙ‚ Ø§Ù„Ù…Ø°Ù‡Ø¨ Ø§Ù„Ø¬Ø¹ÙØ±ÙŠ Ù…Ø¨Ø§Ø´Ø±Ø©Ù‹ Ù…Ù† Aladhan APIØŒ Ù…Ø¹ Ø¯Ø¹Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ ÙˆØ§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙŠØ¯ÙˆÙŠ ÙˆØ¹Ø¯Ù‘ ØªÙ†Ø§Ø²Ù„ÙŠ Ù„Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©.">

  <!-- Ø£Ù…Ø§Ù†: Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ api.aladhan.com ÙÙ‚Ø· -->
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self';
                 script-src 'self' 'nonce-jafari1';
                 style-src 'self' 'unsafe-inline';
                 img-src 'self' data:;
                 connect-src 'self' https://api.aladhan.com;
                 object-src 'none';
                 base-uri 'none';
                 frame-ancestors 'none';
                 form-action 'self';
                 upgrade-insecure-requests;
                 block-all-mixed-content">

  <style>
    :root{
      --bg:#f7f8fa; --text:#0f1720; --muted:#6b7280; --brand:#0ea76b; --ink:#063d29;
      --card:#ffffff; --bd:#e6e8ec; --shadow:0 10px 30px rgba(0,0,0,.06); --radius:16px; --maxw:760px;
    }
    @media (prefers-color-scheme: dark){
      :root{ --bg:#0b0f12; --text:#e8edf3; --muted:#aeb7c2; --card:#12181f; --bd:#223040; --shadow:0 12px 30px rgba(0,0,0,.35) }
    }
    *{box-sizing:border-box} html{scroll-behavior:smooth}
    body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Kufi Arabic","Noto Naskh Arabic",Arial}
    header{position:sticky;top:0;z-index:10;background:radial-gradient(1200px 200px at 50% -60px, color-mix(in oklab, var(--brand) 22%, var(--bg)), var(--bg));border-bottom:1px solid color-mix(in oklab,var(--text) 12%,transparent);backdrop-filter:saturate(140%) blur(10px)}
    .container{max-width:var(--maxw);margin:auto;padding:16px}
    .bar{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:900}
    .logo{inline-size:40px;block-size:40px;border-radius:12px;display:grid;place-items:center;color:#fff;background:linear-gradient(135deg,#1cd184,#0ea76b)}
    nav{display:flex;gap:8px;flex-wrap:wrap}
    nav a{color:inherit;text-decoration:none;padding:.45rem .7rem;border-radius:10px}
    nav a:hover{background:color-mix(in oklab,var(--brand) 14%,transparent)}

    h1{margin:.4rem 0 .2rem;font-size:clamp(1.4rem,1rem + 2vw,2.2rem)}
    .lead{color:var(--muted);margin:0 0 8px}
    .panel{background:var(--card);border:1px solid var(--bd);box-shadow:var(--shadow);border-radius:var(--radius);padding:14px;margin:14px auto 0;max-width:var(--maxw)}
    .row{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
    @media (max-width:800px){.row{grid-template-columns:1fr 1fr}}
    @media (max-width:520px){.row{grid-template-columns:1fr}}
    label{display:flex;flex-direction:column;gap:6px;font-size:.95rem}
    input{padding:.8rem 1rem;border:1px solid var(--bd);background:color-mix(in oklab,var(--card) 70%,transparent);color:inherit;border-radius:12px;width:100%}
    .actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .btn{display:inline-flex;align-items:center;gap:.5rem;border-radius:12px;cursor:pointer;border:2px solid color-mix(in oklab,var(--brand) 65%,var(--text));background:var(--brand);color:#fff;font-weight:800;padding:.8rem 1rem}
    .btn.secondary{background:transparent;color:inherit}
    .badge{display:inline-block;padding:.25rem .6rem;border-radius:999px;background:color-mix(in oklab,var(--brand) 16%,var(--card));color:var(--ink);font-weight:800}

    .grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media (max-width:600px){.grid{grid-template-columns:1fr}}
    .card{background:var(--card);border:1px solid var(--bd);border-radius:14px;box-shadow:var(--shadow);padding:12px 14px}
    .item{display:flex;align-items:center;justify-content:space-between;padding:.6rem .1rem;border-bottom:1px dashed color-mix(in oklab,var(--text) 12%,transparent)}
    .item:last-child{border-bottom:none}
    .label{font-weight:800}
    .time{font-variant-numeric:tabular-nums;font-weight:800;font-size:1.2rem}
    .datebox{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:10px}
    .muted{color:var(--muted)}
    .alert{display:none;margin-top:10px;padding:.8rem 1rem;border:1px solid #f2c6c6;color:#8b1c1c;background:#ffeeee;border-radius:12px}
    @media (prefers-color-scheme: dark){.alert{border-color:#633;background:#311;color:#f3bbbb}}
    footer{margin:28px 0 18px;color:var(--muted);text-align:center}
  </style>
</head>
<body>
  <header>
    <div class="container bar">
      <div class="brand">
        <div class="logo" aria-hidden="true">ğŸ•°ï¸</div>
        <div>Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©</div>
      </div>
      <nav aria-label="Ø§Ù„ØªÙ†Ù‚Ù‘Ù„">
        <a href="#controls">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</a>
        <a href="#today">Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ÙŠÙˆÙ…</a>
      </nav>
    </div>
  </header>

  <section class="container">
    <h1>ÙˆÙÙ‚ <span class="badge">Ø§Ù„Ù…Ø°Ù‡Ø¨ Ø§Ù„Ø¬Ø¹ÙØ±ÙŠ (Shia Jafari)</span></h1>
    <p class="lead">ÙŠØ¹ØªÙ…Ø¯ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¹Ù„Ù‰ <b>Ø·Ø±ÙŠÙ‚Ø© Jafari (Leva Institute, Qum)</b> Ù…Ù† Aladhan API. ÙŠØ¹Ù…Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø§ØªÙ ÙˆØ§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± Ù…Ø¹ Ø¯Ø¹Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø£Ùˆ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙŠØ¯ÙˆÙŠ.</p>
  </section>

  <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
  <section id="controls" class="panel" aria-labelledby="ctlh">
    <h2 id="ctlh" style="margin:.2rem 0 .8rem">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØª</h2>
    <div class="row">
      <label><span>Ø§Ù„Ø¯ÙˆÙ„Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</span><input id="country" placeholder="Ù…Ø«Ø§Ù„: Bahrain"></label>
      <label><span>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</span><input id="city" placeholder="Ù…Ø«Ø§Ù„: Manama / Najaf / Qom"></label>
      <label><span>Ø®Ø· Ø§Ù„Ø¹Ø±Ø¶ (lat)</span><input id="lat" inputmode="decimal" placeholder="26.2189"></label>
      <label><span>Ø®Ø· Ø§Ù„Ø·ÙˆÙ„ (lon)</span><input id="lon" inputmode="decimal" placeholder="50.5903"></label>
    </div>
    <div class="row" style="margin-top:8px">
      <label><span>Ø§Ù„Ø·Ø±ÙŠÙ‚Ø©</span><input value="Jafari â€“ Leva Institute (method=0)" readonly></label>
      <label><span>Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ© (Ø¹Ø±Ø¶ ÙÙ‚Ø·)</span><input id="tz" readonly></label>
      <label><span>Ø§Ø®ØªØµØ§Ø± Ø³Ø±ÙŠØ¹</span><input id="quick" placeholder="Ù…Ø«Ø§Ù„: Najaf, Iraq / Qom, Iran / Karbala, Iraq"></label>
      <label><span>â€”</span><input style="opacity:.001;border:0;background:transparent" tabindex="-1" aria-hidden="true"></label>
    </div>
    <div class="actions">
      <button class="btn" id="useLoc">ğŸ“ Ø§Ø³ØªØ®Ø¯Ù… Ù…ÙˆÙ‚Ø¹ÙŠ</button>
      <button class="btn secondary" id="byCity">Ø¬Ù„Ø¨ Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</button>
      <button class="btn secondary" id="byCoords">Ø¬Ù„Ø¨ Ø­Ø³Ø¨ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª</button>
      <button class="btn" id="presetNajaf">Ù†Ø¬Ù</button>
      <button class="btn" id="presetQom">Ù‚Ù…</button>
      <button class="btn" id="presetKarbala">ÙƒØ±Ø¨Ù„Ø§Ø¡</button>
      <button class="btn" id="reset">ØªÙ‡ÙŠØ¦Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©</button>
    </div>
    <div class="alert" id="errorBox" role="alert"></div>
  </section>

  <!-- Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ÙŠÙˆÙ… -->
  <section id="today" class="panel" aria-labelledby="todayh">
    <div class="datebox">
      <div>
        <div class="badge" id="place">â€”</div>
        <div class="muted" id="gregDate">â€”</div>
      </div>
      <div class="muted" id="hijriDate">â€”</div>
    </div>

    <div class="grid">
      <div class="card">
        <div class="item"><span class="label">Ø§Ù„ÙØ¬Ø±</span>   <span class="time" id="Fajr">â€”</span></div>
        <div class="item"><span class="label">Ø§Ù„Ø´Ø±ÙˆÙ‚</span> <span class="time" id="Sunrise">â€”</span></div>
        <div class="item"><span class="label">Ø§Ù„Ø¸Ù‡Ø±</span>   <span class="time" id="Dhuhr">â€”</span></div>
      </div>
      <div class="card">
        <div class="item"><span class="label">Ø§Ù„Ø¹ØµØ±</span>   <span class="time" id="Asr">â€”</span></div>
        <div class="item"><span class="label">Ø§Ù„Ù…ØºØ±Ø¨</span>  <span class="time" id="Maghrib">â€”</span></div>
        <div class="item"><span class="label">Ø§Ù„Ø¹Ø´Ø§Ø¡</span>  <span class="time" id="Isha">â€”</span></div>
      </div>
    </div>

    <div class="card" style="margin-top:10px">
      <div class="item"><span class="label">Ø§Ù„ØºØ±ÙˆØ¨</span>     <span class="time" id="Sunset">â€”</span></div>
      <div class="item"><span class="label">Ù…Ù†ØªØµÙ Ø§Ù„Ù„ÙŠÙ„ (Ø¬Ø¹ÙØ±ÙŠ)</span><span class="time" id="Midnight">â€”</span></div>
      <div class="item"><span class="label">Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ Ù„Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</span> <span class="time" id="countdown">â€”</span></div>
    </div>
  </section>

  <footer>Â© <span id="year"></span> Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© â€” Ø§Ù„Ù…Ø°Ù‡Ø¨ Ø§Ù„Ø¬Ø¹ÙØ±ÙŠ</footer>

  <!-- Ø³ÙƒØ±Ø¨Øª Ø§Ù„Ø¹Ù…Ù„ (Jafari method = 0) -->
  <script nonce="jafari1">
  (function(){
    'use strict';

    const $ = id => document.getElementById(id);
    const out = ['Fajr','Sunrise','Dhuhr','Asr','Maghrib','Isha','Sunset','Midnight']
      .reduce((o,k)=> (o[k]=$ (k), o), {});
    const placeEl = $('place'), gEl = $('gregDate'), hEl = $('hijriDate'), err = $('errorBox'), cd = $('countdown');

    // Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©: ØªÙˆØ¨Ù„ÙŠØŒ Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†
    let state = { country:'Bahrain', city:'Tubli', lat:26.2189, lon:50.5903 };

    const clean = t => (t||'â€”').toString().replace(/\s*\(.+\)$/, '');
    const busy = b => document.body.style.cursor = b ? 'progress' : 'auto';
    const tzText = () => { const z = -(new Date().getTimezoneOffset())/60; return (z>=0?`+${z}`:z); };
    $('tz').value = `UTC${tzText()}`;
    $('year').textContent = new Date().getFullYear();

    // Aladhan (Jafari method = 0). Ù„Ø§ Ù†Ø³ØªØ®Ø¯Ù… school Ù„Ø£Ù†Ù‡ Ø®Ø§Øµ Ø¨Ø§Ù„Ù…Ø°Ø§Ù‡Ø¨ Ø§Ù„Ø³Ù†ÙŠØ©.
    const byCityURL = (city, country) =>
      `https://api.aladhan.com/v1/timingsByCity?city=${encodeURIComponent(city)}&country=${encodeURIComponent(country)}&method=0`;
    const byCoordsURL = (lat, lon) =>
      `https://api.aladhan.com/v1/timings?latitude=${encodeURIComponent(lat)}&longitude=${encodeURIComponent(lon)}&method=0`;

    async function fetchJSON(url){
      const r = await fetch(url, {cache:'no-store', mode:'cors', referrerPolicy:'no-referrer'});
      if(!r.ok) throw new Error('HTTP '+r.status);
      const j = await r.json();
      if(j.code!==200) throw new Error('API error');
      return j.data;
    }

    function paint(data, placelabel){
      gEl.textContent = new Date().toLocaleDateString('ar', { weekday:'long', year:'numeric', month:'long', day:'numeric' });
      hEl.textContent = `${data.date.hijri.weekday.ar} ${data.date.hijri.day} ${data.date.hijri.month.ar} ${data.date.hijri.year} Ù‡Ù€`;
      placeEl.textContent = placelabel;

      const t = data.timings;
      out.Fajr.textContent    = clean(t.Fajr);
      out.Sunrise.textContent = clean(t.Sunrise);
      out.Dhuhr.textContent   = clean(t.Dhuhr);
      out.Asr.textContent     = clean(t.Asr);
      out.Maghrib.textContent = clean(t.Maghrib);
      out.Isha.textContent    = clean(t.Isha);
      out.Sunset.textContent  = clean(t.Sunset);
      out.Midnight.textContent= clean(t.Midnight); // Aladhan ÙŠØ¹ÙŠØ¯ "Midnight" Ø¨Ø·Ø±ÙŠÙ‚Ø© Ø¬Ø¹ÙØ±ÙŠØ© Ù„Ø·Ø±ÙŠÙ‚Ø© 0

      setupCountdown([t.Fajr, t.Dhuhr, t.Asr, t.Maghrib, t.Isha].map(clean));
    }

    function atToday(hm){
      if(!/^\d{1,2}:\d{2}$/.test(hm)) return null;
      const [h,m] = hm.split(':').map(Number);
      const d = new Date(); d.setHours(h,m,0,0);
      return d;
    }

    let timer;
    function setupCountdown(list){
      if(timer) clearInterval(timer);
      function nextPrayer(){
        const now = new Date();
        const times = list.map(atToday).filter(Boolean);
        return times.find(t => t > now);
      }
      function tick(){
        const nxt = nextPrayer();
        if(!nxt){ cd.textContent = 'â€”'; return; }
        const diff = nxt - new Date();
        if(diff <= 0){ cd.textContent = 'Ø­Ø§Ù† Ø§Ù„Ø£Ø°Ø§Ù†'; return; }
        const hh = Math.floor(diff/3_600_000);
        const mm = Math.floor((diff%3_600_000)/60_000);
        const ss = Math.floor((diff%60_000)/1000);
        cd.textContent = `${String(hh).padStart(2,'0')}:${String(mm).padStart(2,'0')}:${String(ss).padStart(2,'0')}`;
      }
      tick(); timer = setInterval(tick, 1000);
    }

    async function loadByCity(){
      try{ err.style.display='none'; busy(true);
        const data = await fetchJSON(byCityURL(state.city, state.country));
        paint(data, `${state.city}, ${state.country}`);
      }catch(e){ err.textContent = 'ØªØ¹Ø°Ù‘Ø± Ø§Ù„Ø¬Ù„Ø¨ Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©. Ø¬Ø±Ù‘Ø¨ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø£Ùˆ ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„Ùƒ.'; err.style.display='block';
      }finally{ busy(false) }
    }

    async function loadByCoords(){
      try{ err.style.display='none'; busy(true);
        const data = await fetchJSON(byCoordsURL(state.lat, state.lon));
        paint(data, `lat ${state.lat}, lon ${state.lon}`);
      }catch(e){ err.textContent = 'ØªØ¹Ø°Ù‘Ø± Ø§Ù„Ø¬Ù„Ø¨ Ø­Ø³Ø¨ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‚ÙŠÙ… Ø£Ùˆ Ø¬Ø±Ù‘Ø¨ Ù„Ø§Ø­Ù‚Ù‹Ø§.'; err.style.display='block';
      }finally{ busy(false) }
    }

    // Ø£Ø²Ø±Ø§Ø±
    $('useLoc').addEventListener('click', ()=>{
      if(!('geolocation' in navigator)){ err.textContent='Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹.'; err.style.display='block'; return; }
      navigator.geolocation.getCurrentPosition(p=>{
        state.lat=+p.coords.latitude.toFixed(6); state.lon=+p.coords.longitude.toFixed(6);
        loadByCoords();
      }, _=>{ err.textContent='Ø±ÙÙØ¶ Ø¥Ø°Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹. Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø£Ùˆ Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª.'; err.style.display='block'; },
      {enableHighAccuracy:false, timeout:10000, maximumAge:0});
    });

    $('byCity').addEventListener('click', ()=>{
      state.city = $('city').value.trim() || state.city;
      state.country = $('country').value.trim() || state.country;
      loadByCity();
    });

    $('byCoords').addEventListener('click', ()=>{
      const lat = parseFloat($('lat').value), lon = parseFloat($('lon').value);
      if(!isFinite(lat) || !isFinite(lon)){ err.textContent='Ø£Ø¯Ø®Ù„ Ø®Ø· Ø§Ù„Ø¹Ø±Ø¶ ÙˆØ§Ù„Ø·ÙˆÙ„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­.'; err.style.display='block'; return; }
      state.lat = lat; state.lon = lon; loadByCoords();
    });

    $('presetNajaf').addEventListener('click', ()=>{ state={country:'Iraq', city:'Najaf', lat:31.997, lon:44.314}; loadByCity(); });
    $('presetQom').addEventListener('click',   ()=>{ state={country:'Iran', city:'Qom',   lat:34.6416, lon:50.8746}; loadByCity(); });
    $('presetKarbala').addEventListener('click',()=>{ state={country:'Iraq', city:'Karbala', lat:32.6160, lon:44.0249}; loadByCity(); });

    $('reset').addEventListener('click', ()=>{
      state = { country:'Bahrain', city:'Tubli', lat:26.2189, lon:50.5903 };
      $('country').value='Bahrain'; $('city').value='Tubli'; $('lat').value='26.2189'; $('lon').value='50.5903';
      loadByCity();
    });

    // ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ÙŠ
    $('reset').click();
  })();
  </script>
</body>
</html>
