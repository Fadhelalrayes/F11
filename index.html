<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>مواقيت الصلاة وفق المذهب الجعفري</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{
    --ink:#0f172a; --muted:#6b7280;
    --bg:#f6f8fb; --surface:#fff; --border:#e5e7eb;
    --brand:#0ea5a6; --brand2:#2563eb;
    --shadow:0 8px 20px rgba(2,6,23,.08);
    --radius:14px;
  }
  body{
    margin:0; font-family:"Tajawal", sans-serif; color:var(--ink);
    background:var(--bg); padding:16px;
  }
  .container{max-width:900px; margin:auto; display:flex; flex-direction:column; gap:16px;}
  h1{margin:0; text-align:center; font-size:1.3rem; font-weight:800}
  /* اختيار الموقع */
  .locationBox{
    background:var(--surface); border:1px solid var(--border); border-radius:var(--radius);
    box-shadow:var(--shadow); padding:12px 16px;
    display:flex; justify-content:space-between; align-items:center;
  }
  .locLabel{font-weight:700}
  .changeBtn{
    border:none; background:var(--brand); color:#fff;
    padding:6px 12px; border-radius:8px; cursor:pointer; font-weight:700;
  }
  /* قائمة اختيار */
  .sheet{display:none; position:fixed; inset:0; background:rgba(0,0,0,.35); place-items:center; z-index:50;}
  .sheet.open{display:grid;}
  .panel{
    background:#fff; border-radius:16px; max-height:80vh; overflow:auto;
    padding:20px; width:90%; max-width:600px;
  }
  .panel h3{margin-top:0; font-size:1.1rem;}
  .country{margin-bottom:12px;}
  .country h4{margin:8px 0; font-size:1rem; color:var(--brand2);}
  .cityList{display:flex; flex-wrap:wrap; gap:8px;}
  .cityBtn{
    background:#f9fafb; border:1px solid var(--border); border-radius:8px;
    padding:6px 12px; cursor:pointer; font-weight:600;
  }
  .cityBtn:hover{background:#eefaff}
  /* جدول المواقيت */
  table{width:100%; border-collapse:collapse; background:#fff; border-radius:var(--radius); box-shadow:var(--shadow);}
  th,td{padding:10px; border-bottom:1px solid #f0f2f5; text-align:right}
  th{background:#f9fafb; font-weight:700}
  tr:last-child td{border-bottom:none}
  .time{font-weight:800}
  tr.next{background:linear-gradient(90deg,#e0f7f9,transparent)}
  /* صندوق الحديث */
  .hadith{
    background:#fff; border:1px solid var(--border); border-radius:var(--radius);
    box-shadow:var(--shadow); padding:20px; position:relative;
  }
  .hadith:before{
    content:"“"; position:absolute; top:10px; right:15px; font-size:48px; color:#e0e7f1; font-weight:800;
  }
  .hadith p{margin:0; font-size:1.05rem; line-height:1.9}
  .hadith small{display:block; margin-top:10px; color:var(--muted); font-weight:600}
  footer{text-align:center; color:var(--muted); font-weight:700; margin-top:12px}
  .brand{color:var(--brand2)}
</style>
</head>
<body>
  <div class="container">
    <h1>مواقيت الصلاة وفق المذهب الجعفري</h1>

    <!-- اختيار الموقع -->
    <div class="locationBox">
      <div class="locLabel" id="place">المنامة، البحرين</div>
      <button class="changeBtn" id="open">تغيير</button>
    </div>

    <!-- جدول -->
    <table>
      <thead><tr><th>الوقت</th><th>الساعة (12h)</th></tr></thead>
      <tbody id="times"><tr><td colspan="2">جاري تحميل المواقيت…</td></tr></tbody>
    </table>

    <!-- حديث -->
    <div class="hadith">
      <p id="hadithText"></p>
      <small id="hadithSource"></small>
    </div>

    <footer>برمجة وتطوير <span class="brand">فاضل الريس</span></footer>
  </div>

  <!-- اللوح للاختيار -->
  <div class="sheet" id="sheet">
    <div class="panel">
      <h3>اختر الدولة والمدينة</h3>
      <div id="countries"><!-- توليد تلقائي --></div>
    </div>
  </div>

<script>
const MAP={
  "البحرين":[ "المنامة","المحرق","مدينة عيسى","مدينة حمد","سترة","سار","الدراز","جدحفص"],
  "لبنان":[ "بيروت","طرابلس","صيدا"],
  "العراق":[ "بغداد","البصرة","أربيل"],
  "إيران":[ "طهران","مشهد","أصفهان"],
  "الكويت":[ "مدينة الكويت","حولي","الأحمدي"],
  "السعودية":[ "الرياض","جدة","الدمام","مكة","المدينة"]
};
const HADITHS=[
 {t:"قال الإمام الباقر (ع): إذا استقبل المصلي القبلة استقبل الرحمن بوجهه لا إله غيره.",s:"ميزان الحكمة"},
 {t:"قال الإمام علي (ع): إذا قام الرجل إلى الصلاة أقبل إبليس ينظر إليه حسداً.",s:"ميزان الحكمة"},
 {t:"قال الإمام الرضا (ع): الصلاة لها أربعة آلاف باب.",s:"ميزان الحكمة"},
 {t:"قال الإمام علي (ع): يا كميل! ليس الشأن أن تصلي وتصوم وتتصدق، إنما الشأن أن تكون الصلاة بقلب نقي وخشوع.",s:"ميزان الحكمة"},
];
let current={country:"البحرين",city:"المنامة"};

function to12h(t){
 if(!t)return"--"; const [H,M]=t.split(":").map(Number);
 let h=H%12; if(h===0)h=12; return `${String(h).padStart(2,"0")}:${String(M).padStart(2,"0")} ${H<12?"AM":"PM"}`;
}
function renderHadith(){
 const h=HADITHS[Math.floor(Math.random()*HADITHS.length)];
 hadithText.textContent=h.t; hadithSource.textContent=h.s;
}
function nextKey(timings){
 const order=["Imsak","Fajr","Dhuhr","Asr","Maghrib","Isha","Midnight"];
 const now=new Date();
 return order.find(k=>timings[k] && new Date("1970/01/01 "+timings[k])>now) || "Fajr";
}
async function load(){
 place.textContent=`${current.city}، ${current.country}`;
 times.innerHTML="<tr><td colspan=2>...</td></tr>";
 try{
   const url=`https://api.aladhan.com/v1/timingsByCity?city=${encodeURIComponent(current.city)}&country=${encodeURIComponent(current.country)}&method=0`;
   const res=await fetch(url); const j=await res.json(); const t=j.data.timings;
   const rows=[
     {l:"الإمساك",k:"Imsak",i:"🌙"},
     {l:"أذان الفجر",k:"Fajr",i:"🕌"},
     {l:"أذان الظهر",k:"Dhuhr",i:"☀️"},
     {l:"أذان العصر",k:"Asr",i:"🌤️"},
     {l:"أذان المغرب",k:"Maghrib",i:"🌆"},
     {l:"أذان العشاء",k:"Isha",i:"🌙"},
     {l:"منتصف الليل",k:"Midnight",i:"🌌"}
   ];
   const nk=nextKey(t);
   times.innerHTML=rows.map(r=>`<tr class="${r.k===nk?'next':''}"><td>${r.i} ${r.l}</td><td class="time">${to12h((t[r.k]||"").split(" ")[0])}</td></tr>`).join("");
 }catch{ times.innerHTML="<tr><td colspan=2>تعذر</td></tr>"; }
}
function buildList(){
 const box=document.getElementById("countries");
 box.innerHTML="";
 for(const c in MAP){
   const div=document.createElement("div"); div.className="country";
   div.innerHTML=`<h4>${c}</h4><div class="cityList">${MAP[c].map(m=>`<button class="cityBtn" data-c="${c}" data-m="${m}">${m}</button>`).join("")}</div>`;
   box.appendChild(div);
 }
 box.querySelectorAll(".cityBtn").forEach(btn=>{
   btn.onclick=()=>{current={country:btn.dataset.c,city:btn.dataset.m}; closeSheet(); load();}
 });
}
function openSheet(){sheet.classList.add("open");}
function closeSheet(){sheet.classList.remove("open");}

open.onclick=openSheet;
closeSheet.onclick=closeSheet;
sheet.onclick=e=>{if(e.target===sheet)closeSheet();}

buildList(); renderHadith(); load();
</script>
</body>
</html>
