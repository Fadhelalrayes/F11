<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>المِسْبَحة</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;800&display=swap" rel="stylesheet">
<style>
  /* استبدل المسار أدناه بصورة الخلفية (نفس الصورة التي أرسلتها) */
  :root{
    --bg-img:url("bg.jpg");
    --g1:#d90429;   /* أحمر */
    --g2:#ff3b3b;   /* أحمر فاتح */
    --glass:rgba(255,255,255,.14);
    --border:rgba(255,255,255,.28);
    --white:#fff;
    --muted:rgba(255,255,255,.8);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family:"Tajawal", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    color:#fff;
    background:
      linear-gradient(180deg, rgba(0,0,0,.25), rgba(0,0,0,.25)),
      var(--bg-img) center/cover no-repeat fixed;
  }

  .screen{
    position:relative;
    width:min(420px,96vw);
    height:calc(100vh - 24px);
    margin:12px auto;
    border-radius:28px;
    overflow:hidden;
    box-shadow:0 25px 50px rgba(0,0,0,.35);
    background:
      linear-gradient(160deg,var(--g1),var(--g2));
    isolation:isolate;
  }
  .veil{
    position:absolute; inset:0;
    background:
      radial-gradient(120% 90% at 80% -10%, rgba(255,255,255,.12), transparent 50%),
      linear-gradient(160deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
    z-index:0;
  }

  /* شريط علوي */
  .topbar{
    position:relative; z-index:2;
    display:flex; align-items:center; justify-content:space-between;
    padding:16px 16px 6px;
  }
  .icon-btn{
    width:36px;height:36px;border-radius:50%;
    display:grid;place-items:center;
    background:var(--glass); border:1px solid var(--border);
    box-shadow:inset 0 0 0 1px rgba(255,255,255,.08);
    cursor:pointer;
  }
  .title{font-weight:800;font-size:22px;letter-spacing:.3px}

  /* تبويبات */
  .tabs{display:flex;gap:12px; justify-content:center; padding:14px 16px}
  .tab{
    flex:1; text-align:center; padding:12px 10px;
    background:var(--glass); border:1px solid var(--border);
    border-radius:14px; color:var(--muted); font-weight:800; cursor:pointer;
  }
  .tab.active{ color:var(--white); box-shadow:inset 0 0 0 2px rgba(255,255,255,.25) }

  /* العبارة والعداد */
  .phrase{ text-align:center; font-size:40px; font-weight:800; margin:2px 0 8px }
  .counter{
    width:80%; margin:8px auto 14px; display:grid; grid-template-columns:1fr 1fr;
    background:var(--glass); border:1px solid var(--border); border-radius:12px; overflow:hidden;
  }
  .counter div{ padding:14px 0; text-align:center; font-size:30px; font-weight:800 }
  .counter div+div{ border-right:1px solid var(--border) }

  /* زر اضغط + الحلقة */
  .ring-wrap{ width:82%; aspect-ratio:1/1; margin:14px auto 10px; position:relative }
  .ring{
    --p:0;
    position:absolute; inset:0; border-radius:50%;
    background:
      radial-gradient(closest-side, transparent 70%, rgba(255,255,255,.10) 71% 72%, transparent 73%),
      conic-gradient(#fff calc(var(--p)*1turn), rgba(255,255,255,.25) 0);
    display:grid; place-items:center; padding:18px; filter:drop-shadow(0 20px 30px rgba(0,0,0,.25));
  }
  .press{
    width:72%; height:72%;
    display:grid; place-items:center;
    background:#fff; color:#b0001a;
    border-radius:28px; border:1px solid var(--border);
    font-weight:800; font-size:40px; letter-spacing:.6px; cursor:pointer;
    box-shadow:0 20px 45px rgba(0,0,0,.28), inset 0 0 0 2px rgba(255,255,255,.55);
  }

  .footer{
    position:absolute; inset-inline:0; bottom:10px; z-index:2;
    text-align:center; color:var(--muted); font-weight:700
  }
  .footer b{color:#fff}
</style>
</head>
<body>

<div class="screen" role="application" aria-label="المسبحة">
  <div class="veil"></div>

  <!-- الشريط العلوي (نفس الأيقونات) -->
  <div class="topbar">
    <!-- تدوير/إعادة -->
    <button class="icon-btn" id="btn-reset" title="إعادة">
      <!-- أيقونة تدوير -->
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M3 12a9 9 0 1 0 3-6.708" stroke="#fff" stroke-width="2" stroke-linecap="round"/>
        <path d="M3 4v4h4" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>

    <div class="title">المسبحة</div>

    <!-- سهم يمين -->
    <button class="icon-btn" id="btn-next" title="التالي">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M9 6l6 6-6 6" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>
  </div>

  <!-- التبويبات -->
  <div class="tabs" role="tablist">
    <button id="tabZ" class="tab active" role="tab" aria-selected="true">تسبيح الزهراء</button>
    <button id="tabO" class="tab" role="tab" aria-selected="false">التسبيح المفتوح</button>
  </div>

  <!-- عبارة الذكر -->
  <div class="phrase" id="phrase">الله أكبر</div>

  <!-- العدادين على نمط الصورة -->
  <div class="counter">
    <div id="leftNum">34</div>
    <div id="rightNum">0</div>
  </div>

  <!-- زر اضغط داخل حلقة تقدم -->
  <div class="ring-wrap">
    <div class="ring" id="ring" style="--p:0">
      <button class="press" id="press">إضغط</button>
    </div>
  </div>

  <div class="footer">برمجة وتطوير : <b>فاضل الريس</b></div>
</div>

<script>
  /* منطق مطابق لتسبيح الزهراء + وضع مفتوح */
  const SEQ = [
    {text:"الله أكبر", max:34},
    {text:"الحمد لله", max:33},
    {text:"سبحان الله", max:33}
  ];
  const isStored = k => localStorage.getItem(k)!==null;
  const save = (k,v)=> localStorage.setItem(k, JSON.stringify(v));
  const load = (k,d)=> isStored(k)? JSON.parse(localStorage.getItem(k)) : d;
  const vibe = ms=>{ try{ navigator.vibrate && navigator.vibrate(ms);}catch(e){} };

  const phrase = document.getElementById("phrase");
  const leftNum = document.getElementById("leftNum");
  const rightNum = document.getElementById("rightNum");
  const ring = document.getElementById("ring");
  const press = document.getElementById("press");

  const tabZ = document.getElementById("tabZ");
  const tabO = document.getElementById("tabO");
  const btnReset = document.getElementById("btn-reset");

  let mode = load("mode","zahra");           // zahra | open
  let zh = load("zh",{step:0,count:0});      // للحفظ
  let open = load("open",{text:"سبحان الله", count:0, target:0});

  function setTabs(){
    tabZ.classList.toggle("active", mode==="zahra");
    tabO.classList.toggle("active", mode==="open");
    save("mode", mode);
    render();
  }

  function render(){
    if(mode==="zahra"){
      const cur = SEQ[zh.step] || {text:"تم التسبيح", max:1};
      phrase.textContent = cur.text;
      leftNum.textContent  = cur.max;
      rightNum.textContent = zh.count;
      ring.style.setProperty("--p", Math.min(1, zh.count/cur.max));
    }else{
      phrase.textContent = open.text || "—";
      leftNum.textContent  = open.target>0 ? open.target : "∞";
      rightNum.textContent = open.count;
      const p = open.target>0 ? Math.min(1, open.count/open.target) : 0;
      ring.style.setProperty("--p", p);
    }
  }

  function tick(){
    if(mode==="zahra"){
      const cur = SEQ[zh.step];
      if(!cur){ zh={step:0,count:0}; save("zh",zh); render(); return; }
      zh.count++;
      if(zh.count>=cur.max){
        zh.step++;
        zh.count=0;
        vibe(50);
        if(zh.step>=SEQ.length){ // أنهى الدورة
          phrase.textContent="تم التسبيح 👌";
          leftNum.textContent="0"; rightNum.textContent="0";
          ring.style.setProperty("--p",1);
        }
      }else{ vibe(12); }
      save("zh",zh);
    }else{ // open
      open.count++;
      vibe(10);
      save("open",open);
    }
    render();
  }

  // نفس الإحساس: نقرة واحدة = زيادة
  press.addEventListener("click", tick);
  // تنقّل للوضع المفتوح مع السهم
  document.getElementById("btn-next").onclick = ()=>{
    mode = (mode==="zahra")? "open" : "zahra";
    setTabs();
  };

  tabZ.onclick = ()=>{ mode="zahra"; setTabs(); };
  tabO.onclick = ()=>{ mode="open";  setTabs(); };

  // إعادة
  btnReset.onclick = ()=>{
    if(confirm("تصفير العدّاد؟")){
      zh={step:0,count:0};
      open={text:"سبحان الله",count:0,target:0};
      save("zh",zh); save("open",open);
      render();
    }
  };

  // ضغطة طويلة على زر العد في الوضع المفتوح لإنقاص 1
  press.addEventListener("pointerdown", e=>{
    if(mode!=="open") return;
    let held = false;
    const t = setTimeout(()=>{ held=true; open.count = Math.max(0, open.count-1); save("open",open); render(); }, 450);
    const cancel=()=>{ clearTimeout(t); press.removeEventListener("pointerup",cancel); press.removeEventListener("pointerleave",cancel); if(!held) tick(); };
    press.addEventListener("pointerup",cancel); press.addEventListener("pointerleave",cancel);
  });

  setTabs();
</script>
</body>
</html>
