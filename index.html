<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>الأيام الصالحة – 1447هـ (تقويم الصايغ)</title>
  <style>
    :root{
      --bg:#fffdf8; --card:#ffffff; --ink:#171513; --muted:#7a746c; --line:#efe7d9;
      --blessed:#caa74c; --good:#0a8a61; --disliked:#c33b3b; --today:#5b7dff;
      --radius:14px; --shadow:0 6px 14px #0000000a;
      --ctl-h:42px;
    }

    /* reset صغير لضمان التوافق */
    *,*::before,*::after{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;padding:0;background:var(--bg);color:var(--ink);
      font-family:"Noto Naskh Arabic","Amiri","Scheherazade New",system-ui,-apple-system,Segoe UI,Roboto,sans-serif
    }
    button,input,select{font:inherit;color:inherit}

    .container{max-width:720px;margin-inline:auto;padding:18px}

    /* رأس بسيط */
    header{text-align:center;margin-bottom:12px}
    header h1{margin:0 0 4px;font-size:1.2rem}
    header small{color:var(--muted)}
    .gold{height:3px;width:120px;background:linear-gradient(90deg,#f5e4bd,#e9d08e,#caa74c,#f5e4bd);border-radius:999px;margin:8px auto 0}

    /* بطاقات */
    .card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow)}
    .pad{padding:14px}

    .today{display:grid;gap:10px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:8px}
    .tile{border:1px solid var(--line);border-radius:10px;padding:10px}
    .tile h3{margin:0 0 4px;color:var(--muted);font-size:.9rem}
    .tile p{margin:0;font-size:1.06rem;font-weight:700}

    /* عناصر التحكّم – متوافقة */
    .controls{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .btn{
      appearance:none;-webkit-appearance:none;
      height:var(--ctl-h); padding:0 14px; border-radius:10px;
      border:1px solid var(--line); background:#fff; cursor:pointer;
    }
    .btn.primary{background:#fff7e6;border-color:#ecdcb8}
    .btn:active{transform:translateY(1px)}
    .btn:focus-visible{outline:2px solid var(--today); outline-offset:2px}

    .input{
      display:inline-flex; align-items:center; gap:8px;
      border:1px solid var(--line); border-radius:10px; background:#fff; padding-inline:10px; height:var(--ctl-h)
    }
    .input input[type="date"]{
      appearance:none;-webkit-appearance:none;border:0;outline:0;background:transparent;height:calc(var(--ctl-h) - 10px)
    }
    .input input[type="date"]:focus-visible{outline:2px solid var(--today); outline-offset:2px}

    /* وسوم الحالة */
    .legend{display:flex;gap:8px;flex-wrap:wrap}
    .badge{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;border:1px solid var(--line);background:#fff}
    .dot{width:10px;height:10px;border-radius:50%}
    .dot.b{background:var(--blessed)} .dot.g{background:var(--good)} .dot.d{background:var(--disliked)}

    /* التقويم */
    .month{margin-top:12px}
    .head{display:flex;align-items:center;justify-content:space-between;gap:8px;flex-wrap:wrap}
    .name{font-weight:800}
    .weekdays{display:grid;grid-template-columns:repeat(7,1fr);gap:4px;color:#8b8b8b;text-align:center;font-size:.9rem;margin:8px 0 4px}
    .grid{display:grid;grid-template-columns:repeat(7,1fr);gap:4px}

    .cell{
      background:#fff;border:1px solid var(--line);border-radius:10px;min-height:52px;padding:8px;
      text-align:center;cursor:pointer;display:flex;flex-direction:column;justify-content:center;gap:2px;position:relative
    }
    .cell .d{font-weight:800}
    .cell .r{font-size:.82rem;color:#514d47}
    .cell.today{outline:2px solid var(--today)}
    .cell.selected{box-shadow:0 0 0 2px #bfc6ff}

    /* شريط علوي ملوّن بدل أيقونات */
    .cell::before{
      content:"";position:absolute;inset-inline:0;inset-block-start:0;height:4px;
      border-radius:10px 10px 0 0;background:var(--bar,#ddd)
    }
    .cell[data-r="مباركة"]{--bar: var(--blessed)}
    .cell[data-r="صالحة"]{--bar: var(--good)}
    .cell[data-r="مكروهة"]{--bar: var(--disliked)}

    .note{margin-top:6px;color:#444}

    footer{margin:16px 0 6px;text-align:center;color:#7a746c}
    .sig{display:inline-flex;gap:6px;padding:6px 12px;border-radius:999px;background:#ffffffcf;border:1px solid var(--line)}

    @media (max-width:560px){.row{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="container" id="app">
    <header>
      <h1>الأيام الصالحة للعقد والزواج – 1447هـ</h1>
      <small>معتمد على <strong>تقويم الصايغ</strong> (البحرين) – تصميم هادئ ومتناسق</small>
      <div class="gold"></div>
    </header>

    <section class="card pad today">
      <div class="row">
        <div class="tile"><h3>التاريخ الهجري (الصايغ)</h3><p id="hijriStr">-</p></div>
        <div class="tile"><h3>التاريخ الميلادي (البحرين)</h3><p id="gregStr">-</p></div>
      </div>
      <div class="row">
        <div class="tile"><h3>اليوم</h3><p id="weekday">-</p></div>
        <div class="tile"><h3>الساعة الآن</h3><p id="clock">--:--:--</p></div>
      </div>

      <div class="controls">
        <label class="input">اختر تاريخًا <input id="datePicker" type="date" /></label>
        <button class="btn" id="prevDay" type="button">السابق</button>
        <button class="btn" id="nextDay" type="button">التالي</button>
        <button class="btn primary" id="goToday" type="button">اليوم</button>
      </div>

      <div class="legend">
        <span class="badge"><span class="dot b"></span>مباركة</span>
        <span class="badge"><span class="dot g"></span>صالحة</span>
        <span class="badge"><span class="dot d"></span>مكروهة</span>
      </div>

      <div class="note" id="rulingText">اختر تاريخًا لعرض الحكم والملاحظات.</div>
      <div class="note" id="notesText"></div>
    </section>

    <section class="card pad month">
      <div class="head">
        <div class="name" id="monthTitle">تقويم الشهر الهجري</div>
        <div class="controls">
          <button class="btn" id="prevMonth" type="button">الشهر السابق</button>
          <button class="btn" id="nextMonth" type="button">الشهر التالي</button>
        </div>
      </div>
      <div class="weekdays">
        <div>الأحد</div><div>الإثنين</div><div>الثلاثاء</div><div>الأربعاء</div><div>الخميس</div><div>الجمعة</div><div>السبت</div>
      </div>
      <div class="grid" id="monthGrid"></div>
    </section>

    <footer><div class="sig">إعداد وبرمجة: <strong>فاضل الريس</strong></div></footer>
  </div>

<script>
  // المنطقة الزمنية: البحرين
  const TZ='Asia/Bahrain';
  function nowBH(){
    const f=new Intl.DateTimeFormat('en-CA',{timeZone:TZ,year:'numeric',month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit',second:'2-digit',hour12:false});
    const p=Object.fromEntries(f.formatToParts(new Date()).map(x=>[x.type,x.value]));
    return new Date(`${p.year}-${p.month}-${p.day}T${p.hour}:${p.minute}:${p.second}`);
  }
  function clock(d){ return new Intl.DateTimeFormat('ar',{timeZone:TZ,hour:'2-digit',minute:'2-digit',second:'2-digit'}).format(d); }

  // تقويم أم القرى (يعتمده الصايغ) إن توفر
  const hasUmmAlQura=(()=>{try{new Intl.DateTimeFormat('ar-SA-u-ca-islamic-umalqura').format(new Date());return true;}catch{return false;}})();
  function hijriIntl(d){
    const y=+new Intl.DateTimeFormat('en-u-ca-islamic-umalqura',{timeZone:TZ,year:'numeric'}).format(d);
    const m=+new Intl.DateTimeFormat('en-u-ca-islamic-umalqura',{timeZone:TZ,month:'numeric'}).format(d);
    const day=+new Intl.DateTimeFormat('en-u-ca-islamic-umalqura',{timeZone:TZ,day:'numeric'}).format(d);
    const wk=new Intl.DateTimeFormat('ar',{timeZone:TZ,weekday:'long'}).format(d);
    const mn=new Intl.DateTimeFormat('ar-SA-u-ca-islamic-umalqura',{timeZone:TZ,month:'long'}).format(d);
    return {y:y,m:m,d:day,weekday:wk,str:`${day} ${mn} ${y}هـ`};
  }
  // احتياط تقريبي
  function hijriApprox(g){
    const day=g.getDate(),month=g.getMonth()+1,year=g.getFullYear();
    const jd=Math.floor((1461*(year+4800+Math.floor((month-14)/12)))/4)+Math.floor((367*(month-2-12*Math.floor((month-14)/12)))/12)-Math.floor((3*Math.floor((year+4900+Math.floor((month-14)/12))/100))/4)+day-32075;
    const l=jd-1948440+10632; const n=Math.floor((l-1)/10631); const l2=l-10631*n+354;
    const j1=(Math.floor((10985-l2)/5316))*(Math.floor((50*l2)/17719))+(Math.floor(l2/5670))*(Math.floor((43*l2)/15238));
    const j2=l2-(Math.floor((30-j1)/15))*(Math.floor((17719*j1)/50))-(Math.floor(j1/16))*(Math.floor((15238*j1)/43))+29;
    const mH=Math.floor((24*j2)/709); const dH=j2-Math.floor((709*mH)/24); const yH=30*n+j1-30;
    const names=['','محرم','صفر','ربيع الأول','ربيع الثاني','جمادى الأولى','جمادى الثاني','رجب','شعبان','رمضان','شوال','ذو القعدة','ذو الحجة'];
    const wk=new Intl.DateTimeFormat('ar',{timeZone:TZ,weekday:'long'}).format(g);
    return {y:yH,m:mH,d:dH,weekday:wk,str:`${dH} ${names[mH]} ${yH}هـ`};
  }
  const H=d=>hasUmmAlQura?hijriIntl(d):hijriApprox(d);
  function greg(d){
    const s=new Intl.DateTimeFormat('ar',{timeZone:TZ,day:'numeric',month:'long',year:'numeric'}).format(d);
    const w=new Intl.DateTimeFormat('ar',{timeZone:TZ,weekday:'long'}).format(d);
    return {str:s,weekday:w};
  }

  // بيانات 1447هـ (مختصرة)
  const months={ /* نفس البيانات السابقة بالضبط */ 
    3:{name:'ربيع الأول',days:{1:'مباركة',2:'مباركة',3:'مكروهة',4:'مكروهة',5:'مكروهة',6:'مباركة',7:'مباركة',8:'مكروهة',9:'صالحة',10:'مكروهة',11:'صالحة',12:'مباركة',13:'مكروهة',14:'صالحة',15:'صالحة',16:'مكروهة',17:'مكروهة',18:'مباركة',19:'مباركة',20:'مباركة',21:'مكروهة',22:'صالحة',23:'مباركة',24:'مكروهة',25:'مكروهة',26:'مكروهة',27:'مباركة',28:'مباركة',29:'مكروهة',30:'مباركة'},notes:{8:'استشهاد الإمام العسكري (ع)'}},
    4:{name:'ربيع الثاني',days:{1:'مكروهة',2:'مباركة',3:'مكروهة',4:'مباركة',5:'مكروهة',6:'مباركة',7:'مباركة',8:'مكروهة',9:'صالحة',10:'صالحة',11:'صالحة',12:'مباركة',13:'مكروهة',14:'صالحة',15:'مكروهة',16:'مكروهة',17:'مباركة',18:'مكروهة',19:'مباركة',20:'مباركة',21:'مكروهة',22:'مكروهة',23:'مباركة',24:'مكروهة',25:'مكروهة',26:'مكروهة',27:'مباركة',28:'مباركة',29:'مكروهة',30:'مباركة'},notes:{13:'استشهاد السيدة فاطمة الزهراء (ع)'}},
    5:{name:'جمادى الأولى',days:{1:'مباركة',2:'مباركة',3:'مكروهة',4:'مباركة',5:'مكروهة',6:'مكروهة',7:'مباركة',8:'صالحة',9:'صالحة',10:'صالحة',11:'صالحة',12:'مباركة',13:'مكروهة',14:'صالحة',15:'صالحة',16:'مكروهة',17:'مباركة',18:'مكروهة',19:'مباركة',20:'مكروهة',21:'مكروهة',22:'صالحة',23:'مباركة',24:'مكروهة',25:'مكروهة',26:'مكروهة',27:'مكروهة',28:'مباركة',29:'مكروهة'},notes:{13:'استشهاد السيدة فاطمة الزهراء (ع)'}},
    6:{name:'جمادى الثاني',days:{1:'مباركة',2:'مباركة',3:'مكروهة',4:'مباركة',5:'مكروهة',6:'مباركة',7:'مباركة',8:'صالحة',9:'صالحة',10:'صالحة',11:'صالحة',12:'مكروهة',13:'مكروهة',14:'صالحة',15:'صالحة',16:'مكروهة',17:'مباركة',18:'مكروهة',19:'مباركة',20:'مكروهة',21:'مكروهة',22:'صالحة',23:'مباركة',24:'مكروهة',25:'مكروهة',26:'مكروهة',27:'مباركة',28:'مباركة',29:'مكروهة',30:'مباركة'},notes:{3:'استشهاد السيدة فاطمة الزهراء (ع) – الرواية الثانية',13:'وفاة السيدة أم البنين (ع)'}},
    7:{name:'رجب',days:{1:'مباركة',2:'مباركة',3:'مكروهة',4:'مباركة',5:'مكروهة',6:'مباركة',7:'مباركة',8:'صالحة',9:'صالحة',10:'مكروهة',11:'صالحة',12:'مكروهة',13:'مكروهة',14:'صالحة',15:'مكروهة',16:'مكروهة',17:'مكروهة',18:'مباركة',19:'مباركة',20:'مباركة',21:'مكروهة',22:'صالحة',23:'مباركة',24:'مكروهة',25:'مكروهة',26:'مكروهة',27:'مباركة',28:'مباركة',29:'مكروهة',30:'مباركة'},notes:{3:'استشهاد الإمام علي الهادي (ع)',12:'بداية 2026م',15:'وفاة السيدة زينب (ع)',25:'استشهاد الإمام موسى الكاظم (ع)'}},
    8:{name:'شعبان',days:{1:'مكروهة',2:'مباركة',3:'مكروهة',4:'مباركة',5:'مكروهة',6:'مباركة',7:'مباركة',8:'مكروهة',9:'صالحة',10:'صالحة',11:'صالحة',12:'مباركة',13:'مكروهة',14:'صالحة',15:'مكروهة',16:'مكروهة',17:'مباركة',18:'مباركة',19:'مباركة',20:'مباركة',21:'مكروهة',22:'مكروهة',23:'مباركة',24:'مكروهة',25:'مكروهة',26:'مكروهة',27:'مباركة',28:'مباركة',29:'مكروهة'}},
    9:{name:'رمضان',days:{1:'مباركة',2:'مباركة',3:'مكروهة',4:'مباركة',5:'مكروهة',6:'مباركة',7:'مكروهة',8:'مكروهة',9:'صالحة',10:'صالحة',11:'صالحة',12:'صالحة',13:'مكروهة',14:'مكروهة',15:'صالحة',16:'مكروهة',17:'مباركة',18:'مباركة',19:'مكروهة',20:'مكروهة',21:'مكروهة',22:'صالحة',23:'صالحة',24:'مكروهة',25:'مكروهة',26:'مكروهة',27:'مباركة',28:'مكروهة',29:'مكروهة',30:'مباركة'},notes:{8:'وفاة السيدة خديجة (ع)',19:'ضربة الإمام علي (ع)',20:'مرض الإمام علي (ع)',21:'استشهاد الإمام علي (ع)'}},
    10:{name:'شوال',days:{1:'مباركة',2:'مكروهة',3:'مكروهة',4:'مباركة',5:'مكروهة',6:'مباركة',7:'مباركة',8:'صالحة',9:'صالحة',10:'صالحة',11:'صالحة',12:'مكروهة',13:'مكروهة',14:'صالحة',15:'صالحة',16:'مكروهة',17:'مباركة',18:'مباركة',19:'مكروهة',20:'مباركة',21:'مكروهة',22:'مكروهة',23:'مباركة',24:'مكروهة',25:'مكروهة',26:'مكروهة',27:'مباركة',28:'مباركة',29:'مكروهة'},notes:{25:'استشهاد الإمام جعفر الصادق (ع)'}},
    11:{name:'ذو القعدة',days:{1:'مباركة',2:'مباركة',3:'مكروهة',4:'مكروهة',5:'مكروهة',6:'مباركة',7:'مباركة',8:'صالحة',9:'صالحة',10:'صالحة',11:'مكروهة',12:'مباركة',13:'مكروهة',14:'صالحة',15:'صالحة',16:'مكروهة',17:'مباركة',18:'مكروهة',19:'مباركة',20:'مباركة',21:'مكروهة',22:'مكروهة',23:'مباركة',24:'مكروهة',25:'مكروهة',26:'مكروهة',27:'مباركة',28:'مباركة',29:'مكروهة'},notes:{29:'استشهاد الإمام محمد الجواد (ع)'}},
    12:{name:'ذو الحجة',days:{1:'مباركة',2:'مباركة',3:'مكروهة',4:'مباركة',5:'مكروهة',6:'مباركة',7:'مكروهة',8:'مكروهة',9:'صالحة',10:'مكروهة',11:'صالحة',12:'مباركة',13:'مكروهة',14:'صالحة',15:'صالحة',16:'مكروهة',17:'مكروهة',18:'مباركة',19:'مباركة',20:'مباركة',21:'مكروهة',22:'صالحة',23:'مباركة',24:'مكروهة',25:'مكروهة',26:'مكروهة',27:'مباركة',28:'مباركة',29:'مكروهة',30:'مباركة'},notes:{7:'استشهاد الإمام محمد الباقر (ع)',8:'استشهاد مسلم بن عقيل (ع)'}}
  };

  const $=id=>document.getElementById(id);
  const S={date:nowBH(),hijri:null,view:null};
  function tick(){ $('clock').textContent=clock(nowBH()); }

  function update(){
    const d=S.date; const h=H(d); S.hijri=h; const g=greg(d);
    $('hijriStr').textContent=h.str;
    $('gregStr').textContent=g.str;
    $('weekday').textContent=g.weekday;

    const mData=months[h.m]; const rule=mData?.days?.[h.d];
    $('rulingText').textContent=`حكم اليوم: ${rule||'غير محدد'}`;
    $('notesText').textContent=mData?.notes?.[h.d]?`ملاحظة: ${mData.notes[h.d]}`:'';

    $('datePicker').valueAsDate=new Date(d.getFullYear(),d.getMonth(),d.getDate());
    S.view={y:h.y,m:h.m};
    renderMonth();
  }

  function renderMonth(){
    const y = Number(S.view?.y) || Number(S.hijri?.y) || 1447;
    const m = Number(S.view?.m) || Number(S.hijri?.m) || 3;
    const mData=months[m];
    $('monthTitle').textContent=`${mData?.name||'الشهر'} ${y}هـ`;
    const grid=$('monthGrid'); grid.innerHTML='';
    const todayH=H(nowBH());
    for(let i=1;i<=30;i++){
      const r=mData?.days?.[i]; if(!r) continue;
      const c=document.createElement('div'); c.className='cell'; c.dataset.r=r;
      c.innerHTML=`<div class="d">${i}</div><div class="r">${r}</div>`;
      if(todayH.y===y&&todayH.m===m&&todayH.d===i) c.classList.add('today');
      c.addEventListener('click',()=>jumpTo(y,m,i));
      grid.appendChild(c);
    }
  }

  function jumpTo(y,m,d){
    const base=nowBH(); let best=null;
    for(let k=-210;k<=210;k++){
      const t=new Date(base); t.setDate(t.getDate()+k);
      const h=H(t); if(h.y===y&&h.m===m&&h.d===d){best=t;break;}
    }
    S.date=best||base; update(); window.scrollTo({top:0,behavior:'smooth'});
  }

  function init(){
    tick(); setInterval(tick,1000); update();
    $('goToday').addEventListener('click',()=>{S.date=nowBH(); update();});
    $('prevDay').addEventListener('click',()=>{S.date.setDate(S.date.getDate()-1); update();});
    $('nextDay').addEventListener('click',()=>{S.date.setDate(S.date.getDate()+1); update();});
    $('datePicker').addEventListener('change',e=>{
      if(e.target.value){
        /* تأمين متصفحات تغيّر صيغة التاريخ */
        const [y,m,d]=e.target.value.split('-').map(Number);
        S.date=new Date(Date.UTC(y,m-1,d,12,0,0));
        update();
      }
    });
    $('prevMonth').addEventListener('click',()=>{
      const h=S.hijri; let mm=h.m-1, yy=h.y; if(mm<1){mm=12;yy--;}
      S.view={y:yy,m:mm}; jumpTo(yy,mm,1);
    });
    $('nextMonth').addEventListener('click',()=>{
      const h=S.hijri; let mm=h.m+1, yy=h.y; if(mm>12){mm=1;yy++;}
      S.view={y:yy,m:mm}; jumpTo(yy,mm,1);
    });
  }
  document.addEventListener('DOMContentLoaded',init);
</script>
</body>
</html>
