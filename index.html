<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ÙØ§Ø­Øµ Ø£Ø¹Ø±Ø§Ø¶ Ø§Ù„Ø³Ø±Ø·Ø§Ù† â€” ØªÙˆØ¹ÙŠØ© ÙˆØªØ­ÙˆÙŠÙ„Ø§Øª Ù…ÙˆØ«ÙˆÙ‚Ø©</title>
<link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Cairo:wght@300;400;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#f5f6f8; --ink:#111827; --muted:#6b7280;
    --card:#ffffff; --line:#e5e7eb;
    --gold:#b58900; --gold-soft:#f5d574;
    --ocean:#0b4d8a; --emerald:#059669; --crimson:#dc2626;
    --accent:#0ea5e9;
  }
  *{box-sizing:border-box}
  body{margin:0; font-family:"Cairo",sans-serif; background:var(--bg); color:var(--ink)}
  header{text-align:center; padding:24px 12px}
  .brand{font-family:"Amiri",serif; font-size:clamp(26px,4.5vw,42px); color:var(--gold)}
  .tag{margin-top:6px; font-size:14px; color:#6b7280}
  .shell{max-width:980px; margin:0 auto; padding:0 16px}
  .hero{background:var(--card); border:1px solid var(--line); border-radius:20px; padding:20px; box-shadow:0 4px 12px rgba(0,0,0,.05)}
  .row{display:grid; gap:16px}
  @media(min-width:920px){ .row{grid-template-columns:1.2fr .8fr} }
  .field{display:flex; flex-direction:column; gap:8px; margin-bottom:12px}
  .center{text-align:center}
  .seg{display:flex; gap:6px; justify-content:center; flex-wrap:wrap}
  .seg button{flex:1; padding:10px 14px; border-radius:10px; border:1px solid var(--line); background:#f9fafb; cursor:pointer; max-width:200px; font-weight:700}
  .seg button.on{background:var(--gold); color:#111; border-color:var(--gold)}
  .btn{padding:12px 20px; border-radius:10px; border:none; cursor:pointer; background:linear-gradient(90deg,var(--gold),var(--gold-soft)); color:#111; font-weight:700; display:block; margin:0 auto}
  .badge{display:inline-block; padding:10px 14px; border-radius:10px; margin-top:12px}
  .ok{background:#eff6ff; color:var(--ocean)}
  .warn{background:#fff7ed; color:#9a3412}
  .danger{background:#fee2e2; color:#991b1b}

  .kpi{display:grid; gap:10px; grid-template-columns:1fr 1fr; margin-top:10px}
  .k{background:#f9fafb; border:1px solid var(--line); border-radius:10px; padding:10px; text-align:center}
  .k .v{font-weight:700; font-size:18px}

  .deck{display:grid; gap:12px; grid-template-columns:1fr; margin-top:16px}
  @media(min-width:860px){ .deck{grid-template-columns:repeat(2,1fr)} }
  .card{background:#fdfdfd; border:1px solid var(--line); border-radius:12px; padding:14px; box-shadow:0 2px 6px rgba(0,0,0,.04)}
  .card h3{margin:0 0 6px; font-family:"Amiri",serif; color:var(--gold)}
  .card p, .card ul{margin:0; font-size:14px; color:#374151; line-height:1.7}
  .card ul{margin-top:8px; padding-inline-start:20px}

  /* Ø¥Ø´Ø¹Ø§Ø± */
  .notice{
    position:fixed; left:50%; bottom:20px; transform:translateX(-50%) translateY(10px);
    background:#fff; border:1px solid var(--gold); border-radius:12px; padding:10px 14px;
    box-shadow:0 8px 24px rgba(0,0,0,.12); display:flex; align-items:center; gap:10px;
    opacity:0; transition:.25s ease; z-index:9999; max-width:92vw; font-size:14px; color:#111;
  }
  .notice.show{ opacity:1; transform:translateX(-50%) translateY(0) }
  .notice .dot{width:10px; height:10px; border-radius:50%; background:linear-gradient(90deg,var(--gold),var(--gold-soft))}
  .notice .close{ margin-inline-start:8px; cursor:pointer; border:none; background:transparent; font-size:18px; line-height:1; color:#6b7280 }
  .notice.error{ border-color:#fecaca }
  .notice.error .dot{ background:linear-gradient(90deg,#fecaca,#fee2e2) }

  /* PDF */
  .pdfwrap{margin-top:12px; text-align:center; display:none}
  .pdfbtn{padding:10px 16px; border-radius:10px; border:1px solid var(--gold); background:#fff; cursor:pointer; font-weight:700}
  .pdfbtn:hover{ box-shadow:0 0 0 3px rgba(245,213,116,.15) }

  /* Ù‚ÙˆØ§Ø¦Ù… Ù…Ù†Ø³Ø¯Ù„Ù€Ø© ÙƒØ¨ÙŠØ±Ø© ÙˆØ¬Ù…ÙŠÙ„Ø© */
  .bigselect{ position:relative; width:100% }
  .bigselect input{
    width:100%; padding:12px 14px; border:2px solid var(--gold); border-radius:12px; font-size:1rem; background:#fff; outline:none;
  }
  .bigselect .panel{
    position:absolute; top:100%; inset-inline:0; background:#fff; border:1px solid var(--line); border-radius:12px; box-shadow:0 8px 24px rgba(0,0,0,.08);
    max-height:260px; overflow:auto; margin-top:6px; display:none; z-index:9;
  }
  .bigselect .opt{ padding:10px 12px; cursor:pointer; border-bottom:1px solid #f3f4f6 }
  .bigselect .opt:last-child{ border-bottom:none }
  .bigselect .opt:hover{ background:#fff7e6 }
  .hint{font-size:12px; color:#6b7280}

  /* Ù…Ø´Ø§Ø±ÙƒØ© */
  .iconbtn{width:34px; height:34px; border-radius:8px; display:flex; align-items:center; justify-content:center; border:1px solid var(--line); background:#fff; cursor:pointer}
</style>
</head>
<body>
<header>
  <div class="brand">ÙØ§Ø­Øµ Ø£Ø¹Ø±Ø§Ø¶ Ø§Ù„Ø³Ø±Ø·Ø§Ù†</div>
  <div class="tag">Ù…ÙˆÙ‚Ø¹ ØªÙˆØ¹ÙˆÙŠ ÙŠØ³Ø§Ø¹Ø¯Ùƒ Ø¹Ù„Ù‰ ÙÙ‡Ù… Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶ Ø§Ù„ØªØ­Ø°ÙŠØ±ÙŠØ© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø© ÙˆØ¹ÙˆØ§Ù…Ù„ Ø§Ù„Ø®Ø·ÙˆØ±Ø©ØŒ ÙˆÙŠÙ‚Ø¯Ù‘Ù… ØªÙˆØµÙŠØ© Ø£ÙˆÙ„ÙŠØ© ÙˆØ®ÙŠØ§Ø±Ø§Øª ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ Ù…Ø±Ø§Ø¬Ø¹ ÙˆÙ…Ø±Ø§ÙƒØ² Ø¹Ø§Ù„Ù…ÙŠØ© Ù…ÙˆØ«ÙˆÙ‚Ø©. Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø¯Ø§Ø© Ù„Ø§ ØªÙØ´Ø®Ù‘Øµ Ø§Ù„Ù…Ø±Ø¶ ÙˆÙ„Ø§ ØªÙØºÙ†ÙŠ Ø¹Ù† Ø§Ù„Ø·Ø¨ÙŠØ¨.</div>
</header>

<main class="shell">
  <section class="hero">
    <div class="row">
      <div>
        <!-- Ø§Ù„Ø¯ÙˆÙ„Ø© (Ù‚Ø§Ø¦Ù…Ø© ÙƒØ¨ÙŠØ±Ø© Ù…Ø­Ø³Ù‘Ù†Ø© Ù…Ø¹ Ø¨Ø­Ø«) -->
        <div class="field">
          <label><strong>Ø§Ø®ØªØ± Ø¯ÙˆÙ„ØªÙƒ</strong></label>
          <div class="bigselect" id="countryBox">
            <input id="countrySearch" placeholder="Ø§ÙƒØªØ¨ Ù„Ù„Ø¨Ø­Ø«â€¦ (Ù…Ø«Ø§Ù„: Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†ØŒ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©ØŒ Ù…ØµØ±)" aria-label="Ø¨Ø­Ø« Ø§Ù„Ø¯ÙˆÙ„Ø©" />
            <div class="panel" id="countryPanel"></div>
            <div class="hint">Ø§Ø®ØªØ± Ø¯ÙˆÙ„ØªÙƒ Ù„ØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ù†ØµØ§Ø¦Ø­ ØªØ­Ø±Ù‘ÙŠ Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ø¹ÙÙ…Ø±Ùƒ ÙˆØ¨Ù„Ø¯Ùƒ.</div>
          </div>
        </div>

        <!-- Ø§Ù„Ù†ÙˆØ¹ ÙˆØ§Ù„Ø¹Ù…Ø± -->
        <div class="field center">
          <label><strong>Ø§Ù„Ù†ÙˆØ¹</strong></label>
          <div class="seg" id="sexSeg">
            <button type="button" class="on" data-sex="male">Ø±Ø¬Ù„</button>
            <button type="button" data-sex="female">Ø§Ù…Ø±Ø£Ø©</button>
          </div>
        </div>

        <div class="field">
          <label><strong>Ø§Ù„Ø¹Ù…Ø±</strong></label>
          <input id="age" type="number" inputmode="numeric" min="0" max="120" placeholder="Ù…Ø«Ø§Ù„: 45" style="width:160px; padding:12px; border:1px solid var(--line); border-radius:10px; text-align:center">
        </div>

        <!-- Ø¹ÙˆØ§Ù…Ù„ -->
        <div class="field center">
          <label><strong>Ø¹ÙˆØ§Ù…Ù„ Ù…Ø¤Ø«Ø±Ø©</strong></label>
          <div class="seg" id="smokeSeg">
            <button type="button" class="on" data-smoke="no">ØºÙŠØ± Ù…Ø¯Ø®Ù‘Ù†</button>
            <button type="button" data-smoke="yes">Ù…Ø¯Ø®Ù‘Ù†</button>
          </div>
          <div style="margin-top:8px" class="seg" id="familySeg">
            <button type="button" class="on" data-fh="no">Ù„Ø§ ØªØ§Ø±ÙŠØ® Ø¹Ø§Ø¦Ù„ÙŠ Ù‚ÙˆÙŠ</button>
            <button type="button" data-fh="yes">ØªØ§Ø±ÙŠØ® Ø¹Ø§Ø¦Ù„ÙŠ Ù‚ÙˆÙŠ</button>
          </div>
        </div>

        <!-- Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶ -->
        <div class="card">
          <h3>Ø£Ø¬Ø¨ Ø¹Ù† Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶ Ø§Ù„ØªØ§Ù„ÙŠØ© (Ù†Ø¹Ù…/Ù„Ø§)</h3>
          <div id="symptoms"></div>
          <div style="margin-top:8px; font-size:12px; color:#6b7280">* Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø§Ù„Ø¹Ø±Ø¶ &gt; 3 Ø£Ø³Ø§Ø¨ÙŠØ¹ Ø£Ùˆ ØªÙØ§Ù‚Ù…Ù‡ ÙŠØ³ØªØ¯Ø¹ÙŠ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø·Ø¨ÙŠ.</div>
        </div>

        <button class="btn" id="calc">Ø§Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©</button>

        <div class="pdfwrap" id="pdfwrap">
          <button class="pdfbtn" id="pdfBtn">ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ PDF</button>
        </div>
      </div>

      <div>
        <div id="verdict" class="badge ok" style="display:none"></div>

        <div class="kpi" id="kpis" style="display:none">
          <div class="k"><div class="v" id="riskLevel">â€”</div><div>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡</div></div>
          <div class="k"><div class="v" id="whatNext">â€”</div><div>Ù…Ø§Ø°Ø§ ØªÙØ¹Ù„ Ø§Ù„Ø¢Ù†</div></div>
        </div>

        <div class="deck" id="adviceDeck" style="display:none"></div>

        <!-- Ø¯Ù„ÙŠÙ„ Ø¹Ø§Ù„Ù…ÙŠ (Ù…Ù†Ø³Ø¯Ù„) -->
        <div class="card" style="margin-top:12px">
          <h3>Ø¯Ù„ÙŠÙ„ Ø¹Ø§Ù„Ù…ÙŠ Ù…ÙˆØ«ÙˆÙ‚</h3>
          <div class="bigselect" id="refBox">
            <input id="refSearch" placeholder="Ø§Ø®ØªØ± Ù…Ø±Ø¬Ø¹Ù‹Ø§ Ø¹Ø§Ù„Ù…ÙŠÙ‹Ø§ (WHO, IARC, NCIâ€¦)" />
            <div class="panel" id="refPanel"></div>
            <div class="hint">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø±Ø¬Ø¹ Ù„ÙØªØ­Ù‡ Ù…Ø¨Ø§Ø´Ø±Ø©.</div>
          </div>
        </div>

        <!-- Ù…Ø³ØªØ´ÙÙŠØ§Øª Ø¹Ø§Ù„Ù…ÙŠØ© Ù…ÙˆØµÙ‰ Ø¨Ù‡Ø§ (ØºÙŠØ± Ø­ÙƒÙˆÙ…ÙŠØ©) -->
        <div class="card" style="margin-top:12px">
          <h3>Ù…Ø³ØªØ´ÙÙŠØ§Øª Ø¹Ø§Ù„Ù…ÙŠØ© Ù…ÙˆØµÙ‰ Ø¨Ù‡Ø§</h3>
          <div class="bigselect" id="intlBox">
            <input id="intlSearch" placeholder="Ø§Ø®ØªØ± Ù…Ø³ØªØ´ÙÙ‰ Ø¹Ø§Ù„Ù…ÙŠâ€¦ (CharitÃ© â€” Ø£Ù„Ù…Ø§Ù†ÙŠØ§ØŒ Bumrungrad â€” ØªØ§ÙŠÙ„Ù†Ø¯â€¦)" />
            <div class="panel" id="intlPanel"></div>
            <div class="hint">ÙŠØªÙ… ÙØªØ­ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰ Ù…Ø¨Ø§Ø´Ø±Ø©.</div>
          </div>
        </div>

        <!-- Ø§Ù„Ù…ØµØ§Ø¯Ø± Ø§Ù„Ø·Ø¨ÙŠØ© (Ù‚Ø§Ø¦Ù…Ø© Ù…Ù†Ø³Ø¯Ù„Ù€Ø©) -->
        <div class="card" style="margin-top:12px">
          <h3>Ø§Ù„Ù…ØµØ§Ø¯Ø± Ø§Ù„Ø·Ø¨ÙŠØ©</h3>
          <div class="bigselect" id="srcBox">
            <input id="srcSearch" placeholder="Ø§Ø®ØªØ± Ù…ØµØ¯Ø±Ù‹Ø§ Ø·Ø¨ÙŠÙ‹Ø§ Ø¹Ù† Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶/Ø§Ù„ØªØ­Ø±Ù‘ÙŠâ€¦" />
            <div class="panel" id="srcPanel"></div>
            <div class="hint">Ù…Ø­ØªÙˆÙ‰ ØªÙˆØ¹ÙˆÙŠ Ù…ÙˆØ«ÙˆÙ‚ Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© (Ù…Ø¹ Ø±ÙˆØ§Ø¨Ø· Ø±Ø³Ù…ÙŠØ©).</div>
          </div>
        </div>

        <!-- Ù…Ø´Ø§Ø±ÙƒØ© Ø«Ù… Ø¨Ø±Ù…Ø¬Ø© ÙˆØªØ·ÙˆÙŠØ± -->
        <div class="card" style="margin-top:12px; text-align:center">
          <h3>Ø´Ø§Ø±Ùƒ Ø§Ù„ØµÙØ­Ø©</h3>
          <div class="sharebar" style="display:flex; justify-content:center; gap:8px; flex-wrap:wrap">
            <a class="iconbtn" id="shareWA" title="ÙˆØ§ØªØ³Ø§Ø¨" aria-label="WhatsApp">
              <svg viewBox="0 0 24 24" width="18" height="18"><path d="M12 0a12 12 0 00-10 18.3L1 23l4.9-1A12 12 0 1012 0zm6.5 17.2c-.3.8-1.7 1.6-2.4 1.6-.6 0-1.4.1-3.8-1-3.2-1.4-5.3-4.6-5.5-4.8-.1-.2-1.3-1.7-1.3-3.2 0-1.6.8-2.4 1.1-2.7.3-.3.7-.4 1-.4h.8c.2 0 .6 0 .9.7.3.8 1.1 2.7 1.2 2.9.1.2.2.5 0 .8-.2.3-.3.5-.6.8-.3.3-.6.6-.2 1.2.4.6 1.7 2.8 4 3.8 2.9 1.2 3 .8 3.5.8.5 0 1.8-.8 2.1-1.5.2-.7 1-1.6 1.3-1.8.2-.1.3-.2.5-.1l1 .5c.3.1.5.3.5.5-.1.4-.7 2-1 2.7z"/></svg>
            </a>
            <a class="iconbtn" id="shareTG" title="ØªÙŠÙ„ÙŠØºØ±Ø§Ù…" aria-label="Telegram">
              <svg viewBox="0 0 24 24" width="18" height="18"><path d="M9 18.2l-.3 4.1c.4 0 .6-.2.8-.4l2-1.8 4.1 3c.7.4 1.3.2 1.5-.7L22 6.2c.2-1.1-.4-1.5-1.1-1.2L2.3 11.1c-1.1.4-1 1.3 0 1.6l4.1 1.2 9.4-5.9c.4-.3.9-.1.5.2L9 18.2z"/></svg>
            </a>
            <a class="iconbtn" id="shareX" title="X" aria-label="X">
              <svg viewBox="0 0 24 24" width="18" height="18"><path d="M3 2h4.7l5 6.8L18.7 2H22l-7.8 9.1L22 22h-4.8l-5.4-7.2L6 22H2.1l8.3-9.8L3 2z"/></svg>
            </a>
            <a class="iconbtn" id="shareFB" title="Facebook" aria-label="Facebook">
              <svg viewBox="0 0 24 24" width="18" height="18"><path d="M22 12a10 10 0 10-11.6 9.9v-7H7.7V12h2.7V9.8c0-2.7 1.6-4.2 4-4.2 1.2 0 2.5.2 2.5.2v2.7h-1.4c-1.4 0-1.9.9-1.9 1.8V12h3.2l-.5 2.9h-2.7v7A10 10 0 0022 12z"/></svg>
            </a>
            <button class="iconbtn" id="copyLink" title="Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·" aria-label="Copy Link">
              <svg viewBox="0 0 24 24" width="18" height="18"><path d="M16 1H8C6.3 1 5 2.3 5 4v12c0 1.7 1.3 3 3 3h8c1.7 0 3-1.3 3-3V4c0-1.7-1.3-3-3-3zm1 15c0 .6-.4 1-1 1H8c-.6 0-1-.4-1-1V4c0-.6.4-1 1-1h8c.6 0 1 .4 1 1v12zM7 20c0 .6.4 1 1 1h8v2H8c-1.7 0-3-1.3-3-3v-2h2v2z"/></svg>
            </button>
          </div>
        </div>

        <footer style="text-align:center; margin:10px 0 0; font-size:12px; color:#6b7280">
          <a id="devLink" class="ghost-link" href="https://api.whatsapp.com/send/?phone=97333375858&text&type=phone_number&app_absent=0&wame_ctl=1" target="_blank" rel="noopener">Ø¨Ø±Ù…Ø¬Ø© ÙˆØªØ·ÙˆÙŠØ±: ÙØ§Ø¶Ù„ Ø§Ù„Ø±ÙŠØ³</a>
        </footer>
      </div>
    </div>
  </section>
</main>

<!-- Ø¥Ø´Ø¹Ø§Ø± -->
<div id="notice" class="notice" style="display:none">
  <div class="dot"></div>
  <div class="text">â€”</div>
  <button class="close" title="Ø¥ØºÙ„Ø§Ù‚" aria-label="Ø¥ØºÙ„Ø§Ù‚">Ã—</button>
</div>

<!-- PDF -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js" defer></script>

<script>
/* ===== Ø¥Ø´Ø¹Ø§Ø± Ø£Ù†ÙŠÙ‚ ===== */
const notice=document.getElementById('notice'), noticeText=notice.querySelector('.text'); notice.querySelector('.close').onclick=()=>{ notice.classList.remove('show'); setTimeout(()=>notice.style.display='none',250); };
function notify(msg,{type='info',timeout=3500}={}){ notice.style.display='flex'; notice.classList.toggle('error', type==='error'); noticeText.innerHTML=msg; requestAnimationFrame(()=>notice.classList.add('show')); clearTimeout(window.__nt); window.__nt=setTimeout(()=>{ notice.classList.remove('show'); setTimeout(()=>notice.style.display='none',250); }, timeout); }

/* ===== Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ ===== */
function makeToggle(segId, dataKey){
  const seg=document.getElementById(segId);
  seg.addEventListener('click', e=>{
    const b=e.target.closest('button'); if(!b) return;
    seg.querySelectorAll('button').forEach(x=>x.classList.remove('on'));
    b.classList.add('on');
    seg.dataset[dataKey]=Object.values(b.dataset)[0];
  });
}
makeToggle('sexSeg','sex'); makeToggle('smokeSeg','smoke'); makeToggle('familySeg','fh');

/* ===== Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶ ===== */
const QUESTIONS = [
  {id:"cough",  text:"Ø³Ø¹Ø§Ù„ Ù…Ø³ØªÙ…Ø± > 3 Ø£Ø³Ø§Ø¨ÙŠØ¹/Ø¨Ø­Ø© Ù…Ø²Ù…Ù†Ø©/Ù†ÙØ« Ø¯Ù…"},
  {id:"lump",   text:"ÙƒØªÙ„Ø©/ØªÙˆØ±Ù‘Ù… Ø¬Ø¯ÙŠØ¯ Ø«Ø§Ø¨Øª Ù„Ø£ÙƒØ«Ø± Ù…Ù† 3 Ø£Ø³Ø§Ø¨ÙŠØ¹"},
  {id:"bleed",  text:"Ù†Ø²Ù ØºÙŠØ± Ù…Ø¨Ø±Ù‘Ø± (Ø¨Ø±Ø§Ø²/Ø¨ÙˆÙ„/Ø³Ø¹Ø§Ù„/Ø¨ÙŠÙ† Ø§Ù„Ø¯ÙˆØ±Ø§Øª)"},
  {id:"skin",   text:"ØªØºÙŠÙ‘Ø± ÙˆØ§Ø¶Ø­ ÙÙŠ Ø´Ø§Ù…Ø© ÙˆÙÙ‚ ABCDE"},
  {id:"bowel",  text:"ØªØºÙŠÙ‘Ø± Ø¹Ø§Ø¯Ø§Øª Ø§Ù„Ø¥Ø®Ø±Ø§Ø¬ > 3 Ø£Ø³Ø§Ø¨ÙŠØ¹"},
  {id:"pain",   text:"Ø£Ù„Ù… Ø¬Ø¯ÙŠØ¯ Ù…Ø³ØªÙ…Ø± (ØµØ¯Ø±/Ø¹Ø¸Ù…/Ø¨Ø·Ù†/Ø¸Ù‡Ø±)"},
  {id:"gi",     text:"ØµØ¹ÙˆØ¨Ø© Ø¨Ù„Ø¹/Ø­Ø±Ù‚Ø© Ø´Ø¯ÙŠØ¯Ø©/Ø§Ù…ØªÙ„Ø§Ø¡ Ù…Ø¨ÙƒÙ‘Ø±"},
  {id:"bsy",    text:"Ø­Ù…Ù‘Ù‰/ØªØ¹Ø±Ù‘Ù‚ Ù„ÙŠÙ„ÙŠ ØºØ²ÙŠØ±/Ø¥Ø±Ù‡Ø§Ù‚ Ø´Ø¯ÙŠØ¯"},
  {id:"nodes",  text:"ØªÙˆØ±Ù… Ø¹Ù‚Ø¯ Ù„Ù…ÙÙŠØ© ØºÙŠØ± Ù…Ø¤Ù„Ù…Ø© Ù„Ø§ ØªØ²ÙˆÙ„"},
  {id:"breast", text:"ØªØºÙŠÙ‘Ø±Ø§Øª ÙÙŠ Ø§Ù„Ø«Ø¯ÙŠ (Ø¥ÙØ±Ø§Ø²/Ø§Ù†ÙƒÙ…Ø§Ø´/ØªØºØ¶Ù‘Ù†)"},
  {id:"prostate",text:"ØªØºÙŠÙ‘Ø± Ù…Ù„Ø­ÙˆØ¸ ÙÙŠ Ø§Ù„ØªØ¨ÙˆÙ‘Ù„ (Ù„Ù„Ø±Ø¬Ø§Ù„ 50+)"},
  {id:"ulcer",  text:"Ù‚Ø±Ø­Ø© ÙÙ…/Ø¬Ù„Ø¯ Ù„Ø§ ØªÙ„ØªØ¦Ù…"}
];
const symWrap=document.getElementById('symptoms');
function renderSymptoms(){
  symWrap.innerHTML='';
  QUESTIONS.forEach(q=>{
    const div=document.createElement('div'); div.className='field';
    div.innerHTML=`<div style="font-weight:700">${q.text}</div>
    <div class="seg" data-q="${q.id}">
      <button type="button" class="on" data-a="no">Ù„Ø§</button>
      <button type="button" data-a="yes">Ù†Ø¹Ù…</button>
    </div>`;
    symWrap.appendChild(div);
  });
}
renderSymptoms();
symWrap.addEventListener('click', e=>{
  const btn=e.target.closest('button'); if(!btn) return;
  const seg=btn.parentElement;
  seg.querySelectorAll('button').forEach(b=>b.classList.remove('on'));
  btn.classList.add('on');
});

/* ===== Ù‚Ø§Ø¦Ù…Ø© Ø¯ÙˆÙ„Ø© Ù…Ø­Ø³Ù‘Ù†Ø© Ù…Ø¹ Ø¨Ø­Ø« ===== */
const COUNTRIES=[
  ["BHR","Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†"],["KSA","Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©"],["ARE","Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª"],["QAT","Ù‚Ø·Ø±"],["KWT","Ø§Ù„ÙƒÙˆÙŠØª"],["OMN","Ø¹ÙÙ…Ø§Ù†"],
  ["EGY","Ù…ØµØ±"],["JOR","Ø§Ù„Ø£Ø±Ø¯Ù†"],["LBN","Ù„Ø¨Ù†Ø§Ù†"],["IRQ","Ø§Ù„Ø¹Ø±Ø§Ù‚"],["LBA","Ù„ÙŠØ¨ÙŠØ§"],["MAR","Ø§Ù„Ù…ØºØ±Ø¨"],
  ["DZA","Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±"],["TUN","ØªÙˆÙ†Ø³"],["SDN","Ø§Ù„Ø³ÙˆØ¯Ø§Ù†"],["SYR","Ø³ÙˆØ±ÙŠØ§"],["PSE","ÙÙ„Ø³Ø·ÙŠÙ†"],["DJI","Ø¬ÙŠØ¨ÙˆØªÙŠ"],
  ["COM","Ø¬Ø²Ø± Ø§Ù„Ù‚Ù…Ø±"],["MRT","Ù…ÙˆØ±ÙŠØªØ§Ù†ÙŠØ§"],["SOM","Ø§Ù„ØµÙˆÙ…Ø§Ù„"],["YEM","Ø§Ù„ÙŠÙ…Ù†"],["IRN","Ø¥ÙŠØ±Ø§Ù†"]
];
let selectedCountry="BHR";
const countryBox=document.getElementById('countryBox');
const countrySearch=document.getElementById('countrySearch');
const countryPanel=document.getElementById('countryPanel');
function openPanel(panel){ panel.style.display='block'; }
function closePanel(panel){ panel.style.display='none'; }
function fillCountryPanel(filter=""){
  countryPanel.innerHTML='';
  COUNTRIES.filter(c=> c[1].includes(filter) || c[0].includes(filter.toUpperCase()))
    .forEach(([code,name])=>{
      const o=document.createElement('div'); o.className='opt'; o.textContent=name; o.dataset.code=code;
      o.onclick=()=>{ selectedCountry=code; countrySearch.value=name; closePanel(countryPanel); };
      countryPanel.appendChild(o);
    });
}
countrySearch.addEventListener('focus', ()=>{ fillCountryPanel(countrySearch.value.trim()); openPanel(countryPanel); });
countrySearch.addEventListener('input', ()=>fillCountryPanel(countrySearch.value.trim()));
document.addEventListener('click', (e)=>{ if(!countryBox.contains(e.target)) closePanel(countryPanel); });
fillCountryPanel(); countrySearch.value=COUNTRIES.find(c=>c[0]===selectedCountry)[1];

/* ===== Ø¯Ù„ÙŠÙ„ Ø¹Ø§Ù„Ù…ÙŠ (Ù…Ù†Ø³Ø¯Ù„) ===== */
const GLOBAL_REFS=[
  {n:"WHO â€” World Health Organization (Cancer)", url:"https://www.who.int/health-topics/cancer"},
  {n:"IARC â€” International Agency for Research on Cancer", url:"https://www.iarc.who.int/"},
  {n:"NCI â€” National Cancer Institute (US)", url:"https://www.cancer.gov/"},
  {n:"ACS â€” American Cancer Society", url:"https://www.cancer.org/"},
  {n:"NHS â€” Cancer information (UK)", url:"https://www.nhs.uk/conditions/cancer/"},
  {n:"UICC â€” Union for International Cancer Control", url:"https://uicc.org/"},
  {n:"ESMO â€” European Society for Medical Oncology (Patient Guides)", url:"https://www.esmo.org/for-patients"}
];
buildDropdown('refBox','refSearch','refPanel',GLOBAL_REFS);

/* ===== Ù…Ø³ØªØ´ÙÙŠØ§Øª Ø¹Ø§Ù„Ù…ÙŠØ© Ù…ÙˆØµÙ‰ Ø¨Ù‡Ø§ (ØºÙŠØ± Ø­ÙƒÙˆÙ…ÙŠØ©) ===== */
const INTL_HOSPITALS=[
  {n:"MD Anderson Cancer Center â€” Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª Ø§Ù„Ù…ØªØ­Ø¯Ø©", url:"https://www.mdanderson.org/"},
  {n:"Mayo Clinic (Oncology) â€” Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª Ø§Ù„Ù…ØªØ­Ø¯Ø©", url:"https://www.mayoclinic.org/"},
  {n:"Memorial Sloan Kettering â€” Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª Ø§Ù„Ù…ØªØ­Ø¯Ø©", url:"https://www.mskcc.org/"},
  {n:"The Royal Marsden â€” Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ù…ØªØ­Ø¯Ø©", url:"https://www.royalmarsden.nhs.uk/"},
  {n:"CharitÃ© â€“ UniversitÃ¤tsmedizin Berlin â€” Ø£Ù„Ù…Ø§Ù†ÙŠØ§", url:"https://www.charite.de/en/"},
  {n:"University Hospital Heidelberg (NCT) â€” Ø£Ù„Ù…Ø§Ù†ÙŠØ§", url:"https://www.nct-heidelberg.de/en.html"},
  {n:"Gustave Roussy â€” ÙØ±Ù†Ø³Ø§", url:"https://www.gustaveroussy.fr/"},
  {n:"Istituto Europeo di Oncologia (IEO) â€” Ø¥ÙŠØ·Ø§Ù„ÙŠØ§", url:"https://www.ieo.it/"},
  {n:"National Cancer Center Hospital â€” Ø§Ù„ÙŠØ§Ø¨Ø§Ù† (Ø·ÙˆÙƒÙŠÙˆ)", url:"https://www.ncc.go.jp/en/ncch/"},
  {n:"Samsung Medical Center â€” ÙƒÙˆØ±ÙŠØ§ Ø§Ù„Ø¬Ù†ÙˆØ¨ÙŠØ©", url:"https://www.samsunghospital.com/"},
  {n:"National Cancer Centre Singapore â€” Ø³Ù†ØºØ§ÙÙˆØ±Ø©", url:"https://www.nccs.com.sg/"},
  {n:"Bumrungrad International Hospital â€” ØªØ§ÙŠÙ„Ù†Ø¯", url:"https://www.bumrungrad.com/"},
  {n:"Samitivej Hospital (Cancer Center) â€” ØªØ§ÙŠÙ„Ù†Ø¯", url:"https://www.samitivejhospitals.com/"},
  {n:"Anadolu Medical Center â€” ØªØ±ÙƒÙŠØ§ (Ø´Ø±Ø§ÙƒØ© Ø¬ÙˆÙ† Ù‡ÙˆØ¨ÙƒÙ†Ø²)", url:"https://www.anadolumedicalcenter.com/en"},
  {n:"Cleveland Clinic Abu Dhabi (Oncology) â€” Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª", url:"https://www.clevelandclinicabudhabi.ae/"},
  {n:"Apollo Hospitals (Cancer Institutes) â€” Ø§Ù„Ù‡Ù†Ø¯", url:"https://www.apollohospitals.com/clinical-excellence/apollo-cancer-institutes/"}
];
buildDropdown('intlBox','intlSearch','intlPanel',INTL_HOSPITALS);

/* ===== Ø§Ù„Ù…ØµØ§Ø¯Ø± Ø§Ù„Ø·Ø¨ÙŠØ© (Ù‚ÙˆØ§Ø¦Ù… Ù…Ù†Ø³Ø¯Ù„Ù€Ø© Ù„Ù…Ù‚Ø§Ù„Ø§Øª Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶/Ø§Ù„ØªØ­Ø±Ù‘ÙŠ) ===== */
const MED_SOURCES=[
  {n:"WHO â€” Cancer: Key facts", url:"https://www.who.int/news-room/fact-sheets/detail/cancer"},
  {n:"ACS â€” Signs & Symptoms of Cancer", url:"https://www.cancer.org/cancer/diagnosis-staging/signs-and-symptoms.html"},
  {n:"NCI â€” Symptoms and Warning Signs", url:"https://www.cancer.gov/about-cancer/diagnosis-staging/symptoms"},
  {n:"NHS â€” Cancer symptoms Aâ€“Z", url:"https://www.nhs.uk/conditions/cancer/symptoms/"},
  {n:"ESMO â€” Patient Guides", url:"https://www.esmo.org/for-patients/patient-guides"},
  {n:"NCCN â€” Patient Guidelines (free account)", url:"https://www.nccn.org/patients/guidelines/cancers.aspx"}
];
buildDropdown('srcBox','srcSearch','srcPanel',MED_SOURCES);

function buildDropdown(boxId, inputId, panelId, items){
  const box=document.getElementById(boxId);
  const input=document.getElementById(inputId);
  const panel=document.getElementById(panelId);
  function fill(filter=""){
    panel.innerHTML='';
    items.filter(x=> x.n.toLowerCase().includes(filter.toLowerCase()))
      .forEach(x=>{
        const o=document.createElement('div'); o.className='opt'; o.textContent=x.n;
        o.onclick=()=>{ window.open(x.url,'_blank','noopener'); closePanel(panel); };
        panel.appendChild(o);
      });
  }
  input.addEventListener('focus', ()=>{ fill(input.value.trim()); openPanel(panel); });
  input.addEventListener('input', ()=>fill(input.value.trim()));
  document.addEventListener('click', (e)=>{ if(!box.contains(e.target)) closePanel(panel); });
  fill();
}

/* ===== Ø§Ù„ØªÙ‚ÙŠÙŠÙ… ===== */
function screening(age, sex, smoker, fh){
  const list=[];
  if(sex==='female' && age>=40){ list.push("ØªØµÙˆÙŠØ± Ø§Ù„Ø«Ø¯ÙŠ (Ù…Ø§Ù…ÙˆØºØ±Ø§Ù…) ÙƒÙ„ 1â€“2 Ø³Ù†Ø©."); }
  if(sex==='female' && age>=21){ list.push("Ø¹Ù†Ù‚ Ø§Ù„Ø±Ø­Ù…: Pap/HPV Ø­Ø³Ø¨ Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø© (ÙƒÙ„ 3â€“5 Ø³Ù†ÙˆØ§Øª)."); }
  if(age>=45){ list.push("Ø§Ù„Ù‚ÙˆÙ„ÙˆÙ† ÙˆØ§Ù„Ù…Ø³ØªÙ‚ÙŠÙ…: FIT Ø³Ù†ÙˆÙŠÙ‹Ø§ Ø£Ùˆ ØªÙ†Ø¸ÙŠØ± ÙƒÙ„ 10 Ø³Ù†ÙˆØ§Øª."); }
  if(age>=50 && smoker==='yes'){ list.push("Ø§Ù„Ø±Ø¦Ø©: ØªØµÙˆÙŠØ± Ø·Ø¨Ù‚ÙŠ Ù…Ù†Ø®ÙØ¶ Ø§Ù„Ø¬Ø±Ø¹Ø© (LDCT) Ø³Ù†ÙˆÙŠÙ‹Ø§ Ù„Ù„Ù…Ø¯Ø®Ù†ÙŠÙ† Ø§Ù„Ù…Ø¤Ù‡Ù„ÙŠÙ†."); }
  if(sex==='male' && age>=50){ list.push("Ø§Ù„Ø¨Ø±ÙˆØ³ØªØ§ØªØ§: Ù†Ø§Ù‚Ø´ PSA/ÙØ­Øµ Ø§Ù„Ù…Ø³ØªÙ‚ÙŠÙ…."); }
  if(fh==='yes'){ list.push("Ù„ØªØ§Ø±ÙŠØ® Ø¹Ø§Ø¦Ù„ÙŠ Ù‚ÙˆÙŠ: Ø§Ø³ØªØ´Ø± Ø§Ø®ØªØµØ§ØµÙŠ ÙˆØ±Ø§Ø«Ø©/Ø£ÙˆØ±Ø§Ù…."); }
  return list;
}
function computeRisk(){
  let score=0, flags=0;
  const heavy=['bleed','lump','skin','ulcer'];
  QUESTIONS.forEach(q=>{
    const seg=document.querySelector(`.seg[data-q="${q.id}"]`);
    const a=seg.querySelector('button.on')?.dataset.a||'no';
    if(a==='yes'){ score+=1; if(heavy.includes(q.id)) score+=1; flags+=(heavy.includes(q.id)?1:0); }
  });
  if((document.getElementById('smokeSeg').dataset.smoke||'no')==='yes') score+=1;
  if((document.getElementById('familySeg').dataset.fh||'no')==='yes') score+=1;
  if(score>10) score=10;
  let level='Ù…Ù†Ø®ÙØ¶', action='Ø±Ø§Ù‚Ø¨ Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶ ÙˆØ§ØªÙ‘Ø¨Ø¹ Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ­Ø±ÙŠ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨.';
  if(score>=3){ level='Ù…ØªÙˆØ³Ø·'; action='Ø§Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯Ù‹Ø§ Ø£ÙˆÙ„ÙŠÙ‹Ø§ Ù„Ø¯Ù‰ Ø·Ø¨ÙŠØ¨ Ø§Ù„Ø£Ø³Ø±Ø© Ø®Ù„Ø§Ù„ Ø£Ø³Ø¨ÙˆØ¹â€“Ø£Ø³Ø¨ÙˆØ¹ÙŠÙ†.'; }
  if(score>=6 || (document.querySelector('.seg[data-q="bleed"] .on')?.dataset.a==='yes' && document.querySelector('.seg[data-q="pain"] .on')?.dataset.a==='yes')){
    level='Ù…Ø±ØªÙØ¹'; action='Ø±Ø§Ø¬ÙØ¹ Ø¹Ø§Ø¬Ù„Ù‹Ø§ Ø®Ù„Ø§Ù„ 24â€“72 Ø³Ø§Ø¹Ø© Ø£Ùˆ Ø£Ù‚Ø±Ø¨ Ù…Ø³ØªØ´ÙÙ‰ Ø¥Ø°Ø§ Ø³Ø§Ø¡Øª Ø§Ù„Ø­Ø§Ù„Ø©.';
  }
  if(document.querySelector('.seg[data-q="cough"] .on')?.dataset.a==='yes' && document.querySelector('.seg[data-q="bsy"] .on')?.dataset.a==='yes')){
    level='Ù…Ø±ØªÙØ¹'; action='ØªÙ‚ÙŠÙŠÙ… Ø¹Ø§Ø¬Ù„ (Ù‚Ø¯ ÙŠÙ„Ø²Ù… ØªØµÙˆÙŠØ± ØµØ¯Ø±/ØªØ­Ø§Ù„ÙŠÙ„).';
  }
  return {score, flags, level, action};
}

/* ===== Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø© + Ù†ØµØ§Ø¦Ø­ ===== */
function buildAdvice(age, sex, smoke, fh){
  const deck=document.getElementById('adviceDeck'); deck.innerHTML='';
  const mk=(t,html)=>{ const e=document.createElement('div'); e.className='card'; e.innerHTML=`<h3>${t}</h3>${html}`; return e; };
  const list=screening(age, sex, smoke, fh);
  deck.append(
    mk('Ù†ØµØ§Ø¦Ø­ Ø³Ø±ÙŠØ¹Ø©','<ul><li>Ø£ÙŠ Ø¹Ø±Ø¶ Ø¬Ø¯ÙŠØ¯ Ù…Ø³ØªÙ…Ø± &gt; 3 Ø£Ø³Ø§Ø¨ÙŠØ¹ = ØªÙ‚ÙŠÙŠÙ… Ø·Ø¨ÙŠ.</li><li>ØªÙˆÙ‚Ù‘Ù Ø¹Ù† Ø§Ù„ØªØ¨ØºØŒ ØªØ­Ø±Ù‘Ùƒ 150â€“300 Ø¯Ù‚ÙŠÙ‚Ø© Ø£Ø³Ø¨ÙˆØ¹ÙŠÙ‹Ø§ØŒ ÙˆØ²Ù† ØµØ­ÙŠØŒ ÙˆØ§Ù‚Ù Ø´Ù…Ø³ÙŠ.</li><li>Ù„Ù‚Ø§Ø­Ø§Øª: Ø§Ù„ØªÙ‡Ø§Ø¨ ÙƒØ¨Ø¯ BØŒ HPV Ø­ÙŠØ« Ù…ØªØ§Ø­.</li></ul>'),
    mk('ÙØ­ÙˆØµ Ø§Ù„ØªØ­Ø±ÙŠ Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©', list.length? '<ul>'+list.map(x=>`<li>${x}</li>`).join('')+'</ul>' : '<div>Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØ­ÙˆØµ Ø±ÙˆØªÙŠÙ†ÙŠØ© Ø®Ø§ØµÙ‘Ø© Ø¨Ø¹Ù…Ø±Ùƒ Ø§Ù„Ø¢Ù† â€” Ø§ØªØ¨Ø¹ Ù†ØµÙŠØ­Ø© Ø·Ø¨ÙŠØ¨Ùƒ.</div>')
  );
  deck.style.display='grid';
}

/* Ø§Ø­Ø³Ø¨ */
let lastResult=null;
document.getElementById('calc').addEventListener('click', ()=>{
  const age=parseFloat(document.getElementById('age').value);
  if(!(age>=0 && age<=120)){ notify("Ø£Ø¯Ø®Ù„ Ø¹Ù…Ø±Ù‹Ø§ ØµØ­ÙŠØ­Ù‹Ø§.", {type:'error'}); return; }
  const sex = document.getElementById('sexSeg').dataset.sex || 'male';
  const smoke = document.getElementById('smokeSeg').dataset.smoke || 'no';
  const fh = document.getElementById('familySeg').dataset.fh || 'no';

  const {score, flags, level, action}=computeRisk();

  const v=document.getElementById('verdict');
  v.style.display='inline-block';
  v.className='badge '+(level==='Ù…Ø±ØªÙØ¹'?'danger': (level==='Ù…ØªÙˆØ³Ø·'?'warn':'ok'));
  v.textContent = (level==='Ù…Ø±ØªÙØ¹'?'âš ï¸ ':'â„¹ï¸ ')+ 'Ù‡Ø°Ù‡ Ù†ØªÙŠØ¬Ø© ØªØ«Ù‚ÙŠÙÙŠØ© â€” Ø§ØªØ¨Ø¹ Ø§Ù„ØªÙˆØµÙŠØ§Øª ÙˆØ±Ø§Ø¬ÙØ¹ Ø§Ù„Ù…Ø®ØªØµ Ø¹Ù†Ø¯ Ø§Ù„Ù‚Ù„Ù‚.';

  document.getElementById('kpis').style.display='grid';
  document.getElementById('riskLevel').textContent=level;
  document.getElementById('whatNext').textContent=action;

  buildAdvice(age, sex, smoke, fh);

  lastResult = {
    country: document.getElementById('countrySearch').value || 'â€”',
    age, sex:(sex==='male'?'Ø±Ø¬Ù„':'Ø§Ù…Ø±Ø£Ø©'),
    smoke:(smoke==='yes'?'Ù…Ø¯Ø®Ù‘Ù†':'ØºÙŠØ± Ù…Ø¯Ø®Ù‘Ù†'),
    fh:(fh==='yes'?'ØªØ§Ø±ÙŠØ® Ø¹Ø§Ø¦Ù„ÙŠ Ù‚ÙˆÙŠ':'Ù„Ø§'),
    score, flags, level, action,
    answers: QUESTIONS.map(q=>{
      const a=document.querySelector(`.seg[data-q="${q.id}"] .on`)?.dataset.a||'no';
      return {q:q.text, a:(a==='yes'?'Ù†Ø¹Ù…':'Ù„Ø§')};
    })
  };

  document.getElementById('pdfwrap').style.display='block';
});

/* PDF */
document.getElementById('pdfBtn').addEventListener('click', async ()=>{
  if(!lastResult){ notify('Ø£Ø¬Ø¨ Ø¹Ù† Ø§Ù„Ø§Ø³ØªØ¨ÙŠØ§Ù† Ø£ÙˆÙ„Ù‹Ø§.', {type:'error'}); return; }
  const box=document.createElement('div');
  box.setAttribute('dir','rtl');
  box.style.width='780px'; box.style.background='#fff'; box.style.border='1px solid #e5e7eb'; box.style.borderRadius='16px'; box.style.padding='20px'; box.style.fontFamily='"Cairo",sans-serif'; box.style.color='#111827';
  const rows = lastResult.answers.map(x=>`<tr><td style="padding:8px 10px;border-bottom:1px solid #f3f4f6">${x.q}</td><td style="padding:8px 10px;border-bottom:1px solid #f3f4f6">${x.a}</td></tr>`).join('');
  box.innerHTML=`
    <div style="text-align:center; margin-bottom:10px">
      <div style="font-family:'Amiri',serif; font-size:26px; color:${getComputedStyle(document.documentElement).getPropertyValue('--gold')}">ØªÙ‚Ø±ÙŠØ± Ø§Ø³ØªØ¨ÙŠØ§Ù† Ø£Ø¹Ø±Ø§Ø¶ Ø§Ù„Ø³Ø±Ø·Ø§Ù†</div>
      <div style="font-size:12px; color:#6b7280">${new Date().toLocaleString('ar')}</div>
    </div>

    <table style="width:100%; border-collapse:separate; border-spacing:0; overflow:hidden; border-radius:12px; border:1px solid #eee; margin-bottom:10px">
      <thead><tr style="background:linear-gradient(90deg,#fff7e6,#fff)"><th style="padding:10px 12px; text-align:right">Ø§Ù„Ø¨Ù†Ø¯</th><th style="padding:10px 12px; text-align:right">Ø§Ù„Ù‚ÙŠÙ…Ø©</th></tr></thead>
      <tbody>
        ${row('Ø§Ù„Ø¯ÙˆÙ„Ø©', lastResult.country)}
        ${row('Ø§Ù„Ø¹Ù…Ø±', lastResult.age)}
        ${row('Ø§Ù„Ù†ÙˆØ¹', lastResult.sex)}
        ${row('Ø§Ù„ØªØ¯Ø®ÙŠÙ†', lastResult.smoke)}
        ${row('ØªØ§Ø±ÙŠØ® Ø¹Ø§Ø¦Ù„ÙŠ', lastResult.fh)}
        ${row('Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¹Ù„Ø§Ù… Ø§Ù„Ø­Ù…Ø±Ø§Ø¡', lastResult.flags)}
        ${row('Ø¯Ø±Ø¬Ø© ØªÙ‚Ø¯ÙŠØ±ÙŠØ© (0â€“10)', lastResult.score)}
        ${row('Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡', lastResult.level)}
        ${row('Ø§Ù„ØªÙˆØµÙŠØ© Ø§Ù„Ø¢Ù†', lastResult.action)}
      </tbody>
    </table>

    <div style="font-weight:700; margin-bottom:6px">Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶</div>
    <table style="width:100%; border:1px solid #eee; border-radius:12px; border-collapse:separate; border-spacing:0">
      <thead><tr style="background:#f9fafb"><th style="padding:8px 10px; text-align:right">Ø§Ù„Ø¹ÙØ±ÙØ¶</th><th style="padding:8px 10px; text-align:right">Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©</th></tr></thead>
      <tbody>${rows}</tbody>
    </table>

    <div style="margin-top:10px; font-size:12px; color:#6b7280">Ù‡Ø°Ù‡ Ù†ØªÙŠØ¬Ø© ØªØ«Ù‚ÙŠÙÙŠØ© Ù…Ø¨Ù†ÙŠØ© Ø¹Ù„Ù‰ Ø¯Ù„Ø§Ø¦Ù„ Ø¹Ø§Ù…Ø© (WHO/ACS). Ù„Ø§ ØªØºÙ†ÙŠ Ø¹Ù† Ø§Ù„Ø·Ø¨ÙŠØ¨.</div>
  `;
  function row(k,v){ return `<tr><td style="padding:8px 10px;border-bottom:1px solid #f3f4f6"><strong>${k}</strong></td><td style="padding:8px 10px;border-bottom:1px solid #f3f4f6">${v}</td></tr>`; }

  document.body.appendChild(box);
  await new Promise(r=>setTimeout(r, 100));
  const canvas = await html2canvas(box, {scale:2, useCORS:true});
  document.body.removeChild(box);

  const imgData = canvas.toDataURL('image/png');
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF({orientation:'p', unit:'pt', format:'a4'});
  const pageW = pdf.internal.pageSize.getWidth();
  const pageH = pdf.internal.pageSize.getHeight();
  const margin = 28;
  const imgW = pageW - margin*2;
  const imgH = canvas.height * (imgW / canvas.width);

  if(imgH <= pageH - margin*2){
    pdf.addImage(imgData, 'PNG', margin, margin, imgW, imgH);
  }else{
    let sH = pageH - margin*2;
    let ratio = canvas.width / imgW;
    let slice = sH * ratio;
    let pos = 0;
    while(pos < canvas.height){
      const sliceCanvas = document.createElement('canvas');
      sliceCanvas.width = canvas.width;
      sliceCanvas.height = Math.min(slice, canvas.height - pos);
      const ctx = sliceCanvas.getContext('2d');
      ctx.drawImage(canvas, 0, pos, canvas.width, sliceCanvas.height, 0, 0, sliceCanvas.width, sliceCanvas.height);
      const sliceData = sliceCanvas.toDataURL('image/png');
      if(pos>0) pdf.addPage();
      pdf.addImage(sliceData, 'PNG', margin, margin, imgW, (sliceCanvas.height / ratio));
      pos += slice;
    }
  }

  pdf.save('Ù†ØªÙŠØ¬Ø©-Ø§Ø³ØªØ¨ÙŠØ§Ù†-Ø§Ù„Ø³Ø±Ø·Ø§Ù†.pdf');
});

/* Ù…Ø´Ø§Ø±ÙƒØ© */
document.getElementById('shareWA').onclick=(e)=>{e.preventDefault(); window.open(`https://wa.me/?text=${encodeURIComponent(location.href)}`,'_blank','noopener');};
document.getElementById('shareTG').onclick=(e)=>{e.preventDefault(); window.open(`https://t.me/share/url?url=${encodeURIComponent(location.href)}`,'_blank','noopener');};
document.getElementById('shareX').onclick=(e)=>{e.preventDefault(); window.open(`https://twitter.com/intent/tweet?url=${encodeURIComponent(location.href)}`,'_blank','noopener');};
document.getElementById('shareFB').onclick=(e)=>{e.preventDefault(); window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(location.href)}`,'_blank','noopener');};
document.getElementById('copyLink').onclick=async()=>{ try{ await navigator.clipboard.writeText(location.href); notify('ğŸ”— ØªÙ…Ù‘ Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙØ­Ø©.'); }catch(_){ notify('Ù„Ù… Ù†ØªÙ…ÙƒÙ† Ù…Ù† Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·.',{type:'error'});} };

/* Ø¨Ø±Ù…Ø¬Ø© ÙˆØªØ·ÙˆÙŠØ± */
document.getElementById('devLink').addEventListener('click', function(){ setTimeout(()=>{ if(!document.hasFocus()) return; location.href=this.href; }, 120); });
</script>
</body>
</html>
