<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>دليل الصلاة الشامل | تعلم الصلاة ومواقيتها وفق المذهب الجعفري</title>
  <meta name="description" content="دليلك الشامل لتعلم الصلاة وأحكامها (الطهارة، الوضوء، التيمم) مع مواقيت الصلاة الدقيقة لمنطقتك وفق فتاوى سماحة السيد السيستاني (دام ظله).">
  <meta name="robots" content="index, follow">
  <meta name="theme-color" content="#003366">
  <!-- إبقاء inline مسموح به لتعمل السكربتات ضمن الصفحة -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com; img-src 'self' https: data:; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com; connect-src 'self' https://api.aladhan.com; frame-ancestors 'none'; form-action 'none'; base-uri 'self'">
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta http-equiv="X-Frame-Options" content="DENY">
  <meta name="referrer" content="strict-origin-when-cross-origin">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

  <style>
    :root{--primary:#003366;--secondary:#5A7D7C;--bg:#fff;--light:#F7F7FB;--text:#333;--muted:#6b7280;--border:#e5e7eb}
    *{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{margin:0;font-family:'Tajawal',system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:var(--bg);color:var(--text);line-height:1.9;font-size:clamp(16px,1.2vw,18px)}
    .container{max-width:1100px;margin:auto;padding:0 20px}
    h1,h2,h3{color:var(--primary);margin:0 0 16px}
    h2{font-size:clamp(1.8rem,4.5vw,2.4rem);text-align:center;margin-bottom:32px}
    section{padding:clamp(48px,6vw,80px) 0}

    /* شريط علوي: برمجة وتطوير + مشاركة */
    .topbar{background:#0f2f57;color:#fff}
    .topbar .row{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:10px 0;flex-wrap:wrap}
    .topbar .badge{background:#174a88;padding:6px 10px;border-radius:8px;font-weight:700}
    .share{display:flex;gap:10px;align-items:center}
    .share a{color:#fff;text-decoration:none;font-size:1.1rem;display:inline-flex;align-items:center;justify-content:center;width:36px;height:36px;border-radius:50%;background:#174a88}
    .share a:hover{background:#1f5fb4}

    header{position:sticky;top:0;z-index:40;background:#ffffffcc;backdrop-filter:blur(8px);box-shadow:0 2px 10px rgba(0,0,0,.06)}
    header .bar{display:flex;gap:14px;align-items:center;justify-content:space-between;padding:12px 0}
    .logo{font-weight:800;color:var(--primary);text-decoration:none;white-space:nowrap}
    nav{display:flex;gap:14px;overflow:auto}
    nav a{color:var(--primary);text-decoration:none;font-weight:600;white-space:nowrap}
    nav a:hover{color:var(--secondary)}

    .hero{padding:48px 0;background:
      linear-gradient(to top,rgba(255,255,255,.92),rgba(255,255,255,.7)),
      url('https://images.unsplash.com/photo-1584335319462-a3c6a3885165?q=80&w=2070&auto=format&fit=crop') center/cover no-repeat}
    .hero .grid{display:grid;grid-template-columns:1fr;gap:20px;justify-items:center}
    @media(min-width:900px){.hero .grid{grid-template-columns:1.2fr .8fr}}

    .hero-title{background:#ffffffb3;border:1px solid #e5e7eb;border-radius:12px;padding:18px 22px;font-weight:800;font-size:clamp(1.6rem,4.5vw,2.2rem);box-shadow:0 6px 18px rgba(0,0,0,.06)}
    
    /* شريط التاريخ والعدّاد — عمودي */
    .dates-card{width:100%;max-width:900px;background:#fff;border:1px solid var(--border);border-radius:12px;padding:12px 16px;display:grid;gap:6px;box-shadow:0 6px 16px rgba(0,0,0,.06)}
    .dates-line{display:flex;gap:8px;align-items:center}
    .dates-line i{color:var(--secondary)}
    .countdown{color:var(--primary);font-weight:800}

    /* ودجت المواقيت */
    .widget{background:#fff;border:1px solid var(--border);border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.08);padding:18px;max-width:440px;width:100%}
    .widget h3{text-align:center;margin:0 0 8px}
    .pt-list{list-style:none;margin:0;padding:0}
    .pt-row{display:flex;justify-content:space-between;align-items:center;padding:12px 6px;border-bottom:1px dashed var(--border)}
    .pt-row:last-child{border-bottom:0}
    .pt-name{font-weight:700}
    .pt-time{font-weight:800;color:var(--primary);direction:ltr}
    .note{font-size:.92rem;color:var(--muted);text-align:center;margin-top:6px}

    /* أيقونات العناوين */
    .icon-title{display:flex;gap:10px;align-items:center;justify-content:center}
    .icon-title i{color:var(--secondary)}

    /* صندوق المصادر */
    .sources{direction:rtl;background:#fff;border:1px solid var(--border);border-radius:12px;padding:14px 16px;margin-top:18px;box-shadow:0 6px 16px rgba(0,0,0,.05)}
    .sources h4{margin:0 0 8px;color:#2f3e4f}
    .sources ul{margin:0;padding:0 18px;list-style:disc}
    .sources li{margin:4px 0}

    /* أقسام المحتوى — ضمان عدم الاقتطاع */
    .content .container{max-width:950px}
    .content p,.content ul,.content ol{margin:0 0 14px}
    .content ul{list-style:disc;padding-inline-start:22px}
    .content ol{list-style:decimal;padding-inline-start:22px}

    footer{background:var(--primary);color:#fff;text-align:center;padding:28px 16px}
    .top{position:fixed;bottom:22px;left:22px;width:44px;height:44px;border-radius:50%;background:var(--primary);color:#fff;display:grid;place-items:center;text-decoration:none;opacity:.85;transform:translateY(20px);transition:.2s;z-index:40}
    .top.hide{opacity:0;pointer-events:none;transform:translateY(20px)}
  </style>
</head>
<body>

  <!-- شريط برمجة وتطوير + مشاركة الصفحة -->
  <div class="topbar">
    <div class="container row">
      <span class="badge"><i class="fa-solid fa-code"></i> برمجة وتطوير</span>
      <div class="share" aria-label="مشاركة الصفحة">
        <a title="نسخ الرابط" href="#" onclick="navigator.clipboard.writeText(location.href)"><i class="fa-regular fa-copy"></i></a>
        <a title="واتساب" href="https://wa.me/?text=%D8%AF%D9%84%D9%8A%D9%84%20%D8%A7%D9%84%D8%B5%D9%84%D8%A7%D8%A9%20-%20{{URL}}" target="_blank" rel="noopener"><i class="fa-brands fa-whatsapp"></i></a>
        <a title="تلغرام" href="https://t.me/share/url?url={{URL}}&text=%D8%AF%D9%84%D9%8A%D9%84%20%D8%A7%D9%84%D8%B5%D9%84%D8%A7%D8%A9" target="_blank" rel="noopener"><i class="fa-brands fa-telegram"></i></a>
        <a title="X" href="https://twitter.com/intent/tweet?url={{URL}}&text=%D8%AF%D9%84%D9%8A%D9%84%20%D8%A7%D9%84%D8%B5%D9%84%D8%A7%D8%A9" target="_blank" rel="noopener"><i class="fa-brands fa-x-twitter"></i></a>
        <a title="فيسبوك" href="https://www.facebook.com/sharer/sharer.php?u={{URL}}" target="_blank" rel="noopener"><i class="fa-brands fa-facebook-f"></i></a>
      </div>
    </div>
  </div>

  <header>
    <div class="container bar">
      <a href="#" class="logo">دليل الصلاة <span style="color:#5A7D7C">الجعفرية</span></a>
      <nav aria-label="روابط أساسية">
        <a href="#preliminaries">مقدمات الصلاة</a>
        <a href="#how">كيفية الصلاة</a>
        <a href="#times">أوقات الصلاة</a>
        <a href="#rulings">أحكام الصلاة</a>
        <a href="#missed">قضاء الفوائت</a>
      </nav>
    </div>
  </header>

  <main>
    <section class="hero">
      <div class="container">
        <div class="hero-title">دليلك الشامل لتعلم الصلاة</div>

        <!-- التاريخ/اليوم/الهجري/المتبقي — كل سطر لوحده -->
        <div class="dates-card" id="datesCard" aria-live="polite">
          <div class="dates-line"><i class="fa-solid fa-calendar-day"></i><span id="dayName">—</span></div>
          <div class="dates-line"><i class="fa-regular fa-calendar"></i><span id="gregDate">—</span></div>
          <div class="dates-line"><i class="fa-regular fa-moon"></i><span id="hijriDate">—</span></div>
          <div class="dates-line"><i class="fa-solid fa-location-dot"></i><span id="cityName">Asia/Bahrain</span></div>
          <div class="dates-line countdown"><i class="fa-regular fa-bell"></i><span id="countdownLabel">المتبقي على الأذان:</span> <span id="countdown">—:—:—</span></div>
        </div>

        <!-- ودجت المواقيت -->
        <div class="widget" id="ptWidget">
          <h3>مواقيت اليوم</h3>
          <p id="nextAdhan" class="note"></p>
          <ul class="pt-list" id="ptList"></ul>
          <div class="note" id="ptNote">جاري تحديد الموقع لجلب المواقيت…</div>
        </div>
      </div>
    </section>

    <section id="preliminaries" class="content">
      <div class="container">
        <h2 class="icon-title"><i class="fa-solid fa-hands-praying"></i> مقدمات الصلاة</h2>
        <p>تحصيل شروط الصلاة: الطهارة من الحدث والخبث، استقبال القبلة، ستر العورة، وتهيئة المكان واللباس.</p>
        <h3>التيمم بإيجاز</h3>
        <p>يُشرع عند فقد الماء أو تعذّر استعماله أو ضرره أو المشقة. يُتيمم على التراب الطاهر ونحوه. الخطوات: نية، ضرب الكفين، مسح الجبهة والجبينين، مسح ظاهر الكفين تباعًا.</p>

        <!-- مصادر RTL أنيقة -->
        <div class="sources">
          <h4><i class="fa-solid fa-book-open"></i> المصادر</h4>
          <ul>
            <li>المصدر: موقع مكتب سماحة السيد السيستاني (دام ظله)، منهاج الصالحين، والاستفتاءات.</li>
          </ul>
        </div>
      </div>
    </section>

    <section id="how" class="content" style="background:var(--light)">
      <div class="container">
        <h2 class="icon-title"><i class="fa-solid fa-person-praying"></i> كيفية الصلاة</h2>
        <ul>
          <li>النية، تكبيرة الإحرام، القيام، القراءة، الركوع، السجود، التشهد، التسليم، الترتيب والموالاة.</li>
        </ul>
      </div>
    </section>

    <section id="times" class="content">
      <div class="container">
        <h2 class="icon-title"><i class="fa-regular fa-clock"></i> أوقات الصلاة</h2>
        <ul>
          <li><strong>الصبح:</strong> من الفجر الصادق إلى الشروق.</li>
          <li><strong>الظهر والعصر:</strong> من الزوال إلى المغرب، مع الترتيب.</li>
          <li><strong>المغرب والعشاء:</strong> من المغرب إلى منتصف الليل للمختار.</li>
        </ul>

        <div class="sources">
          <h4><i class="fa-solid fa-book-open"></i> المصادر</h4>
          <ul>
            <li>المصدر: موقع مكتب سماحة السيد السيستاني (دام ظله)، منهاج الصالحين، والاستفتاءات.</li>
          </ul>
        </div>
      </div>
    </section>

    <section id="rulings" class="content" style="background:var(--light)">
      <div class="container">
        <h2 class="icon-title"><i class="fa-solid fa-scale-balanced"></i> أحكام الشك والسهو</h2>
        <p>الشكوك المبطِلة وغير المبطِلة وسجدتا السهو…</p>
        <div class="sources">
          <h4><i class="fa-solid fa-book-open"></i> المصادر</h4>
          <ul>
            <li>المصدر: موقع مكتب سماحة السيد السيستاني (دام ظله)، الوجيز في أحكام العبادات.</li>
          </ul>
        </div>
      </div>
    </section>

    <section id="missed" class="content">
      <div class="container">
        <h2 class="icon-title"><i class="fa-solid fa-rotate"></i> قضاء الصلوات</h2>
        <ul>
          <li>يجوز القضاء في أي وقت؛ قضاء الحضر تامّ والسفر قصر.</li>
        </ul>
        <div class="sources">
          <h4><i class="fa-solid fa-book-open"></i> المصادر</h4>
          <ul>
            <li>المصدر: موقع مكتب سماحة السيد السيستاني (دام ظله)، منهاج الصالحين.</li>
          </ul>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <div class="container">
      <p>&copy; 2025 دليل الصلاة الجعفرية.</p>
      <p>إعداد ومراجعة: <a href="https://wa.me/97333375858" target="_blank" rel="noopener" style="color:#a9cce3;font-weight:700">فاضل الريس</a></p>
    </div>
  </footer>

  <a href="#top" class="top hide" aria-label="العودة للأعلى"><i class="fa-solid fa-arrow-up"></i></a>

  <script>
  // زر أعلى الصفحة
  const topBtn=document.querySelector('.top');
  addEventListener('scroll',()=>{ topBtn.classList.toggle('hide', scrollY<400); });

  // عناصر التاريخ
  const dayNameEl=document.getElementById('dayName');
  const gregDateEl=document.getElementById('gregDate');
  const hijriDateEl=document.getElementById('hijriDate');
  const cityEl=document.getElementById('cityName');
  const countdownEl=document.getElementById('countdown');
  const countdownLabel=document.getElementById('countdownLabel');
  const nextAdhanEl=document.getElementById('nextAdhan');

  const ptList=document.getElementById('ptList');
  const ptNote=document.getElementById('ptNote');

  const now=new Date();
  dayNameEl.textContent=new Intl.DateTimeFormat('ar',{weekday:'long'}).format(now);
  gregDateEl.textContent=new Intl.DateTimeFormat('ar',{year:'numeric',month:'long',day:'numeric'}).format(now);
  hijriDateEl.textContent=new Intl.DateTimeFormat('ar-SA-u-ca-islamic',{year:'numeric',month:'long',day:'numeric'}).format(now);

  function fmt12(hm){const [H,M]=hm.split(':').map(Number);const p=H>=12?'م':'ص';const h=H%12||12;return `${String(h).padStart(2,'0')}:${String(M).padStart(2,'0')} ${p}`;}
  function toTodayDate(hm){const d=new Date();const [H,M]=hm.split(':').map(Number);d.setHours(H,M,0,0);return d;}

  function renderTimes(T, meta){
    // نستخدم Maghrib الجعفري من API method=2، ونُظهر Sunset كسطر مستقل
    const clean=s=>s.split(' ')[0];
    const rows=[
      ['صلاة الفجر', clean(T.Fajr)],
      ['الشروق', clean(T.Sunrise)],
      ['صلاة الظهر', clean(T.Dhuhr)],
      ['الغروب', clean(T.Sunset)],
      ['صلاة المغرب (جعفري)', clean(T.Maghrib)],
      ['منتصف الليل', clean(T.Midnight)]
    ];
    ptList.innerHTML=rows.map(([n,t])=>`<li class="pt-row"><span class="pt-name">${n}</span><span class="pt-time">${fmt12(t)}</span></li>`).join('');
    ptNote.textContent='';

    cityEl.textContent=(meta && meta.timezone)?meta.timezone:'Asia/Bahrain';

    // أقرب أذان: الفجر/الظهر/المغرب (جعفري)
    const adhanList=[
      {name:'الفجر', time:clean(T.Fajr)},
      {name:'الظهر', time:clean(T.Dhuhr)},
      {name:'المغرب', time:clean(T.Maghrib)}
    ];
    function nextAdhan(){
      const now=new Date(); let best=null;
      for(const a of adhanList){const dt=toTodayDate(a.time); if(dt>now && (!best||dt<best.dt)) best={...a,dt};}
      if(!best){ // الفجر القادم
        const [H,M]=adhanList[0].time.split(':').map(Number);
        const dt=new Date(); dt.setDate(dt.getDate()+1); dt.setHours(H,M,0,0);
        best={...adhanList[0],dt};
      }
      return best;
    }
    let nxt=nextAdhan();
    nextAdhanEl.textContent=`أقرب أذان: ${nxt.name} ${fmt12(`${String(nxt.dt.getHours()).padStart(2,'0')}:${String(nxt.dt.getMinutes()).padStart(2,'0')}`)}`;
    function tick(){
      const now=new Date();
      if(now>=nxt.dt){nxt=nextAdhan(); nextAdhanEl.textContent=`أقرب أذان: ${nxt.name} ${fmt12(`${String(nxt.dt.getHours()).padStart(2,'0')}:${String(nxt.dt.getMinutes()).padStart(2,'0')}`)}`;}
      const diff=Math.max(0,Math.floor((nxt.dt-now)/1000));
      const hh=String(Math.floor(diff/3600)).padStart(2,'0');
      const mm=String(Math.floor((diff%3600)/60)).padStart(2,'0');
      const ss=String(diff%60).padStart(2,'0');
      countdownEl.textContent=`${hh}:${mm}:${ss}`;
    }
    tick(); setInterval(tick,1000);
  }

  function fetchPrayerTimes(lat, lon){
    const d=new Date(), y=d.getFullYear(), m=d.getMonth()+1, day=d.getDate();
    // method=2 => Shia Ithna-Ashari (جعفري)
    const url=`https://api.aladhan.com/v1/calendar/${y}/${m}?latitude=${lat}&longitude=${lon}&method=2`;
    ptNote.textContent='جاري جلب المواقيت…';
    fetch(url).then(r=>r.json()).then(json=>{
      if(json.code!==200) throw new Error('API');
      const today=json.data[day-1];
      renderTimes(today.timings, today.meta);
    }).catch(()=>{ ptNote.textContent='تعذر جلب المواقيت. تحقق من الاتصال/إذن الموقع.'; });
  }

  if('geolocation' in navigator){
    navigator.geolocation.getCurrentPosition(
      pos=>fetchPrayerTimes(pos.coords.latitude,pos.coords.longitude),
      _=>{ ptNote.textContent='يُرجى السماح بالموقع لعرض المواقيت بدقة.'; }
    );
  }else{
    ptNote.textContent='المتصفح لا يدعم تحديد الموقع.';
  }
  </script>
</body>
</html>
