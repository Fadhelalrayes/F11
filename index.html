<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{
    /* Ù„ÙˆØ­Ø© Ø£Ù„ÙˆØ§Ù† Ø§Ø­ØªØ±Ø§ÙÙŠØ©: ÙƒØ­Ù„ÙŠ/ØªØ±ÙƒÙˆØ§Ø²/Ø¹Ø§Ø¬ÙŠ */
    --ink:#0b132b;          /* Ù†Øµ Ø£Ø³Ø§Ø³ÙŠ */
    --muted:#5b6476;        /* Ù†Øµ Ø«Ø§Ù†ÙˆÙŠ */
    --bg:#f7f8fb;           /* Ø®Ù„ÙÙŠØ© Ø¹Ø§Ù…Ø© */
    --grad1:#eff6ff;        /* Ø·Ø¨Ù‚Ø© Ø¶ÙˆØ¡ */
    --grad2:#e8fbf7;        /* Ø·Ø¨Ù‚Ø© Ø¶ÙˆØ¡ */
    --card:#ffffff;         /* Ø®Ù„ÙÙŠØ§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
    --border:#e6e8ef;       /* Ø­Ø¯ÙˆØ¯ Ø±Ù‚ÙŠÙ‚Ø© */
    --brand:#0ea5a6;        /* ØªØ±ÙƒÙˆØ§Ø² Ø£Ù†ÙŠÙ‚ */
    --brand-2:#2563eb;      /* Ø£Ø²Ø±Ù‚ Ù‡Ø§Ø¯Ø¦ */
    --badge:#eef6ff;        /* Ø´Ø§Ø±Ø© */
    --shadow:0 18px 45px rgba(2,6,23,.08);
    --radius:18px;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:"Cairo", system-ui, -apple-system, Segoe UI, "Noto Kufi Arabic", sans-serif;
    color:var(--ink);
    background:
      radial-gradient(900px 600px at 10% 0%, var(--grad1) 0%, transparent 60%),
      radial-gradient(700px 500px at 92% 8%, var(--grad2) 0%, transparent 55%),
      var(--bg);
    min-height:100svh; padding:24px;
  }
  .wrap{width:min(1180px,100%); margin-inline:auto; display:flex; flex-direction:column; gap:18px; animation:fade .5s ease both}
  @keyframes fade{from{opacity:0; transform:translateY(6px)}to{opacity:1; transform:translateY(0)}}

  /* Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© */
  .header{
    position:relative;
    background:linear-gradient(160deg,#ffffff,#fbfdff);
    border:1px solid var(--border);
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    padding:20px clamp(16px, 3vw, 26px);
    display:grid; grid-template-columns: 1fr auto; gap:16px; align-items:center;
  }
  /* Ø§Ù„Ø³Ø§Ø¹Ø© Ù…Ø«Ø¨ØªØ© ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰ ÙŠØ³Ø§Ø± Ø§Ù„ØµÙØ­Ø© (Ù…ÙˆÙ‚Ø¹ ÙÙŠØ²ÙŠØ§Ø¦ÙŠ ÙŠØ³Ø§Ø± Ø­ØªÙ‰ Ù…Ø¹ RTL) */
  .clock-fixed{
    position:absolute; left:16px; top:16px; z-index:3;
    background:#fff; border:1px solid var(--border); border-radius:14px;
    padding:.5rem .8rem; font-variant-numeric:tabular-nums; font-weight:800; color:#0b3a37;
    box-shadow:0 10px 24px rgba(0,0,0,.06);
  }

  .title h1{margin:0; font-size: clamp(1.15rem, 2.2vw, 1.6rem); font-weight:800; letter-spacing:.2px}
  .subline{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
  .badge{
    display:inline-flex; align-items:center; gap:8px;
    background:var(--badge); color:#093a64; border:1px solid var(--border);
    border-radius:999px; padding:.4rem .7rem; font-size:.92rem; font-weight:700;
  }
  .badge i{font-style:normal; opacity:.7}

  .controls{
    display:flex; gap:10px; align-items:center; flex-wrap:wrap;
    background:#fff; border:1px solid var(--border); border-radius:12px; padding:10px 12px;
  }
  .controls label{color:var(--muted); font-weight:700; font-size:.95rem}
  select{
    appearance:none; padding:12px 44px 12px 14px; border-radius:12px;
    border:1px solid var(--border); background:
      #fff url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 20 20" fill="none"><path d="M5 7l5 6 5-6" stroke="%235b6476" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>') no-repeat left 12px center/12px;
    color:#0b132b; font-weight:700; box-shadow:0 1px 0 #00000008;
  }

  /* Ø´Ø¨ÙƒØ© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
  .grid{display:grid; grid-template-columns: repeat(3, 1fr); gap:16px}
  @media (max-width: 980px){ .grid{grid-template-columns: repeat(2,1fr)} }
  @media (max-width: 640px){ .grid{grid-template-columns:1fr} }

  .card{
    position:relative; overflow:hidden;
    background:var(--card); border:1px solid var(--border); border-radius:var(--radius);
    box-shadow:var(--shadow); padding:18px; display:flex; flex-direction:column; gap:8px;
  }
  .accent{
    position:absolute; inset-inline-start:0; top:0; width:6px; height:100%;
    background:linear-gradient(180deg,var(--brand),var(--brand-2));
  }
  .head{display:flex; align-items:center; gap:10px; font-weight:800}
  .dot{
    width:28px; height:28px; border-radius:10px; display:grid; place-items:center;
    background:linear-gradient(135deg,#effaff,#ffffff); border:1px solid #d9e9ff; color:#0c5a88; font-size:1rem;
  }
  .time{font-variant-numeric:tabular-nums; font-weight:800; font-size:1.32rem}
  .next{
    position:absolute; top:12px; inset-inline-end:12px; background:#ecfeff; color:#0c4a6e;
    border:1px solid #c7f3f6; border-radius:999px; padding:.22rem .55rem; font-size:.78rem; font-weight:800;
  }

  /* Ø­Ø¯ÙŠØ« Ø§Ù„ÙŠÙˆÙ… */
  .hadith{
    background:linear-gradient(180deg,#ffffff,#fbfdff);
    border:1px solid var(--border); border-radius:var(--radius);
    box-shadow:var(--shadow); padding:18px; display:flex; flex-direction:column; gap:8px;
  }
  .htitle{margin:0 0 4px; font-size:1.02rem; font-weight:800}
  .hsrc{color:var(--muted); font-size:.92rem}

  /* ØªØ°ÙŠÙŠÙ„ */
  footer{ text-align:center; color:var(--muted); font-weight:700 }
  .brand{ color:var(--brand); }
</style>
</head>
<body>
  <div class="wrap">
    <section class="header" aria-live="polite">
      <!-- Ø§Ù„Ø³Ø§Ø¹Ø© Ø£Ø¹Ù„Ù‰ ÙŠØ³Ø§Ø± -->
      <div id="clock" class="clock-fixed">--:-- --</div>

      <div class="title">
        <h1>Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©</h1>
        <div class="subline">
          <span id="placeLabel" class="badge"><i>ğŸ“</i><span>Ø§Ù„Ø¨Ø­Ø±ÙŠÙ† â€“ Ø§Ù„Ù…Ù†Ø§Ù…Ø©</span></span>
          <span id="hijri" class="badge"><i>ğŸ—“</i><span>--</span></span>
          <span id="greg" class="badge"><i>ğŸ“…</i><span>--</span></span>
        </div>
      </div>

      <div class="controls">
        <label for="country">Ø§Ù„Ø¯ÙˆÙ„Ø©</label>
        <select id="country" aria-label="Ø§Ø®ØªØ± Ø§Ù„Ø¯ÙˆÙ„Ø©">
          <option value="Bahrain" selected>Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†</option>
          <option value="Lebanon">Ù„Ø¨Ù†Ø§Ù†</option>
          <option value="Iraq">Ø§Ù„Ø¹Ø±Ø§Ù‚</option>
          <option value="Iran">Ø¥ÙŠØ±Ø§Ù†</option>
          <option value="Kuwait">Ø§Ù„ÙƒÙˆÙŠØª</option>
          <option value="Saudi Arabia">Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</option>
        </select>

        <label for="city">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label>
        <select id="city" aria-label="Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©">
          <!-- ÙŠÙÙ…Ù„Ø£ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
        </select>
      </div>
    </section>

    <section class="grid" id="cards">
      <!-- Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØª ØªÙÙ†Ø´Ø£ Ù‡Ù†Ø§ -->
    </section>

    <section class="hadith">
      <h3 class="htitle">Ø­Ø¯ÙŠØ« Ø§Ù„ÙŠÙˆÙ…</h3>
      <div id="hadithText"></div>
      <div class="hsrc" id="hadithSource"></div>
    </section>

    <footer>Ø¨Ø±Ù…Ø¬Ø© ÙˆØªØ·ÙˆÙŠØ± <span class="brand">ÙØ§Ø¶Ù„ Ø§Ù„Ø±ÙŠØ³</span></footer>
  </div>

<script>
  /* Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙˆÙ„ ÙˆØ§Ù„Ù…Ø¯Ù† (EN Ù„Ù„Ù€ APIØŒ AR Ù„Ù„Ø¹Ø±Ø¶) */
  const MAP = {
    "Bahrain": {
      tz:"Asia/Bahrain",
      cities:[
        {en:"Manama", ar:"Ø§Ù„Ù…Ù†Ø§Ù…Ø©"},
        {en:"Muharraq", ar:"Ø§Ù„Ù…Ø­Ø±Ù‚"},
        {en:"Isa Town", ar:"Ù…Ø¯ÙŠÙ†Ø© Ø¹ÙŠØ³Ù‰"},
        {en:"Hamad Town", ar:"Ù…Ø¯ÙŠÙ†Ø© Ø­Ù…Ø¯"},
        {en:"Sitra", ar:"Ø³ØªØ±Ø©"},
        {en:"Saar", ar:"Ø³Ø§Ø±"},
        {en:"Draz", ar:"Ø§Ù„Ø¯Ø±Ø§Ø²"},
        {en:"Jidhafs", ar:"Ø¬Ø¯Ø­ÙØµ"}
      ]
    },
    "Lebanon": {
      tz:"Asia/Beirut",
      cities:[
        {en:"Beirut", ar:"Ø¨ÙŠØ±ÙˆØª"},
        {en:"Tripoli", ar:"Ø·Ø±Ø§Ø¨Ù„Ø³"},
        {en:"Sidon", ar:"ØµÙŠØ¯Ø§"}
      ]
    },
    "Iraq": {
      tz:"Asia/Baghdad",
      cities:[
        {en:"Baghdad", ar:"Ø¨ØºØ¯Ø§Ø¯"},
        {en:"Basrah", ar:"Ø§Ù„Ø¨ØµØ±Ø©"},
        {en:"Erbil", ar:"Ø£Ø±Ø¨ÙŠÙ„"}
      ]
    },
    "Iran": {
      tz:"Asia/Tehran",
      cities:[
        {en:"Tehran", ar:"Ø·Ù‡Ø±Ø§Ù†"},
        {en:"Mashhad", ar:"Ù…Ø´Ù‡Ø¯"},
        {en:"Isfahan", ar:"Ø£ØµÙÙ‡Ø§Ù†"}
      ]
    },
    "Kuwait": {
      tz:"Asia/Kuwait",
      cities:[
        {en:"Kuwait City", ar:"Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„ÙƒÙˆÙŠØª"},
        {en:"Hawalli", ar:"Ø­ÙˆÙ„ÙŠ"},
        {en:"Al Ahmadi", ar:"Ø§Ù„Ø£Ø­Ù…Ø¯ÙŠ"}
      ]
    },
    "Saudi Arabia": {
      tz:"Asia/Riyadh",
      cities:[
        {en:"Riyadh", ar:"Ø§Ù„Ø±ÙŠØ§Ø¶"},
        {en:"Jeddah", ar:"Ø¬Ø¯Ø©"},
        {en:"Dammam", ar:"Ø§Ù„Ø¯Ù…Ø§Ù…"},
        {en:"Mecca", ar:"Ù…ÙƒØ©"},
        {en:"Medina", ar:"Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©"}
      ]
    }
  };

  /* Ø£Ø­Ø§Ø¯ÙŠØ« */
  const HADITHS = [
    { text:"Ù‚Ø§Ù„ Ø§Ù„Ø¥Ù…Ø§Ù… Ø§Ù„Ø¨Ø§Ù‚Ø± (Ø¹Ù„ÙŠÙ‡ Ø§Ù„Ø³Ù„Ø§Ù…): Ø¥Ø°Ø§ Ø§Ø³ØªÙ‚Ø¨Ù„ Ø§Ù„Ù…ØµÙ„ÙŠ Ø§Ù„Ù‚Ø¨Ù„Ø© Ø§Ø³ØªÙ‚Ø¨Ù„ Ø§Ù„Ø±Ø­Ù…Ù† Ø¨ÙˆØ¬Ù‡Ù‡ Ù„Ø§ Ø¥Ù„Ù‡ ØºÙŠØ±Ù‡.", src:"Ø§Ù„Ù…ØµØ¯Ø±: Ù…ÙŠØ²Ø§Ù† Ø§Ù„Ø­ÙƒÙ…Ø©" },
    { text:"Ù‚Ø§Ù„ Ø§Ù„Ø¥Ù…Ø§Ù… Ø¹Ù„ÙŠ (Ø¹Ù„ÙŠÙ‡ Ø§Ù„Ø³Ù„Ø§Ù…): Ø¥Ø°Ø§ Ù‚Ø§Ù… Ø§Ù„Ø±Ø¬Ù„ Ø¥Ù„Ù‰ Ø§Ù„ØµÙ„Ø§Ø© Ø£Ù‚Ø¨Ù„ Ø¥Ø¨Ù„ÙŠØ³ ÙŠÙ†Ø¸Ø± Ø¥Ù„ÙŠÙ‡ Ø­Ø³Ø¯Ø§Ù‹ Ù„Ù…Ø§ ÙŠØ±Ù‰ Ù…Ù† Ø±Ø­Ù…Ø© Ø§Ù„Ù„Ù‡ Ø§Ù„ØªÙŠ ØªØºØ´Ø§Ù‡.", src:"Ø§Ù„Ù…ØµØ¯Ø±: Ù…ÙŠØ²Ø§Ù† Ø§Ù„Ø­ÙƒÙ…Ø©" },
    { text:"Ù‚Ø§Ù„ Ø§Ù„Ø¥Ù…Ø§Ù… Ø§Ù„Ø±Ø¶Ø§ (Ø¹Ù„ÙŠÙ‡ Ø§Ù„Ø³Ù„Ø§Ù…): Ø§Ù„ØµÙ„Ø§Ø© Ù„Ù‡Ø§ Ø£Ø±Ø¨Ø¹Ø© Ø¢Ù„Ø§Ù Ø¨Ø§Ø¨.", src:"Ø§Ù„Ù…ØµØ¯Ø±: Ù…ÙŠØ²Ø§Ù† Ø§Ù„Ø­ÙƒÙ…Ø©" },
    { text:"Ù‚Ø§Ù„ Ø§Ù„Ø¥Ù…Ø§Ù… Ø¹Ù„ÙŠ (Ø¹Ù„ÙŠÙ‡ Ø§Ù„Ø³Ù„Ø§Ù…): ÙŠØ§ ÙƒÙ…ÙŠÙ„! Ù„ÙŠØ³ Ø§Ù„Ø´Ø£Ù† Ø£Ù† ØªØµÙ„ÙŠ ÙˆØªØµÙˆÙ… ÙˆØªØªØµØ¯Ù‚ØŒ Ø¥Ù†Ù…Ø§ Ø§Ù„Ø´Ø£Ù† Ø£Ù† ØªÙƒÙˆÙ† Ø§Ù„ØµÙ„Ø§Ø© ÙØ¹Ù„Øª Ø¨Ù‚Ù„Ø¨ Ù†Ù‚ÙŠØŒ ÙˆØ¹Ù…Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ù„Ù‡ Ù…Ø±Ø¶ÙŠØŒ ÙˆØ®Ø´ÙˆØ¹ Ø³ÙˆÙŠ.", src:"Ø§Ù„Ù…ØµØ¯Ø±: Ù…ÙŠØ²Ø§Ù† Ø§Ù„Ø­ÙƒÙ…Ø©" }
  ];
  function setRandomHadith(){
    const h = HADITHS[Math.floor(Math.random()*HADITHS.length)];
    document.getElementById('hadithText').textContent = h.text;
    document.getElementById('hadithSource').textContent = h.src;
  }

  /* 12 Ø³Ø§Ø¹Ø© */
  function to12h(t){
    if(!t) return "--:-- --";
    const pure = t.replace(/\s*\(.*?\)\s*/g, "");
    const [H,M] = pure.split(":").map(Number);
    if(Number.isNaN(H)||Number.isNaN(M)) return t;
    let h = H % 12; if(h===0) h = 12;
    const ampm = H < 12 ? "AM" : "PM";
    return `${String(h).padStart(2,"0")}:${String(M).padStart(2,"0")} ${ampm}`;
  }

  /* Ø§Ù„ÙˆÙ‚Øª ÙˆØ§Ù„ØªÙˆØ§Ø±ÙŠØ® */
  function fmtClock(tz){
    return new Intl.DateTimeFormat('en-GB', {timeZone:tz, hour:'2-digit', minute:'2-digit', hour12:true}).format(new Date());
  }
  function fmtGreg(tz){
    return new Intl.DateTimeFormat('ar', {timeZone:tz, weekday:'long', year:'numeric', month:'long', day:'numeric'}).format(new Date());
  }
  function fmtHijri(tz){
    try{
      return new Intl.DateTimeFormat('ar-SA-u-ca-islamic', {timeZone:tz, weekday:'long', year:'numeric', month:'long', day:'numeric'}).format(new Date());
    }catch{ return "Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ (Ù…ØªØµÙØ­ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…)"; }
  }

  /* Ø¨Ù†Ø§Ø¡ Ø¨Ø·Ø§Ù‚Ø© */
  function makeCard({label, icon, time, next=false}){
    const el = document.createElement('div');
    el.className = 'card';
    el.innerHTML = `
      <span class="accent" aria-hidden="true"></span>
      ${next ? `<span class="next">Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</span>` : ``}
      <div class="head"><span class="dot">${icon}</span> <span>${label}</span></div>
      <div class="time">${to12h(time)}</div>
    `;
    return el;
  }

  /* ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© */
  function nextPrayerKey(timings, tz){
    const order = ["Imsak","Fajr","Dhuhr","Asr","Maghrib","Isha","Midnight"];
    const nowTZ = new Date(new Date().toLocaleString('en-US',{timeZone:tz}));
    const dstr = new Intl.DateTimeFormat('en-CA', {timeZone:tz, year:'numeric', month:'2-digit', day:'2-digit'}).format(nowTZ);
    const [Y,M,D] = dstr.split('-').map(Number);

    const cand = order.map(k=>{
      const raw = (timings[k]||"").replace(/\s*\(.*?\)\s*/g,"");
      if(!raw.includes(':')) return {k, diff:Infinity};
      const [HH,MM] = raw.split(':').map(Number);
      const dt = new Date(Y, M-1, D, HH, MM, 0);
      return {k, diff: dt - nowTZ};
    });
    let next = cand.filter(x=>x.diff>=0).sort((a,b)=>a.diff-b.diff)[0];
    if(!next) next = cand.sort((a,b)=>Math.abs(a.diff)-Math.abs(b.diff))[0];
    return next?.k || null;
  }

  /* ØªÙ‚Ø¯ÙŠØ± Ø§Ù„Ø¥Ù…Ø³Ø§Ùƒ Ø¥Ø°Ø§ ØºØ§Ø¨ */
  function ensureImsak(timings){
    if(!timings.Imsak && timings.Fajr){
      const pure = timings.Fajr.replace(/\s*\(.*?\)\s*/g,"");
      const [H,M] = pure.split(":").map(Number);
      const d = new Date(); d.setHours(H, M-10, 0, 0);
      const hh = String(d.getHours()).padStart(2,"0");
      const mm = String(d.getMinutes()).padStart(2,"0");
      timings.Imsak = `${hh}:${mm}`;
    }
    return timings;
  }

  /* Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØª (Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© 0 = ÙˆÙÙ‚ Ø§Ù„Ù…Ø°Ù‡Ø¨ Ø§Ù„Ø¬Ø¹ÙØ±ÙŠ) */
  async function fetchTimings(country, city){
    const url = `https://api.aladhan.com/v1/timingsByCity?city=${encodeURIComponent(city)}&country=${encodeURIComponent(country)}&method=0`;
    const res = await fetch(url);
    if(!res.ok) throw new Error("ØªØ¹Ø°Ù‘Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù…Ø²ÙˆØ¯ Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØª");
    const json = await res.json();
    return json.data.timings;
  }

  /* Ø±Ø³Ù… Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ */
  function renderAll(timings, tz){
    const grid = document.getElementById('cards');
    grid.innerHTML = "";
    ensureImsak(timings);
    const rows = [
      {label:"Ø§Ù„Ø¥Ù…Ø³Ø§Ùƒ",    key:"Imsak",   icon:"ğŸŒ™"},
      {label:"Ø£Ø°Ø§Ù† Ø§Ù„ÙØ¬Ø±", key:"Fajr",    icon:"ğŸ•Œ"},
      {label:"Ø£Ø°Ø§Ù† Ø§Ù„Ø¸Ù‡Ø±", key:"Dhuhr",   icon:"â˜€ï¸"},
      {label:"Ø£Ø°Ø§Ù† Ø§Ù„Ø¹ØµØ±", key:"Asr",     icon:"ğŸŒ¤ï¸"},
      {label:"Ø£Ø°Ø§Ù† Ø§Ù„Ù…ØºØ±Ø¨",key:"Maghrib", icon:"ğŸŒ†"},
      {label:"Ø£Ø°Ø§Ù† Ø§Ù„Ø¹Ø´Ø§Ø¡",key:"Isha",    icon:"ğŸŒ™"},
      {label:"Ù…Ù†ØªØµÙ Ø§Ù„Ù„ÙŠÙ„",key:"Midnight",icon:"ğŸŒŒ"}
    ];
    const nextK = nextPrayerKey(timings, tz);
    rows.forEach(r=>{
      grid.appendChild(makeCard({label:r.label, icon:r.icon, time:timings[r.key]||"", next: r.key===nextK}));
    });
  }

  /* ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù…Ø¯Ù† Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙˆÙ„Ø© */
  function populateCities(country){
    const citySel = document.getElementById('city');
    citySel.innerHTML = "";
    (MAP[country]?.cities || []).forEach((c, i)=>{
      const opt = document.createElement('option');
      opt.value = c.en;
      opt.textContent = c.ar;
      if(i===0) opt.selected = true;
      citySel.appendChild(opt);
    });
  }

  /* ØªØ­Ø¯ÙŠØ« Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© (Ø§Ù„Ù…ÙƒØ§Ù† + Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠÙ† + Ø§Ù„Ø³Ø§Ø¹Ø©) */
  function updateHeader(country, city){
    const tz = MAP[country]?.tz || "Asia/Bahrain";
    const cityObj = (MAP[country]?.cities || []).find(c=>c.en===city) || {ar:city};
    document.getElementById('placeLabel').querySelector('span').textContent = `${countryNameAR(country)} â€“ ${cityObj.ar}`;
    document.getElementById('greg').querySelector('span').textContent  = fmtGreg(tz);
    document.getElementById('hijri').querySelector('span').textContent = fmtHijri(tz);
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø§Ø¹Ø© Ø§Ù„Ø«Ø§Ø¨ØªØ©
    clearInterval(window._clk);
    document.getElementById('clock').textContent = fmtClock(tz);
    window._clk = setInterval(()=>{ document.getElementById('clock').textContent = fmtClock(tz); }, 1000);
    return tz;
  }

  function countryNameAR(code){
    switch(code){
      case "Bahrain": return "Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†";
      case "Lebanon": return "Ù„Ø¨Ù†Ø§Ù†";
      case "Iraq": return "Ø§Ù„Ø¹Ø±Ø§Ù‚";
      case "Iran": return "Ø¥ÙŠØ±Ø§Ù†";
      case "Kuwait": return "Ø§Ù„ÙƒÙˆÙŠØª";
      case "Saudi Arabia": return "Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©";
      default: return code;
    }
  }

  /* ØªØ­Ù…ÙŠÙ„ Ø­Ø³Ø¨ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±Ø§Øª */
  async function load(){
    const country = document.getElementById('country').value;
    const city    = document.getElementById('city').value;
    const tz = updateHeader(country, city);
    // Ø­Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ø£Ù†ÙŠÙ‚Ø©
    const cards = document.getElementById('cards');
    cards.innerHTML = `<div class="card"><span class="accent"></span><div class="head"><span class="dot">â³</span><span>ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØªâ€¦</span></div></div>`;
    try{
      const timings = await fetchTimings(country, city);     // method=0 (Ø¬Ø¹ÙØ±ÙŠ)
      renderAll(timings, tz);
    }catch(e){
      console.error(e);
      cards.innerHTML = `<div class="card"><span class="accent"></span>ØªØ¹Ø°Ù‘Ø± Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØª. Ø­Ø§ÙˆÙ„ Ù„Ø§Ø­Ù‚Ù‹Ø§.</div>`;
    }
  }

  /* ØªÙ‡ÙŠØ¦Ø© ÙƒØ§Ù…Ù„Ø© */
  function init(){
    setRandomHadith();

    // ØªØ¹Ø¨Ø¦Ø© Ù…Ø¯Ù† Ø§Ù„Ø¯ÙˆÙ„Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© (Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†)
    const countrySel = document.getElementById('country');
    const citySel    = document.getElementById('city');
    populateCities(countrySel.value);

    // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ØªØºÙŠÙŠØ±
    countrySel.addEventListener('change', ()=>{
      populateCities(countrySel.value);
      load();
    });
    citySel.addEventListener('change', load);

    // ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ÙŠ
    load();
  }
  init();
</script>
</body>
</html>
