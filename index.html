<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>مواقيت الصلاة – البحرين</title>
  <style>
    :root{
      --bg1:#f8fbff; --bg2:#e9f2ff;
      --card-bg:#ffffffcc; --text:#1f2937;
      --muted:#4b5563; --accent:#2563eb20; --border:#e5e7eb;
      --radius:18px; --shadow:0 10px 30px rgba(0,0,0,.06);
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: "Tahoma", system-ui, -apple-system, Segoe UI, "Noto Kufi Arabic", "Amiri", sans-serif;
      color:var(--text);
      background: linear-gradient(135deg,var(--bg1),var(--bg2));
      min-height:100svh; display:flex; flex-direction:column; justify-content:space-between; padding:24px;
    }
    .app{width:min(950px,100%); margin:auto; animation:fade .6s ease both}
    @keyframes fade{from{opacity:0; transform:translateY(8px)}to{opacity:1; transform:translateY(0)}}
    .header{
      background:var(--card-bg); border:1px solid var(--border);
      border-radius:var(--radius); box-shadow:var(--shadow); padding:18px 20px; margin-bottom:14px;
      display:grid; grid-template-columns: 1fr auto; gap:10px; align-items:center;
    }
    .title{font-size:1.25rem; font-weight:700}
    .meta{display:flex; gap:12px; flex-wrap:wrap; color:var(--muted); font-size:.95rem}
    .clock{font-variant-numeric:tabular-nums; font-weight:700}
    .location{color:var(--muted)}

    .grid{
      display:grid; grid-template-columns: 1.35fr .65fr; gap:14px;
    }
    @media (max-width:800px){ .grid{grid-template-columns:1fr} }

    .card{
      background:var(--card-bg); border:1px solid var(--border);
      border-radius:var(--radius); box-shadow:var(--shadow); padding:18px;
    }
    .section-title{margin:0 0 10px; font-size:1.05rem; color:#0f172a; font-weight:700}

    table{width:100%; border-collapse:separate; border-spacing:0; overflow:hidden}
    thead th{
      text-align:right; font-weight:600; color:var(--muted); font-size:.9rem; padding:10px 12px;
      background:var(--accent);
    }
    tbody td{
      padding:14px 12px; border-bottom:1px solid var(--border); background:#fff;
    }
    tbody tr:last-child td{border-bottom:none; border-radius:0 0 var(--radius) var(--radius)}
    .row{
      display:flex; gap:10px; align-items:center; font-weight:600;
    }
    .badge{
      display:inline-flex; align-items:center; justify-content:center; width:26px; height:26px;
      border-radius:10px; background:linear-gradient(135deg,#eff6ff,#ffffff);
      border:1px solid var(--border); font-size:.9rem;
    }
    .hadith{
      font-size: .98rem; line-height:1.8; color:#0f172a;
      background:linear-gradient(180deg,#ffffff,#fbfdff);
      border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow);
      padding:16px 18px; position:relative;
    }
    .hadith small{display:block; color:var(--muted); margin-top:8px}
    .hadith .tag{
      position:absolute; inset-inline-start:12px; top:-12px; padding:6px 10px; font-size:.8rem;
      background:#fff; border:1px solid var(--border); border-radius:999px; color:#374151;
      box-shadow:0 4px 16px rgba(0,0,0,.04);
    }
    .footer-note{margin-top:10px; color:var(--muted); font-size:.85rem}
    footer{
      text-align:center; color:var(--muted); font-size:.9rem; margin-top:20px;
    }
  </style>
</head>
<body>
  <main class="app" aria-live="polite">
    <header class="header">
      <div>
        <div class="title">مواقيت الصلاة – البحرين</div>
        <div class="meta">
          <span id="hijri"></span>
          <span>•</span>
          <span id="greg"></span>
          <span>•</span>
          <span class="clock" id="clock">--:-- --</span>
        </div>
      </div>
      <div class="location">البحرين – المنامة</div>
    </header>

    <section class="grid">
      <section class="card" id="times-card">
        <h3 class="section-title">الجدول اليومي</h3>
        <table aria-describedby="times">
          <thead>
            <tr><th>الوقت</th><th>الساعة (12h)</th></tr>
          </thead>
          <tbody id="times">
            <!-- يُملأ تلقائياً -->
          </tbody>
        </table>
        <div class="footer-note">يتم التحديث يوميًا تلقائيًا. المنطقة الزمنية: Asia/Bahrain</div>
      </section>

      <aside class="card">
        <h3 class="section-title">حديث اليوم</h3>
        <div class="hadith" id="hadithBox">
          <span class="tag">📖 ميزان الحكمة</span>
          <div id="hadithText"></div>
          <small id="hadithSource"></small>
        </div>
      </aside>
    </section>
  </main>

  <footer>
    برمجة وتطوير فاضل الريس
  </footer>

  <script>
    const tz = "Asia/Bahrain";

    function to12h(t) {
      if (!t) return "--:-- --";
      const [H,M] = t.split(":").map(Number);
      let h = H % 12; if (h === 0) h = 12;
      const ampm = H < 12 ? "AM" : "PM";
      return `${String(h).padStart(2,"0")}:${String(M).padStart(2,"0")} ${ampm}`;
    }

    function nowInTZ() {
      const f = new Intl.DateTimeFormat('en-GB', { timeZone: tz, hour:'2-digit', minute:'2-digit', hour12:true });
      return f.format(new Date());
    }

    function formatGreg() {
      const fmt = new Intl.DateTimeFormat('ar', {
        timeZone: tz, weekday:'long', year:'numeric', month:'long', day:'numeric'
      });
      return fmt.format(new Date());
    }

    function formatHijri() {
      try {
        const fmt = new Intl.DateTimeFormat('ar-SA-u-ca-islamic', {
          timeZone: tz, weekday:'long', year:'numeric', month:'long', day:'numeric'
        });
        return fmt.format(new Date());
      } catch {
        return "التاريخ الهجري (غير مدعوم في هذا المتصفح)";
      }
    }

    const HADITHS = [
      {
        text: "قال الإمام الباقر (عليه السلام): إذا استقبل المصلي القبلة استقبل الرحمن بوجهه لا إله غيره.",
        src: "المصدر: ميزان الحكمة"
      },
      {
        text: "قال الإمام علي (عليه السلام): إذا قام الرجل إلى الصلاة أقبل إبليس ينظر إليه حسداً لما يرى من رحمة الله التي تغشاه.",
        src: "المصدر: ميزان الحكمة"
      },
      {
        text: "قال الإمام الرضا (عليه السلام): الصلاة لها أربعة آلاف باب.",
        src: "المصدر: ميزان الحكمة"
      },
      {
        text: "قال الإمام علي (عليه السلام): يا كميل! ليس الشأن أن تصلي وتصوم وتتصدق، إنما الشأن أن تكون الصلاة فعلت بقلب نقي، وعمل عند الله مرضي، وخشوع سوي.",
        src: "المصدر: ميزان الحكمة"
      }
    ];

    function setRandomHadith(){
      const h = HADITHS[Math.floor(Math.random()*HADITHS.length)];
      document.getElementById('hadithText').textContent = h.text;
      document.getElementById('hadithSource').textContent = h.src;
    }

    async function fetchTimes(){
      const url = `https://api.aladhan.com/v1/timingsByCity?city=Manama&country=Bahrain`;
      const res = await fetch(url);
      if(!res.ok) throw new Error("فشل الجلب");
      const json = await res.json();
      return json.data.timings;
    }

    function renderTimes(t) {
      const rows = [
        {label:"الإمساك",    key:"Imsak",       icon:"🌙"},
        {label:"أذان الفجر", key:"Fajr",        icon:"🕌"},
        {label:"أذان الظهر", key:"Dhuhr",       icon:"☀️"},
        {label:"أذان العصر", key:"Asr",         icon:"🌤️"},
        {label:"أذان المغرب",key:"Maghrib",     icon:"🌆"},
        {label:"أذان العشاء",key:"Isha",        icon:"🌙"},
        {label:"منتصف الليل",key:"Midnight",    icon:"🌌"},
      ];
      const tbody = document.getElementById('times');
      tbody.innerHTML = "";
      rows.forEach(r=>{
        let val = t[r.key] || "";
        if(r.key==="Imsak" && !val && t.Fajr){
          const [H,M]=t.Fajr.split(":").map(Number);
          const date = new Date();
          date.setHours(H, M-10, 0, 0);
          const hh = String(date.getHours()).padStart(2,"0");
          const mm = String(date.getMinutes()).padStart(2,"0");
          val = `${hh}:${mm}`;
        }
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td><span class="row"><span class="badge" aria-hidden="true">${r.icon}</span> ${r.label}</span></td>
          <td>${to12h(val)}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    function tick(){
      document.getElementById('clock').textContent = nowInTZ();
      document.getElementById('greg').textContent = formatGreg();
      document.getElementById('hijri').textContent = formatHijri();
    }

    async function init(){
      setRandomHadith();
      tick();
      setInterval(tick, 1000);

      try{
        document.getElementById('times').innerHTML = `<tr><td colspan="2">... جاري تحديث المواقيت</td></tr>`;
        const times = await fetchTimes();
        renderTimes(times);
      }catch(e){
        document.getElementById('times').innerHTML = `<tr><td colspan="2" style="color:#b91c1c">تعذّر جلب المواقيت. حاول لاحقًا.</td></tr>`;
        console.error(e);
      }
    }
    init();
  </script>
</body>
</html>
