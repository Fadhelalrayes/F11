<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>Ù‡ÙˆØ³ Ø¨Ø§Ù„Ø®Ù…Ø³ â€” ØªØ·Ø¨ÙŠÙ‚ Ø·Ù„Ø¨ Ø·Ø¹Ø§Ù… Ù…Ø¨Ø³Ù‘Ø·</title>
  <meta name="description" content="ØªØ·Ø¨ÙŠÙ‚ Ø·Ù„Ø¨ Ø·Ø¹Ø§Ù… Ø¨Ù…Ù„Ù ÙˆØ§Ø­Ø¯: Ø§Ø³ØªÙƒØ´Ø§ÙØŒ ÙÙ„Ø§ØªØ±ØŒ Ù‚Ø§Ø¦Ù…Ø©ØŒ Ø³Ù„Ø©ØŒ ÙƒÙˆØ¨ÙˆÙ†Ø§ØªØŒ Ø¯ÙØ¹ ØªØ¬Ø±ÙŠØ¨ÙŠØŒ ØªØªØ¨Ø¹ØŒ Ø·Ù„Ø¨Ø§ØªÙŠØŒ Ø­Ø³Ø§Ø¨. Ù…ÙØ­Ø³Ù‘Ù† Ù„Ù„Ø¬ÙˆØ§Ù„." />
  <style>
    /* ===== Ø§Ù„Ø£Ø³Ø§Ø³ (Mobile-First) ===== */
    *,*::before,*::after{box-sizing:border-box}
    html,body{margin:0;padding:0}
    :root{
      --bg:#ffffff; --text:#141b2d; --muted:#5f6b7a; --brand:#ff5a1f; --stroke:#e7e9f0;
      --radius:16px; --touch:48px; --shadow:0 6px 20px rgba(0,0,0,.08);
      --safe-bottom: env(safe-area-inset-bottom, 0px);
    }
    body{background:var(--bg);color:var(--text);font:400 16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,"Noto Kufi Arabic",Tahoma,Arial; -webkit-tap-highlight-color: transparent}
    a{color:inherit;text-decoration:none}
    button{font:inherit}

    .wrap{max-width:980px;margin:auto;padding:12px 16px}

    /* ===== Ø§Ù„ØªØ±ÙˆÙŠØ³Ø© ===== */
    header{position:sticky;top:0;background:#fff;border-bottom:1px solid var(--stroke);z-index:20}
    .row{display:flex;gap:10px;align-items:center}
    .grow{flex:1}
    .logo{display:flex;align-items:center;gap:10px}
    .logo h1{font-size:20px;margin:0}
    .logo .dot{width:10px;height:10px;border-radius:50%;background:var(--brand)}

    /* Ø²Ø± Ø§Ù„Ø³Ù„Ø© ÙƒØ£ÙŠÙ‚ÙˆÙ†Ø© Ù…Ø¹ Badge ØµØºÙŠØ± */
    #btnCart{
      background:none;border:none;color:#222;cursor:pointer;
      font-size:22px;line-height:1;position:relative;min-width:44px;min-height:44px;
      display:inline-flex;align-items:center;justify-content:center;
    }
    #btnCart .badge{
      position:absolute;top:-6px;right:-6px;
      background:var(--brand);color:#fff;border-radius:999px;
      padding:2px 6px;font-size:12px;line-height:1;min-width:18px;text-align:center;
    }

    /* ===== Ø§Ù„Ø­Ù‚ÙˆÙ„ ÙˆØ§Ù„Ø£Ø²Ø±Ø§Ø± ===== */
    .search{display:flex;gap:8px;align-items:center;border:1px solid var(--stroke);border-radius:12px;background:#fff;padding:8px 10px}
    .search input{all:unset;direction:rtl;flex:1;min-height:var(--touch)}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;background:var(--brand);color:#fff;border:none;border-radius:12px;padding:0 16px;min-height:var(--touch);cursor:pointer}
    .btn.secondary{background:#f3f4f6;color:var(--text);border:1px solid var(--stroke)}
    .btn.block{display:flex;width:100%}
    .btn.ghost{background:#fff;border:1px dashed var(--stroke);color:var(--muted)}

    .chipbar{display:flex;gap:8px;overflow:auto;padding:6px 0}
    .chip{border:1px solid var(--stroke);padding:10px 14px;border-radius:999px;color:var(--muted);user-select:none;white-space:nowrap}
    .chip.active{background:#fff1ea;color:#7a2d11;border-color:#ffd9cc}

    /* ===== Ø§Ù„Ø´Ø¨ÙƒØ§Øª ÙˆØ§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª ===== */
    .grid{display:grid;grid-template-columns:1fr;gap:12px}
    @media (min-width:640px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media (min-width:960px){.grid{grid-template-columns:repeat(3,1fr)}}
    .card{background:#fff;border:1px solid var(--stroke);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden}
    .rest{display:grid;grid-template-columns:84px 1fr auto;gap:12px;align-items:center;padding:12px}
    .rest .pic{width:84px;height:84px;border-radius:12px;background:#fff7f3;display:grid;place-items:center;font-size:28px}
    .muted{color:var(--muted);font-size:14px}
    .hidden{display:none !important}

    .menu-item{display:grid;grid-template-columns:64px 1fr auto;gap:10px;align-items:center;padding:12px;border-top:1px solid var(--stroke)}
    .menu-item .pic{width:64px;height:64px;border-radius:10px;background:#fff7f3;display:grid;place-items:center}
    .qty{display:inline-flex;align-items:center;border:1px solid var(--stroke);border-radius:12px}
    .qty button{all:unset;padding:12px;cursor:pointer}
    .qty span{min-width:36px;text-align:center}

    /* ===== ØªØ¨ÙˆÙŠØ¨ Ø³ÙÙ„ÙŠ ===== */
    footer.nav{position:fixed;inset-inline:0;bottom:0;background:#fff;border-top:1px solid var(--stroke);z-index:30;padding-bottom:var(--safe-bottom)}
    footer.nav .tabs{display:grid;grid-template-columns:repeat(4,1fr)}
    footer.nav a{padding:12px;text-align:center;display:grid;place-items:center;color:var(--muted)}
    footer.nav a.active{color:var(--brand);font-weight:700}

    /* ===== Ø£Ù‚Ø³Ø§Ù… ===== */
    main{padding:18px 16px calc(88px + var(--safe-bottom))}

    /* ===== Ø­ÙˆØ§Ø±Ø§Øª ===== */
    dialog{border:none;border-radius:16px;box-shadow:var(--shadow)}
    dialog::backdrop{background:rgba(0,0,0,.35)}

    /* ===== Ø¬Ø¯Ø§ÙˆÙ„ ===== */
    table{width:100%;border-collapse:collapse}
    th,td{padding:12px;border-bottom:1px solid var(--stroke);text-align:right}

    /* ===== Toast ===== */
    #toast{position:fixed;top:14px;left:50%;transform:translateX(-50%);z-index:99;display:none}
    .toast{background:#111827;color:#fff;padding:10px 14px;border-radius:12px;box-shadow:var(--shadow)}
  </style>
</head>
<body>
  <header>
    <div class="wrap row">
      <div class="logo">
        <span class="dot" aria-hidden="true"></span>
        <h1>Ù‡ÙˆØ³ Ø¨Ø§Ù„Ø®Ù…Ø³</h1>
      </div>

      <div class="grow search" role="search">
        <input id="q" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ø·Ø¹Ù… Ø£Ùˆ Ø·Ø¨Ù‚â€¦" aria-label="Ø¨Ø­Ø«" />
        <button class="btn secondary" id="btnSearch">Ø¨Ø­Ø«</button>
      </div>

      <!-- Ø²Ø± Ø§Ù„Ø³Ù„Ø© Ø£ÙŠÙ‚ÙˆÙ†Ø© + Ø¹Ø¯Ù‘Ø§Ø¯ -->
      <button id="btnCart" aria-label="Ø§Ù„Ø³Ù„Ø©">
        ğŸ›’
        <span class="badge" id="count">0</span>
      </button>
    </div>
  </header>

  <main class="wrap">
    <!-- Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <section id="home">
      <div class="chipbar" id="homeChips" aria-label="Ø§Ù„ÙÙ„Ø§ØªØ±">
        <button class="chip active" data-filter="all">Ø§Ù„ÙƒÙ„</button>
        <button class="chip" data-filter="free">ØªÙˆØµÙŠÙ„ Ù…Ø¬Ø§Ù†ÙŠ</button>
        <button class="chip" data-filter="top">Ø§Ù„Ø£Ø¹Ù„Ù‰ ØªÙ‚ÙŠÙŠÙ…Ù‹Ø§</button>
        <button class="chip" data-filter="fast">Ø§Ù„Ø£Ø³Ø±Ø¹</button>
        <button class="chip" data-filter="offers">Ø¹Ø±ÙˆØ¶</button>
      </div>
      <h2 style="margin:8px 0">Ø§Ù„Ù…Ø·Ø§Ø¹Ù…</h2>
      <div id="restaurants" class="grid"></div>
    </section>

    <!-- ØµÙØ­Ø© Ù…Ø·Ø¹Ù… -->
    <section id="restaurantView" class="hidden">
      <div class="row" style="justify-content:space-between;margin:6px 0">
        <button class="btn secondary" id="backToList">â¬…ï¸ Ø±Ø¬ÙˆØ¹</button>
        <strong id="restName"></strong>
      </div>
      <div id="menu"></div>
      <div style="margin-top:12px" class="hidden" id="restInfo"></div>
    </section>

    <!-- Ø§Ù„Ø³Ù„Ø© -->
    <section id="cartView" class="hidden">
      <h2 style="margin:8px 0">Ø§Ù„Ø³Ù„Ø©</h2>
      <div id="cartEmpty" class="muted">Ø³Ù„ØªÙƒ ÙØ§Ø±ØºØ©.</div>
      <div id="cartFilled" class="hidden">
        <table>
          <thead><tr><th>Ø§Ù„Ù…Ù†ØªØ¬</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø§Ù„Ø³Ø¹Ø±</th></tr></thead>
          <tbody id="cartRows"></tbody>
        </table>
        <div class="row" style="justify-content:space-between;margin-top:8px">
          <div class="muted">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div>
          <div id="cartTotalNum">0.00 Ø¯.Ø¨</div>
        </div>
        <div class="row" style="justify-content:space-between;margin-top:8px">
          <label style="flex:1" class="search"><input id="coupon" placeholder="Ù‚Ø³ÙŠÙ…Ø© (Ù…Ø«Ø§Ù„: WELCOME)" /></label>
          <button class="btn secondary" id="applyCoupon">ØªØ·Ø¨ÙŠÙ‚</button>
        </div>
        <div class="row" style="justify-content:flex-end;margin-top:8px;gap:8px">
          <button class="btn secondary" id="clearCart">Ø¥ÙØ±Ø§Øº Ø§Ù„Ø³Ù„Ø©</button>
          <button class="btn" id="goCheckout">Ø§Ù„Ø¯ÙØ¹</button>
        </div>
      </div>
    </section>

    <!-- Ø§Ù„Ø¯ÙØ¹ -->
    <section id="checkoutView" class="hidden">
      <h2 style="margin:8px 0">Ø§Ù„Ø¯ÙØ¹</h2>
      <div class="card" style="padding:12px;margin-bottom:12px">
        <h3 style="margin:0 0 8px 0">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</h3>
        <label class="search"><input id="addr" placeholder="Ø§ÙƒØªØ¨ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªØ³Ù„ÙŠÙ… (Ø§Ù„Ù…Ù†Ø§Ù…Ø© â€¦)" /></label>
      </div>
      <div class="card" style="padding:12px">
        <h3 style="margin:0 0 8px 0">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</h3>
        <div class="chipbar">
          <button class="chip active" data-pay="card">Ø¨Ø·Ø§Ù‚Ø©</button>
          <button class="chip" data-pay="cod">Ù†Ù‚Ø¯Ù‹Ø§ Ø¹Ù†Ø¯ Ø§Ù„ØªØ³Ù„ÙŠÙ…</button>
          <button class="chip" data-pay="wallet">Ù…Ø­ÙØ¸Ø©</button>
        </div>
        <div id="cardFields" style="margin-top:10px">
          <label class="search"><input id="cardNum" placeholder="0000 0000 0000 0000" /></label>
        </div>
      </div>
      <div class="row" style="justify-content:space-between;margin-top:12px">
        <button class="btn secondary" id="backCart">â¬…ï¸ Ø±Ø¬ÙˆØ¹</button>
        <button class="btn" id="confirmPay">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¯ÙØ¹</button>
      </div>
    </section>

    <!-- ØªØªØ¨Ø¹ -->
    <section id="trackView" class="hidden">
      <h2 style="margin:8px 0">ØªØªØ¨Ø¹ Ø§Ù„Ø·Ù„Ø¨</h2>
      <div class="card" style="padding:12px">
        <div id="trackMeta" class="muted"></div>
        <div class="grid" id="trackSteps" style="grid-template-columns:1fr;gap:8px;margin-top:10px"></div>
        <div class="row" style="justify-content:flex-end;margin-top:8px">
          <button class="btn secondary" id="toOrders">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
        </div>
      </div>
    </section>

    <!-- Ø·Ù„Ø¨Ø§ØªÙŠ -->
    <section id="ordersView" class="hidden">
      <h2 style="margin:8px 0">Ø·Ù„Ø¨Ø§ØªÙŠ</h2>
      <div id="ordersList"></div>
    </section>

    <!-- Ø§Ù„Ø­Ø³Ø§Ø¨ -->
    <section id="profileView" class="hidden">
      <h2 style="margin:8px 0">Ø­Ø³Ø§Ø¨ÙŠ</h2>
      <div id="profileBox" class="card" style="padding:12px"></div>
    </section>
  </main>

  <footer class="nav" aria-label="Ø§Ù„ØªÙ†Ù‚Ù„">
    <div class="wrap tabs">
      <a href="#" data-tab="home"   class="active">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
      <a href="#" data-tab="orders">Ø·Ù„Ø¨Ø§ØªÙŠ</a>
      <a href="#" data-tab="cart">Ø§Ù„Ø³Ù„Ø©</a>
      <a href="#" data-tab="profile">Ø­Ø³Ø§Ø¨ÙŠ</a>
    </div>
  </footer>

  <section id="toast"><div class="toast" id="toastMsg"></div></section>

<script>
(()=>{

  const $=(s,c=document)=>c.querySelector(s);
  const $$=(s,c=document)=>Array.from(c.querySelectorAll(s));
  const fmt=n=>(Math.round(n*100)/100).toFixed(2);
  const uid=()=>Math.random().toString(36).slice(2,10);
  const toast=(m)=>{const t=$('#toast'); $('#toastMsg').textContent=m; t.style.display='block'; setTimeout(()=>t.style.display='none', 1800)};

  const state={
    user:null,
    address:'',
    coupon:'',
    restaurants:[
      {id:'r1',name:'Ø¨ÙŠØªØ²Ø§ Ø±ÙˆÙ…Ø§',cuisines:['Ø¥ÙŠØ·Ø§Ù„ÙŠ','Ø¨ÙŠØªØ²Ø§'],rating:4.6,deliveryTime:25,deliveryFee:0.5,promo:'Ø®ØµÙ… 20%',open:true,menu:[
        {id:'m1',cat:'Ø¨ÙŠØªØ²Ø§',name:'Ù…Ø§Ø±Ø¬Ø±ÙŠØªØ§',price:3.5,desc:'Ø¬Ø¨Ù† ÙˆØ·Ù…Ø§Ø·Ù…'},
        {id:'m2',cat:'Ø¨ÙŠØªØ²Ø§',name:'Ø¨ÙŠØ¨Ø±ÙˆÙ†ÙŠ',price:3.9,desc:'Ø³Ù„Ø§Ù…ÙŠ Ø¨Ù‚Ø±ÙŠ'}
      ]},
      {id:'r2',name:'Ø¨Ø±Ø¬Ø± Ø³ØªØ±ÙŠØª',cuisines:['Ø£Ù…Ø±ÙŠÙƒÙŠ'],rating:4.4,deliveryTime:20,deliveryFee:0.0,promo:'ØªÙˆØµÙŠÙ„ Ù…Ø¬Ø§Ù†ÙŠ',open:true,menu:[
        {id:'m3',cat:'Ø¨Ø±Ø¬Ø±',name:'ØªØ´ÙŠØ² Ø¨Ø±Ø¬Ø±',price:2.6,desc:'Ø¬Ø¨Ù†Ø© Ø´ÙŠØ¯Ø±'},
        {id:'m4',cat:'Ø¬Ø§Ù†Ø¨ÙŠ',name:'Ø¨Ø·Ø§Ø·Ø³ Ù…Ù‚Ù„ÙŠØ©',price:0.9,desc:'Ù…Ù‚Ø±Ù…Ø´Ø©'}
      ]},
      {id:'r3',name:'Ù…Ø´ÙˆÙŠØ§Øª Ø§Ù„Ø³Ù„Ø·Ø§Ù†',cuisines:['Ø¹Ø±Ø¨ÙŠ','Ù…Ø´ÙˆÙŠØ§Øª'],rating:4.7,deliveryTime:30,deliveryFee:0.7,promo:'Ø®ØµÙ… 10%',open:true,menu:[
        {id:'m5',cat:'Ù…Ø´ÙˆÙŠØ§Øª',name:'ÙƒØ¨Ø§Ø¨ Ù„Ø­Ù…',price:4.2,desc:'200Øº'},
        {id:'m6',cat:'Ù…Ù‚Ø¨Ù„Ø§Øª',name:'Ø­Ù…Øµ',price:0.8,desc:'Ø¨Ø§Ù„Ø·Ø­ÙŠÙ†Ø©'}
      ]}
    ],
    cart:[],
    orders:[],
    tracking:null
  };

  /* ===== ØªÙ†Ù‚Ù„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… ===== */
  function show(which){
    ['home','restaurantView','cartView','checkoutView','trackView','ordersView','profileView'].forEach(id=>$('#'+id).classList.toggle('hidden', id!==which));
    $$('.tabs a').forEach(a=>a.classList.toggle('active', a.dataset.tab===mapTab(which)));
  }
  function mapTab(view){ return view==='cartView'?'cart' : view==='ordersView'?'orders' : view==='profileView'?'profile' : 'home'; }

  /* ===== Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© + ÙÙ„Ø§ØªØ± ===== */
  function renderHome(filter='all',q=''){
    const cont=$('#restaurants'); cont.innerHTML='';
    let list=[...state.restaurants];
    if(q){ const t=q.toLowerCase(); list=list.filter(r=> r.name.toLowerCase().includes(t)||r.cuisines.join(',').toLowerCase().includes(t)); }
    if(filter==='free') list=list.filter(r=>r.deliveryFee===0);
    if(filter==='top') list=list.sort((a,b)=>b.rating-a.rating);
    if(filter==='fast') list=list.sort((a,b)=>a.deliveryTime-b.deliveryTime);
    if(filter==='offers') list=list.filter(r=>/Ø®ØµÙ…|Ù…Ø¬Ø§Ù†ÙŠ/.test(r.promo||''));
    list.forEach(r=>{
      const card=document.createElement('article'); card.className='card';
      card.innerHTML=`<div class="rest">
        <div class="pic" aria-hidden="true">ğŸ½ï¸</div>
        <div>
          <div><strong>${r.name}</strong></div>
          <div class="muted">${r.cuisines.join(' â€¢ ')} â€¢ â­ ${r.rating} â€¢ â±ï¸ ${r.deliveryTime} Ø¯</div>
          ${r.promo?`<div class="chip" style="margin-top:6px">${r.promo}</div>`:''}
        </div>
        <div><button class="btn secondary" data-open="${r.id}">Ø§ÙØªØ­</button></div>
      </div>`;
      cont.appendChild(card);
    });
    $$('#restaurants [data-open]').forEach(b=>b.onclick=()=>openRestaurant(b.dataset.open));
  }

  /* ===== ØµÙØ­Ø© Ø§Ù„Ù…Ø·Ø¹Ù… ===== */
  function openRestaurant(id){
    const r=state.restaurants.find(x=>x.id===id); if(!r) return;
    show('restaurantView');
    $('#restName').textContent=r.name;
    const cats=[...new Set(r.menu.map(m=>m.cat))];
    const menu=$('#menu'); menu.innerHTML='';
    cats.forEach(c=>{
      const h=document.createElement('h3'); h.textContent=c; h.style.margin='10px 0 6px'; menu.appendChild(h);
      r.menu.filter(m=>m.cat===c).forEach(m=>{
        const row=document.createElement('div'); row.className='menu-item';
        row.innerHTML=`<div class="pic">ğŸ•</div>
          <div>
            <div class="row" style="justify-content:space-between"><strong>${m.name}</strong><strong>${fmt(m.price)} Ø¯.Ø¨</strong></div>
            <div class="muted">${m.desc||''}</div>
          </div>
          <div><button class="btn" data-add="${m.id}" data-rest="${r.id}">Ø£Ø¶ÙÙ</button></div>`;
        menu.appendChild(row);
      });
    });
    $$('#menu [data-add]').forEach(btn=>btn.onclick=()=>addToCart(btn.dataset.rest, btn.dataset.add));
  }

  /* ===== Ø§Ù„Ø³Ù„Ø© ===== */
  const cartCount = ()=>state.cart.reduce((a,i)=>a+i.qty,0);
  const updateCartBadge = ()=>{ $('#count').textContent = cartCount(); };

  function addToCart(rid,mid){
    const r=state.restaurants.find(x=>x.id===rid); const m=r?.menu.find(x=>x.id===mid); if(!m) return;
    const f=state.cart.find(x=>x.id===mid); if(f) f.qty++; else state.cart.push({id:mid,name:m.name,price:m.price,qty:1,rest:rid});
    updateCartBadge(); toast('Ø£ÙØ¶ÙŠÙ Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©');
  }

  function renderCart(){
    show('cartView');
    const empty=state.cart.length===0; $('#cartEmpty').classList.toggle('hidden',!empty); $('#cartFilled').classList.toggle('hidden',empty);
    if(empty) return;
    const tbody=$('#cartRows'); tbody.innerHTML='';
    state.cart.forEach(i=>{
      const tr=document.createElement('tr'); tr.innerHTML=`
        <td>${i.name}</td>
        <td><span class="qty"><button data-d="-1" data-id="${i.id}">âˆ’</button><span>${i.qty}</span><button data-d="1" data-id="${i.id}">+</button></span></td>
        <td>${fmt(i.qty*i.price)} Ø¯.Ø¨</td>`;
      tbody.appendChild(tr);
    });
    $$('#cartRows [data-d]').forEach(b=>b.onclick=()=>changeQty(b.dataset.id, Number(b.dataset.d)));
    calcTotals();
  }

  function changeQty(id,d){
    const it=state.cart.find(x=>x.id===id); if(!it) return;
    it.qty += d;
    if(it.qty<=0) state.cart = state.cart.filter(x=>x.id!==id);
    updateCartBadge();
    renderCart();
  }

  function clearCart(){ state.cart=[]; updateCartBadge(); renderCart(); }

  function calcTotals(){
    const total=state.cart.reduce((a,i)=>a+i.qty*i.price,0);
    let discount=0; if((state.coupon||'').toUpperCase()==='WELCOME') discount=1.0;
    $('#cartTotalNum').textContent = fmt(Math.max(total-discount,0))+' Ø¯.Ø¨';
  }

  /* ===== Ø§Ù„Ø¯ÙØ¹ ===== */
  function openCheckout(){ if(state.cart.length===0){ toast('Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©'); return;} show('checkoutView'); $('#addr').value=state.address||''; }
  function confirmPay(){
    const subtotal=state.cart.reduce((a,i)=>a+i.qty*i.price,0); const discount=((state.coupon||'').toUpperCase()==='WELCOME')?1.0:0; const total=Math.max(subtotal-discount,0);
    const order={ id:'o-'+uid(), createdAt:new Date().toISOString(), statuses:['Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¶ÙŠØ±','ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚','ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„'], statusIdx:0, items:JSON.parse(JSON.stringify(state.cart)), address:$('#addr').value||'', subtotal, discount, total };
    state.address=$('#addr').value||''; state.orders.unshift(order); state.tracking=order.id; state.cart=[]; updateCartBadge();
    toast('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨'); openTrack(order.id);
  }

  /* ===== ØªØªØ¨Ø¹ ===== */
  function openTrack(id){
    show('trackView');
    const o=state.orders.find(x=>x.id===id); if(!o){ $('#trackMeta').textContent='â€”'; return; }
    $('#trackMeta').textContent=`Ø·Ù„Ø¨ #${o.id} â€” ${new Date(o.createdAt).toLocaleString('ar')}`;
    const steps=$('#trackSteps'); steps.innerHTML='';
    o.statuses.forEach((s,idx)=>{ const card=document.createElement('div'); card.className='card'; card.style.padding='12px';
      card.innerHTML=`<div class="row" style="justify-content:space-between"><div>${s}</div><div class="chip">${idx<o.statusIdx? 'âœ“ ØªÙ…' : idx===o.statusIdx ? 'Ø¬Ø§Ø±Ù' : 'Ù„Ø§Ø­Ù‚'}</div></div>`;
      steps.appendChild(card);
    });
  }

  /* ===== Ø·Ù„Ø¨Ø§ØªÙŠ ===== */
  function renderOrders(){
    show('ordersView');
    const box=$('#ordersList'); box.innerHTML= state.orders.length? '' : '<p class="muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¨Ø¹Ø¯.</p>';
    state.orders.forEach(o=>{
      const card=document.createElement('article'); card.className='card'; card.style.padding='12px'; card.style.margin='10px 0';
      card.innerHTML=`
        <div class="row" style="justify-content:space-between">
          <div>Ø·Ù„Ø¨ #${o.id}</div>
          <div class="muted">${new Date(o.createdAt).toLocaleString('ar')}</div>
        </div>
        <div class="row" style="justify-content:space-between">
          <div class="muted">Ø§Ù„Ø­Ø§Ù„Ø©: ${o.statuses[Math.min(o.statusIdx,o.statuses.length-1)]}</div>
          <button class="btn secondary" data-track="${o.id}">ØªØªØ¨Ø¹</button>
        </div>`;
      box.appendChild(card);
    });
    $$('#ordersList [data-track]').forEach(b=>b.onclick=()=>openTrack(b.dataset.track));
  }

  /* ===== Ø§Ù„Ø­Ø³Ø§Ø¨ ===== */
  function renderProfile(){
    show('profileView');
    const box=$('#profileBox');
    if(!state.user){
      box.innerHTML=`<p class="muted">Ø³Ø¬Ù‘Ù„ Ø§Ø³Ù…Ùƒ ÙˆØ±Ù‚Ù… Ø¬ÙˆØ§Ù„Ùƒ Ù…Ø­Ù„ÙŠÙ‹Ø§ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ.</p>
      <div class="search" style="margin:8px 0"><input id="pName" placeholder="Ø§Ù„Ø§Ø³Ù…"/></div>
      <div class="search" style="margin:8px 0"><input id="pPhone" placeholder="Ø§Ù„Ø¬ÙˆØ§Ù„"/></div>
      <button class="btn block" id="saveProfile">Ø­ÙØ¸</button>`;
      $('#saveProfile').onclick=()=>{ state.user={name:$('#pName').value||'', phone:$('#pPhone').value||''}; toast('ØªÙ… Ø§Ù„Ø­ÙØ¸'); renderProfile(); };
    }else{
      box.innerHTML=`<div class="row" style="justify-content:space-between">
        <div><div><strong>${state.user.name||'-'}</strong></div><div class="muted">${state.user.phone||''}</div></div>
        <button class="btn secondary" id="logout">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
      </div>
      <div class="search" style="margin-top:10px"><input id="pAddr" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†" value="${state.address||''}"></div>
      <button class="btn block" id="saveAddr">Ø­ÙØ¸ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</button>`;
      $('#logout').onclick=()=>{ state.user=null; toast('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬'); renderProfile(); };
      $('#saveAddr').onclick=()=>{ state.address=$('#pAddr').value||''; toast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†ÙˆØ§Ù†'); };
    }
  }

  /* ===== Ø±Ø¨Ø· Ø§Ù„Ø£Ø²Ø±Ø§Ø± ===== */
  $('#btnSearch').onclick=()=>{ const chip=$('#homeChips .chip.active'); renderHome(chip?.dataset.filter||'all', $('#q').value||''); };
  $('#btnCart').onclick=()=>renderCart();
  $('#backToList').onclick=()=>{ show('home'); renderHome($('#homeChips .chip.active')?.dataset.filter||'all', $('#q').value||''); };
  $('#applyCoupon').onclick=()=>{ state.coupon=$('#coupon').value||''; calcTotals(); toast('ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù‚Ø³ÙŠÙ…Ø©'); };
  $('#clearCart').onclick=()=>clearCart();
  $('#goCheckout').onclick=()=>openCheckout();
  $('#backCart').onclick=()=>renderCart();
  $('#confirmPay').onclick=()=>confirmPay();

  $$('.tabs a').forEach(a=>a.onclick=(e)=>{
    e.preventDefault();
    if(a.dataset.tab==='home'){ show('home'); renderHome($('#homeChips .chip.active')?.dataset.filter||'all', $('#q').value||''); }
    if(a.dataset.tab==='cart') renderCart();
    if(a.dataset.tab==='orders') renderOrders();
    if(a.dataset.tab==='profile') renderProfile();
  });

  $$('#homeChips .chip').forEach(ch=>ch.onclick=()=>{
    $$('#homeChips .chip').forEach(x=>x.classList.remove('active'));
    ch.classList.add('active');
    renderHome(ch.dataset.filter, $('#q').value||'');
  });

  $$('.chipbar [data-pay]').forEach(ch=>ch.onclick=()=>{
    $$('.chipbar [data-pay]').forEach(x=>x.classList.remove('active'));
    ch.classList.add('active');
    $('#cardFields').style.display= ch.dataset.pay==='card' ? 'block':'none';
  });

  /* ===== ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ÙŠ ===== */
  renderHome('all','');
  show('home');
  $('#count').textContent = 0;

})();
</script>
</body>
</html>
