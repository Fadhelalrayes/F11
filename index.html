<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>توصيات البورصة — مباشر</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">

<style>
  :root{
    --gold:#D4AF37; --gold-2:#C9A227;
    --bg:#ffffff; --bg-soft:#faf8f3;
    --text:#161616; --muted:#6b7280;
    --card:#ffffff; --border:#e9e9ef;
    --pos:#0a7a2f; --neg:#b11a1a;
    --shadow:0 8px 24px rgba(0,0,0,.08);
    --radius:16px;
  }
  @media (prefers-color-scheme: dark){
    :root{ --bg:#0c0c0e; --bg-soft:#131318; --text:#f5f5f5; --card:#141419; --border:#292933; --shadow:0 10px 30px rgba(0,0,0,.35); }
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;background:var(--bg);color:var(--text);
    font-family:"Cairo","Tajawal","Noto Kufi Arabic",system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
    line-height:1.65;
  }
  .container{max-width:1160px;margin:0 auto;padding:12px}
  header{
    position:sticky;top:0;z-index:80;
    background:linear-gradient(180deg,rgba(212,175,55,.08),transparent),var(--bg);
    border-bottom:1px solid var(--border);
    backdrop-filter:blur(6px) saturate(130%);
  }
  .topbar{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:8px 0}
  .brand{display:flex;align-items:center;gap:10px;font-weight:900;font-size:20px}
  .logo{width:28px;height:28px;border-radius:8px;background:conic-gradient(from 0deg,var(--gold),var(--gold-2),var(--gold))}
  .meta{font-size:13px;color:var(--muted)}
  .newsbar{display:none;overflow:hidden;border-top:1px solid var(--border);border-bottom:1px solid var(--border);background:var(--bg-soft)}
  .news-track{display:flex;gap:28px;white-space:nowrap;animation:scroll 26s linear infinite;padding:8px 4px}
  .news-item{flex:0 0 auto;padding:6px 12px;border:1px solid var(--border);border-radius:999px;background:var(--card);font-size:13px;font-weight:700}
  @keyframes scroll{0%{transform:translateX(0)}100%{transform:translateX(-50%)}}

  main{padding:12px}
  .grid{display:grid;gap:14px}
  .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden}
  .head{padding:12px 14px;border-bottom:1px solid var(--border);font-weight:800;background:linear-gradient(180deg,rgba(212,175,55,.10),transparent)}
  .body{padding:12px}
  table{width:100%;border-collapse:collapse}
  th,td{padding:10px;border-bottom:1px solid var(--border);text-align:center;font-size:14px}
  th{font-size:12px;color:var(--muted)}
  tr:hover td{background:rgba(212,175,55,.06)}
  .pill{display:inline-block;padding:4px 10px;border-radius:999px;font-size:12px;font-weight:800;border:1px solid var(--border)}
  .bull{background:#e6f8ec;color:var(--pos)}
  .bear{background:#fde8e8;color:#b11a1a}
  .neutral{background:#f1f1f1;color:#555}
  .alert{border:1px solid var(--border);border-radius:12px;padding:10px;margin-bottom:10px;background:var(--bg-soft);display:flex;align-items:center;gap:8px;justify-content:space-between}
  .empty{text-align:center;color:var(--muted);padding:12px}

  /* سهم/مؤشر مصغّر */
  .sigwrap{display:flex;align-items:center;justify-content:center;gap:8px}
  .sigbox{display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;border-radius:6px;border:1px solid var(--border);box-shadow:var(--shadow);position:relative;overflow:hidden}
  .sig-bull{background:#e6f8ec}
  .sig-bear{background:#fde8e8}
  .sig-neutral{background:#f1f1f1}
  .sigbox svg{display:block}
  .sigbox.fallback{font-weight:900;color:#333}

  /* نصائح التداول */
  .tips{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:14px;margin-top:6px}

  /* قائمة مواقع التداول */
  .links-card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:14px}
  .select-wrap{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .select-wrap select{padding:10px 12px;border:1px solid var(--border);border-radius:10px;background:var(--bg-soft);font-family:inherit}
  .select-wrap a{padding:10px 12px;border:1px solid var(--border);border-radius:10px;text-decoration:none}
  .select-wrap a:hover{background:rgba(212,175,55,.10)}

  footer{margin-top:16px;padding:18px;border-top:1px solid var(--border);text-align:center;color:var(--muted);font-size:13px}
</style>
</head>
<body>

<header>
  <div class="container topbar">
    <div class="brand"><div class="logo"></div>توصيات البورصة</div>
    <div class="meta">آخر تحديث: <span id="lastUpdated">—:—:—</span></div>
  </div>
  <div class="newsbar" id="newsbar">
    <div id="newsScroller" class="news-track"></div>
  </div>
</header>

<main class="container grid">
  <section class="card">
    <div class="head">الأسعار الحالية</div>
    <div class="body">
      <table>
        <thead><tr><th>الأصل</th><th>السعر</th><th>التغير %</th><th>الحجم</th></tr></thead>
        <tbody id="pricesTbody"><tr><td colspan="4" class="empty">جاري التحميل…</td></tr></tbody>
      </table>
    </div>
  </section>

  <section class="card">
    <div class="head">التنبؤات</div>
    <div class="body">
      <table>
        <thead><tr><th>الأصل</th><th>5د</th><th>1س</th><th>1ي</th><th>الثقة</th><th>الإشارة</th></tr></thead>
        <tbody id="forecastTbody"><tr><td colspan="6" class="empty">جاري التحميل…</td></tr></tbody>
      </table>
    </div>
  </section>

  <section class="card" id="card-buy" style="display:none">
    <div class="head">الأسهم الموصى بشرائها</div>
    <div class="body" id="buyList"></div>
  </section>

  <section class="card" id="card-sell" style="display:none">
    <div class="head">الأسهم الموصى ببيعها</div>
    <div class="body" id="sellList"></div>
  </section>

  <section class="card" id="card-alerts">
    <div class="head">التنبيهات</div>
    <div class="body" id="alertsList"><div class="empty">لا توجد تنبيهات حاليًا</div></div>
  </section>

  <section class="tips" id="tipsBox">
    <h3 style="margin:0 0 8px;font-weight:900">نصيحة تداول مثبتة</h3>
    <p id="tipOfTheDay" style="margin:0;padding:10px;border:1px dashed var(--border);border-radius:12px;background:var(--bg-soft)">…</p>
  </section>

  <section class="links-card">
    <h3 style="margin:0 0 8px;font-weight:900">مواقع تداول عالمية</h3>
    <div class="select-wrap">
      <select id="siteSelect" aria-label="اختر موقع تداول">
        <option value="" selected disabled>اختر موقعًا</option>
        <option value="https://www.interactivebrokers.com/">Interactive Brokers</option>
        <option value="https://www.saxobank.com/">Saxo Bank</option>
        <option value="https://www.ig.com/">IG</option>
        <option value="https://www.cmcmarkets.com/">CMC Markets</option>
        <option value="https://www.etoro.com/">eToro</option>
        <option value="https://www.plus500.com/">Plus500</option>
        <option value="https://www.xtb.com/">XTB</option>
        <option value="https://www.avatrade.com/">AvaTrade</option>
        <option value="https://www.fidelity.com/">Fidelity</option>
        <option value="https://www.schwab.com/">Charles Schwab</option>
        <option value="https://www.tdameritrade.com/">TD Ameritrade</option>
        <option value="https://www.robinhood.com/">Robinhood</option>
      </select>
      <a id="openSite" href="#" target="_blank" rel="noopener" style="color:var(--text)">فتح الموقع</a>
    </div>
  </section>
</main>

<footer>
  برمجة وتطوير فاضل الريس
</footer>

<script>
document.addEventListener('DOMContentLoaded', () => {
  /* ================== إعدادات ================== */
  const CONFIG = {
    CRYPTO_WS: ["btcusdt","ethusdt","solusdt","bnbusdt","xrpusdt"],
    STOOQ_F: (s) => `https://stooq.com/q/l/?s=${encodeURIComponent(s)}&f=sd2t2ohlcv&h&e=csv`,
    // قوائم Stooq
    COMMODITIES: [
      {stooq:'gc.f',  symbol:'XAUUSD'},   // Gold Futures
      {stooq:'si.f',  symbol:'XAGUSD'},   // Silver Futures
      {stooq:'cl.f',  symbol:'WTIUSD'},   // WTI
      {stooq:'br.f',  symbol:'BRENTUSD'}, // Brent
      {stooq:'ng.f',  symbol:'NGUSD'}     // Natural Gas
    ],
    STOCKS: [
      {stooq:'aapl.us',  symbol:'AAPL'},
      {stooq:'msft.us',  symbol:'MSFT'},
      {stooq:'tsla.us',  symbol:'TSLA'},
      {stooq:'amzn.us',  symbol:'AMZN'},
      {stooq:'nvda.us',  symbol:'NVDA'},
      {stooq:'googl.us', symbol:'GOOGL'},
      {stooq:'meta.us',  symbol:'META'}
    ],
    FX_PRIMARY:  "https://open.er-api.com/v6/latest/USD",
    FX_FALLBACK: "https://api.frankfurter.app/latest?from=USD",
    NEWS: [
      "https://api.allorigins.win/raw?url=https%3A%2F%2Fwww.cnbcarabia.com%2Frss%2Flatest",
      "https://api.allorigins.win/raw?url=https%3A%2F%2Fwww.asharqbusiness.com%2Far%2Frss",
      "https://api.allorigins.win/raw?url=https%3A%2F%2Fwww.mubasher.info%2Frss%2Fnews%2Fall",
      "https://api.allorigins.win/raw?url=https%3A%2F%2Fwww.alarabiya.net%2Ftools%2Frss%3Fcat%3Daswaq"
    ],
    REFRESH_MS: 15000,
    NEWS_REFRESH_MS: 120000,
    NEWS_LIMIT: 30
  };

  /* ================== أدوات ================== */
  const $ = s => document.querySelector(s);
  function fmt(n,d=2){ if(n==null||Number.isNaN(n)) return "—"; return Number(n).toLocaleString('en-US',{maximumFractionDigits:d}); }
  function now(){ const d=new Date(),p=n=>String(n).padStart(2,"0"); $("#lastUpdated").textContent = `${p(d.getHours())}:${p(d.getMinutes())}:${p(d.getSeconds())}`; }

  // fetch نص/CSV مع بروكسي AllOrigins احتياطيًا لتفادي CORS
  async function fetchText(url, timeout=9000){
    const ctrl=new AbortController(); const t=setTimeout(()=>ctrl.abort(),timeout);
    try{ const r=await fetch(url,{signal:ctrl.signal,headers:{'Cache-Control':'no-cache'}}); if(!r.ok) throw new Error(r.status); return await r.text(); }
    finally{ clearTimeout(t); }
  }
  async function fetchTextWithProxy(url){
    try{ return await fetchText(url); }
    catch(_){
      const prox = `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`;
      return await fetchText(prox);
    }
  }

  function arabicName(symbol){
    const map = {
      "BTCUSD":"بيتكوين/دولار","ETHUSD":"إيثريوم/دولار","SOLUSD":"سولانا/دولار","BNBUSD":"بي إن بي/دولار","XRPUSD":"ريبل/دولار",
      "EURUSD":"يورو/دولار","USDJPY":"دولار/ين","USDBHD":"دولار/دينار بحريني","USDSAR":"دولار/ريال سعودي",
      "USDAED":"دولار/درهم إماراتي","GBPUSD":"جنيه/دولار","USDTRY":"دولار/ليرة تركية",
      "XAUUSD":"ذهب/دولار","XAGUSD":"فضة/دولار",
      "WTIUSD":"نفط خام WTI/دولار","BRENTUSD":"نفط برنت/دولار","NGUSD":"غاز طبيعي/دولار",
      "AAPL":"آبل","MSFT":"مايكروسوفت","TSLA":"تسلا","AMZN":"أمازون","NVDA":"إنفيديا","GOOGL":"ألفابت (جوجل)","META":"ميتا"
    };
    return map[symbol] || symbol;
  }

  /* ================== حالة ================== */
  let CRYPTO = {}; // {symbol,last,change,vol}
  let FX = [];
  let COMM = [];
  let STOCKS = [];

  /* ================== WebSocket: Binance (كريبتو) ================== */
  (function openCryptoStream(){
    try{
      const streams = CONFIG.CRYPTO_WS.map(s=>`${s}@ticker`).join('/');
      const ws = new WebSocket(`wss://stream.binance.com:9443/stream?streams=${streams}`);
      ws.onmessage = ev => {
        try{
          const {data:t} = JSON.parse(ev.data);
          const sym = (t.s||"").replace("USDT","USD");
          CRYPTO[sym] = { symbol:sym, last:+t.c, change:+t.P, vol:+t.v };
          renderAll();
        }catch(_){}
      };
      ws.onclose = () => setTimeout(openCryptoStream, 2000);
    }catch(_){}
  })();

  /* ================== فوركس ================== */
  async function loadFXPrimary(){
    try{
      const txt = await fetchTextWithProxy(`${CONFIG.FX_PRIMARY}?_=${Date.now()}`);
      const d = JSON.parse(txt);
      if(d.result!=="success") throw 0;
      const r=d.rates||{}, out=[];
      const push=(k,v)=>out.push({symbol:k,last:+v,change:0,vol:0});
      if(r.EUR) push("EURUSD",1/r.EUR);
      if(r.JPY) push("USDJPY",r.JPY);
      if(r.BHD) push("USDBHD",r.BHD);
      if(r.SAR) push("USDSAR",r.SAR);
      if(r.AED) push("USDAED",r.AED);
      if(r.GBP) push("GBPUSD",1/r.GBP);
      if(r.TRY) push("USDTRY",r.TRY);
      return out;
    }catch(e){ return null; }
  }
  async function loadFXFallback(){
    try{
      const txt = await fetchTextWithProxy(`${CONFIG.FX_FALLBACK}?_=${Date.now()}`);
      const d = JSON.parse(txt);
      const r=d.rates||{}, out=[];
      const push=(k,v)=>out.push({symbol:k,last:+v,change:0,vol:0});
      if(r.EUR) push("EURUSD",1/r.EUR);
      if(r.JPY) push("USDJPY",r.JPY);
      if(r.GBP) push("GBPUSD",1/r.GBP);
      if(r.TRY) push("USDTRY",r.TRY);
      return out;
    }catch(e){ return []; }
  }

  /* ================== Stooq CSV parsing ================== */
  // Header: Symbol,Date,Time,Open,High,Low,Close,Volume
  function parseStooqCSV(csv){
    const lines = (csv||"").trim().split(/\r?\n/);
    if(lines.length<2) return null;
    const parts = lines[1].split(',');
    const rec = {
      open: parts[3] ? +parts[3] : null,
      close: parts[6] ? +parts[6] : null,
      volume: parts[7] ? +parts[7] : 0
    };
    if(!rec.close || !rec.open) return null;
    rec.change = (rec.close - rec.open)/rec.open * 100;
    return rec;
  }

  async function loadStooqItem(stooqSym, mappedSymbol){
    try{
      const csv = await fetchTextWithProxy(CONFIG.STOOQ_F(stooqSym));
      const rec = parseStooqCSV(csv);
      if(rec){
        return {symbol:mappedSymbol, last:rec.close, change:rec.change, vol:rec.volume};
      }
    }catch(_){}
    return null;
  }

  async function loadListStooq(list){
    const out=[];
    await Promise.all(list.map(async item=>{
      const r = await loadStooqItem(item.stooq, item.symbol);
      if(r) out.push(r);
    }));
    return out;
  }

  /* ================== اشتقاقات ================== */
  function buildForecastRows(list){
    return list.map(p=>{
      const m=(p.change||0)/100;
      const conf=Math.min(0.9,Math.max(0.35,Math.abs(m)*3.5));
      const sig=m>0.003?"bull":m<-0.003?"bear":"neutral";
      return {symbol:p.symbol, f5:p.last*(1+m*0.2), f1h:p.last*(1+m*0.6), f1d:p.last*(1+m*1.2), conf:Math.round(conf*100), sig};
    });
  }
  function buildRecommendations(list){
    const buy=[],sell=[];
    for(const p of list){ if(p.change>=1.5) buy.push(p); if(p.change<=-1.5) sell.push(p); }
    return {buy,sell};
  }
  function buildAlerts(list){
    // تنبيه عند |التغير| >= 3% (يوجد اتجاه واضح)
    return list.filter(p=>p.change!=null && Math.abs(p.change)>=3).map(p=>({
      symbol:p.symbol, change:p.change, dir: p.change>=0?'bull':'bear'
    }));
  }

  /* ================== أخبار عربية (سوق الأسهم فقط) ================== */
  const NEWS_KEYWORDS = /(بورصة|تداول|سوق(?:\s*الأسهم)?|الأسهم|أسهم|مؤشر|السندات|اكتتاب|قيد|طرح|صندوق|محفظة|توزيعات|سيولة|متداولين|إغلاق|جلسة|ارتفاع|انخفاض)/i;
  function parseRSS(xml){
    const out=[]; try{
      const doc=new DOMParser().parseFromString(xml,"text/xml");
      const items=[...doc.querySelectorAll("item > title, entry > title")].map(n=>(n.textContent||"").trim()).filter(Boolean);
      for(const t of items){ if(NEWS_KEYWORDS.test(t)) out.push(t); }
    }catch(_){}
    return out;
  }
  async function loadNews(){
    const titles=[]; const seen=new Set();
    for(const url of CONFIG.NEWS){
      try{
        const txt=await fetchTextWithProxy(url);
        const arr=parseRSS(txt);
        for(const t of arr){ if(!seen.has(t) && titles.length<CONFIG.NEWS_LIMIT){ seen.add(t); titles.push(t); } }
      }catch(_){}
    }
    const bar=$("#newsbar"), track=$("#newsScroller");
    if(!titles.length){ bar.style.display="none"; track.innerHTML=""; return; }
    bar.style.display="block"; track.innerHTML="";
    const dup=titles.concat(titles);
    for(const t of dup){
      const d=document.createElement("div"); d.className="news-item"; d.textContent=t; track.appendChild(d);
    }
  }

  /* ===== SVG arrows (برمجي) ===== */
  function makeSvg(tag){ return document.createElementNS('http://www.w3.org/2000/svg', tag); }
  function arrowUpSVG(){
    const s=makeSvg('svg'); s.setAttribute('width','16'); s.setAttribute('height','16'); s.setAttribute('viewBox','0 0 24 24');
    const p=makeSvg('path'); p.setAttribute('d','M12 4l6 6h-4v10h-4V10H6z'); p.setAttribute('fill','#0a7a2f'); s.appendChild(p); return s;
  }
  function arrowDownSVG(){
    const s=makeSvg('svg'); s.setAttribute('width','16'); s.setAttribute('height','16'); s.setAttribute('viewBox','0 0 24 24');
    const p=makeSvg('path'); p.setAttribute('d','M12 20l-6-6h4V4h4v10h4z'); p.setAttribute('fill','#b11a1a'); s.appendChild(p); return s;
  }
  function arrowFlatSVG(){
    const s=makeSvg('svg'); s.setAttribute('width','16'); s.setAttribute('height','16'); s.setAttribute('viewBox','0 0 24 24');
    const r=makeSvg('rect'); r.setAttribute('x','4'); r.setAttribute('y','11'); r.setAttribute('width','16'); r.setAttribute('height','2'); r.setAttribute('fill','#555'); s.appendChild(r); return s;
  }

  /* ================== العرض ================== */
  function renderPrices(list){
    const tb=$("#pricesTbody"); tb.innerHTML="";
    if(!list.length){ tb.innerHTML='<tr><td colspan="4" class="empty">لا توجد بيانات متاحة حاليًا</td></tr>'; return; }
    for(const p of list){
      const tr=document.createElement("tr");
      const digits = p.symbol.endsWith("USD")
        ? (p.symbol.startsWith("USD")?5 : (p.symbol==='USDJPY'?3:2))
        : 4;
      tr.innerHTML = `
        <td><b>${arabicName(p.symbol)}</b></td>
        <td>${fmt(p.last,digits)}</td>
        <td style="font-weight:800;color:${p.change>=0?'#0a7a2f':'#b11a1a'}">${p.change>=0?'↑':'↓'} ${fmt(Math.abs(p.change),2)}%</td>
        <td>${fmt(p.vol,0)}</td>`;
      tb.appendChild(tr);
    }
  }

  function renderForecast(list){
    const tb=$("#forecastTbody"); tb.innerHTML="";
    if(!list.length){ tb.innerHTML='<tr><td colspan="6" class="empty">لا توجد بيانات متاحة حاليًا</td></tr>'; return; }
    for(const f of buildForecastRows(list)){
      let label="", boxClass="", svgEl=null, pillCls="";
      if(f.sig==="bull"){ label="يرتفع"; boxClass="sig-bull"; svgEl=arrowUpSVG(); pillCls="bull"; }
      else if(f.sig==="bear"){ label="ينخفض"; boxClass="sig-bear"; svgEl=arrowDownSVG(); pillCls="bear"; }
      else { label="مستقر"; boxClass="sig-neutral"; svgEl=arrowFlatSVG(); pillCls="neutral"; }

      const box = document.createElement('span');
      box.className = `sigbox ${boxClass}`;
      box.setAttribute('aria-label', label);
      box.setAttribute('title', label);
      if(svgEl){ box.appendChild(svgEl); } else { box.classList.add('fallback'); box.textContent = (pillCls==="bull"?"▲":pillCls==="bear"?"▼":"↔"); }

      const pill = document.createElement('span');
      pill.className = `pill ${pillCls}`;
      pill.textContent = label;

      const wrap = document.createElement('div');
      wrap.className = 'sigwrap';
      wrap.appendChild(box);
      wrap.appendChild(pill);

      const tr=document.createElement("tr");
      tr.innerHTML=`
        <td><b>${arabicName(f.symbol)}</b></td>
        <td>${fmt(f.f5,2)}</td>
        <td>${fmt(f.f1h,2)}</td>
        <td>${fmt(f.f1d,2)}</td>
        <td>${f.conf}%</td>`;
      const td = document.createElement('td');
      td.appendChild(wrap);
      tr.appendChild(td);
      tb.appendChild(tr);
    }
  }

  function renderRecommendations(list){
    const {buy,sell}=buildRecommendations(list);
    const b=$("#buyList"), s=$("#sellList");
    const cb=$("#card-buy"), cs=$("#card-sell");

    b.innerHTML="";
    if(!buy.length){ cb.style.display="none"; }
    else {
      cb.style.display="block";
      for(const r of buy){
        const d=document.createElement("div");
        d.className="alert";
        d.innerHTML=`<span><b>${arabicName(r.symbol)}</b> — إشارة شراء (زخم إيجابي)</span>`;
        const sig = document.createElement('span'); sig.className='sigbox sig-bull'; sig.appendChild(arrowUpSVG());
        d.appendChild(sig);
        b.appendChild(d);
      }
    }

    s.innerHTML="";
    if(!sell.length){ cs.style.display="none"; }
    else {
      cs.style.display="block";
      for(const r of sell){
        const d=document.createElement("div");
        d.className="alert";
        d.innerHTML=`<span><b>${arabicName(r.symbol)}</b> — إشارة بيع (زخم سلبي)</span>`;
        const sig = document.createElement('span'); sig.className='sigbox sig-bear'; sig.appendChild(arrowDownSVG());
        d.appendChild(sig);
        s.appendChild(d);
      }
    }
  }

  function renderAlerts(list){
    const arr=buildAlerts(list), a=$("#alertsList"); a.innerHTML="";
    if(!arr.length){ a.innerHTML='<div class="empty">لا توجد تنبيهات حاليًا</div>'; return; }
    for(const x of arr){
      const row=document.createElement("div"); row.className="alert";
      const left = document.createElement('span');
      left.innerHTML = `<b>${arabicName(x.symbol)}</b> — ${x.change>=0?'ارتفع':'انخفض'} ${fmt(Math.abs(x.change),2)}%`;
      const sig = document.createElement('span');
      sig.className = `sigbox ${x.dir==='bull'?'sig-bull':'sig-bear'}`;
      sig.appendChild(x.dir==='bull'?arrowUpSVG():arrowDownSVG());
      row.appendChild(left);
      row.appendChild(sig);
      a.appendChild(row);
    }
  }

  function renderAll(){
    const combined = Object.values(CRYPTO).concat(FX).concat(COMM).concat(STOCKS);
    renderPrices(combined);
    renderForecast(combined);
    renderRecommendations(combined);
    renderAlerts(combined);
    now();
  }

  /* ================== نصائح التداول (30 نصيحة) ================== */
  const TIPS_POOL = [
    "ضع خطة مكتوبة للدخول والخروج وإدارة المخاطر قبل فتح الصفقة.",
    "لا تخاطر بأكثر من 1–2% من رأس المال في صفقة واحدة.",
    "استخدم أوامر وقف الخسارة دائمًا واحترمها.",
    "جمّد عواطفك: لا تدع الخوف أو الطمع يقودان قرارك.",
    "التزم بإستراتيجية مجرَّبة ولا تغيّرها بعد كل صفقة.",
    "قيّم الصفقات على سلسلة نتائج، لا على صفقة منفردة.",
    "تداول مع الاتجاه العام بدلًا من مصارعة السوق.",
    "لا تُطارد الحركة بعد فواتها؛ انتظر إعادة اختبار منطقية.",
    "نوّع محفظتك ولا تركّز كل المخاطر في أصل واحد.",
    "احسب العائد إلى المخاطرة قبل الدخول (مثلاً 1:2 على الأقل).",
    "تجنّب الإفراط في التداول؛ الجودة أهم من الكثرة.",
    "تاجر بأموال يمكنك تحمل خسارتها دون ضغط نفسي.",
    "استخدم أحجام صفقة ثابتة ومنضبطة.",
    "دوّن أسباب الدخول والخروج وتعلّم من المراجعة الدورية.",
    "لا تتداول وقت الأخبار عالية التقلّب دون خطة واضحة.",
    "احذر من مضاعفة الحجم لتعويض الخسائر.",
    "راقب السيولة والسبريد قبل التنفيذ.",
    "اختبر الاستراتيجية تاريخيًا وعلى حساب تجريبي أولًا.",
    "لا تدع صفقة رابحة تتحول إلى خاسرة—حرّك الوقف بحكمة.",
    "احترم مستويات الدعم والمقاومة على الأطر الزمنية الأكبر.",
    "اتبع إشارة واحدة واضحة بدل تكديس مؤشرات كثيرة.",
    "تذكّر أن عدم الدخول قرار تداول أيضًا.",
    "اعرف ما تتداول: العوامل المؤثرة والمخاطر الخاصة بالأصل.",
    "اضبط توقيتك مع جلسات السوق النشطة.",
    "لا تُهمل التكاليف: العمولات والانزلاق تؤثر على الأداء.",
    "تقبّل الخسارة الصغيرة سريعًا لتجنب الخسارة الكبيرة.",
    "لا تتداول بدافع الملل؛ انتظر فرصًا ذات ميزة واضحة.",
    "راجع الخطة عند تغيّر هيكل السوق، لا بعد كل تذبذب.",
    "تدرّج في زيادة الحجم بعد ثبات الأداء لا بعد صفقة واحدة.",
    "احمِ رأس المال أولًا—الفرص لا تنتهي."
  ];
  (function setPinnedTip(){
    const tip = TIPS_POOL[Math.floor(Math.random()*TIPS_POOL.length)];
    $("#tipOfTheDay").textContent = tip;
  })();

  /* ================== مواقع التداول (زر فتح) ================== */
  const siteSelect = $("#siteSelect");
  const openBtn = $("#openSite");
  openBtn.addEventListener('click', (e)=>{
    e.preventDefault();
    const url = siteSelect.value;
    if(url) window.open(url, '_blank', 'noopener');
  });

  /* ================== تشغيل ================== */
  (async function init(){
    // فوركس
    const pfx = await loadFXPrimary();
    FX = pfx ?? await loadFXFallback();

    // سلع وأسهم عبر Stooq (مع بروكسي احتياطي مضمّن)
    [COMM, STOCKS] = await Promise.all([
      loadListStooq(CONFIG.COMMODITIES),
      loadListStooq(CONFIG.STOCKS)
    ]);

    // أخبار عربية
    loadNews(); setInterval(loadNews, CONFIG.NEWS_REFRESH_MS);

    // عرض أولي وتحديثات
    renderAll();
    setInterval(renderAll, CONFIG.REFRESH_MS);

    // تحديث دوري أقل تكرارًا للسلع/الأسهم (كل ~دقيقة)
    setInterval(async ()=>{
      [COMM, STOCKS] = await Promise.all([
        loadListStooq(CONFIG.COMMODITIES),
        loadListStooq(CONFIG.STOCKS)
      ]);
      renderAll();
    }, CONFIG.REFRESH_MS * 4);
  })();
});
</script>
</body>
</html>
