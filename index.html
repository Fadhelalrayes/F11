<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <title>أدوات PDF عربية | تحويل (مع OCR)، ضغط، دمج، تقسيم — تعمل داخل المتصفح</title>
  <meta name="description" content="حوّل PDF إلى Word مع OCR العربي/الإنجليزي، واضغط وادمج وقسّم ملفات PDF — مباشرة داخل المتصفح بدون رفع ملفات. خصوصية كاملة وسرعة عالية." />
  <meta name="keywords" content="PDF, تحويل PDF, OCR عربي, OCR انجليزي, ضغط PDF, دمج PDF, تقسيم PDF, PDF إلى Word, أدوات PDF عربية" />
  <link rel="canonical" href="https://example.com/pdf-tools-ocr" />
  <meta name="robots" content="index,follow,max-image-preview:large" />
  <!-- Open Graph / Twitter -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="أدوات PDF عربية — تحويل مع OCR ودمج/تقسيم/ضغط" />
  <meta property="og:description" content="أدوات PDF مجانية تعمل داخل المتصفح مع OCR عربي/إنجليزي." />
  <meta property="og:locale" content="ar_AR" />
  <meta property="og:url" content="https://example.com/pdf-tools-ocr" />
  <meta property="og:site_name" content="أدوات PDF" />
  <meta name="twitter:card" content="summary" />

  <!-- JSON-LD (WebApp + FAQ) -->
  <script type="application/ld+json">
  {"@context":"https://schema.org","@type":"WebApplication","name":"أدوات PDF عربية (OCR)","operatingSystem":"Any","applicationCategory":"UtilitiesApplication","description":"تحويل/ضغط/دمج/تقسيم PDF داخل المتصفح مع OCR عربي/إنجليزي.","inLanguage":"ar","url":"https://example.com/pdf-tools-ocr","featureList":["تحويل PDF إلى Word (نصوص+OCR)","ضغط مبسّط","دمج PDF","تقسيم صفحات"],"offers":{"@type":"Offer","price":"0","priceCurrency":"USD"}}
  </script>
  <script type="application/ld+json">
  {"@context":"https://schema.org","@type":"FAQPage","mainEntity":[
    {"@type":"Question","name":"هل تُرفع ملفاتي للإنترنت؟","acceptedAnswer":{"@type":"Answer","text":"لا. تتم كل المعالجة محلياً داخل المتصفح."}},
    {"@type":"Question","name":"هل يدعم التحويل نصوص PDF المصوّرة؟","acceptedAnswer":{"@type":"Answer","text":"نعم. إذا لم يجد نصاً رقمياً سيستخدم OCR تلقائياً (عربي/إنجليزي حسب اختيارك)."}},
    {"@type":"Question","name":"هل يحافظ على التنسيق والجداول؟","acceptedAnswer":{"@type":"Answer","text":"التحويل يركّز على النصوص. التنسيقات/الجداول/الصور لا تُعاد بنسقها الأصلي."}}
  ]}
  </script>

  <!-- مكتبات (CDN) -->
  <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js" defer></script>
  <script src="https://unpkg.com/pdfjs-dist@4.10.38/build/pdf.min.js" defer></script>
  <script>window.__PDFJS_WORKER_SRC__="https://unpkg.com/pdfjs-dist@4.10.38/build/pdf.worker.min.js";</script>
  <script src="https://unpkg.com/docx@8.5.0/build/index.umd.js" defer></script>
  <!-- Tesseract.js (OCR) + تحميل لغات عند الطلب -->
  <script src="https://unpkg.com/tesseract.js@5.1.0/dist/tesseract.min.js" defer></script>

  <style>
    :root{--gold:#b8860b;--gold2:#d4af37;--text:#222;--muted:#666;--border:#e9e9e9;--bg:#fff;--card:#fafafa;--radius:14px}
    *{box-sizing:border-box}
    body{margin:0;font-family:Tahoma,Arial,sans-serif;color:var(--text);background:var(--bg);line-height:1.8}
    header{padding:28px 14px;text-align:center;border-bottom:2px solid #f0f0f0}
    header h1{margin:.2rem 0;color:var(--gold);font-size:2rem}
    header p{margin:0;color:var(--muted)}
    main{max-width:980px;margin:28px auto;padding:0 14px}
    .panel{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:16px;margin-bottom:16px}
    h2{color:var(--gold);margin-top:0;font-size:1.25rem}
    .grid{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(240px,1fr))}
    .tool-card{background:#fff;border:1px solid var(--border);border-radius:12px;padding:12px}
    label{font-weight:700}
    input[type=file],select,input[type=text],button{width:100%;padding:12px;border:1px solid #ccc;border-radius:10px;background:#fff;font-size:1rem}
    button{background:var(--gold);color:#fff;border:none;cursor:pointer;transition:.25s}
    button:hover{background:var(--gold2)}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .row>*{flex:1 1 220px}
    .muted{color:var(--muted)}
    .status{font-size:.95rem;margin-top:8px}
    .ok{color:#0a8f3c}.err{color:#c62828}
    .file-multi{border:1px dashed #ccc;padding:14px;border-radius:10px;background:#fff}
    progress{width:100%}
    footer{text-align:center;padding:16px;border-top:2px solid #f0f0f0;color:var(--muted)}
    .visually-hidden{position:absolute !important;height:1px;width:1px;overflow:hidden;clip:rect(1px,1px,1px,1px);white-space:nowrap;border:0;padding:0;margin:-1px}
  </style>
</head>
<body>
  <a class="visually-hidden" href="#tools">تخطي إلى المحتوى</a>
  <header>
    <h1>أدوات PDF عربية — تعمل داخل المتصفح (مع OCR)</h1>
    <p>تحويل (نصوص + OCR)، ضغط مبسّط، دمج، تقسيم — خصوصيتك أولاً</p>
  </header>

  <main id="tools">
    <section class="panel">
      <h2>اختر الخدمة</h2>
      <div class="grid" role="list">
        <div class="tool-card" role="listitem">
          <label><input type="radio" name="tool" value="toWord" checked> تحويل PDF إلى Word (نصوص + OCR)</label>
          <div class="muted">يستخرج نصاً رقمياً أولاً؛ وإن لم يجد يستخدم OCR تلقائياً.</div>
          <div class="row" style="margin-top:8px">
            <div>
              <label for="ocrLang">لغة OCR</label>
              <select id="ocrLang">
                <option value="ara+eng">عربي + إنجليزي (افتراضي)</option>
                <option value="ara">عربي فقط</option>
                <option value="eng">إنجليزي فقط</option>
              </select>
            </div>
            <div>
              <label for="ocrHint">تلميح الجودة (اختياري)</label>
              <select id="ocrHint">
                <option value="">افتراضي</option>
                <option value="fast">سريع</option>
                <option value="accurate">دقة أعلى</option>
              </select>
            </div>
          </div>
          <div class="muted">ملاحظة: تحميل حزم OCR يتم من CDN عند أول استخدام وقد يستغرق لحظات.</div>
        </div>
        <div class="tool-card" role="listitem">
          <label><input type="radio" name="tool" value="compress"> ضغط PDF (مبسّط)</label>
          <div class="muted">إعادة حفظ وتنظيف بيانات التعريف — تقليل الحجم محدود.</div>
        </div>
        <div class="tool-card" role="listitem">
          <label><input type="radio" name="tool" value="merge"> دمج ملفات PDF</label>
          <div class="muted">اختر عدة ملفات وسيتم دمجها بالترتيب.</div>
        </div>
        <div class="tool-card" role="listitem">
          <label><input type="radio" name="tool" value="split"> تقسيم PDF بنطاقات صفحات</label>
          <div class="muted">مثال: 1-3,5,8-10</div>
        </div>
      </div>
    </section>

    <section class="panel">
      <h2>الملفات والإعدادات</h2>

      <div id="singleWrap">
        <label for="single">اختر ملف PDF</label>
        <input id="single" type="file" accept="application/pdf" />
      </div>

      <div id="multiWrap" style="display:none">
        <label for="multi">اختر ملفات PDF للدمج</label>
        <input id="multi" class="file-multi" type="file" accept="application/pdf" multiple />
        <div id="order" class="muted" aria-live="polite"></div>
      </div>

      <div id="rangesWrap" style="display:none">
        <label for="ranges">نطاقات الصفحات</label>
        <input id="ranges" type="text" placeholder="مثال: 1-3,5,8-10" />
      </div>

      <div class="row" style="margin-top:8px">
        <button id="run">تنفيذ الآن</button>
        <button id="reset" type="button" style="background:#999">تفريغ</button>
      </div>
      <div class="status muted" id="status" aria-live="polite">جاهز.</div>
      <progress id="prog" max="100" value="0" style="display:none" aria-label="تقدم المعالجة"></progress>
    </section>

    <section class="panel">
      <h2>لماذا هذا الحل؟</h2>
      <p>كل شيء يتم محلياً داخل متصفحك لضمان الخصوصية والسرعة. يدعم التحويل باستخدام OCR للملفات المصوّرة، إلى جانب أدوات دمج وتقسيم وضغط مبسّط.</p>
    </section>
  </main>

  <footer>© 2025 جميع الحقوق محفوظة — أدوات PDF عربية تعمل داخل المتصفح</footer>
  <noscript>الرجاء تفعيل JavaScript لاستخدام أدوات PDF.</noscript>

  <script>
    // تهيئة pdf.js
    document.addEventListener('DOMContentLoaded', () => {
      if (window.pdfjsLib) {
        pdfjsLib.GlobalWorkerOptions.workerSrc = window.__PDFJS_WORKER_SRC__;
      }
    });

    // عناصر الواجهة
    const radios = document.querySelectorAll('input[name="tool"]');
    const singleWrap = document.getElementById('singleWrap');
    const multiWrap  = document.getElementById('multiWrap');
    const rangesWrap = document.getElementById('rangesWrap');

    const single = document.getElementById('single');
    const multi  = document.getElementById('multi');
    const ranges = document.getElementById('ranges');

    const ocrLangSel = document.getElementById('ocrLang');
    const ocrHintSel = document.getElementById('ocrHint');

    const runBtn = document.getElementById('run');
    const resetBtn = document.getElementById('reset');
    const statusEl = document.getElementById('status');
    const prog = document.getElementById('prog');
    const orderEl = document.getElementById('order');

    function currentTool(){ return [...radios].find(r=>r.checked)?.value || 'toWord'; }
    function setStatus(msg, cls='muted'){ statusEl.className='status '+cls; statusEl.textContent=msg; }
    function updateUI(){
      const t=currentTool();
      singleWrap.style.display = (t==='toWord'||t==='compress'||t==='split') ? '' : 'none';
      multiWrap.style.display  = (t==='merge') ? '' : 'none';
      rangesWrap.style.display = (t==='split') ? '' : 'none';
      setStatus('جاهز.','muted'); prog.style.display='none'; prog.value=0;
    }
    radios.forEach(r=>r.addEventListener('change',updateUI)); updateUI();

    multi.addEventListener('change',()=>{
      if(!multi.files?.length){orderEl.textContent='';return;}
      orderEl.textContent='الترتيب:\n'+[...multi.files].map((f,i)=>`${i+1}. ${f.name}`).join('\n');
    });

    function downloadBlob(blob, filename){
      const url = URL.createObjectURL(blob); const a = document.createElement('a');
      a.href = url; a.download = filename; document.body.appendChild(a); a.click(); a.remove();
      URL.revokeObjectURL(url);
    }

    function parseRanges(spec){
      const out=new Set();
      (spec||'').split(',').map(s=>s.trim()).filter(Boolean).forEach(p=>{
        if(/^\d+$/.test(p)) out.add(+p);
        else{
          const m=p.match(/^(\d+)\s*-\s*(\d+)$/);
          if(m){ let a=+m[1], b=+m[2]; if(a>b)[a,b]=[b,a]; for(let i=a;i<=b;i++) out.add(i); }
        }
      });
      return [...out].sort((a,b)=>a-b);
    }

    async function extractTextPdfJs(arrayBuf){
      // استخراج نص رقمي (إن وجد) عبر pdf.js
      const pdf = await pdfjsLib.getDocument({ data: arrayBuf }).promise;
      const parts=[];
      for(let i=1;i<=pdf.numPages;i++){
        const page = await pdf.getPage(i);
        const content = await page.getTextContent();
        const text = content.items.map(it => it.str).join(' ').trim();
        parts.push({page:i,text});
      }
      return parts;
    }

    async function renderPageToImage(page){
      // تحويل صفحة PDF إلى صورة (Canvas → PNG Blob) لاستخدامها مع OCR
      const viewport = page.getViewport({ scale: 2 }); // جودة أعلى لـ OCR
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      canvas.width = viewport.width; canvas.height = viewport.height;
      await page.render({ canvasContext: ctx, viewport }).promise;
      return new Promise(resolve => canvas.toBlob(b => resolve(b), 'image/png'));
    }

    async function extractTextOCR(arrayBuf, langs, hint, progressCb){
      // OCR كامل للملف: يرسم كل صفحة كصورة ويعالجها بـ Tesseract
      const pdf = await pdfjsLib.getDocument({ data: arrayBuf }).promise;
      const results = [];
      const worker = await Tesseract.createWorker(langs, 1, {
        logger: m => { if(progressCb && m.status) progressCb(m); }
      });
      if(hint==='fast'){ await worker.setParameters({ tessedit_pageseg_mode: 6 }); }
      if(hint==='accurate'){ await worker.setParameters({ tessedit_char_blacklist: '', preserve_interword_spaces: '1' }); }

      for(let i=1;i<=pdf.numPages;i++){
        const page = await pdf.getPage(i);
        const imgBlob = await renderPageToImage(page);
        const { data: { text } } = await worker.recognize(imgBlob);
        results.push({page:i,text:(text||'').trim()});
      }
      await worker.terminate();
      return results;
    }

    async function toDocx(paragraphs, originalName){
      const { Document, Packer, Paragraph, HeadingLevel, TextRun } = docx;
      const doc = new Document({
        sections:[{
          properties:{},
          children:[
            new Paragraph({ text:`تحويل PDF إلى Word — ${originalName}`, heading: HeadingLevel.HEADING_1 }),
            new Paragraph(''),
            ...paragraphs.flatMap(p => [
              new Paragraph({ children:[ new TextRun({ text:`صفحة ${p.page}:`, bold:true }) ] }),
              new Paragraph({ children:[ new TextRun({ text: p.text || '' }) ] }),
              new Paragraph('')
            ])
          ]
        }]
      });
      return await Packer.toBlob(doc);
    }

    runBtn.addEventListener('click', async ()=>{
      try{
        const tool = currentTool();

        // دمج
        if(tool==='merge'){
          if(!multi.files?.length) return setStatus('اختر ملفات للدمج.','err');
          setStatus('جاري الدمج...','muted');
          const { PDFDocument } = PDFLib;
          const outPdf = await PDFDocument.create();
          for(const f of multi.files){
            const buf = await f.arrayBuffer();
            const src = await PDFDocument.load(buf);
            const pages = await outPdf.copyPages(src, src.getPageIndices());
            pages.forEach(p=>outPdf.addPage(p));
          }
          const bytes = await outPdf.save({ useObjectStreams:true });
          downloadBlob(new Blob([bytes],{type:'application/pdf'}),'merged.pdf');
          setStatus('تم الدمج ✅','ok');
          return;
        }

        // بقية الأدوات تحتاج ملف واحد
        const file = single.files?.[0];
        if(!file) return setStatus('اختر ملف PDF.','err');
        const arrayBuf = await file.arrayBuffer();

        // ضغط مبسّط
        if(tool==='compress'){
          setStatus('جاري الضغط المبسّط...','muted');
          const { PDFDocument } = PDFLib;
          const doc = await PDFDocument.load(arrayBuf,{ updateMetadata:false });
          doc.setTitle(''); doc.setAuthor(''); doc.setSubject('');
          doc.setKeywords([]); doc.setProducer(''); doc.setCreator('');
          doc.setCreationDate(undefined); doc.setModificationDate(undefined);
          const bytes = await doc.save({ useObjectStreams:true });
          downloadBlob(new Blob([bytes],{type:'application/pdf'}), `compressed_${file.name}`);
          setStatus('تم الضغط (مبسّط) ✅','ok');
          return;
        }

        // تقسيم
        if(tool==='split'){
          const spec = ranges.value.trim();
          if(!spec) return setStatus('أدخل نطاقات صفحات.','err');
          setStatus('جاري التقسيم...','muted');
          const wanted = (function(spec){
            const out=new Set();
            (spec||'').split(',').map(s=>s.trim()).filter(Boolean).forEach(p=>{
              if(/^\d+$/.test(p)) out.add(+p);
              else{ const m=p.match(/^(\d+)\s*-\s*(\d+)$/);
                if(m){ let a=+m[1], b=+m[2]; if(a>b)[a,b]=[b,a]; for(let i=a;i<=b;i++) out.add(i); }
              }
            });
            return [...out].sort((a,b)=>a-b);
          })(spec);

          const { PDFDocument } = PDFLib;
          const src = await PDFDocument.load(arrayBuf);
          const total = src.getPageCount();
          const zeroIdx = wanted.filter(p=>p>=1 && p<=total).map(p=>p-1);
          if(!zeroIdx.length) return setStatus(`النطاقات خارج مدى الملف (عدد الصفحات: ${total}).`,'err');
          const outPdf = await PDFDocument.create();
          const pages = await outPdf.copyPages(src, zeroIdx);
          pages.forEach(p=>outPdf.addPage(p));
          const bytes = await outPdf.save({ useObjectStreams:true });
          downloadBlob(new Blob([bytes],{type:'application/pdf'}), `split_${file.name}`);
          setStatus(`تم استخراج ${pages.length} صفحة ✅`,'ok');
          return;
        }

        // تحويل إلى Word (نصوص + OCR)
        if(tool==='toWord'){
          setStatus('جاري التحويل إلى Word... (محاولة استخراج نص مباشر)', 'muted');
          // 1) استخراج النص الرقمي
          const digitalText = await extractTextPdfJs(arrayBuf);
          const hasDigital = digitalText.some(p => (p.text||'').length > 10);

          let paragraphs = digitalText;
          // 2) إن لم يوجد نص كافٍ → OCR تلقائي
          if(!hasDigital){
            setStatus('لا يوجد نص رقمي واضح، تشغيل OCR... (قد يستغرق قليلاً عند تحميل حزم اللغة)', 'muted');
            prog.style.display='block'; prog.value=5;

            const langs = ocrLangSel.value || 'ara+eng';
            const hint  = ocrHintSel.value || '';
            const ocrRes = await extractTextOCR(arrayBuf, langs, hint, (m)=>{
              if(m.status==='recognizing text' && m.progress!=null){
                prog.value = Math.min(100, Math.round(m.progress*100));
              }
            });
            paragraphs = ocrRes;
          }

          setStatus('إنشاء ملف DOCX...', 'muted');
          const blob = await toDocx(paragraphs, file.name);
          downloadBlob(blob, file.name.replace(/\.pdf$/i,'') + '.docx');
          setStatus('تم التحويل ✅', 'ok'); prog.style.display='none'; prog.value=0;
          return;
        }

      }catch(err){
        console.error(err);
        setStatus('حدث خطأ أثناء المعالجة. إن كان الملف كبيراً جداً فجرّب تقليصه أو تقسيمه أولاً.', 'err');
        prog.style.display='none'; prog.value=0;
      }
    });

    resetBtn.addEventListener('click', ()=>{
      single.value=''; multi.value=''; ranges.value='';
      orderEl.textContent=''; setStatus('تمت إعادة الضبط.','muted');
      prog.style.display='none'; prog.value=0;
    });
  </script>
</body>
</html>
