<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Ø§Ø³ØªØ¨ÙŠØ§Ù† Ø£Ø¹Ø±Ø§Ø¶ Ø§Ù„Ø³Ø±Ø·Ø§Ù† â€” ØªÙˆØ¹ÙŠØ© ÙˆØªØ­Ø±ÙŠ Ù…Ø¨ÙƒÙ‘Ø± (WHO/ACS)</title>
<link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Cairo:wght@300;400;700&display=swap" rel="stylesheet">
<style>
  :root{ --bg:#f5f6f8; --ink:#111827; --muted:#6b7280; --card:#ffffff; --line:#e5e7eb; --gold:#b58900; --gold-soft:#f5d574; --ocean:#0b4d8a; --emerald:#059669; --crimson:#dc2626; }
  *{box-sizing:border-box}
  body{margin:0; font-family:"Cairo",sans-serif; background:var(--bg); color:var(--ink)}
  header{text-align:center; padding:24px 12px}
  .brand{font-family:"Amiri",serif; font-size:clamp(26px,4.5vw,42px); color:var(--gold)}
  .tag{margin-top:6px; font-size:14px; color:#6b7280}
  .shell{max-width:980px; margin:0 auto; padding:0 16px}
  .hero{background:var(--card); border:1px solid var(--line); border-radius:20px; padding:20px; box-shadow:0 4px 12px rgba(0,0,0,.05)}
  .row{display:grid; gap:16px}
  @media(min-width:920px){ .row{grid-template-columns:1.2fr .8fr} }
  .field{display:flex; flex-direction:column; gap:8px; margin-bottom:12px}
  .center{text-align:center}
  .seg{display:flex; gap:6px; justify-content:center; flex-wrap:wrap}
  .seg button{flex:1; padding:10px 12px; border-radius:8px; border:1px solid var(--line); background:#f9fafb; cursor:pointer; max-width:160px}
  .seg button.on{background:var(--gold); color:#fff; border-color:var(--gold)}
  .select{ position:relative; display:inline-block; width:100% }
  .select select, .textin, .numin{
    width:100%; background:#fff; border:1px solid var(--line); border-radius:10px; padding:10px 12px; font-size:1rem; color:#111; text-align:right;
  }
  .btn{padding:12px 20px; border-radius:10px; border:none; cursor:pointer; background:linear-gradient(90deg,var(--gold),var(--gold-soft)); color:#111; font-weight:700; display:block; margin:0 auto}
  .badge{display:inline-block; padding:10px 14px; border-radius:10px; margin-top:12px}
  .ok{background:#eff6ff; color:var(--ocean)}
  .warn{background:#fff7ed; color:#9a3412}
  .deck{display:grid; gap:12px; grid-template-columns:1fr; margin-top:16px}
  @media(min-width:860px){ .deck{grid-template-columns:repeat(2,1fr)} }
  .card{background:#fdfdfd; border:1px solid var(--line); border-radius:12px; padding:14px; box-shadow:0 2px 6px rgba(0,0,0,.04)}
  .card h3{margin:0 0 6px; font-family:"Amiri",serif; color:var(--gold)}
  .kpi{display:grid; gap:10px; grid-template-columns:1fr 1fr; margin-top:10px}
  .k{background:#f9fafb; border:1px solid var(--line); border-radius:10px; padding:10px; text-align:center}
  .k .v{font-weight:700; font-size:18px}
  .notice{
    position:fixed; left:50%; bottom:20px; transform:translateX(-50%) translateY(10px);
    background:#fff; border:1px solid var(--gold); border-radius:12px; padding:10px 14px;
    box-shadow:0 8px 24px rgba(0,0,0,.12); display:flex; align-items:center; gap:10px;
    opacity:0; transition:.25s ease; z-index:9999; max-width:92vw; font-size:14px; color:#111;
  }
  .notice.show{ opacity:1; transform:translateX(-50%) translateY(0) }
  .notice .dot{width:10px; height:10px; border-radius:50%; background:linear-gradient(90deg,var(--gold),var(--gold-soft))}
  .notice .close{ margin-inline-start:8px; cursor:pointer; border:none; background:transparent; font-size:18px; line-height:1; color:#6b7280 }
  .notice.error{ border-color:#fecaca }
  .notice.error .dot{ background:linear-gradient(90deg,#fecaca,#fee2e2) }
  .pdfwrap{margin-top:12px; text-align:center; display:none}
  .pdfbtn{padding:10px 16px; border-radius:10px; border:1px solid var(--gold); background:#fff; cursor:pointer; font-weight:700}
</style>
</head>
<body>
<header>
  <div class="brand">Ø§Ø³ØªØ¨ÙŠØ§Ù† Ø£Ø¹Ø±Ø§Ø¶ Ø§Ù„Ø³Ø±Ø·Ø§Ù†</div>
  <div class="tag">Ù…Ø­ØªÙˆÙ‰ Ù…ÙˆØ«Ù‘Ù‚ Ù…Ù† WHO/ACS ÙˆÙ…ØµØ§Ø¯Ø± Ø·Ø¨ÙŠØ©. Ø£Ø¬Ø¨ Ø¹Ù† Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù„ØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ù†ØµÙŠØ­Ø© Ø´Ø®ØµÙŠØ© ØªÙ‚Ø±ÙŠØ¨ÙŠØ© ÙˆØ±ÙˆØ§Ø¨Ø·/Ø£Ø±Ù‚Ø§Ù… Ù„Ù…Ø±Ø§ÙƒØ² Ù…Ø®ØªØµÙ‘Ø© ÙÙŠ Ø¨Ù„Ø¯Ùƒ.</div>
</header>

<main class="shell">
  <section class="hero">
    <div class="row">
      <div>
        <!-- Ø§Ù„Ø§Ø³Ù… -->
        <div class="field">
          <label><strong>Ø§Ù„Ø§Ø³Ù… (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</strong></label>
          <input id="name" class="textin" placeholder="Ù…Ø«Ø§Ù„: Ø¹Ù„ÙŠ Ø£Ø­Ù…Ø¯"/>
        </div>

        <!-- Ø§Ù„Ø¨Ù„Ø¯ -->
        <div class="field">
          <label><strong>Ø§Ù„Ø¯ÙˆÙ„Ø©</strong></label>
          <div class="select">
            <select id="countrySelect" aria-label="Ø§Ø®ØªØ± Ø§Ù„Ø¯ÙˆÙ„Ø©">
              <option value="BHR" selected>Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†</option>
              <option value="KSA">Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</option>
              <option value="ARE">Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª</option>
              <option value="QAT">Ù‚Ø·Ø±</option>
              <option value="KWT">Ø§Ù„ÙƒÙˆÙŠØª</option>
              <option value="OMN">Ø¹ÙÙ…Ø§Ù†</option>
              <option value="EGY">Ù…ØµØ±</option>
              <option value="JOR">Ø§Ù„Ø£Ø±Ø¯Ù†</option>
              <option value="LBN">Ù„Ø¨Ù†Ø§Ù†</option>
              <option value="MAR">Ø§Ù„Ù…ØºØ±Ø¨</option>
              <option value="TUN">ØªÙˆÙ†Ø³</option>
              <option value="IRQ">Ø§Ù„Ø¹Ø±Ø§Ù‚</option>
              <option value="DZA">Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±</option>
              <option value="SYR">Ø³ÙˆØ±ÙŠØ§</option>
              <option value="PSE">ÙÙ„Ø³Ø·ÙŠÙ†</option>
              <option value="YEM">Ø§Ù„ÙŠÙ…Ù†</option>
            </select>
          </div>
        </div>

        <!-- Ø§Ù„Ù†ÙˆØ¹ -->
        <div class="field center">
          <label><strong>Ø§Ù„Ù†ÙˆØ¹</strong></label>
          <div class="seg" id="sexSeg">
            <button type="button" class="on" data-sex="male">Ø±Ø¬Ù„</button>
            <button type="button" data-sex="female">Ø§Ù…Ø±Ø£Ø©</button>
          </div>
        </div>

        <!-- Ø§Ù„Ø¹Ù…Ø± -->
        <div class="field">
          <label><strong>Ø§Ù„Ø¹Ù…Ø±</strong></label>
          <input id="age" class="numin" type="number" inputmode="numeric" min="0" max="120" placeholder="Ù…Ø«Ø§Ù„: 45"/>
        </div>

        <!-- Ø¹ÙˆØ§Ù…Ù„ -->
        <div class="field center">
          <label><strong>Ø¹ÙˆØ§Ù…Ù„ Ù…Ø¤Ø«Ø±Ø©</strong></label>
          <div class="seg" id="smokeSeg">
            <button type="button" class="on" data-smoke="no">ØºÙŠØ± Ù…Ø¯Ø®Ù‘Ù†</button>
            <button type="button" data-smoke="yes">Ù…Ø¯Ø®Ù‘Ù†</button>
          </div>
          <div style="margin-top:8px" class="seg" id="familySeg">
            <button type="button" class="on" data-fh="no">Ù„Ø§ ØªØ§Ø±ÙŠØ® Ø¹Ø§Ø¦Ù„ÙŠ Ù‚ÙˆÙŠ</button>
            <button type="button" data-fh="yes">ØªØ§Ø±ÙŠØ® Ø¹Ø§Ø¦Ù„ÙŠ Ù‚ÙˆÙŠ</button>
          </div>
        </div>

        <!-- Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶ -->
        <div class="card">
          <h3>Ø£Ø¬Ø¨ Ø¹Ù† Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶ Ø§Ù„ØªØ§Ù„ÙŠØ© (Ù†Ø¹Ù…/Ù„Ø§)</h3>
          <div id="symptoms" style="display:grid; gap:8px">
            <!-- ÙŠÙ…ØªÙ„Ø¦ Ø¨Ø±Ù…Ø¬ÙŠÙ‹Ø§ -->
          </div>
          <div style="margin-top:8px; font-size:12px; color:#6b7280">* Ø¥Ø°Ø§ ÙƒØ§Ù† Ø£ÙŠ Ø¹Ø±Ø¶ Ù…Ø³ØªÙ…Ø±Ù‹Ø§ &gt; 3 Ø£Ø³Ø§Ø¨ÙŠØ¹ Ø£Ùˆ ÙŠØªÙØ§Ù‚Ù…ØŒ ÙÙ‡Ø°Ù‡ Ø¥Ø´Ø§Ø±Ø© Ù…Ø±Ø§Ø¬Ø¹Ø© Ø·Ø¨ÙŠØ©.</div>
        </div>

        <button class="btn" id="calc">Ø§Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©</button>

        <div class="pdfwrap" id="pdfwrap">
          <button class="pdfbtn" id="pdfBtn">ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ù†ØªÙŠØ¬Ø© PDF</button>
        </div>
      </div>

      <div>
        <div id="verdict" class="badge ok" style="display:none"></div>

        <div class="kpi" id="kpis" style="display:none">
          <div class="k"><div class="v" id="riskLevel">â€”</div><div>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡</div></div>
          <div class="k"><div class="v" id="whatNext">â€”</div><div>Ù…Ø§Ø°Ø§ ØªÙØ¹Ù„ Ø§Ù„Ø¢Ù†</div></div>
        </div>

        <div class="deck" id="adviceDeck" style="display:none"></div>

        <div class="card" id="contactsCard" style="display:none; margin-top:12px">
          <h3>Ù…Ø³ØªØ´ÙÙŠØ§Øª ÙˆØ®Ø·ÙˆØ· Ù…Ø³Ø§Ø¹Ø¯Ø© ÙÙŠ <span id="ctryName">â€”</span></h3>
          <ul id="contactsList" style="margin:0; padding-inline-start:18px"></ul>
          <div style="margin-top:8px; font-size:12px; color:#6b7280">Ù„Ø§ ØªÙ†ØªØ¸Ø± ÙÙŠ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø·Ø§Ø±Ø¦Ø© â€” Ø§ØªØµÙ„ Ø¨Ø§Ù„Ø¥Ø³Ø¹Ø§Ù ÙÙˆØ±Ù‹Ø§.</div>
        </div>

        <div class="card" style="margin-top:12px">
          <h3>Ù…Ø±Ø§Ø¬Ø¹ Ø¹Ù„Ù…ÙŠØ©</h3>
          <ul style="margin:0; padding-inline-start:18px; font-size:14px">
            <li><a href="https://www.who.int/news-room/fact-sheets/detail/cancer" target="_blank" rel="noopener">WHO â€” Ø­Ù‚Ø§Ø¦Ù‚ Ø¹Ù† Ø§Ù„Ø³Ø±Ø·Ø§Ù†</a></li>
            <li><a href="https://www.cancer.org/cancer/diagnosis-staging/signs-and-symptoms-of-cancer.html" target="_blank" rel="noopener">ACS â€” Ø¹Ù„Ø§Ù…Ø§Øª ÙˆØ£Ø¹Ø±Ø§Ø¶ Ø§Ù„Ø³Ø±Ø·Ø§Ù†</a></li>
            <li><a href="https://www.mayoclinic.org/diseases-conditions/cancer/symptoms-causes/syc-20370588" target="_blank" rel="noopener">Mayo Clinic â€” Ø£Ø¹Ø±Ø§Ø¶ ÙˆØ£Ø³Ø¨Ø§Ø¨</a></li>
          </ul>
        </div>
      </div>
    </div>
  </section>

  <footer style="text-align:center; margin:12px 0 24px; font-size:12px; color:#6b7280">
    <div><strong>ØªÙ†Ø¨ÙŠÙ‡:</strong> Ù‡Ø°Ù‡ Ø£Ø¯Ø§Ø© ØªØ«Ù‚ÙŠÙÙŠØ© ÙˆÙ„Ø§ ØªÙØ´Ø®Ù‘Øµ Ø§Ù„Ù…Ø±Ø¶. ÙˆØ¬ÙˆØ¯ Ø¹Ø±Ø¶ Ù„Ø§ ÙŠØ¹Ù†ÙŠ Ø§Ù„Ø³Ø±Ø·Ø§Ù†ØŒ Ù„ÙƒÙ†Ù‡ ÙŠØ³ØªÙ„Ø²Ù… ØªÙ‚ÙŠÙŠÙ…Ù‹Ø§ Ø·Ø¨ÙŠÙ‹Ø§.</div>
    <div style="margin-top:6px">
      <a id="devLink" class="ghost-link" href="https://api.whatsapp.com/send/?phone=97333375858&text&type=phone_number&app_absent=0&wame_ctl=1" target="_blank" rel="noopener">Ø¨Ø±Ù…Ø¬Ø© ÙˆØªØ·ÙˆÙŠØ±: ÙØ§Ø¶Ù„ Ø§Ù„Ø±ÙŠØ³</a>
    </div>
  </footer>
</main>

<!-- Ø¥Ø´Ø¹Ø§Ø± -->
<div id="notice" class="notice" style="display:none">
  <div class="dot"></div>
  <div class="text">â€”</div>
  <button class="close" title="Ø¥ØºÙ„Ø§Ù‚" aria-label="Ø¥ØºÙ„Ø§Ù‚">Ã—</button>
</div>

<!-- PDF -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js" defer></script>

<script>
/* ===== Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙˆØ«Ù‘Ù‚Ø© Ù„Ø£Ø±Ù‚Ø§Ù… Ù…Ø±Ø§ÙƒØ²/Ù…Ø³ØªØ´ÙÙŠØ§Øª Ù…Ø®ØªØµÙ‘Ø© =====
   ØªÙ… Ø¬Ù…Ø¹Ù‡Ø§ Ù…Ù† Ù…ÙˆØ§Ù‚Ø¹ Ø±Ø³Ù…ÙŠØ©/Ù‡ÙŠØ¦Ø§Øª ØªØ®ØµØµÙŠØ©. Ù‚Ø¯ ØªØªØºÙŠÙ‘Ø± Ø¨Ù…Ø±ÙˆØ± Ø§Ù„ÙˆÙ‚Øª.
   Ø£ÙØ¯Ø±Ø¬Øª Ø¯ÙˆÙ„ Ø§Ù„Ø®Ù„ÙŠØ¬ + Ø¯ÙˆÙ„ Ø¹Ø±Ø¨ÙŠØ© Ø±Ø¦ÙŠØ³ÙŠØ©. */
const HOSPITALS = {
  BHR: { name:"Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†", contacts:[
    {label:"ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØµØ­Ø© â€” Ø¨Ø¯Ø§Ù„Ø©/Ù…ÙˆØ§Ø¹ÙŠØ¯", tel:"+97380007000"}, // Health Centers hotline
    {label:"Ù‚Ø³Ù… Ø§Ù„Ø£ÙˆØ±Ø§Ù… â€” Ù…Ø¬Ù…Ù‘Ø¹ Ø§Ù„Ø³Ù„Ù…Ø§Ù†ÙŠØ©", tel:"+97317284185"}, // moh portal
    {label:"Ø¬Ù…Ø¹ÙŠØ© Ø§Ù„Ø¨Ø­Ø±ÙŠÙ† Ù„Ù…ÙƒØ§ÙØ­Ø© Ø§Ù„Ø³Ø±Ø·Ø§Ù†", tel:"+97317233080"}
  ]},
  KSA: { name:"Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©", contacts:[
    {label:"Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ù…Ù„Ùƒ ÙÙŠØµÙ„ Ø§Ù„ØªØ®ØµØµÙŠ â€” Ø§Ù„Ø±ÙŠØ§Ø¶", tel:"+966114647272"}, // KFSHRC main
    {label:"Ù…Ø±ÙƒØ² Ø§Ù„Ù…Ù„Ùƒ ÙÙ‡Ø¯ Ù„Ø£ÙˆØ±Ø§Ù… Ø§Ù„Ø£Ø·ÙØ§Ù„ â€” Ø§Ù„Ø±ÙŠØ§Ø¶", tel:"+966112294444"}
  ]},
  ARE: { name:"Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª", contacts:[
    {label:"Ù…Ø³ØªØ´ÙÙ‰ ØªÙˆØ§Ù… â€” Ù‚Ø³Ù… Ø§Ù„Ø£ÙˆØ±Ø§Ù… (Ø§Ù„Ø¹ÙŠÙ†)", tel:"+97137677444"}
  ]},
  QAT: { name:"Ù‚Ø·Ø±", contacts:[
    {label:"Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„ÙˆØ·Ù†ÙŠ Ù„Ø¹Ù„Ø§Ø¬ ÙˆØ¨Ø­ÙˆØ« Ø§Ù„Ø³Ø±Ø·Ø§Ù† NCCCR â€” Ø­Ù…Ø¯", tel:"+97444397138"}
  ]},
  KWT: { name:"Ø§Ù„ÙƒÙˆÙŠØª", contacts:[
    {label:"Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„ÙƒÙˆÙŠØª Ù„Ø¹Ù„Ø§Ø¬ Ø§Ù„Ø³Ø±Ø·Ø§Ù† KCCC", tel:"+96524810232"},
    {label:"Ø¨Ø¯Ø§Ù„Ø© KCCC (Ø¹Ø§Ù…)", tel:"+96524849100"}
  ]},
  OMN: { name:"Ø¹ÙÙ…Ø§Ù†", contacts:[
    {label:"Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„ÙˆØ·Ù†ÙŠ Ù„Ù„Ø£ÙˆØ±Ø§Ù… â€” Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ø³Ù„Ø·Ø§Ù†ÙŠ", tel:"+96824627053"},
    {label:"Ø¨Ø¯Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ø³Ù„Ø·Ø§Ù†ÙŠ", tel:"+96824599000"}
  ]},
  EGY: { name:"Ù…ØµØ±", contacts:[
    {label:"Ø§Ù„Ù…Ø¹Ù‡Ø¯ Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ù„Ù„Ø£ÙˆØ±Ø§Ù… â€” Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©", tel:"+20225351424"},
    {label:"Ù…Ø±ÙƒØ² Ø§ØªØµØ§Ù„ AFNCI/Ø§Ù„ØªØ¨Ø±Ø¹Ø§Øª/Ø­Ø¬Ø²", tel:"19663"}
  ]},
  JOR: { name:"Ø§Ù„Ø£Ø±Ø¯Ù†", contacts:[
    {label:"Ù…Ø±ÙƒØ² Ø§Ù„Ø­Ø³ÙŠÙ† Ù„Ù„Ø³Ø±Ø·Ø§Ù† KHCC â€” Ø¨Ø¯Ø§Ù„Ø©", tel:"+96265300460"},
    {label:"Ù…Ø¤Ø³Ø³Ø© Ø§Ù„Ø­Ø³ÙŠÙ† Ù„Ù„Ø³Ø±Ø·Ø§Ù† KHCF", tel:"+96265544970"}
  ]},
  LBN: { name:"Ù„Ø¨Ù†Ø§Ù†", contacts:[
    {label:"Ù…Ø¹Ù‡Ø¯ Ù†Ø§ÙŠÙ Ø¨Ø³ÙŠÙ„ Ù„Ù„Ø³Ø±Ø·Ø§Ù† â€” AUBMC", tel:"+9611350000"},
    {label:"Ù…Ø±ÙƒØ² Ø³Ø±Ø·Ø§Ù† Ø§Ù„Ø£Ø·ÙØ§Ù„ CCCL", tel:"+9611351515"}
  ]},
  MAR: { name:"Ø§Ù„Ù…ØºØ±Ø¨", contacts:[
    {label:"Ø§Ù„Ù…Ø¹Ù‡Ø¯ Ø§Ù„ÙˆØ·Ù†ÙŠ Ù„Ù„Ø£ÙˆØ±Ø§Ù… â€” Ø§Ù„Ø±Ø¨Ø§Ø·", tel:"+212537712455"}
  ]},
  TUN: { name:"ØªÙˆÙ†Ø³", contacts:[
    {label:"Ù…Ø¹Ù‡Ø¯ ØµØ§Ù„Ø­ Ø¹Ø²ÙŠÙ‘Ø² Ù„Ù„Ø£ÙˆØ±Ø§Ù… â€” ØªÙˆÙ†Ø³", tel:"+21671150740"}
  ]},
  IRQ: { name:"Ø§Ù„Ø¹Ø±Ø§Ù‚", contacts:[
    {label:"Ù…Ø³ØªØ´ÙÙ‰ Ù‡ÙŠÙˆØ§ Ù„Ù„Ø£ÙˆØ±Ø§Ù… â€” Ø§Ù„Ø³Ù„ÙŠÙ…Ø§Ù†ÙŠØ©", tel:"+964533266100"}
  ]},
  DZA: { name:"Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±", contacts:[
    // ÙŠÙ…ÙƒÙ† Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ø§Ø­Ù‚Ù‹Ø§ Ù…Ù† Ø¯Ù„ÙŠÙ„ ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØµØ­Ø©/Ø§Ù„Ù…Ø±Ø§ÙƒØ² Ø§Ù„Ø¬Ù‡ÙˆÙŠØ©
  ]},
  SYR: { name:"Ø³ÙˆØ±ÙŠØ§", contacts:[
    // Ù…Ø«Ø§Ù„ Ø´Ø§Ø¦Ø¹: Ù…Ø±ÙƒØ² Ø§Ù„Ø¨ÙŠØ±ÙˆÙ†ÙŠ Ù„Ù„Ø£ÙˆØ±Ø§Ù… (ÙŠÙÙØ¶Ù‘Ù„ Ø§Ù„ØªØ­Ù‚Ù‘Ù‚ Ø§Ù„Ù…Ø­Ù„ÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø¯Ø±Ø§Ø¬)
  ]},
  PSE: { name:"ÙÙ„Ø³Ø·ÙŠÙ†", contacts:[
    // Ù…Ø«Ø§Ù„: ÙˆØ­Ø¯Ø© Ø§Ù„Ø£ÙˆØ±Ø§Ù… Ø¨Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ù…Ø·Ù„Ø¹/Ø£ÙˆØºØ³ØªØ§ ÙÙŠÙƒØªÙˆØ±ÙŠØ§ â€” Ø§Ù„Ù‚Ø¯Ø³
  ]},
  YEM: { name:"Ø§Ù„ÙŠÙ…Ù†", contacts:[
    // Ù…Ø«Ø§Ù„: Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„ÙˆØ·Ù†ÙŠ Ù„Ù„Ø£ÙˆØ±Ø§Ù… â€” ØµÙ†Ø¹Ø§Ø¡ (Ø¥Ø¶Ø§ÙØ© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù‚Ù‚)
  ]}
};

/* ===== Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶ (Ù…Ø³ØªÙ‚Ø§Ø© Ù…Ù† WHO/ACS/Mayo) ===== */
const QUESTIONS = [
  {id:"wloss", text:"ÙÙ‚Ø¯Ø§Ù† ÙˆØ²Ù† ØºÙŠØ± Ù…Ø¨Ø±Ù‘Ø± Ø®Ù„Ø§Ù„ Ø§Ù„Ø£Ø´Ù‡Ø± Ø§Ù„Ø£Ø®ÙŠØ±Ø©ØŸ"},
  {id:"fatigue", text:"ØªØ¹Ø¨ Ø´Ø¯ÙŠØ¯ Ù…Ø³ØªÙ…Ø± Ø£Ùˆ Ø­ÙÙ…Ù‘Ù‰ Ù…ØªÙƒØ±Ù‘Ø±Ø©ØŸ"},
  {id:"pain", text:"Ø£Ù„Ù… Ø¬Ø¯ÙŠØ¯/Ù…Ø³ØªÙ…Ø± Ø¨Ù„Ø§ Ø³Ø¨Ø¨ ÙˆØ§Ø¶Ø­ Ù„Ø£ÙƒØ«Ø± Ù…Ù† 3 Ø£Ø³Ø§Ø¨ÙŠØ¹ØŸ"},
  {id:"lump", text:"ÙƒØªÙ„Ø©/ØªÙˆØ±Ù‘Ù… Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ø§Ù„Ø«Ø¯ÙŠ Ø£Ùˆ Ø£ÙŠ Ù…ÙƒØ§Ù† Ø¨Ø§Ù„Ø¬Ø³Ù…ØŸ"},
  {id:"bleed", text:"Ù†Ø²Ù ØºÙŠØ± Ù…Ø¹ØªØ§Ø¯ (Ù…Ø¹ Ø§Ù„Ø³Ø¹Ø§Ù„/Ø§Ù„Ø¨ÙˆÙ„/Ø§Ù„Ø¨Ø±Ø§Ø² Ø£Ùˆ Ù†Ø²Ù Ù…Ù‡Ø¨Ù„ÙŠ ØºÙŠØ± Ø·Ø¨ÙŠØ¹ÙŠ)ØŸ"},
  {id:"cough", text:"Ø³Ø¹Ø§Ù„/Ø¨Ø­Ù‘Ø©/Ø¶ÙŠÙ‚ Ù†ÙØ³ Ù…Ø³ØªÙ…Ø± Ù„Ø£ÙƒØ«Ø± Ù…Ù† 3 Ø£Ø³Ø§Ø¨ÙŠØ¹ØŸ"},
  {id:"swallow", text:"Ø¹ÙØ³Ø± Ø¨Ù„Ø¹ Ø£Ùˆ Ø­Ø±Ù‚Ø© Ù…Ø¹Ø¯Ø© Ù…Ø³ØªÙ…Ø±Ø©ØŸ"},
  {id:"mole", text:"ØªØºÙŠÙ‘Ø± ÙˆØ§Ø¶Ø­ ÙÙŠ Ø´Ø§Ù…Ø©/Ø¨Ù‚Ø¹Ø© Ø¬Ù„Ø¯ÙŠØ©ØŸ"},
  {id:"ulcer", text:"Ù‚Ø±Ø­Ø©/Ø¬Ø±Ø­ Ù„Ø§ ÙŠÙ„ØªØ¦Ù…ØŸ"},
  {id:"bloat", text:"Ø§Ù†ØªÙØ§Ø®/Ù†ÙØ®Ø© Ù…Ø³ØªÙ…Ø±Ø© Ø¨Ø§Ù„Ø¨Ø·Ù†ØŸ"}
];

/* ===== Ø¹Ù†Ø§ØµØ± DOM ===== */
const sexSeg=document.getElementById('sexSeg');
const smokeSeg=document.getElementById('smokeSeg');
const familySeg=document.getElementById('familySeg');
let selectedSex="male", isSmoker="no", strongFH="no";
sexSeg.addEventListener('click',e=>{ const b=e.target.closest('button'); if(!b)return; sexSeg.querySelectorAll('button').forEach(x=>x.classList.remove('on')); b.classList.add('on'); selectedSex=b.dataset.sex; });
smokeSeg.addEventListener('click',e=>{ const b=e.target.closest('button'); if(!b)return; smokeSeg.querySelectorAll('button').forEach(x=>x.classList.remove('on')); b.classList.add('on'); isSmoker=b.dataset.smoke; });
familySeg.addEventListener('click',e=>{ const b=e.target.closest('button'); if(!b)return; familySeg.querySelectorAll('button').forEach(x=>x.classList.remove('on')); b.classList.add('on'); strongFH=b.dataset.fh; });

const notice=document.getElementById('notice'), noticeText=notice.querySelector('.text');
notice.querySelector('.close').onclick=()=>{ notice.classList.remove('show'); setTimeout(()=>notice.style.display='none',250); };
function notify(msg,{type='info',timeout=3500}={}){ notice.style.display='flex'; notice.classList.toggle('error', type==='error'); noticeText.innerHTML=msg; requestAnimationFrame(()=>notice.classList.add('show')); clearTimeout(window.__nt); window.__nt=setTimeout(()=>{ notice.classList.remove('show'); setTimeout(()=>notice.style.display='none',250); }, timeout); }

/* ===== Ø¨Ù†Ø§Ø¡ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ===== */
const symWrap=document.getElementById('symptoms');
QUESTIONS.forEach(q=>{
  const row=document.createElement('div');
  row.style.display='flex'; row.style.justifyContent='space-between'; row.style.alignItems='center'; row.style.gap='8px';
  row.innerHTML=`<div>${q.text}</div>
    <div class="seg" style="gap:6px">
      <button type="button" class="on" data-q="${q.id}" data-a="no">Ù„Ø§</button>
      <button type="button" data-q="${q.id}" data-a="yes">Ù†Ø¹Ù…</button>
    </div>`;
  symWrap.appendChild(row);
});
symWrap.addEventListener('click', e=>{
  const b=e.target.closest('button'); if(!b) return;
  const seg=b.parentElement;
  seg.querySelectorAll('button').forEach(x=>x.classList.remove('on'));
  b.classList.add('on');
});

/* ===== ØªÙˆØµÙŠØ§Øª Ø§Ù„ØªØ­Ø±ÙŠ Ø­Ø³Ø¨ Ø§Ù„Ø¹Ù…Ø±/Ø§Ù„Ù†ÙˆØ¹ ===== */
function screening(age, sex, smoker, fh){
  const list=[];
  if(sex==='female' && age>=40){ list.push("ØªØµÙˆÙŠØ± Ø§Ù„Ø«Ø¯ÙŠ Ø§Ù„Ø¯ÙˆØ±ÙŠ (Ù…Ø§Ù…ÙˆØºØ±Ø§Ù…): ÙƒÙ„ 1â€“2 Ø³Ù†Ø© Ø¨Ø¯Ø¡Ù‹Ø§ Ù…Ù† 40â€“50 ÙˆÙÙ‚ Ø¥Ø±Ø´Ø§Ø¯Ø§Øª Ø¨Ù„Ø¯Ùƒ."); }
  if(sex==='female' && age>=21){ list.push("Ø¹Ù†Ù‚ Ø§Ù„Ø±Ø­Ù…: Ø§Ø®ØªØ¨Ø§Ø± Pap/HPV Ø­Ø³Ø¨ Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø© (Ø¹Ø§Ø¯Ø© ÙƒÙ„ 3â€“5 Ø³Ù†ÙˆØ§Øª)."); }
  if(age>=45){ list.push("Ø³Ø±Ø·Ø§Ù† Ø§Ù„Ù‚ÙˆÙ„ÙˆÙ† ÙˆØ§Ù„Ù…Ø³ØªÙ‚ÙŠÙ…: FIT Ø³Ù†ÙˆÙŠÙ‹Ø§ Ø£Ùˆ ØªÙ†Ø¸ÙŠØ± Ù‚ÙˆÙ„ÙˆÙ† ÙƒÙ„ 10 Ø³Ù†ÙˆØ§Øª (ÙˆÙÙ‚ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø·Ø¨ÙŠØ¨)."); }
  if(age>=50 && smoker==='yes'){ list.push("Ø³Ø±Ø·Ø§Ù† Ø§Ù„Ø±Ø¦Ø©: ØªØµÙˆÙŠØ± Ø·Ø¨Ù‚ÙŠ Ù…Ù†Ø®ÙØ¶ Ø§Ù„Ø¬Ø±Ø¹Ø© (LDCT) Ø³Ù†ÙˆÙŠÙ‹Ø§ Ù„Ù„Ù…Ø¯Ø®Ù†ÙŠÙ† Ø§Ù„Ù…Ø¤Ù‡Ù„ÙŠÙ†."); }
  if(sex==='male' && age>=50){ list.push("Ø§Ù„Ø¨Ø±ÙˆØ³ØªØ§ØªØ§: Ù†Ø§Ù‚Ø´ PSA/ÙØ­Øµ Ø§Ù„Ù…Ø³ØªÙ‚ÙŠÙ… Ù„Ø§ØªØ®Ø§Ø° Ù‚Ø±Ø§Ø± Ù…Ø´ØªØ±Ùƒ."); }
  if(fh==='yes'){ list.push("Ù†Ø¸Ø±Ù‹Ø§ Ù„Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¹Ø§Ø¦Ù„ÙŠ Ø§Ù„Ù‚ÙˆÙŠ: Ø§Ø³ØªØ´Ø± Ø§Ø®ØªØµØ§ØµÙŠ ÙˆØ±Ø§Ø«Ø©/Ø£ÙˆØ±Ø§Ù… Ù„Ø¥Ù…ÙƒØ§Ù† ÙØ­ÙˆØµ Ù…Ø¨ÙƒØ±Ø©/Ù…ÙˆØ³Ø¹Ø©."); }
  return list;
}

/* ===== ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ø¨Ø³ÙŠØ· (ØªØ«Ù‚ÙŠÙÙŠ) =====
   Ù†Ø­Ø³Ø¨ Ù†Ù‚Ø§Ø·Ù‹Ø§: ÙƒÙ„ Ø¹Ø±Ø¶ (Ù†Ø¹Ù…)=1. Ø¨Ø¹Ø¶ Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶ Ø§Ù„Ø«Ù‚ÙŠÙ„Ø© (Ù†Ø²Ù ØºÙŠØ± Ù…Ø¹ØªØ§Ø¯/ÙƒØªÙ„Ø©/ØªØºÙŠÙ‘Ø± Ø§Ù„Ø´Ø§Ù…Ø©/Ù‚Ø±Ø­Ø© Ù„Ø§ ØªÙ„ØªØ¦Ù…)=+1 Ø¥Ø¶Ø§ÙÙŠØ©.
   Ø«Ù… Ù†Ø±ÙØ¹ Ø¯Ø±Ø¬Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø¨ÙˆØ¬ÙˆØ¯ Ø§Ù„ØªØ¯Ø®ÙŠÙ†/ØªØ§Ø±ÙŠØ® Ø¹Ø§Ø¦Ù„ÙŠ Ù‚ÙˆÙŠ. */
function computeRisk(){
  let score=0;
  const answers={};
  QUESTIONS.forEach(q=>{
    const seg=[...symWrap.querySelectorAll(`button[data-q="${q.id}"]`)];
    const a=seg.find(b=>b.classList.contains('on'))?.dataset.a || 'no';
    answers[q.id]=a;
    if(a==='yes'){ score+=1; }
  });
  // Ø£Ø¹Ø±Ø§Ø¶ Ø«Ù‚ÙŠÙ„Ø©
  ["bleed","lump","mole","ulcer"].forEach(k=>{ if(answers[k]==='yes') score+=1; });
  // Ø¹ÙˆØ§Ù…Ù„
  if(isSmoker==='yes') score+=1;
  if(strongFH==='yes') score+=1;
  return {score, answers};
}

/* ===== Ø­Ø³Ø§Ø¨/Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø© ===== */
let lastResult=null;
document.getElementById('calc').addEventListener('click', ()=>{
  const age = parseInt(document.getElementById('age').value,10);
  if(!(age>=0 && age<=120)){ notify("Ø£Ø¯Ø®Ù„ Ø¹Ù…Ø±Ù‹Ø§ ØµØ­ÙŠØ­Ù‹Ø§ Ø¨ÙŠÙ† 0 Ùˆ 120.", {type:'error'}); return; }

  const name = (document.getElementById('name').value||"â€”").trim()||"â€”";
  const {score, answers}=computeRisk();

  // Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡
  let level, action;
  if(score>=6){ level="Ù…Ø±ØªÙØ¹"; action="Ø§Ø­Ø¬Ø² ØªÙ‚ÙŠÙŠÙ…Ù‹Ø§ Ø·Ø¨ÙŠÙ‹Ø§ Ø¹Ø§Ø¬Ù„Ù‹Ø§ (Ø®Ù„Ø§Ù„ Ø£ÙŠØ§Ù… Ù‚Ù„ÙŠÙ„Ø©)."; }
  else if(score>=3){ level="Ù…ØªÙˆØ³Ø·"; action="Ø§Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯Ù‹Ø§ Ø£ÙˆÙ„ÙŠÙ‹Ø§ Ù„Ø¯Ù‰ Ø·Ø¨ÙŠØ¨ Ø§Ù„Ø£Ø³Ø±Ø© Ø®Ù„Ø§Ù„ Ø£Ø³Ø¨ÙˆØ¹ÙŠÙ† ÙˆØ§ØªØ¨ÙØ¹ ÙØ­ÙˆØµ Ø§Ù„ØªØ­Ø±ÙŠ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©."; }
  else { level="Ù…Ù†Ø®ÙØ¶"; action="Ø±Ø§Ù‚Ø¨ Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶ØŒ ÙˆØ­Ø§ÙÙØ¸ Ø¹Ù„Ù‰ Ù†Ù…Ø· ØµØ­ÙŠØŒ ÙˆØ£Ø¬Ø±Ù Ø§Ù„ØªØ­Ø±ÙŠ Ø§Ù„Ù…ÙˆØµÙ‰ Ø¨Ù‡ Ù„Ø¹ÙÙ…Ø±Ùƒ/Ù†ÙˆØ¹Ùƒ."; }

  // Ø´Ø§Ø´Ø© KPIs
  document.getElementById('kpis').style.display='grid';
  document.getElementById('riskLevel').textContent=level;
  document.getElementById('whatNext').textContent=action;

  // Ø´Ø§Ø±Ø©
  const v=document.getElementById('verdict');
  v.style.display='inline-block';
  v.className='badge '+(level==="Ù…Ø±ØªÙØ¹"?'warn':'ok');
  v.textContent="ğŸ” Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªØ«Ù‚ÙŠÙÙŠØ© Ø¬Ø§Ù‡Ø²Ø© â€” Ø§Ù†Ø²Ù„ Ù„Ù„Ø£Ø³ÙÙ„ Ù„Ù„ØªÙˆØµÙŠØ§Øª ÙˆØ¬Ù‡Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„.";

  // ØªÙˆØµÙŠØ§Øª
  const deck=document.getElementById('adviceDeck');
  deck.innerHTML="";
  const mk=(t,html)=>{ const e=document.createElement('div'); e.className='card'; e.innerHTML=`<h3>${t}</h3>${html}`; return e; };
  const list=screening(age, selectedSex, isSmoker, strongFH);
  deck.append(
    mk("Ù…Ø§Ø°Ø§ ØªÙØ¹Ù„ Ø§Ù„Ø¢Ù†", `<ul><li>${action}</li><li>Ø¥Ø°Ø§ Ø³Ø§Ø¡ Ø£ÙŠ Ø¹Ø±Ø¶ Ø£Ùˆ Ø¸Ù‡Ø± Ù†Ø²Ù/ÙƒØªÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø© â€” Ù„Ø§ ØªØ¤Ø¬Ù‘Ù„ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©.</li><li>Ø£Ø­Ø¶ÙØ± Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶ ÙˆÙ…Ø¯ØªÙ‡Ø§ ÙˆØ£ÙŠ Ø£Ø¯ÙˆÙŠØ©.</li></ul>`),
    mk("ÙØ­ÙˆØµ Ø§Ù„ØªØ­Ø±ÙŠ Ø§Ù„Ù…ÙˆØµÙ‰ Ø¨Ù‡Ø§", list.length? `<ul>${list.map(x=>`<li>${x}</li>`).join("")}</ul>` : "<div>Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØ­ÙˆØµ Ø±ÙˆØªÙŠÙ†ÙŠØ© Ø®Ø§ØµØ© Ø¨Ø¹Ù…Ø±Ùƒ Ø§Ù„Ø¢Ù† â€” Ø§ØªØ¨Ø¹ Ù†ØµÙŠØ­Ø© Ø·Ø¨ÙŠØ¨Ùƒ.</div>"),
    mk("Ù†Ù…Ø· Ø§Ù„Ø­ÙŠØ§Ø© Ù„Ù„ÙˆÙ‚Ø§ÙŠØ©", "<ul><li>Ø§Ù„Ø¥Ù‚Ù„Ø§Ø¹ Ø¹Ù† Ø§Ù„ØªØ¯Ø®ÙŠÙ† ÙˆØªÙ‚Ù„ÙŠÙ„ Ø§Ù„ØªØ¹Ø±Ù‘Ø¶ Ù„Ù„Ø¯Ø®Ø§Ù†.</li><li>Ù†Ø´Ø§Ø· Ø¨Ø¯Ù†ÙŠ â‰¥ 150 Ø¯Ù‚ÙŠÙ‚Ø©/Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ÙˆØºØ°Ø§Ø¡ Ù…ØªÙˆØ§Ø²Ù†.</li><li>ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„ÙƒØ­ÙˆÙ„ØŒ ÙˆØ­Ù…Ø§ÙŠØ© Ø§Ù„Ø¬Ù„Ø¯ Ù…Ù† Ø§Ù„Ø´Ù…Ø³.</li><li>Ø§Ù„ØªØ·Ø¹ÙŠÙ…Ø§Øª (HPV/Ø§Ù„ØªÙ‡Ø§Ø¨ Ø§Ù„ÙƒØ¨Ø¯ B) ÙˆÙÙ‚ Ø¨Ù„Ø¯Ùƒ.</li></ul>")
  );
  deck.style.display='grid';

  // Ø¬Ù‡Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„
  const iso = document.getElementById('countrySelect').value;
  const cfg = HOSPITALS[iso];
  const card = document.getElementById('contactsCard');
  const listEl = document.getElementById('contactsList');
  const nameEl = document.getElementById('ctryName');
  listEl.innerHTML="";
  const readableCountry = cfg?.name || document.querySelector(`#countrySelect option[value="${iso}"]`)?.textContent || "Ø§Ù„Ø¯ÙˆÙ„Ø©";
  nameEl.textContent = readableCountry;

  if(cfg && cfg.contacts && cfg.contacts.length){
    cfg.contacts.forEach(c=>{
      const li=document.createElement('li');
      li.innerHTML = `<strong>${c.label}</strong> â€” <a href="tel:${c.tel.replace(/\\s+/g,'')}" dir="ltr">${c.tel}</a>`;
      listEl.appendChild(li);
    });
  }else{
    const q = encodeURIComponent(`Ù…Ø±ÙƒØ² Ø£ÙˆØ±Ø§Ù… ${readableCountry}`);
    listEl.innerHTML = `<li>Ù„Ù… ØªÙØ¯Ø±Ø¬ Ø£Ø±Ù‚Ø§Ù… Ù…Ø­Ù„ÙŠØ© Ø¨Ø¹Ø¯. Ø§Ø¨Ø­Ø« Ù…Ø¨Ø§Ø´Ø±Ø©: <a target="_blank" rel="noopener" href="https://www.google.com/search?q=${q}">Ø¹Ù† Ø£Ù‚Ø±Ø¨ Ù…Ø±ÙƒØ² Ø£ÙˆØ±Ø§Ù… ÙÙŠ ${readableCountry}</a></li>`;
  }
  card.style.display='block';

  // Ø­ÙØ¸ Ø¢Ø®Ø± Ù†ØªÙŠØ¬Ø© Ù…Ù† Ø£Ø¬Ù„ PDF
  lastResult = {
    name, country: readableCountry,
    sex: (selectedSex==='male'?'Ø±Ø¬Ù„':'Ø§Ù…Ø±Ø£Ø©'),
    age, smoker: (isSmoker==='yes'?'Ù…Ø¯Ø®Ù‘Ù†':'ØºÙŠØ± Ù…Ø¯Ø®Ù‘Ù†'),
    family: (strongFH==='yes'?'ØªØ§Ø±ÙŠØ® Ø¹Ø§Ø¦Ù„ÙŠ Ù‚ÙˆÙŠ':'Ù„Ø§'),
    answers, level, action, screenings:list
  };

  // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± PDF
  document.getElementById('pdfwrap').style.display='block';
});

/* ===== PDF ===== */
document.getElementById('pdfBtn').addEventListener('click', async ()=>{
  if(!lastResult){ notify('Ø£Ø¬ÙØ¨ Ø¹Ù† Ø§Ù„Ø§Ø³ØªØ¨ÙŠØ§Ù† Ø£ÙˆÙ„Ù‹Ø§.', {type:'error'}); return; }
  const box=document.createElement('div');
  box.setAttribute('dir','rtl');
  box.style.width='780px';
  box.style.background='#fff';
  box.style.border='1px solid #e5e7eb';
  box.style.borderRadius='16px';
  box.style.padding='20px';
  box.style.fontFamily='"Cairo",sans-serif';
  box.style.color='#111827';

  const ansRows = Object.entries(lastResult.answers).map(([k,v])=>{
    const map={
      wloss:"ÙÙ‚Ø¯Ø§Ù† ÙˆØ²Ù† ØºÙŠØ± Ù…Ø¨Ø±Ù‘Ø±", fatigue:"ØªØ¹Ø¨/Ø­ÙÙ…Ù‘Ù‰ Ù…ØªÙƒØ±Ù‘Ø±Ø©", pain:"Ø£Ù„Ù… Ù…Ø³ØªÙ…Ø±", lump:"ÙƒØªÙ„Ø©/ØªÙˆØ±Ù‘Ù…", bleed:"Ù†Ø²Ù ØºÙŠØ± Ù…Ø¹ØªØ§Ø¯",
      cough:"Ø³Ø¹Ø§Ù„/Ø¨Ø­Ù‘Ø©/Ø¶ÙŠÙ‚ Ù†ÙØ³", swallow:"Ø¹Ø³Ø± Ø¨Ù„Ø¹/Ø­Ø±Ù‚Ø©", mole:"ØªØºÙŠÙ‘Ø± ÙÙŠ Ø´Ø§Ù…Ø©", ulcer:"Ù‚Ø±Ø­Ø© Ù„Ø§ ØªÙ„ØªØ¦Ù…", bloat:"Ù†ÙØ®Ø© Ù…Ø³ØªÙ…Ø±Ø©"
    };
    return `<tr><td style="padding:8px 10px;border-bottom:1px solid #f3f4f6">${map[k]}</td><td style="padding:8px 10px;border-bottom:1px solid #f3f4f6">${v==='yes'?'Ù†Ø¹Ù…':'Ù„Ø§'}</td></tr>`;
  }).join("");

  box.innerHTML=`
    <div style="text-align:center; margin-bottom:10px">
      <div style="font-family:'Amiri',serif; font-size:26px; color:${getComputedStyle(document.documentElement).getPropertyValue('--gold')}">Ù†ØªÙŠØ¬Ø© Ø§Ø³ØªØ¨ÙŠØ§Ù† Ø£Ø¹Ø±Ø§Ø¶ Ø§Ù„Ø³Ø±Ø·Ø§Ù† (ØªØ«Ù‚ÙŠÙÙŠ)</div>
      <div style="font-size:12px; color:#6b7280">${new Date().toLocaleString('ar')}</div>
    </div>

    <table style="width:100%; border-collapse:separate; border-spacing:0; overflow:hidden; border-radius:12px; border:1px solid #eee; margin-bottom:10px">
      <thead><tr style="background:linear-gradient(90deg,#fff7e6,#fff)">
        <th style="padding:10px 12px; text-align:right; border-bottom:1px solid #eee">Ø§Ù„Ø¨Ù†Ø¯</th>
        <th style="padding:10px 12px; text-align:right; border-bottom:1px solid #eee">Ø§Ù„Ù‚ÙŠÙ…Ø©</th>
      </tr></thead>
      <tbody>
        <tr><td style="padding:8px 10px;border-bottom:1px solid #f3f4f6"><strong>Ø§Ù„Ø§Ø³Ù…</strong></td><td style="padding:8px 10px;border-bottom:1px solid #f3f4f6">${lastResult.name}</td></tr>
        <tr><td style="padding:8px 10px;border-bottom:1px solid #f3f4f6"><strong>Ø§Ù„Ø¯ÙˆÙ„Ø©</strong></td><td style="padding:8px 10px;border-bottom:1px solid #f3f4f6">${lastResult.country}</td></tr>
        <tr><td style="padding:8px 10px;border-bottom:1px solid #f3f4f6"><strong>Ø§Ù„Ù†ÙˆØ¹</strong></td><td style="padding:8px 10px;border-bottom:1px solid #f3f4f6">${lastResult.sex}</td></tr>
        <tr><td style="padding:8px 10px;border-bottom:1px solid #f3f4f6"><strong>Ø§Ù„Ø¹Ù…Ø±</strong></td><td style="padding:8px 10px;border-bottom:1px solid #f3f4f6">${lastResult.age}</td></tr>
        <tr><td style="padding:8px 10px;border-bottom:1px solid #f3f4f6"><strong>Ø§Ù„ØªØ¯Ø®ÙŠÙ†</strong></td><td style="padding:8px 10px;border-bottom:1px solid #f3f4f6">${lastResult.smoker}</td></tr>
        <tr><td style="padding:8px 10px;border-bottom:1px solid #f3f4f6"><strong>ØªØ§Ø±ÙŠØ® Ø¹Ø§Ø¦Ù„ÙŠ Ù‚ÙˆÙŠ</strong></td><td style="padding:8px 10px;border-bottom:1px solid #f3f4f6">${lastResult.family}</td></tr>
        <tr><td style="padding:8px 10px;border-bottom:1px solid #f3f4f6"><strong>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡</strong></td><td style="padding:8px 10px;border-bottom:1px solid #f3f4f6">${lastResult.level}</td></tr>
        <tr><td style="padding:8px 10px;border-bottom:1px solid #f3f4f6"><strong>Ù…Ø§Ø°Ø§ ØªÙØ¹Ù„ Ø§Ù„Ø¢Ù†</strong></td><td style="padding:8px 10px;border-bottom:1px solid #f3f4f6">${lastResult.action}</td></tr>
      </tbody>
    </table>

    <div style="font-weight:700; margin-bottom:6px">Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶</div>
    <table style="width:100%; border-collapse:separate; border-spacing:0; overflow:hidden; border-radius:12px; border:1px solid #eee; margin-bottom:10px">
      <thead><tr style="background:#f9fafb"><th style="padding:8px 10px; text-align:right">Ø§Ù„Ø¹ÙØ±ÙØ¶</th><th style="padding:8px 10px; text-align:right">Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©</th></tr></thead>
      <tbody>${ansRows}</tbody>
    </table>

    <div style="font-weight:700; margin-bottom:6px">ÙØ­ÙˆØµØ§Øª Ø§Ù„ØªØ­Ø±ÙŠ Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©</div>
    <ul style="margin:0 0 8px 0; padding-inline-start:18px">${(lastResult.screenings&&lastResult.screenings.length)? lastResult.screenings.map(s=>`<li>${s}</li>`).join("") : "<li>â€”</li>"}</ul>

    <div style="margin-top:10px; font-size:12px; color:#6b7280; line-height:1.7">
      <strong>Ø§Ù„Ù…ØµØ¯Ø±:</strong> WHO, ACS, Mayo Clinic (Ø±ÙˆØ§Ø¨Ø· ÙÙŠ Ø§Ù„ØµÙØ­Ø©). Ù‡Ø°Ù‡ Ù†ØªÙŠØ¬Ø© ØªØ«Ù‚ÙŠÙÙŠØ© ÙˆÙ„ÙŠØ³Øª ØªØ´Ø®ÙŠØµÙ‹Ø§ Ø·Ø¨ÙŠÙ‹Ø§.
    </div>
  `;

  document.body.appendChild(box);
  await new Promise(r=>setTimeout(r, 120));
  const canvas = await html2canvas(box, {scale:2, useCORS:true});
  document.body.removeChild(box);

  const imgData = canvas.toDataURL('image/png');
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF({orientation:'p', unit:'pt', format:'a4'});
  const pageW = pdf.internal.pageSize.getWidth();
  const pageH = pdf.internal.pageSize.getHeight();
  const margin = 28;
  const imgW = pageW - margin*2;
  const imgH = canvas.height * (imgW / canvas.width);

  if(imgH <= pageH - margin*2){
    pdf.addImage(imgData, 'PNG', margin, margin, imgW, imgH);
  }else{
    let sH = pageH - margin*2;
    let ratio = canvas.width / imgW;
    let slice = sH * ratio;
    let pos = 0;
    while(pos < canvas.height){
      const sliceCanvas = document.createElement('canvas');
      sliceCanvas.width = canvas.width;
      sliceCanvas.height = Math.min(slice, canvas.height - pos);
      const ctx = sliceCanvas.getContext('2d');
      ctx.drawImage(canvas, 0, pos, canvas.width, sliceCanvas.height, 0, 0, sliceCanvas.width, sliceCanvas.height);
      const sliceData = sliceCanvas.toDataURL('image/png');
      if(pos>0) pdf.addPage();
      pdf.addImage(sliceData, 'PNG', margin, margin, imgW, (sliceCanvas.height / ratio));
      pos += slice;
    }
  }
  pdf.save('Ù†ØªÙŠØ¬Ø©-Ø§Ø³ØªØ¨ÙŠØ§Ù†-Ø§Ù„Ø³Ø±Ø·Ø§Ù†.pdf');
});

/* ÙØªØ­ Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø·ÙˆÙ‘Ø± Ø¨Ø­Ø°Ø± */
document.getElementById('devLink').addEventListener('click', function(){ setTimeout(()=>{ if(!document.hasFocus()) return; location.href=this.href; }, 100); });
</script>
</body>
</html>
