<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>منشئ سيرة ذاتية ثنائي اللغة — عربي/English — PDF & Word</title>
<link href="https://fonts.googleapis.com/css2?family=Reem+Kufi:wght@600&family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root{--ink:#0f172a;--muted:#6b7280;--bg:#f6f8fb;--border:#e5e7eb;--accent:#0ea5a6;--shadow:0 8px 20px rgba(2,6,23,.08);--paper:#fff;--chip:#eef6ff}
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font-family:"Tajawal",sans-serif}
  .wrap{max-width:1200px;margin:auto;padding:16px;display:grid;grid-template-columns:380px 1fr;gap:16px}
  @media(max-width:1020px){.wrap{grid-template-columns:1fr}}
  .panel{background:#fff;border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow);padding:16px}
  .title{margin:0 0 10px;font-family:"Reem Kufi",sans-serif;font-size:1.4rem}
  .hint{color:var(--muted);font-size:.92rem}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .row-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
  .field{display:flex;flex-direction:column;margin:8px 0}
  .field label{font-weight:700;font-size:.9rem;color:#334155;margin-bottom:6px}
  .field input,.field textarea,.field select{border:1px solid var(--border);border-radius:10px;padding:10px 12px;font-weight:700;background:#fff}
  .field textarea{min-height:84px;resize:vertical}
  .subsec{border-top:1px dashed #e5e7eb;margin:14px 0 6px;padding-top:8px;display:flex;justify-content:space-between;align-items:center}
  .btn{border:1px solid var(--border);background:#fff;border-radius:10px;padding:.5rem .8rem;font-weight:800;cursor:pointer}
  .btn.primary{background:#eef6ff}
  .btn.danger{background:#fff0f0;border-color:#fecaca;color:#991b1b}
  .small{font-size:.85rem;color:var(--muted)}
  .uploader{display:flex;align-items:center;gap:10px}
  .uploader input[type=file]{display:none}
  .avatarPreview{width:56px;height:56px;border-radius:12px;border:1px solid var(--border);object-fit:cover;background:#f1f5f9}

  /* ===== CV Page (A4) ===== */
  .cv-wrap{display:flex;justify-content:center;align-items:flex-start}
  .cv-page{width:210mm;min-height:297mm;background:var(--paper);color:#111827;border:1px solid #e5e7eb;border-radius:12px;box-shadow:var(--shadow);overflow:hidden}
  .cv-head{display:grid;grid-template-columns:1fr 140px;gap:16px;padding:22px 22px 0}
  .cv-name{margin:0;font-family:"Reem Kufi",sans-serif;font-size:28px;line-height:1.2}
  .cv-role{margin:6px 0 10px;font-weight:800;color:#0b3b3a}
  .cv-summary{color:#334155;line-height:1.8;white-space:pre-line}
  .cv-photo{width:120px;height:120px;border-radius:14px;border:2px solid var(--accent);object-fit:cover;justify-self:end;background:#f1f5f9}
  .cv-contact{display:flex;flex-wrap:wrap;gap:8px;margin:14px 22px 0}
  .chip{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border:1px solid #e5e7eb;border-radius:999px;background:#f8fafc;font-weight:700}
  .cv-cols{display:grid;grid-template-columns:1.1fr .9fr;gap:16px;padding:14px 22px 22px}
  .sec{margin-top:8px}
  .sec h3{margin:0 0 8px;font-size:15px;color:#0f172a;border-bottom:2px solid var(--accent);display:inline-block;padding-bottom:2px}
  .item{margin:10px 0}
  .item .top{display:flex;justify-content:space-between;font-weight:800}
  .item .meta{color:#475569;font-size:.92rem}
  .item .desc{margin-top:6px;color:#334155;white-space:pre-line}
  .tags{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
  .tag{padding:6px 10px;border-radius:999px;background:#eef6ff;border:1px solid #dbeafe;font-weight:800}
  .langRow{display:flex;justify-content:space-between;border:1px dashed #e5e7eb;border-radius:10px;padding:8px 10px;margin-top:8px}
  .accentDot{display:inline-block;width:8px;height:8px;border-radius:50%;background:var(--accent);margin-inline:6px}
  .muted{color:#64748b}

  /* Print */
  @media print{
    body{background:#fff}
    .wrap{display:block;padding:0}
    .panel.controlsOnly{display:none}
    .cv-page{border:none;box-shadow:none;width:auto;min-height:auto}
    @page{size:A4;margin:12mm}
  }
</style>
</head>
<body>
  <div class="wrap">
    <!-- ============ النموذج ============ -->
    <section class="panel">
      <h1 class="title">منشئ سيرة ذاتية ثنائي اللغة (عربي / English)</h1>
      <p class="hint">اكتب بياناتك بأي لغة، وسنُنشئ نسخة عربية ونسخة إنجليزية تلقائيًا يمكن تنزيلهما بصيغة PDF أو Word.</p>

      <div class="field">
        <label>لغة الواجهة / UI Language</label>
        <select id="uiLang">
          <option value="ar" selected>العربية</option>
          <option value="en">English</option>
        </select>
      </div>

      <div class="field">
        <label>ترجمة تلقائية للمحتوى / Auto-translate content</label>
        <select id="autoTranslate">
          <option value="on" selected>تشغيل / On</option>
          <option value="off">إيقاف / Off</option>
        </select>
        <div class="small">إن كانت الترجمة التلقائية غير دقيقة، عطّلها واكتب صيغة اللغة الثانية يدويًا.</div>
      </div>

      <div class="subsec"><b>الأساسيات / Basics</b></div>
      <div class="field"><label>الاسم الكامل / Full Name</label><input id="f_name" placeholder="اسمك الكامل / Your full name"></div>
      <div class="field"><label>المسمّى / Title</label><input id="f_role" placeholder="مثال: مطوّر واجهات / e.g., Frontend Developer"></div>
      <div class="field"><label>الملخص المهني / Professional Summary</label><textarea id="f_summary" placeholder="نبذة موجزة / A concise professional summary"></textarea></div>

      <div class="row">
        <div class="field"><label>البريد / Email</label><input id="f_email" placeholder="you@example.com"></div>
        <div class="field"><label>الهاتف / Phone</label><input id="f_phone" placeholder="+973 …"></div>
      </div>
      <div class="row">
        <div class="field"><label>الموقع / Location</label><input id="f_loc" placeholder="المنامة، البحرين / Manama, Bahrain"></div>
        <div class="field"><label>LinkedIn</label><input id="f_linkedin" placeholder="linkedin.com/in/username"></div>
      </div>
      <div class="row">
        <div class="field"><label>الموقع الشخصي / Website</label><input id="f_site" placeholder="your-portfolio.com"></div>
        <div class="field"><label>لون التمييز / Accent</label><input id="f_accent" type="color" value="#0ea5a6"></div>
      </div>

      <div class="field">
        <label>صورة شخصية / Photo</label>
        <div class="uploader">
          <img id="avatarPrev" class="avatarPreview" alt="">
          <label class="btn" for="f_photo">اختر / Choose</label>
          <input id="f_photo" type="file" accept="image/*">
          <button type="button" class="btn" id="clearPhoto">حذف / Remove</button>
        </div>
        <div class="small">يفضّل مربعة 600×600 px.</div>
      </div>

      <!-- الخبرات -->
      <div class="subsec"><b>الخبرات العملية / Experience</b> <button class="btn" type="button" id="addExp">+ إضافة / Add</button></div>
      <div id="expList"></div>

      <!-- التعليم -->
      <div class="subsec"><b>التعليم / Education</b> <button class="btn" type="button" id="addEdu">+ إضافة / Add</button></div>
      <div id="eduList"></div>

      <!-- المشاريع -->
      <div class="subsec"><b>المشاريع / Projects</b> <button class="btn" type="button" id="addProj">+ إضافة / Add</button></div>
      <div id="projList"></div>

      <!-- المهارات -->
      <div class="subsec"><b>المهارات / Skills</b></div>
      <div class="field"><label>اكتبها بفواصل / Comma-separated</label>
        <input id="f_skills" placeholder="HTML, CSS, JavaScript, Python">
      </div>

      <!-- اللغات -->
      <div class="subsec"><b>اللغات / Languages</b> <button class="btn" type="button" id="addLang">+ إضافة / Add</button></div>
      <div id="langList"></div>

      <!-- الشهادات -->
      <div class="subsec"><b>الشهادات / Certificates</b> <button class="btn" type="button" id="addCert">+ إضافة / Add</button></div>
      <div id="certList"></div>

      <div class="subsec"><b>التنزيل / Export</b></div>
      <div class="row">
        <div class="field">
          <label>تنزيل PDF / Download PDF</label>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <button class="btn primary" id="btnPDF_AR" type="button">PDF (عربي)</button>
            <button class="btn primary" id="btnPDF_EN" type="button">PDF (English)</button>
          </div>
        </div>
        <div class="field">
          <label>تنزيل Word / Download Word</label>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <button class="btn" id="btnWord_AR" type="button">Word (AR)</button>
            <button class="btn" id="btnWord_EN" type="button">Word (EN)</button>
          </div>
        </div>
      </div>

      <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px">
        <button class="btn danger" id="btnClear" type="button">تفريغ / Clear</button>
      </div>

      <div class="small" style="margin-top:10px">💡 لنسخة PDF: نفتح صفحة طباعة للّغة المختارة، ثم اختر "حفظ بتنسيق PDF".</div>
    </section>

    <!-- ============ المعاينة ============ -->
    <section class="panel cv-wrap">
      <article id="cvPage" class="cv-page" aria-label="CV Preview">
        <header class="cv-head">
          <div>
            <h2 id="cvName" class="cv-name">اسمك الكامل هنا / Your Name</h2>
            <div id="cvRole" class="cv-role">المسمّى / Title</div>
            <p id="cvSummary" class="cv-summary">اكتب ملخصًا قصيرًا / Write a short summary.</p>
          </div>
          <img id="cvPhoto" class="cv-photo" alt="" />
        </header>

        <div class="cv-contact" id="cvContact">
          <span class="chip" id="cEmail">✉️ <b>you@example.com</b></span>
          <span class="chip" id="cPhone">📞 <b>+973 …</b></span>
          <span class="chip" id="cLoc">📍 <b>المنامة، البحرين / Manama, Bahrain</b></span>
          <span class="chip" id="cLinkedin">🔗 <b>LinkedIn</b></span>
          <span class="chip" id="cSite">🌐 <b>Website</b></span>
        </div>

        <div class="cv-cols">
          <div>
            <section class="sec" id="cvExp"><h3 data-i18n="exp">الخبرات العملية</h3><div class="item muted">أضف خبراتك…</div></section>
            <section class="sec" id="cvProj"><h3 data-i18n="projects">المشاريع</h3><div class="item muted">أضف مشاريعك…</div></section>
          </div>
          <div>
            <section class="sec" id="cvEdu"><h3 data-i18n="education">التعليم</h3><div class="item muted">أضف تعليمك…</div></section>
            <section class="sec" id="cvSkills"><h3 data-i18n="skills">المهارات</h3><div class="tags" id="cvSkillTags"><span class="muted">…</span></div></section>
            <section class="sec" id="cvLangs"><h3 data-i18n="languages">اللغات</h3><div id="cvLangList"><div class="muted">…</div></div></section>
            <section class="sec" id="cvCerts"><h3 data-i18n="certs">الشهادات / الدورات</h3><div id="cvCertList"><div class="muted">…</div></div></section>
          </div>
        </div>
      </article>
    </section>
  </div>

<script>
/* ================== Utilities & i18n ================== */
const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));
const S = {
  ar: {
    name:'اسمك الكامل هنا', role:'المسمّى/التخصص', summary:'اكتب ملخصًا قصيرًا عن خبرتك.',
    exp:'الخبرات العملية', projects:'المشاريع', education:'التعليم', skills:'المهارات', languages:'اللغات', certs:'الشهادات / الدورات',
    at:'في', range:(f,t)=>[f,t].filter(Boolean).join(' — '), bullet: s=>s
  },
  en: {
    name:'Your Full Name', role:'Title / Specialization', summary:'Write a concise professional summary.',
    exp:'Experience', projects:'Projects', education:'Education', skills:'Skills', languages:'Languages', certs:'Certificates',
    at:'at', range:(f,t)=>[f,t].filter(Boolean).join(' — '), bullet: s=>s
  }
};

/* Lightweight dictionary for common CV phrases (fallback for user text).
   For anything not found, we return the original text. */
const DICT = {
  // ar -> en
  ar2en: new Map(Object.entries({
    'المنامة':'Manama','البحرين':'Bahrain','الرياض':'Riyadh','جدة':'Jeddah',
    'المسمّى':'Title','التخصص':'Specialization','الخبرات العملية':'Experience','المشاريع':'Projects',
    'التعليم':'Education','المهارات':'Skills','اللغات':'Languages','الشهادات':'Certificates',
    'ملخص':'Summary','الآن':'Present','جامعة':'University','شركة':'Company','مطور':'Developer',
    'واجهة':'Frontend','خلفية':'Backend','مهندس':'Engineer','محلل':'Analyst','إدارة منتجات':'Product Management'
  })),
  // en -> ar
  en2ar: new Map(Object.entries({
    'Manama':'المنامة','Bahrain':'البحرين','Riyadh':'الرياض','Jeddah':'جدة',
    'Title':'المسمّى','Specialization':'التخصص','Experience':'الخبرات العملية','Projects':'المشاريع',
    'Education':'التعليم','Skills':'المهارات','Languages':'اللغات','Certificates':'الشهادات','Summary':'الملخص',
    'Present':'الآن','University':'جامعة','Company':'شركة','Developer':'مطور','Engineer':'مهندس','Analyst':'محلل'
  }))
};

/* naive translator: tries dictionary word-by-word; keeps unknown words */
function translateText(txt, to='en'){
  if(!txt) return '';
  const map = (to==='en') ? DICT.ar2en : DICT.en2ar;
  // split on spaces & punctuation, translate tokens when available
  return txt.split(/(\s+|[.,;:!?\-–—()\/])/g).map(tok=>{
    const k = tok.trim();
    if(!k) return tok;
    let t = map.get(k);
    if(!t){
      // try capitalized/lowercase
      t = map.get(k.toLowerCase()) || map.get(k[0]?.toUpperCase()+k.slice(1)) || null;
    }
    return t || tok;
  }).join('');
}

/* ================== Inputs, Photo, Accent ================== */
const uiLangSel = $('#uiLang');
const autoTranslateSel = $('#autoTranslate');
const f = {
  name: $('#f_name'), role: $('#f_role'), summary: $('#f_summary'),
  email: $('#f_email'), phone: $('#f_phone'), loc: $('#f_loc'),
  linkedin: $('#f_linkedin'), site: $('#f_site'), accent: $('#f_accent')
};

const photoInput = $('#f_photo'), photoPrev = $('#avatarPrev'), cvPhoto = $('#cvPhoto');
$('#clearPhoto').onclick = () => { photoInput.value=""; photoPrev.src=""; cvPhoto.src=""; cvPhoto.style.display="none"; renderPreview(); };
photoInput.addEventListener('change', e=>{
  const f = e.target.files[0]; if(!f) return;
  const reader = new FileReader();
  reader.onload = ev => { photoPrev.src = ev.target.result; cvPhoto.src = ev.target.result; cvPhoto.style.display='block'; renderPreview(); };
  reader.readAsDataURL(f);
});
Object.values(f).forEach(el=>el.addEventListener('input', renderPreview));
uiLangSel.addEventListener('change', ()=>{
  document.documentElement.lang = uiLangSel.value;
  document.documentElement.dir = uiLangSel.value==='ar' ? 'rtl' : 'ltr';
  renderPreview();
});
autoTranslateSel.addEventListener('change', renderPreview);

/* ================== Dynamic Lists ================== */
const expList = $('#expList'), eduList = $('#eduList'), projList = $('#projList'), langList = $('#langList'), certList = $('#certList');

function mkField(label, ph){ return `<div class="field"><label>${label}</label><input placeholder="${ph}"></div>`; }
function mkArea(label, ph){ return `<div class="field"><label>${label}</label><textarea placeholder="${ph}"></textarea></div>`; }
function mkDates(){ return `<div class="row-3">
  ${mkField('من/From','09/2022')}
  ${mkField('إلى/To','Present')}
  ${mkField('الموقع/Location','Manama, Bahrain')}
</div>`; }
function blockShell(title, inner){
  return `<div class="panel" style="padding:12px;margin-bottom:10px">
    <div class="subsec" style="margin-top:0"><b>${title}</b>
      <span>
        <button class="btn" type="button" data-up>⬆️</button>
        <button class="btn" type="button" data-down>⬇️</button>
        <button class="btn" type="button" data-del>🗑</button>
      </span>
    </div>${inner}
  </div>`;
}

function addExp(prefill={}){
  const html = blockShell('خبرة/Experience', `
    ${mkField('المسمّى/Title','Frontend Developer')}
    ${mkField('الشركة/Company','Tech Co.')}
    ${mkDates()}
    ${mkArea('المهام/الإنجازات | Responsibilities/Achievements','Built …\nImproved …')}
  `);
  expList.insertAdjacentHTML('beforeend', html); fillLatest(expList, prefill);
}
function addEdu(prefill={}){ 
  const html = blockShell('تعليم/Education', `
    ${mkField('الجهة/Institution','University of …')}
    ${mkField('الدرجة/التخصص | Degree/Major','B.Sc. Computer Science')}
    <div class="row-3">
      ${mkField('البدء/Start','2019')}
      ${mkField('التخرج/End','2023')}
      ${mkField('المعدل/GPA','3.6 / 4')}
    </div>
    ${mkArea('تفاصيل/Details (اختياري/Optional)','Courses: …')}
  `);
  eduList.insertAdjacentHTML('beforeend', html); fillLatest(eduList, prefill);
}
function addProj(prefill={}){ 
  const html = blockShell('مشروع/Project', `
    ${mkField('اسم/Name','Task Manager App')}
    ${mkField('تقنيات/Tech','React, Node')}
    ${mkField('رابط/Link','https://…')}
    ${mkArea('الوصف/Description','Implemented auth …')}
  `);
  projList.insertAdjacentHTML('beforeend', html); fillLatest(projList, prefill);
}
function addLang(prefill={}){ 
  const html = blockShell('لغة/Language', `
    <div class="row">
      ${mkField('اللغة/Language','Arabic')}
      <div class="field"><label>المستوى/Level</label>
        <select>
          <option>Basic</option><option>Intermediate</option><option selected>Advanced</option><option>Fluent</option>
        </select>
      </div>
    </div>
  `);
  langList.insertAdjacentHTML('beforeend', html); fillLatest(langList, prefill);
}
function addCert(prefill={}){ 
  const html = blockShell('شهادة/Certificate', `
    ${mkField('الاسم/Name','Google Data Analytics')}
    <div class="row">
      ${mkField('الجهة/Issuer','Google')}
      ${mkField('السنة/Year','2024')}
    </div>
  `);
  certList.insertAdjacentHTML('beforeend', html); fillLatest(certList, prefill);
}

$('#addExp').onclick=()=>addExp();
$('#addEdu').onclick=()=>addEdu();
$('#addProj').onclick=()=>addProj();
$('#addLang').onclick=()=>addLang();
$('#addCert').onclick=()=>addCert();

document.addEventListener('click', e=>{
  const card = e.target.closest('.panel'); if(!card) return;
  if(e.target.matches('[data-del]')){ card.remove(); renderPreview(); }
  if(e.target.matches('[data-up]') && card.previousElementSibling){ card.parentElement.insertBefore(card, card.previousElementSibling); renderPreview(); }
  if(e.target.matches('[data-down]') && card.nextElementSibling){ card.parentElement.insertBefore(card.nextElementSibling, card); renderPreview(); }
});
document.addEventListener('input', e=>{
  if(e.target.closest('#expList,#eduList,#projList,#langList,#certList')) renderPreview();
});

function fillLatest(container, data){
  const card = container.lastElementChild;
  if(!card) return;
  const inputs = card.querySelectorAll('input, textarea, select');
  Object.entries(data).forEach(([i,v],idx)=>{ if(inputs[idx]) inputs[idx].value=v; });
  renderPreview();
}
function readBlocks(container){
  return Array.from(container.children).map(panel=>{
    const fields = panel.querySelectorAll('input,textarea,select');
    return Array.from(fields).map(el=>el.value.trim());
  });
}

/* ================== Rendering ================== */
function bullets(text){ return (text||'').split(/\r?\n/).filter(l=>l.trim()).map(l=>'• '+l.trim()).join('\n'); }
function setChip(id, icon, text, label){
  const el=$(id);
  if(text){ el.style.display='inline-flex'; el.innerHTML=`${icon} <b>${label||text}</b>`; } else { el.style.display='none'; }
}
function renderPreview(){
  // accent
  document.documentElement.style.setProperty('--accent', f.accent.value||'#0ea5a6');
  // header
  $('#cvName').textContent = f.name.value || 'اسمك الكامل هنا / Your Name';
  $('#cvRole').textContent = f.role.value || 'المسمّى / Title';
  $('#cvSummary').textContent = f.summary.value || 'اكتب ملخصًا قصيرًا / Write a short summary.';

  if($('#cvPhoto').src){ $('#cvPhoto').style.display='block'; }

  setChip('#cEmail','✉️', f.email.value);
  setChip('#cPhone','📞', f.phone.value);
  setChip('#cLoc','📍', f.loc.value || 'Manama, Bahrain');
  setChip('#cLinkedin','🔗', f.linkedin.value, 'LinkedIn');
  setChip('#cSite','🌐', f.site.value, 'Website');

  // section headings per UI language
  const lang = uiLangSel.value;
  $$('[data-i18n="exp"]').forEach(h=>h.textContent=S[lang].exp);
  $$('[data-i18n="projects"]').forEach(h=>h.textContent=S[lang].projects);
  $$('[data-i18n="education"]').forEach(h=>h.textContent=S[lang].education);
  $$('[data-i18n="skills"]').forEach(h=>h.textContent=S[lang].skills);
  $$('[data-i18n="languages"]').forEach(h=>h.textContent=S[lang].languages);
  $$('[data-i18n="certs"]').forEach(h=>h.textContent=S[lang].certs);

  // lists
  renderListsTo($('#cvExp'), readBlocks(expList), 'exp');
  renderListsTo($('#cvProj'), readBlocks(projList), 'proj');
  renderListsTo($('#cvEdu'), readBlocks(eduList), 'edu');
  renderSkills();
  renderLangs(readBlocks(langList));
  renderCerts(readBlocks(certList));
}

function renderListsTo(container, arrs, type){
  const lang = uiLangSel.value;
  container.innerHTML = `<h3 data-i18n="${type==='exp'?'exp':type==='proj'?'projects':'education'}">${S[lang][type==='exp'?'exp':type==='proj'?'projects':'education']}</h3>`;
  if(arrs.length===0){ container.insertAdjacentHTML('beforeend', `<div class="item muted">—</div>`); return; }
  arrs.forEach(a=>{
    if(type==='exp'){
      const [title, company, from, to, place, desc] = [a[0],a[1],a[2],a[3],a[4],a[5]||''];
      container.insertAdjacentHTML('beforeend', `
        <div class="item">
          <div class="top"><div>${title||'Title'} <span class="accentDot"></span> ${company||''}</div><div class="meta">${S[lang].range(from,to)}</div></div>
          <div class="meta">${place||''}</div>
          <div class="desc">${bullets(desc)}</div>
        </div>
      `);
    }else if(type==='proj'){
      const [name, techs, link, desc] = [a[0],a[1],a[2],a[3]||''];
      const linkHtml = link? ` — <a href="${link}" target="_blank" rel="noopener" style="color:var(--accent);font-weight:800">${link}</a>`:'';
      container.insertAdjacentHTML('beforeend', `
        <div class="item">
          <div class="top"><div>${name||'Project'}</div><div class="meta">${techs||''}</div></div>
          <div class="desc">${bullets(desc)}${linkHtml}</div>
        </div>
      `);
    }else{
      const [org, degree, start, end, gpa, details] = [a[0],a[1],a[2],a[3],a[4],a[5]||''];
      container.insertAdjacentHTML('beforeend', `
        <div class="item">
          <div class="top"><div>${org||'Institution'}</div><div class="meta">${S[lang].range(start,end)}</div></div>
          <div class="meta">${degree||''}${gpa?` — GPA: ${gpa}`:''}</div>
          ${details?`<div class="desc">${bullets(details)}</div>`:''}
        </div>
      `);
    }
  });
}

function renderSkills(){
  const tags = (f.skills.value||'').split(',').map(s=>s.trim()).filter(Boolean);
  const cvSkillTags = $('#cvSkillTags'); cvSkillTags.innerHTML='';
  if(tags.length===0){ cvSkillTags.innerHTML='<span class="muted">…</span>'; }
  else tags.forEach(t=>cvSkillTags.insertAdjacentHTML('beforeend', `<span class="tag">${t}</span>`));
}
function renderLangs(arrs){
  const cvLangList = $('#cvLangList'); cvLangList.innerHTML='';
  if(arrs.length===0){ cvLangList.innerHTML='<div class="muted">…</div>'; return; }
  arrs.forEach(a=>{
    const [name, level] = [a[0],a[1]||''];
    cvLangList.insertAdjacentHTML('beforeend', `<div class="langRow"><b>${name||'Language'}</b><span class="muted">${level}</span></div>`);
  });
}
function renderCerts(arrs){
  const cvCertList = $('#cvCertList'); cvCertList.innerHTML='';
  if(arrs.length===0){ cvCertList.innerHTML='<div class="muted">…</div>'; return; }
  arrs.forEach(a=>{
    const [name, issuer, year] = [a[0],a[1],a[2]];
    cvCertList.insertAdjacentHTML('beforeend', `
      <div class="item"><div class="top"><div>${name||'Certificate'}</div><div class="meta">${year||''}</div></div>
      <div class="meta">${issuer||''}</div></div>
    `);
  });
}

/* ================== Build CV Node per language ================== */
function makeCVNode(lang='ar'){
  const src = $('#cvPage').cloneNode(true);
  // headings
  src.querySelectorAll('[data-i18n]').forEach(el=>{
    const key = el.getAttribute('data-i18n');
    el.textContent = S[lang][key];
  });
  // header
  const name = f.name.value || (lang==='ar'? S.ar.name : S.en.name);
  const role = f.role.value || (lang==='ar'? S.ar.role : S.en.role);
  const sum  = f.summary.value || (lang==='ar'? S.ar.summary : S.en.summary);

  const auto = autoTranslateSel.value==='on';
  const tr = (t)=> auto ? (lang==='en'? translateText(t,'en') : translateText(t,'ar')) : t;

  src.querySelector('#cvName').textContent   = lang==='en' ? tr(name) : tr(name);
  src.querySelector('#cvRole').textContent   = lang==='en' ? tr(role) : tr(role);
  src.querySelector('#cvSummary').textContent= lang==='en' ? tr(sum)  : tr(sum);

  // contact chips (translate location mainly)
  const chips = {
    cEmail: f.email.value, cPhone: f.phone.value, cLoc: f.loc.value,
    cLinkedin: f.linkedin.value?'LinkedIn':'', cSite: f.site.value?'Website':''
  };
  Object.entries(chips).forEach(([id,val])=>{
    const el = src.querySelector('#'+id);
    if(!el) return;
    if(!val){ el.style.display='none'; return; }
    if(id==='cLoc' && val){ el.innerHTML = `📍 <b>${lang==='en'? translateText(val,'en'): translateText(val,'ar')}</b>`; }
    else if(id==='cEmail'){ el.innerHTML = `✉️ <b>${val}</b>`; }
    else if(id==='cPhone'){ el.innerHTML = `📞 <b>${val}</b>`; }
    else if(id==='cLinkedin'){ el.innerHTML = `🔗 <b>${lang==='en'?'LinkedIn':'لينكدإن'}</b>`; }
    else if(id==='cSite'){ el.innerHTML = `🌐 <b>${lang==='en'?'Website':'موقع إلكتروني'}</b>`; }
    el.style.display='inline-flex';
  });

  // direction + fonts
  src.setAttribute('dir', lang==='ar'?'rtl':'ltr');
  src.setAttribute('lang', lang);

  // translate body lists
  function trBullets(txt){ return auto ? translateText(bullets(txt), lang==='en'?'en':'ar') : bullets(txt); }

  // Experience
  const cvExp = src.querySelector('#cvExp'); cvExp.innerHTML = `<h3>${S[lang].exp}</h3>`;
  readBlocks(expList).forEach(a=>{
    const [title, company, from, to, place, desc] = [a[0],a[1],a[2],a[3],a[4],a[5]||''];
    const titleT = auto? translateText(title, lang): title;
    const companyT = auto? translateText(company, lang): company;
    const placeT = auto? translateText(place, lang): place;
    cvExp.insertAdjacentHTML('beforeend', `
      <div class="item">
        <div class="top"><div>${(titleT||'')}${companyT?` <span class="accentDot"></span> ${companyT}`:''}</div><div class="meta">${S[lang].range(from,to)}</div></div>
        <div class="meta">${placeT||''}</div>
        <div class="desc">${trBullets(desc)}</div>
      </div>
    `);
  });
  if(!expList.children.length) cvExp.insertAdjacentHTML('beforeend', `<div class="item muted">—</div>`);

  // Projects
  const cvProj = src.querySelector('#cvProj'); cvProj.innerHTML = `<h3>${S[lang].projects}</h3>`;
  readBlocks(projList).forEach(a=>{
    const [name, techs, link, desc] = [a[0],a[1],a[2],a[3]||''];
    const nameT = auto? translateText(name, lang): name;
    const techsT= auto? translateText(techs, lang): techs;
    cvProj.insertAdjacentHTML('beforeend', `
      <div class="item">
        <div class="top"><div>${nameT||''}</div><div class="meta">${techsT||''}</div></div>
        <div class="desc">${trBullets(desc)}${link?` — <a href="${link}" target="_blank" rel="noopener" style="color:var(--accent);font-weight:800">${link}</a>`:''}</div>
      </div>
    `);
  });
  if(!projList.children.length) cvProj.insertAdjacentHTML('beforeend', `<div class="item muted">—</div>`);

  // Education
  const cvEdu = src.querySelector('#cvEdu'); cvEdu.innerHTML = `<h3>${S[lang].education}</h3>`;
  readBlocks(eduList).forEach(a=>{
    const [org, degree, start, end, gpa, details] = [a[0],a[1],a[2],a[3],a[4],a[5]||''];
    const orgT = auto? translateText(org, lang): org;
    const degreeT = auto? translateText(degree, lang): degree;
    cvEdu.insertAdjacentHTML('beforeend', `
      <div class="item">
        <div class="top"><div>${orgT||''}</div><div class="meta">${S[lang].range(start,end)}</div></div>
        <div class="meta">${degreeT||''}${gpa?` — ${lang==='en'?'GPA':'المعدل'}: ${gpa}`:''}</div>
        ${details?`<div class="desc">${trBullets(details)}</div>`:''}
      </div>
    `);
  });
  if(!eduList.children.length) cvEdu.insertAdjacentHTML('beforeend', `<div class="item muted">—</div>`);

  // Skills
  const skills = (f.skills.value||'').split(',').map(s=>s.trim()).filter(Boolean);
  const cvSkillTags = src.querySelector('#cvSkillTags'); cvSkillTags.innerHTML='';
  if(skills.length===0){ cvSkillTags.innerHTML='<span class="muted">…</span>'; }
  else skills.forEach(t=>{
    const t2 = auto? translateText(t, lang): t;
    cvSkillTags.insertAdjacentHTML('beforeend', `<span class="tag">${t2}</span>`);
  });

  // Languages
  const cvLangList = src.querySelector('#cvLangList'); cvLangList.innerHTML='';
  const langs = readBlocks(langList);
  if(langs.length===0){ cvLangList.innerHTML='<div class="muted">…</div>'; }
  else langs.forEach(a=>{
    const [name, level] = [a[0],a[1]||''];
    const nameT = auto? translateText(name, lang): name;
    const levelT = auto? translateText(level, lang): level;
    cvLangList.insertAdjacentHTML('beforeend', `<div class="langRow"><b>${nameT||''}</b><span class="muted">${levelT}</span></div>`);
  });

  // Certs
  const cvCertList = src.querySelector('#cvCertList'); cvCertList.innerHTML='';
  const certs = readBlocks(certList);
  if(certs.length===0){ cvCertList.innerHTML='<div class="muted">…</div>'; }
  else certs.forEach(a=>{
    const [name, issuer, year] = [a[0],a[1],a[2]];
    const nameT = auto? translateText(name, lang): name;
    const issuerT = auto? translateText(issuer, lang): issuer;
    cvCertList.insertAdjacentHTML('beforeend', `
      <div class="item"><div class="top"><div>${nameT||''}</div><div class="meta">${year||''}</div></div>
      <div class="meta">${issuerT||''}</div></div>
    `);
  });

  // ensure photo present in clone
  const srcPhoto = $('#cvPhoto'); const dstPhoto = src.querySelector('#cvPhoto');
  if(srcPhoto && srcPhoto.src){ dstPhoto.src = srcPhoto.src; dstPhoto.style.display='block'; } else { dstPhoto.style.display='none'; }

  return src;
}

/* ================== Export ================== */
function exportWord(lang='ar'){
  const cv = makeCVNode(lang);
  cv.style.border='none'; cv.style.boxShadow='none'; cv.style.width='100%'; cv.style.minHeight='auto';
  const html = `<!DOCTYPE html>
<html lang="${lang}" dir="${lang==='ar'?'rtl':'ltr'}">
<head><meta charset="utf-8"><title>CV</title>
<style>
  body{font-family:"Tajawal",sans-serif;color:#111827;direction:${lang==='ar'?'rtl':'ltr'};line-height:1.6}
  h2{font-family:"Reem Kufi",sans-serif}
  a{color:#0ea5a6}
  .cv-page{width:100%}
</style>
</head>
<body>${cv.outerHTML}</body></html>`;
  const blob = new Blob([html], {type:'application/msword'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  const fname = (f.name.value|| (lang==='ar'?'سيرة_ذاتية':'CV')).replace(/\s+/g,'_');
  a.href = url; a.download = `${fname}-${lang.toUpperCase()}.doc`; document.body.appendChild(a); a.click(); a.remove();
  URL.revokeObjectURL(url);
}

function exportPDF(lang='ar'){
  const cv = makeCVNode(lang);
  const w = window.open('', '_blank');
  const html = `<!DOCTYPE html>
<html lang="${lang}" dir="${lang==='ar'?'rtl':'ltr'}">
<head><meta charset="utf-8"><title>CV ${lang.toUpperCase()}</title>
<link href="https://fonts.googleapis.com/css2?family=Reem+Kufi:wght@600&family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root{--accent:${f.accent.value||'#0ea5a6'}}
  body{margin:0;font-family:"Tajawal",sans-serif;background:#fff;color:#111827}
  .cv-page{width:210mm;min-height:297mm;margin:auto}
  .cv-head{display:grid;grid-template-columns:1fr 140px;gap:16px;padding:22px 22px 0}
  .cv-name{margin:0;font-family:"Reem Kufi",sans-serif;font-size:28px}
  .cv-role{margin:6px 0 10px;font-weight:800;color:#0b3b3a}
  .cv-summary{color:#334155;line-height:1.8;white-space:pre-line}
  .cv-photo{width:120px;height:120px;border-radius:14px;border:2px solid var(--accent);object-fit:cover;justify-self:end;background:#f1f5f9}
  .cv-contact{display:flex;flex-wrap:wrap;gap:8px;margin:14px 22px 0}
  .chip{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border:1px solid #e5e7eb;border-radius:999px;background:#f8fafc;font-weight:700}
  .cv-cols{display:grid;grid-template-columns:1.1fr .9fr;gap:16px;padding:14px 22px 22px}
  .sec{margin-top:8px}
  .sec h3{margin:0 0 8px;font-size:15px;color:#0f172a;border-bottom:2px solid var(--accent);display:inline-block;padding-bottom:2px}
  .item{margin:10px 0}
  .item .top{display:flex;justify-content:space-between;font-weight:800}
  .item .meta{color:#475569;font-size:.92rem}
  .item .desc{margin-top:6px;color:#334155;white-space:pre-line}
  .tags{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
  .tag{padding:6px 10px;border-radius:999px;background:#eef6ff;border:1px solid #dbeafe;font-weight:800}
  .langRow{display:flex;justify-content:space-between;border:1px dashed #e5e7eb;border-radius:10px;padding:8px 10px;margin-top:8px}
  @page{size:A4;margin:12mm}
</style>
</head>
<body>${cv.outerHTML}
<script>window.onload=()=>setTimeout(()=>window.print(),200);<\/script>
</body></html>`;
  w.document.open(); w.document.write(html); w.document.close();
}

/* Buttons */
$('#btnWord_AR').onclick = ()=>exportWord('ar');
$('#btnWord_EN').onclick = ()=>exportWord('en');
$('#btnPDF_AR').onclick  = ()=>exportPDF('ar');
$('#btnPDF_EN').onclick  = ()=>exportPDF('en');

/* Clear */
$('#btnClear').onclick = ()=>{
  if(!confirm('تفريغ جميع الحقول؟ / Clear all fields?')) return;
  $$('input, textarea').forEach(el=>{
    if(el.type==='color') return;
    if(el.type==='file'){ el.value=''; return; }
    el.value='';
  });
  expList.innerHTML=''; eduList.innerHTML=''; projList.innerHTML='';
  langList.innerHTML=''; certList.innerHTML='';
  $('#cvPhoto').src=''; $('#cvPhoto').style.display='none'; photoPrev.src='';
  renderPreview();
};

/* ====== Demo data & initial render ====== */
addExp({0:'Frontend Developer',1:'Modern Tech Co.',2:'09/2022',3:'Present',4:'Manama, Bahrain',5:'Built interactive dashboards.\nImproved performance by 35%.\nLed RTL accessibility.'});
addEdu({0:'University of Bahrain',1:'B.Sc. Computer Science',2:'2018',3:'2022',4:'3.6 / 4',5:'Capstone: Task tracking system using React.'});
addProj({0:'CV Builder',1:'HTML, CSS, JS',2:'',3:'Bilingual CV generator (RTL/LTR) with PDF/Word export.'});
addLang({0:'Arabic',1:'Fluent'});
addLang({0:'English',1:'Advanced'});
addCert({0:'Google Data Analytics',1:'Google',2:'2024'});

f.name.value='اسمك الكامل هنا / Your Full Name';
f.role.value='مطوّر واجهات / Frontend Developer';
f.loc.value='المنامة، البحرين / Manama, Bahrain';
f.email.value='you@example.com';
f.phone.value='+973 …';
f.summary.value='مختص بتطوير الويب (RTL) وتحسين الأداء.\nWeb developer focused on performance & UX.';
f.accent.value='#0ea5a6';
f.skills.value='HTML, CSS, JavaScript, React, Git, Figma';

renderPreview();
</script>
</body>
</html>
