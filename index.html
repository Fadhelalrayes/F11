<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ø®Ø· Ø§Ù„ØªÙ…Ø§Ø³ Ø§Ù„Ø£Ø®Ø¨Ø§Ø±ÙŠ</title>
<style>
  :root{
    --bg:#0b0f14; --card:#111827; --muted:#93a4b1; --text:#e6edf3; --acc:#00d3a7; --accent-weak:#0fd3a7;
    --chip:#0f172a; --chip-b:#1f2937; --shadow: 0 10px 30px rgba(0,0,0,.35);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:linear-gradient(180deg, #0b0f14 0%, #0b1220 100%);
    color:var(--text); font:16px/1.6 "Cairo","Tajawal",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  }
  header{
    position:sticky; top:0; z-index:10; backdrop-filter:saturate(140%) blur(6px);
    background:linear-gradient(180deg, rgba(7,12,18,.85), rgba(7,12,18,.55));
    border-bottom:1px solid rgba(255,255,255,.06);
  }
  .container{max-width:1200px; margin:auto; padding:20px}
  .brand{
    display:flex; align-items:center; gap:14px;
  }
  .logo{
    width:44px; height:44px; border-radius:12px; display:grid; place-items:center;
    background:radial-gradient(circle at 30% 30%, var(--acc), #027a97 60%, #013a45 100%);
    box-shadow: 0 10px 30px rgba(0, 211, 167, .25), inset 0 0 30px rgba(255,255,255,.08);
  }
  .logo svg{width:28px; height:28px; fill:white}
  h1{margin:0; font-size:1.6rem; letter-spacing:0.3px}
  .tagline{color:var(--muted); font-size:.95rem; margin-top:2px}
  .toolbar{display:flex; align-items:center; gap:10px; flex-wrap:wrap}
  .toolbar .chip{
    background:linear-gradient(180deg,var(--chip),var(--chip-b)); color:#cfe7ff;
    padding:8px 12px; border:1px solid rgba(255,255,255,.06); border-radius:999px; font-size:.9rem;
    display:flex; align-items:center; gap:8px;
  }
  .btn{
    border:1px solid rgba(255,255,255,.1); background:#0b1420; color:var(--text);
    border-radius:12px; padding:10px 14px; cursor:pointer; transition:.2s; font-weight:600;
  }
  .btn:hover{transform:translateY(-1px); border-color:rgba(255,255,255,.2)}
  .grid{
    display:grid; gap:16px; margin-top:14px;
    grid-template-columns: repeat( auto-fill, minmax(280px, 1fr) );
  }
  article.card{
    background:linear-gradient(180deg, #0c1522, #0e1a2b);
    border:1px solid rgba(255,255,255,.06); border-radius:18px; padding:16px;
    box-shadow:var(--shadow); display:flex; flex-direction:column; gap:10px; position:relative; overflow:hidden;
  }
  .badge{display:inline-flex; gap:8px; align-items:center; font-size:.8rem;
    color:#bfe; background:rgba(0,211,167,.08); border:1px solid rgba(0,211,167,.25);
    padding:6px 10px; border-radius:999px; width:max-content}
  .title{font-size:1.05rem; font-weight:800; margin:4px 0 0}
  .excerpt{color:#d0dae4; font-size:.95rem}
  .meta{display:flex; gap:10px; color:var(--muted); font-size:.8rem}
  .card-top{display:flex; align-items:flex-start; gap:8px}
  .more{
    margin-inline-start:auto; width:36px; height:36px; border-radius:10px; border:1px solid rgba(255,255,255,.1);
    background:rgba(255,255,255,.02); display:grid; place-items:center; cursor:pointer; transition:.2s;
  }
  .more:hover{transform:translateY(-1px); border-color:rgba(255,255,255,.22)}
  .more svg{width:18px; height:18px}
  details{border-top:1px dashed rgba(255,255,255,.08); padding-top:10px}
  details[open] summary{opacity:.6}
  summary{list-style:none; cursor:pointer; display:flex; align-items:center; gap:8px}
  summary::-webkit-details-marker{display:none}
  .empty, .error{
    text-align:center; color:var(--muted); padding:50px 20px; border:1px dashed rgba(255,255,255,.08);
    border-radius:18px; background:linear-gradient(180deg,#0c1420,#0c1827)
  }
  .footer-note{color:var(--muted); font-size:.8rem; text-align:center; margin:24px 0 10px}
  .pulse{display:inline-block; width:8px; height:8px; border-radius:999px; background:var(--accent-weak); box-shadow:0 0 0 0 rgba(15,211,167,.8); animation:pulse 2s infinite}
  @keyframes pulse{ 0%{box-shadow:0 0 0 0 rgba(15,211,167,.8)} 70%{box-shadow:0 0 0 12px rgba(15,211,167,0)} 100%{box-shadow:0 0 0 0 rgba(15,211,167,0)} }
</style>
</head>
<body>
  <header>
    <div class="container" style="display:flex; align-items:center; justify-content:space-between; gap:16px; flex-wrap:wrap">
      <div class="brand">
        <div class="logo" aria-hidden="true" title="Ø´Ø¹Ø§Ø± Ø®Ø· Ø§Ù„ØªÙ…Ø§Ø³">
          <!-- ÙƒØ±Ø© + Ø®Ø· ØªÙ…Ø§Ø³ -->
          <svg viewBox="0 0 24 24" role="img" aria-label="ÙƒØ±Ø©">
            <path d="M12 2a10 10 0 1 0 10 10A10.012 10.012 0 0 0 12 2Zm0 2a8 8 0 1 1-8 8 8.009 8.009 0 0 1 8-8Zm4.5 6.75h-9a.75.75 0 0 0 0 1.5h9a.75.75 0 0 0 0-1.5Z"/>
          </svg>
        </div>
        <div>
          <h1>Ø®Ø· Ø§Ù„ØªÙ…Ø§Ø³ Ø§Ù„Ø£Ø®Ø¨Ø§Ø±ÙŠ</h1>
          <div class="tagline">Ø¢Ø®Ø± Ù…Ø³ØªØ¬Ø¯Ø§Øª Ø§Ù„Ø±ÙŠØ§Ø¶Ø© â€” ØªØªØ­Ø¯Ù‘Ø« ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©</div>
        </div>
      </div>
      <div class="toolbar">
        <div class="chip" id="liveChip"><span class="pulse" aria-hidden="true"></span> ØªØ­Ø¯ÙŠØ« ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©</div>
        <div class="chip" id="lastUpdated">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: Ø§Ù„Ø¢Ù†</div>
        <button class="btn" id="refreshBtn" type="button">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¢Ù†</button>
      </div>
    </div>
  </header>

  <main class="container">
    <section id="news" class="grid" aria-live="polite" aria-busy="true"></section>
    <div id="status" class="empty" hidden>ÙŠØªÙ… Ø¬Ù„Ø¨ Ø§Ù„Ø£Ø®Ø¨Ø§Ø±â€¦</div>

    <p class="footer-note">ÙŠØ¹Ø±Ø¶ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† ÙˆØ§Ù„Ù…Ù‚ØªØ·ÙØ§Øª ÙÙ‚Ø· (Ø¨Ø¯ÙˆÙ† Ø±ÙˆØ§Ø¨Ø· Ø£Ùˆ Ù…ØµØ§Ø¯Ø±). ÙŠØªÙ… Ø¯Ù…Ø¬ Ø¹Ø¯Ø© Ø®Ù„Ø§ØµØ§Øª Ø±ÙŠØ§Ø¶ÙŠØ© ÙˆÙØ±Ø²Ù‡Ø§ Ø­Ø³Ø¨ Ø§Ù„Ø£Ø­Ø¯Ø«.</p>
  </main>

<script>
(() => {
  // â€”â€”â€” Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª â€”â€”â€”
  const MINUTE = 60_000;
  const FEEDS = [
    // Ù†Ø³ØªØ®Ø¯Ù… ÙˆÙƒÙŠÙ„ CORS Ø¹Ø§Ù… Ù„Ø¬Ù„Ø¨ RSS Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ù† Ø§Ù„Ù…ØªØµÙØ­
    'https://api.allorigins.win/raw?url=' + encodeURIComponent('https://www.espn.com/espn/rss/news'),
    'https://api.allorigins.win/raw?url=' + encodeURIComponent('https://feeds.bbci.co.uk/sport/rss.xml'),
    'https://api.allorigins.win/raw?url=' + encodeURIComponent('https://www.skysports.com/rss/12040'),
    'https://api.allorigins.win/raw?url=' + encodeURIComponent('https://www.reuters.com/rssFeed/sportsNews')
  ];
  const LIMIT = 36; // Ø¹Ø¯Ø¯ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø©
  const REFRESH_EVERY = MINUTE; // ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©

  const $grid = document.getElementById('news');
  const $status = document.getElementById('status');
  const $last = document.getElementById('lastUpdated');
  const $btn = document.getElementById('refreshBtn');

  let lastTitles = new Set();

  function relativeTime(date){
    try{
      const d = (date instanceof Date) ? date : new Date(date);
      const diff = (Date.now() - d.getTime())/1000;
      const abs = Math.abs(diff);
      const rtf = new Intl.RelativeTimeFormat('ar', {numeric:'auto'});
      if(abs < 60) return 'Ø§Ù„Ø¢Ù†';
      if(abs < 3600) return rtf.format(Math.round(-diff/60), 'minute');
      if(abs < 86400) return rtf.format(Math.round(-diff/3600), 'hour');
      return rtf.format(Math.round(-diff/86400), 'day');
    }catch{ return ''; }
  }

  function strip(html){
    const tmp = document.createElement('div');
    tmp.innerHTML = (html || '').replace(/<script[^>]*>[\s\S]*?<\/script>/gi,'');
    return (tmp.textContent || tmp.innerText || '').replace(/\s+/g,' ').trim();
  }

  function parseFeed(xmlText){
    const out = [];
    const xml = new DOMParser().parseFromString(xmlText, 'text/xml');

    // Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø¹Ø§Ù…Ø© Ù„Ù€ RSS Ùˆ Atom
    const items = Array.from(xml.querySelectorAll('item'));
    const entries = Array.from(xml.querySelectorAll('entry'));
    const nodes = items.length ? items : entries;

    for(const n of nodes){
      const title = (n.querySelector('title')?.textContent || '').trim();
      if(!title) continue;

      const desc = n.querySelector('description, summary, content')?.textContent || '';
      const pub = n.querySelector('pubDate, updated, published')?.textContent || new Date().toISOString();
      const date = new Date(pub);
      out.push({
        title,
        excerpt: strip(desc).slice(0, 240),
        date: isNaN(date.getTime()) ? new Date() : date
      });
    }
    return out;
  }

  function card({title, excerpt, date}){
    const id = btoa(unescape(encodeURIComponent(title))).slice(0,24);
    return `
      <article class="card" data-id="${id}">
        <div class="card-top">
          <span class="badge" aria-label="ØªØµÙ†ÙŠÙ Ø§Ù„Ø®Ø¨Ø±">âš½ Ø±ÙŠØ§Ø¶Ø©</span>
          <button class="more" title="Ù…Ø²ÙŠØ¯" aria-label="Ù…Ø²ÙŠØ¯ (ÙØªØ­ Ø§Ù„Ù…Ù‚ØªØ·Ù)">
            <!-- Ø£ÙŠÙ‚ÙˆÙ†Ø© Â«Ù…Ø²ÙŠØ¯Â»: Ø«Ù„Ø§Ø« Ù†Ù‚Ø§Ø· Ø¯Ø§Ø®Ù„ Ø¯Ø§Ø¦Ø±Ø© -->
            <svg viewBox="0 0 24 24" role="img" aria-label="Ù…Ø²ÙŠØ¯">
              <path fill="currentColor" d="M12 2a10 10 0 1 0 .001 20.001A10 10 0 0 0 12 2Zm-4 9a1 1 0 1 1 0 2 1 1 0 0 1 0-2Zm4 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2Zm4 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2Z"/>
            </svg>
          </button>
        </div>
        <h2 class="title">${escapeHTML(title)}</h2>
        <div class="meta">ğŸ•’ <span>${escapeHTML(relativeTime(date))}</span></div>
        <details>
          <summary>Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù‚ØªØ·Ù</summary>
          <p class="excerpt">${escapeHTML(excerpt || 'â€”')}</p>
        </details>
      </article>
    `;
  }

  function escapeHTML(s){
    return (s||'').replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;');
  }

  async function fetchOne(url){
    const r = await fetch(url, {cache:'no-store'});
    if(!r.ok) throw new Error('HTTP '+r.status);
    return await r.text();
  }

  async function load(){
    $grid.setAttribute('aria-busy','true');
    $status.hidden = false;
    $status.textContent = 'ÙŠØªÙ… Ø¬Ù„Ø¨ Ø§Ù„Ø£Ø®Ø¨Ø§Ø±â€¦';

    try{
      const texts = await Promise.allSettled(FEEDS.map(fetchOne));
      const items = texts
        .filter(x => x.status === 'fulfilled')
        .flatMap(x => parseFeed(x.value));

      // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙƒØ±Ø§Ø± Ø¨Ø§Ù„Ø¹Ù†ÙˆØ§Ù† + ÙØ±Ø² Ø²Ù…Ù†ÙŠ
      const seen = new Set();
      const unique = [];
      for(const it of items){
        const key = it.title.trim().toLowerCase();
        if(seen.has(key)) continue;
        seen.add(key);
        unique.push(it);
      }
      unique.sort((a,b) => b.date - a.date);

      // Ø¥Ø¨Ø±Ø§Ø² Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù…Ù‚Ø§Ø±Ù†Ø© Ø¨Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø§Ø¨Ù‚
      const fresh = [];
      for(const it of unique){
        if(!lastTitles.has(it.title)) fresh.push(it.title);
      }
      lastTitles = new Set(unique.map(x => x.title));

      // Ø±Ø³Ù…
      const limited = unique.slice(0, LIMIT);
      if(!limited.length){
        $grid.innerHTML = '';
        $status.hidden = false;
        $status.className = 'empty';
        $status.textContent = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù†Ø§ØµØ± Ù…Ù†Ø§Ø³Ø¨Ø© Ø§Ù„Ø¢Ù†. Ø³ÙŠØªÙ… Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§.';
      } else {
        $status.hidden = true;
        $grid.innerHTML = limited.map(card).join('');
        // ÙˆÙ…ÙŠØ¶ Ø®ÙÙŠÙ Ù„Ù„Ø¬Ø¯ÙŠØ¯
        for(const t of fresh.slice(0, LIMIT)){
          const id = btoa(unescape(encodeURIComponent(t))).slice(0,24);
          const el = $grid.querySelector(`[data-id="${id}"]`);
          if(el){
            el.animate([{transform:'scale(1)', boxShadow:'var(--shadow)'},
                        {transform:'scale(1.015)', boxShadow:'0 8px 30px rgba(0,211,167,.35)'},
                        {transform:'scale(1)', boxShadow:'var(--shadow)'}],
                        {duration:600, easing:'ease-out'});
          }
        }
      }

      const ts = new Date();
      $last.textContent = 'Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ' + ts.toLocaleTimeString('ar', {hour:"2-digit", minute:"2-digit"});
    } catch(e){
      console.error(e);
      $grid.innerHTML = '';
      $status.hidden = false;
      $status.className = 'error';
      $status.textContent = 'ØªØ¹Ø°Ù‘Ø± Ø¬Ù„Ø¨ Ø§Ù„Ø£Ø®Ø¨Ø§Ø±. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„ Ø£Ùˆ Ø¬Ø±Ù‘Ø¨ Ù„Ø§Ø­Ù‚Ù‹Ø§.';
    } finally{
      $grid.removeAttribute('aria-busy');
    }
  }

  // Ø­Ø¯Ø« Â«Ù…Ø²ÙŠØ¯Â»: ÙØªØ­/Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…Ù‚ØªØ·Ù Ø¨Ø³Ø±Ø¹Ø©
  document.addEventListener('click', (ev) => {
    const btn = ev.target.closest('.more');
    if(!btn) return;
    const card = btn.closest('.card');
    const det = card?.querySelector('details');
    if(det) det.open = !det.open;
  });

  $btn.addEventListener('click', load);

  // ØªØ­Ù…ÙŠÙ„ Ø£ÙˆÙ„ÙŠ ÙˆØªØ­Ø¯ÙŠØ« Ø¯ÙˆØ±ÙŠ ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©
  load();
  setInterval(load, REFRESH_EVERY);
})();
</script>
</body>
</html>
