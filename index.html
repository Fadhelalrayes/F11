<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <!-- صفحة "مواقيت الصلاة" — تجلب المواقيت مباشرةً من واجهة حقيبة المؤمن (Alkafeel) -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <title>مواقيت الصلاة — من حقيبة المؤمن</title>
  <meta name="description" content="صفحة عربية خفيفة وأنيقة تجلب مواقيت الصلاة مباشرةً من واجهة حقيبة المؤمن حسب موقعك أو الإحداثيات.">
  <link rel="canonical" href="https://example.com/prayer-times">

  <!-- سياسة أمن المحتوى: السماح بالاتصال بـ hq.alkafeel.net فقط -->
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self';
                 script-src 'self' 'nonce-kafeel123';
                 style-src 'self' 'unsafe-inline';
                 img-src 'self' data:;
                 connect-src 'self' https://hq.alkafeel.net;
                 object-src 'none';
                 base-uri 'none';
                 frame-ancestors 'none';
                 form-action 'self';
                 upgrade-insecure-requests;
                 block-all-mixed-content">

  <style>
    /* تصميم نظيف، متجاوب، يدعم الفاتح/الداكن، بدون مكتبات خارجية */
    :root{
      --bg:#0b0f0e; --panel:#101713; --ink:#eaf4ee; --muted:#b9c7c1;
      --brand:#00c861; --ring:#10e073; --bd:#16251f; --shadow:0 12px 30px rgba(0,0,0,.35);
      --radius:16px; --max:1000px;
    }
    @media (prefers-color-scheme: light){
      :root{ --bg:#ffffff; --panel:#f5fbf8; --ink:#0e1a15; --muted:#5c6e66; --bd:#dfe8e2; --shadow:0 10px 26px rgba(0,0,0,.08) }
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Kufi Arabic","Noto Naskh Arabic",Arial}
    header{position:sticky;top:0;z-index:10;backdrop-filter:saturate(140%) blur(10px);
      background:color-mix(in oklab,var(--bg) 90%,transparent); border-bottom:1px solid color-mix(in oklab,var(--ink) 12%,transparent)}
    .container{max-width:var(--max);margin-inline:auto;padding:18px}
    .top{display:flex;align-items:center;justify-content:space-between;gap:14px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:800}
    .brand svg{flex:0 0 auto}
    nav a{color:inherit;text-decoration:none;padding:.4rem .7rem;border-radius:10px}
    nav a:hover{background:color-mix(in oklab,var(--brand) 18%,transparent)}
    .hero{display:grid;grid-template-columns:1.15fr .85fr;gap:22px;align-items:center;padding:24px 0}
    @media (max-width:900px){.hero{grid-template-columns:1fr}}
    h1{margin:0 0 10px;font-size:clamp(1.6rem,1.1rem + 2vw,3rem);line-height:1.2}
    p.lead{margin:0 0 14px;color:var(--muted);font-size:clamp(1rem,.9rem + .5vw,1.2rem)}
    .badge{display:inline-block;background:color-mix(in oklab,var(--brand) 14%,var(--panel));border:1px solid var(--bd);padding:.35rem .7rem;border-radius:999px}
    .card{background:var(--panel);border:1px solid var(--bd);border-radius:var(--radius);box-shadow:var(--shadow);padding:18px}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    @media (max-width:800px){.grid{grid-template-columns:1fr 1fr}}
    @media (max-width:560px){.grid{grid-template-columns:1fr}}
    .kpi{display:flex;align-items:center;justify-content:space-between;background:color-mix(in oklab,var(--panel) 70%,var(--bg));border:1px dashed var(--bd);padding:.8rem 1rem;border-radius:12px}
    .btn{display:inline-flex;align-items:center;gap:.55rem;padding:.85rem 1rem;border-radius:12px;border:2px solid color-mix(in oklab,var(--brand) 70%,var(--ink));
      background:var(--brand);color:#062114;font-weight:800;cursor:pointer}
    .btn.secondary{background:transparent;color:inherit}
    .btn:focus{outline:3px solid var(--ring);outline-offset:2px}
    .times{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
    @media (max-width:560px){.times{grid-template-columns:1fr}}
    .time{display:flex;justify-content:space-between;align-items:center;padding:.9rem 1rem;border-radius:12px;background:color-mix(in oklab,var(--panel) 70%,var(--bg));border:1px solid var(--bd)}
    .time strong{font-size:1.25rem}
    .form{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:12px}
    @media (max-width:900px){.form{grid-template-columns:1fr 1fr}}
    @media (max-width:560px){.form{grid-template-columns:1fr}}
    input{width:100%;padding:.9rem 1rem;border-radius:12px;border:1px solid var(--bd);background:color-mix(in oklab,var(--panel) 70%,var(--bg));color:inherit}
    footer{margin-top:30px;border-top:1px solid color-mix(in oklab,var(--ink) 12%,transparent);background:color-mix(in oklab,var(--bg) 92%,transparent);color:var(--muted)}
    .foot{display:flex;align-items:center;justify-content:space-between;gap:10px}
    .sr{position:absolute;inline-size:1px;block-size:1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;margin:-1px;padding:0;border:0}
  </style>
</head>
<body>
  <header>
    <div class="container top">
      <div class="brand" aria-label="الشعار">
        <svg width="40" height="40" viewBox="0 0 64 64" aria-hidden="true">
          <defs><linearGradient id="g" x1="0" x2="1"><stop offset="0" stop-color="#00df74"/><stop offset="1" stop-color="#00b65a"/></linearGradient></defs>
          <rect x="4" y="4" width="56" height="56" rx="14" fill="url(#g)"/>
          <path d="M19 37c5 6 10 9 13 9 7 0 16-8 16-19 0-4-1-7-3-9-2-1-5-1-7 0-2 2-3 5-3 8 0 7-4 12-9 12-3 0-5-1-7-1z" fill="#fff" opacity=".9"/>
        </svg>
        <span>مواقيت الصلاة</span>
      </div>
      <nav aria-label="التنقّل">
        <a href="#today">اليوم</a>
        <a href="#manual">إدخال يدوي</a>
        <a href="#how">الطريقة</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <section class="hero">
      <div>
        <span class="badge">الوقت من: <b>حقيبة المؤمن</b></span>
        <h1>مواقيت الصلاة مباشرةً من واجهة <span style="color:#79f0b8">hq.alkafeel.net</span></h1>
        <p class="lead">انقر “استخدم موقعي” ليُجلب وقت مدينتك، أو أدخل الإحداثيات يدويًا. لا نُخزّن أي موقع — تُرسل الإحداثيات للواجهة فقط لحساب المواقيت.</p>
        <div class="grid" style="margin-top:12px">
          <div class="kpi"><span>الربط</span><strong>مباشر</strong></div>
          <div class="kpi"><span>الأداء</span><strong>سريع</strong></div>
          <div class="kpi"><span>التوافق</span><strong>كافة الأجهزة</strong></div>
        </div>
      </div>

      <aside class="card" id="today" aria-live="polite">
        <h2 style="margin:0 0 10px">مواقيت اليوم</h2>
        <div class="times" id="timesWrap" aria-busy="false">
          <div class="time"><span>الفجر</span><strong id="t-fajr">—</strong></div>
          <div class="time"><span>الظهر</span><strong id="t-dhuhr">—</strong></div>
          <div class="time"><span>العصر</span><strong id="t-asr">—</strong></div>
          <div class="time"><span>المغرب</span><strong id="t-maghrib">—</strong></div>
          <div class="time"><span>العشاء</span><strong id="t-isha">—</strong></div>
          <div class="time"><span>التاريخ</span><strong id="t-date">—</strong></div>
        </div>
        <div class="actions" style="margin-top:12px">
          <button class="btn" id="useLoc" type="button" aria-describedby="pnote">
            <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M12 2a7 7 0 0 0-7 7c0 5.25 7 13 7 13s7-7.75 7-13a7 7 0 0 0-7-7Zm0 9.5a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5Z"/></svg>
            استخدم موقعي
          </button>
        </div>
        <p id="pnote" class="sr">لن نستخدم موقعك إلا عند النقر، ولن نخزّنه.</p>

        <form class="form" id="manual" autocomplete="off" novalidate style="margin-top:10px">
          <label><span class="sr">خط العرض</span><input type="number" step="any" id="lat" placeholder="خط العرض (مثال: 26.2235)" required></label>
          <label><span class="sr">خط الطول</span><input type="number" step="any" id="lon" placeholder="خط الطول (مثال: 50.5876)" required></label>
          <label><span class="sr">المنطقة الزمنية</span><input type="text" id="tz" placeholder="المنطقة الزمنية (+3)" value="+3" pattern="^[+\-]?\d{1,2}$" required></label>
          <button class="btn secondary" type="submit">جلب المواقيت يدويًا</button>
        </form>
      </aside>
    </section>

    <section class="card" id="how" aria-labelledby="howh">
      <h2 id="howh" style="margin:0 0 8px">نقطة النهاية المستخدمة</h2>
      <p style="color:var(--muted)">
        <code dir="ltr" style="background:color-mix(in oklab,var(--panel) 70%,var(--bg));border:1px solid var(--bd);border-radius:10px;padding:.2rem .45rem;display:inline-block">
          https://hq.alkafeel.net/Api/init/init.php?timezone=+3&long=50.5876&lati=26.2235&v=jsonPrayerTimes
        </code><br>
        الحقول التي نعرضها: <b>fajir</b> / <b>dhuhr</b> / <b>asr</b> / <b>maghrib</b> / <b>isha</b> / <b>date</b>.
      </p>
    </section>
  </main>

  <footer>
    <div class="container foot">
      <small>© <span id="year"></span> مواقيت الصلاة — البيانات من حقيبة المؤمن</small>
      <small>خصوصية: لا يتم تخزين موقعك على الخادم.</small>
    </div>
  </footer>

  <!-- ربط فعلي بواجهة حقيبة المؤمن -->
  <script nonce="kafeel123">
  (function(){
    'use strict';
    const $ = s => document.querySelector(s);
    const out = {
      fajr:   $('#t-fajr'),
      dhuhr:  $('#t-dhuhr'),
      asr:    $('#t-asr'),
      maghrib:$('#t-maghrib'),
      isha:   $('#t-isha'),
      date:   $('#t-date'),
      wrap:   $('#timesWrap')
    };
    const fmt = v => (v && /^\d{2}:\d{2}/.test(v)) ? v : '—';
    const setBusy = b => out.wrap.setAttribute('aria-busy', b ? 'true' : 'false');

    function paint(data){
      out.fajr.textContent    = fmt(data.fajir) || fmt(data.fajr) || '—';
      out.dhuhr.textContent   = fmt(data.dhuhr) || '—';
      out.asr.textContent     = fmt(data.asr)   || '—';
      out.maghrib.textContent = fmt(data.maghrib) || '—';
      out.isha.textContent    = fmt(data.isha)  || '—';
      out.date.textContent    = data.date || data.hDate || new Date().toLocaleDateString('ar', { dateStyle:'long' });
    }

    async function fetchFromKafeel(lat, lon, tz){
      const url = `https://hq.alkafeel.net/Api/init/init.php?timezone=${encodeURIComponent(tz)}&long=${encodeURIComponent(lon)}&lati=${encodeURIComponent(lat)}&v=jsonPrayerTimes`;
      const res = await fetch(url, { method:'GET', mode:'cors', cache:'no-store', referrerPolicy:'no-referrer' });
      if(!res.ok) throw new Error('تعذر الاتصال بواجهة حقيبة المؤمن');
      return await res.json();
    }

    // زر: استخدم موقعي
    $('#useLoc').addEventListener('click', ()=>{
      if(!('geolocation' in navigator)){ alert('متصفحك لا يدعم تحديد الموقع.'); return; }
      setBusy(true);
      navigator.geolocation.getCurrentPosition(async p=>{
        try{
          const lat = p.coords.latitude.toFixed(6);
          const lon = p.coords.longitude.toFixed(6);
          const tz  = (new Date().getTimezoneOffset() / -60) || +3; // مثال: آسيا/البحرين = +3
          const data = await fetchFromKafeel(lat, lon, tz>0?`+${tz}`:`${tz}`);
          paint(data || {});
        }catch(err){ console.error(err); alert('لم نتمكن من جلب المواقيت الآن.'); }
        finally{ setBusy(false); }
      }, err=>{ console.warn(err); setBusy(false); alert('رُفض إذن الموقع أو حدث خطأ. استخدم الإدخال اليدوي.'); },
      { enableHighAccuracy:false, timeout:10000, maximumAge:0 });
    });

    // إدخال يدوي
    $('#manual').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const lat = $('#lat').value.trim();
      const lon = $('#lon').value.trim();
      const tz  = $('#tz').value.trim();
      if(!lat || !lon || !tz){ alert('يرجى إدخال خط العرض وخط الطول والمنطقة الزمنية.'); return; }
      try{
        setBusy(true);
        const data = await fetchFromKafeel(lat, lon, tz);
        paint(data || {});
      }catch(err){ console.error(err); alert('تعذر جلب المواقيت. تحقق من القيم وحاول مجددًا.'); }
      finally{ setBusy(false); }
    });

    // قيم أولية لتجنب القفز البصري + تذييل
    paint({ fajir:'—', dhuhr:'—', asr:'—', maghrib:'—', isha:'—', date:'' });
    document.querySelector('#year').textContent = new Date().getFullYear();
  })();
  </script>
</body>
</html>
