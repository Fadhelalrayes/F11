<!doctype html>
<html lang="ar" dir="rtl" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ø§Ù„ØµØ­ÙŠÙØ© Ø§Ù„Ø³Ø¬Ù‘Ø§Ø¯ÙŠØ© | ÙÙ‡Ø±Ø³ Ø§Ù„Ø£Ø¯Ø¹ÙŠØ©</title>
  <meta name="description" content="ÙˆØ§Ø¬Ù‡Ø© Ø¹Ø±Ø¨ÙŠØ© Ø£Ù†ÙŠÙ‚Ø© Ù„Ø¹Ø±Ø¶ Ø£Ø¯Ø¹ÙŠØ© Ø§Ù„ØµØ­ÙŠÙØ© Ø§Ù„Ø³Ø¬Ù‘Ø§Ø¯ÙŠØ© Ù…Ø¹ ÙÙ‡Ø±Ø³ ÙˆØ¨Ø­Ø« ÙˆÙˆØ¶Ø¹ Ù„ÙŠÙ„ÙŠØŒ ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¯Ø¹Ø§Ø¡ ÙƒØ§Ù…Ù„Ø§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø±." />
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@500;700&family=Noto+Naskh+Arabic:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#f8fafc; --fg:#0f172a; --muted:#64748b; --card:#ffffff; --border:#e2e8f0;
      --accent:#5b8aff; --accent2:#06b6d4; --shadow:0 10px 28px rgba(2,6,23,.08)
    }
    html[data-theme="dark"]{
      --bg:#0b1220; --fg:#e6edf7; --muted:#9aa7bd; --card:#0f172a; --border:#1f2a3a;
      --accent:#7aa2ff; --accent2:#22d3ee; --shadow:0 14px 30px rgba(0,0,0,.5)
    }
    *{box-sizing:border-box}  body{margin:0;background:var(--bg);color:var(--fg);
      font-family:"Noto Naskh Arabic",system-ui,-apple-system,"Segoe UI",sans-serif; line-height:1.9}
    a{color:inherit} code{direction:ltr}
    header.appbar{position:sticky;top:0;z-index:50;background:
      linear-gradient(135deg,rgba(91,138,255,.15),rgba(6,182,212,.12));
      border-bottom:1px solid var(--border); backdrop-filter:saturate(130%) blur(6px)}
    .appbar-inner{max-width:1200px;margin:auto;display:flex;gap:12px;align-items:center;padding:10px 14px}
    .logo{width:42px;height:42px;border-radius:12px;display:grid;place-items:center;
      font-family:Cairo,sans-serif;font-weight:700;color:#fff;
      background:conic-gradient(from 270deg,var(--accent),var(--accent2));
      box-shadow:0 10px 24px rgba(91,138,255,.35)}
    .title{margin:0;font-family:Cairo,sans-serif;font-weight:700;font-size:1.16rem}
    .subtitle{margin:0;color:var(--muted);font-size:.9rem}
    .controls{margin-inline-start:auto;display:flex;gap:8px;align-items:center}
    .btn{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:9px 12px;cursor:pointer;
      display:inline-flex;gap:8px;align-items:center;box-shadow:var(--shadow);font-size:.95rem;transition:.2s}
    .btn:hover{transform:translateY(-1px)} .btn.icon{padding:8px;aspect-ratio:1/1}
    .btn.primary{background:linear-gradient(135deg,var(--accent),var(--accent2));border-color:transparent;color:#fff}
    main.layout{max-width:1200px;margin:auto;display:grid;grid-template-columns:320px 1fr;gap:22px;padding:16px}
    aside{position:sticky;top:64px;height:calc(100dvh - 64px);overflow:auto;background:var(--card);
      border:1px solid var(--border);border-radius:18px;box-shadow:var(--shadow);padding:14px}
    .content{background:var(--card);border:1px solid var(--border);border-radius:20px;box-shadow:var(--shadow);padding:22px}
    .panel{display:grid;gap:10px;margin-bottom:10px}
    .search{position:relative}
    .search input{width:100%;padding:12px 42px 12px 12px;border-radius:12px;border:1px solid var(--border);
      background:var(--bg);color:var(--fg);outline:none;font-size:.98rem}
    .search svg{position:absolute;inset-inline-end:10px;inset-block-start:50%;transform:translateY(-50%);opacity:.65}
    .pill{background:var(--bg);border:1px solid var(--border);border-radius:999px;color:var(--muted);font-size:.86rem;padding:6px 10px}
    .toc{list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:8px}
    .toc li{display:flex;gap:10px;align-items:flex-start;border:1px solid var(--border);background:var(--card);
      border-radius:12px;padding:10px 12px;cursor:pointer;transition:.2s}
    .toc li:hover{background:linear-gradient(135deg,rgba(91,138,255,.07),rgba(6,182,212,.06));transform:translateY(-1px)}
    .idx{width:36px;height:36px;border-radius:10px;display:grid;place-items:center;color:#fff;flex:0 0 auto;
      font-family:Cairo,sans-serif;font-weight:700;background:linear-gradient(135deg,var(--accent),var(--accent2))}
    .meta{flex:1 1 auto;min-width:0} .meta .t{font-weight:700;margin:0 0 4px} .meta .s{margin:0;color:var(--muted);font-size:.9rem}
    .tags{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px}
    .tag{border:1px dashed var(--border);border-radius:999px;padding:3px 9px;font-size:.8rem;color:var(--muted)}
    .dua-header{display:flex;gap:10px;align-items:center;justify-content:space-between;margin-bottom:8px}
    .dua-title{margin:0;font-family:Cairo,sans-serif;font-weight:700;font-size:1.4rem}
    .dua-sub{margin:.2em 0 .4em;color:var(--muted)}
    .toolbar{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .range{display:flex;align-items:center;gap:8px;color:var(--muted);font-size:.9rem}
    .dua-body{font-size:1.12rem;text-align:justify} .dua-body p{margin:.6em 0}
    .divider{border:0;border-top:1px solid var(--border);margin:12px 0}
    .empty{text-align:center;color:var(--muted);padding:30px}
    .footer-line{color:var(--muted);font-size:.88rem;display:flex;gap:10px;justify-content:space-between;align-items:center}
    @media (max-width:980px){
      main.layout{grid-template-columns:1fr}
      aside{position:static;height:auto}
    }
    @media print{
      header,aside,.toolbar .range,.toolbar button,.footer-line{display:none !important}
      main.layout{display:block;padding:0} .content{border:none;box-shadow:none}
      .dua-title{font-size:1.6rem} .dua-body{font-size:1.15em}
    }
  </style>
</head>
<body>
  <header class="appbar" role="banner">
    <div class="appbar-inner">
      <button class="btn icon" id="menuBtn" title="Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ÙÙ‡Ø±Ø³" aria-label="Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ÙÙ‡Ø±Ø³">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M3 6h18M3 12h18M3 18h18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
      </button>
      <div style="display:flex;align-items:center;gap:10px">
        <div class="logo" aria-hidden="true">Ø³</div>
        <div>
          <h1 class="title">Ø§Ù„ØµØ­ÙŠÙØ© Ø§Ù„Ø³Ø¬Ù‘Ø§Ø¯ÙŠØ©</h1>
          <p class="subtitle">ÙÙ‡Ø±Ø³ Ø§Ù„Ø£Ø¯Ø¹ÙŠØ© â€¢ Ø§Ø¶ØºØ· Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¯Ø¹Ø§Ø¡ ÙƒØ§Ù…Ù„Ø§Ù‹</p>
        </div>
      </div>
      <div class="controls">
        <button class="btn" id="importBtn" title="Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø£Ø¯Ø¹ÙŠØ© (JSON)">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M12 3v12m0 0l-4-4m4 4l4-4M4 21h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
          Ø§Ø³ØªÙŠØ±Ø§Ø¯
        </button>
        <button class="btn" id="exportBtn" title="ØªØµØ¯ÙŠØ± Ø§Ù„Ø£Ø¯Ø¹ÙŠØ© (JSON)">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M12 21V9m0 0l4 4m-4-4l-4 4M4 3h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
          ØªØµØ¯ÙŠØ±
        </button>
        <button class="btn icon" id="themeBtn" aria-label="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ/Ø§Ù„Ù†Ù‡Ø§Ø±ÙŠ" title="Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ">
          <svg id="themeIcon" width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" stroke="currentColor" stroke-width="2"/></svg>
        </button>
      </div>
    </div>
  </header>

  <main class="layout">
    <aside id="sidebar" aria-label="ÙÙ‡Ø±Ø³ Ø§Ù„Ø£Ø¯Ø¹ÙŠØ©">
      <div class="panel">
        <div class="search">
          <input id="search" type="search" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø£Ùˆ Ø§Ù„Ù†Øµâ€¦" aria-label="Ø¨Ø­Ø«">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="2"/><path d="M20 20l-3.5-3.5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
        </div>
        <div class="pill">Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <b id="count">0</b> Ø¯Ø¹Ø§Ø¡</div>
      </div>
      <ol class="toc" id="toc" role="listbox" aria-label="Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø¯Ø¹ÙŠØ©"></ol>
      <div class="pill" style="margin-top:10px">ğŸ’¡ Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø£ÙŠ Ø¯Ø¹Ø§Ø¡ Ù„Ø¹Ø±Ø¶Ù‡ ÙƒØ§Ù…Ù„Ø§Ù‹</div>
    </aside>

    <section class="content" id="content" aria-live="polite">
      <div class="empty">
        <h2 style="margin:0 0 6px;font-family:Cairo">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ</h2>
        <p>Ø§Ø®ØªØ± Ø¯Ø¹Ø§Ø¡Ù‹ Ù…Ù† Ø§Ù„ÙÙ‡Ø±Ø³ Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¨Ø­Ø«. ÙŠÙ…ÙƒÙ†Ùƒ Ø£ÙŠØ¶Ø§Ù‹ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù„Ù JSON Ù„Ù„Ø£Ø¯Ø¹ÙŠØ© Ø§Ù„ÙƒØ§Ù…Ù„Ø©.</p>
      </div>
    </section>
  </main>

  <input type="file" id="fileInput" accept="application/json" hidden />

  <script>
    // --- Ø¨ÙŠØ§Ù†Ø§Øª Ø¹ÙŠÙ‘Ù†ÙŠØ© (Ø§Ø³ØªØ¨Ø¯Ù„Ù‡Ø§ Ø¨Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ù…ÙˆØ«Ù‘Ù‚Ø© Ø£Ùˆ Ø§Ø³ØªÙˆØ±Ø¯ JSON) ---
    const samplePrayers = [
      {
        id: 1,
        title: "Ø§Ù„Ø¯Ø¹Ø§Ø¡ Ø§Ù„Ø£ÙˆÙ‘Ù„: ÙÙŠ Ø­Ù…Ø¯Ù Ø§Ù„Ù„Ù‡ ØªØ¹Ø§Ù„Ù‰",
        subtitle: "Ø§ÙØªØªØ§Ø­ Ø¨Ø§Ù„Ø­Ù…Ø¯ ÙˆØ§Ù„Ø«Ù†Ø§Ø¡",
        tags: ["Ø­Ù…Ø¯","Ø«Ù†Ø§Ø¡"],
        text: [
          "Ø§Ù„Ø­Ù…Ø¯Ù Ù„Ù„Ù‡Ù Ø§Ù„Ù‘ÙØ°ÙŠ Ù„Ø§ ÙŠÙØ¨Ù’Ù„ÙØºÙ Ù…ÙØ¯Ù’Ø­ÙØªÙÙ‡Ù Ø§Ù„Ù‚Ø§Ø¦Ù„ÙˆÙ†ÙØŒ ÙˆÙ„Ø§ ÙŠÙØ­ØµÙŠ Ù†Ø¹Ù…Ø§Ø¡ÙÙ‡Ù Ø§Ù„Ø¹Ø§Ø¯Ù‘ÙˆÙ†ÙØŒ ÙˆÙ„Ø§ ÙŠÙØ¤Ø¯Ù‘ÙŠ Ø­Ù‚Ù‘ÙÙ‡Ù Ø§Ù„Ù…ÙØ¬ØªÙ‡Ø¯ÙˆÙ†Ù.",
          "Ø§Ù„Ù„Ù‘Ù‡Ù…Ù‘Ù Ù„ÙƒÙ Ø§Ù„Ø­Ù…Ø¯Ù Ø­Ù…Ø¯Ø§Ù‹ ÙƒØ«ÙŠØ±Ø§Ù‹ Ø·ÙŠÙ‘Ø¨Ø§Ù‹ Ù…Ø¨Ø§Ø±ÙƒØ§Ù‹ ÙÙŠÙ‡ ÙƒÙ…Ø§ ØªÙØ­Ø¨Ù‘ ÙˆØªØ±Ø¶Ù‰.",
          "*Ù†ØµÙ‘ Ù…Ø®ØªØµØ± ØªØ¬Ø±ÙŠØ¨ÙŠ â€” Ø§Ø³ØªØ¨Ø¯Ù„Ù‡ Ø¨Ø§Ù„Ù†ØµÙ‘ Ø§Ù„ÙƒØ§Ù…Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯.*"
        ]
      },
      {
        id: 2,
        title: "Ø§Ù„Ø¯Ø¹Ø§Ø¡ Ø§Ù„Ø«Ø§Ù†ÙŠ: ÙÙŠ Ø§Ù„ØµÙ„Ø§Ø© Ø¹Ù„Ù‰ Ù…Ø­Ù…Ù‘Ø¯Ù ÙˆØ¢Ù„Ù‡",
        subtitle: "Ø§Ù„ØµÙ„Ø§Ø© ÙˆØ§Ù„Ø¨Ø±ÙƒØ©",
        tags: ["ØµÙ„Ø§Ø©","Ø±Ø­Ù…Ø©"],
        text: [
          "Ø§Ù„Ù„Ù‘Ù‡Ù…Ù‘Ù ØµÙ„Ù‘Ù Ø¹Ù„Ù‰ Ù…Ø­Ù…Ù‘Ø¯Ù ÙˆØ¢Ù„Ù Ù…Ø­Ù…Ù‘Ø¯ØŒ ÙˆØ§Ø¬Ø¹Ù„ ØµÙ„ÙˆØ§ØªÙƒ ÙˆØ¨Ø±ÙƒØ§ØªÙƒ ÙˆØ±Ø­Ù…ØªÙƒ Ø¹Ù„ÙŠÙ‡Ù… Ø£Ø¨Ø¯Ø§Ù‹.",
          "ÙˆØ²ÙØ¯Ù†Ø§ Ø¨Ù‡Ù… Ø¥ÙŠÙ…Ø§Ù†Ø§Ù‹ ÙˆÙŠÙ‚ÙŠÙ†Ø§Ù‹ ÙˆØ§ØªØ¨Ø§Ø¹Ø§Ù‹.",
          "*Ù†ØµÙ‘ Ù…Ø®ØªØµØ± ØªØ¬Ø±ÙŠØ¨ÙŠ.*"
        ]
      },
      {
        id: 3,
        title: "Ø§Ù„Ø¯Ø¹Ø§Ø¡ Ø§Ù„Ø«Ø§Ù„Ø«: ÙÙŠ Ø§Ù„Ø§Ø¹ØªØ±Ø§Ù Ø¨Ø§Ù„Ø°Ù†Ø¨ ÙˆØ·Ù„Ø¨ Ø§Ù„Ø¹ÙÙˆ",
        subtitle: "ØªÙˆØ¨Ø© ÙˆØ§Ø³ØªØºÙØ§Ø±",
        tags: ["ØªÙˆØ¨Ø©","Ø§Ø³ØªØºÙØ§Ø±"],
        text: [
          "Ø¥Ù„Ù‡ÙŠ Ø¥Ù† Ù„Ù… ØªØºÙØ± Ù„ÙŠ ÙˆØªØ±Ø­Ù…Ù†ÙŠ Ù„Ø£ÙƒÙˆÙ†Ù†Ù‘ Ù…Ù† Ø§Ù„Ø®Ø§Ø³Ø±ÙŠÙ†.",
          "ØªØ¨Ù’ Ø¹Ù„ÙŠÙ‘Ù ØªÙˆØ¨Ø©Ù‹ Ù†ØµÙˆØ­Ø§Ù‹ ÙˆØ§ØºØ³Ù„ Ù‚Ù„Ø¨ÙŠ Ù…Ù† Ø§Ù„Ø°Ù†ÙˆØ¨.",
          "*Ù†ØµÙ‘ Ù…Ø®ØªØµØ± ØªØ¬Ø±ÙŠØ¨ÙŠ.*"
        ]
      },
      {
        id: 4,
        title: "Ø§Ù„Ø¯Ø¹Ø§Ø¡ Ø§Ù„Ø±Ø§Ø¨Ø¹: ÙÙŠ Ø§Ù„Ù…Ø³Ø£Ù„Ø© ÙˆØ§Ù„Ø§Ø¨ØªÙ‡Ø§Ù„",
        subtitle: "Ø³Ø¤Ø§Ù„ Ø§Ù„ÙØ¶Ù„ ÙˆØ§Ù„Ù„Ø·Ù",
        tags: ["Ø¯Ø¹Ø§Ø¡","Ù…Ø³Ø£Ù„Ø©"],
        text: [
          "ÙŠØ§ ÙˆØ§Ø³Ø¹ Ø§Ù„Ø±Ø­Ù…Ø©ØŒ ÙŠØ§ Ù…ÙØ¬ÙŠØ¨ Ø§Ù„Ù…Ø¶Ø·Ø±Ù‘ Ø¥Ø°Ø§ Ø¯Ø¹Ø§Ù‡ØŒ Ù†Ø³Ø£Ù„Ùƒ Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ù„Ø¹Ø¸ÙŠÙ….",
          "Ø£Ù„Ù‡Ù…Ù†Ø§ Ø°ÙƒØ±Ùƒ ÙˆØ´ÙƒØ±Ùƒ ÙˆØ­Ø³Ù† Ø¹Ø¨Ø§Ø¯ØªÙƒ.",
          "*Ù†ØµÙ‘ Ù…Ø®ØªØµØ± ØªØ¬Ø±ÙŠØ¨ÙŠ.*"
        ]
      },
      {
        id: 5,
        title: "Ø§Ù„Ø¯Ø¹Ø§Ø¡ Ø§Ù„Ø®Ø§Ù…Ø³: ÙÙŠ Ø§Ù„ØªÙˆÙƒÙ‘Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ù„Ù‡",
        subtitle: "ØªÙÙˆÙŠØ¶ Ø§Ù„Ø£Ù…Ø± Ø¥Ù„Ù‰ Ø§Ù„Ù„Ù‡",
        tags: ["ØªÙˆÙƒÙ‘Ù„","ÙŠÙ‚ÙŠÙ†"],
        text: [
          "ØªÙˆÙƒÙ‘Ù„ØªÙ Ø¹Ù„Ù‰ Ø§Ù„Ø­ÙŠÙ‘ Ø§Ù„Ø°ÙŠ Ù„Ø§ ÙŠÙ…ÙˆØªØŒ ÙˆÙÙˆÙ‘Ø¶ØªÙ Ø£Ù…Ø±ÙŠ Ø¥Ù„Ù‰ Ø§Ù„Ù„Ù‡.",
          "Ø§Ù„Ù„Ù‘Ù‡Ù…Ù‘ Ø§ÙƒÙÙ†ÙŠ Ù…Ø§ Ø£Ù‡Ù…Ù‘Ù†ÙŠ Ù…Ù† Ø£Ù…Ø± Ø§Ù„Ø¯Ù†ÙŠØ§ ÙˆØ§Ù„Ø¢Ø®Ø±Ø©.",
          "*Ù†ØµÙ‘ Ù…Ø®ØªØµØ± ØªØ¬Ø±ÙŠØ¨ÙŠ.*"
        ]
      }
    ];

    // --- Ø§Ù„Ø­Ø§Ù„Ø© ---
    const state = {
      prayers: [...samplePrayers],
      filtered: null,
      currentId: null,
      fontScale: parseFloat(localStorage.getItem("fontScale") || "1.0"),
      theme: localStorage.getItem("theme") || "light"
    };

    // --- Ø¹Ù†Ø§ØµØ± DOM ---
    const root = document.documentElement;
    const tocEl = document.getElementById("toc");
    const contentEl = document.getElementById("content");
    const searchEl = document.getElementById("search");
    const countEl = document.getElementById("count");

    // --- ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø«ÙŠÙ… ---
    root.setAttribute("data-theme", state.theme);

    // --- Ø£Ø¯ÙˆØ§Øª ---
    const getList = () => state.filtered ?? state.prayers;

    function escapeHtml(s){
      return String(s).replaceAll("&","&amp;").replaceAll("<","&lt;")
        .replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#39;");
    }
    function normalizeArabic(s){
      return s.toLowerCase()
        .replace(/[\u064B-\u0652]/g,"")
        .replace(/[Ø¥Ø£Ù±Ø¢]/g,"Ø§").replace(/Ù‰/g,"ÙŠ").replace(/Ø¤/g,"Ùˆ").replace(/Ø¦/g,"ÙŠ").replace(/Ø©/g,"Ù‡");
    }
    function includesNorm(hay, needle){
      return normalizeArabic(hay).includes(needle);
    }
    function toast(msg){
      const t=document.createElement("div");
      t.textContent=msg;
      t.style.cssText="position:fixed;inset-inline-start:50%;transform:translateX(-50%);inset-block-end:20px;background:var(--fg);color:var(--bg);padding:8px 12px;border-radius:999px;z-index:9999;box-shadow:var(--shadow);font-size:.9rem";
      document.body.appendChild(t); setTimeout(()=>t.remove(),1600);
    }

    // --- ÙÙ‡Ø±Ø³ ---
    function renderTOC(){
      const list = getList();
      countEl.textContent = list.length;
      tocEl.innerHTML = "";
      list.forEach(d=>{
        const li = document.createElement("li");
        li.dataset.id = d.id;
        li.innerHTML = `
          <div class="idx">${d.id}</div>
          <div class="meta">
            <p class="t">${escapeHtml(d.title)}</p>
            ${d.subtitle?`<p class="s">${escapeHtml(d.subtitle)}</p>`:""}
            <div class="tags">${(d.tags||[]).map(t=>`<span class="tag">#${escapeHtml(t)}</span>`).join("")}</div>
          </div>
          <button class="btn icon" data-copy-title="${d.id}" title="Ù†Ø³Ø® Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙÙ‚Ø·">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><rect x="9" y="9" width="10" height="12" rx="2" stroke="currentColor" stroke-width="2"/><rect x="5" y="3" width="10" height="12" rx="2" stroke="currentColor" stroke-width="2"/></svg>
          </button>
        `;
        li.addEventListener("click",(e)=>{
          if(e.target.closest("[data-copy-title]")) return;
          showPrayer(d.id);
        });
        li.querySelector("[data-copy-title]")?.addEventListener("click",(e)=>{
          e.stopPropagation();
          navigator.clipboard.writeText(d.title).then(()=>toast("Ù†ÙØ³ÙØ® Ø§Ù„Ø¹Ù†ÙˆØ§Ù†"));
        });
        tocEl.appendChild(li);
      });
    }

    // --- Ø¹Ø±Ø¶ Ø§Ù„Ø¯Ø¹Ø§Ø¡ ---
    function showPrayer(id){
      const d = state.prayers.find(x=>x.id===id);
      if(!d){ contentEl.innerHTML = `<div class="empty">ØªØ¹Ø°Ù‘Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¯Ø¹Ø§Ø¡.</div>`; return; }

      state.currentId = id;
      location.hash = `#dua-${id}`;

      contentEl.innerHTML = `
        <div class="dua-header">
          <div style="min-inline-size:0">
            <h2 class="dua-title">${escapeHtml(d.title)}</h2>
            ${d.subtitle?`<p class="dua-sub">${escapeHtml(d.subtitle)}</p>`:""}
            <div class="tags">${(d.tags||[]).map(t=>`<span class="tag">#${escapeHtml(t)}</span>`).join("")}</div>
          </div>
          <div class="toolbar">
            <button class="btn" id="copyBtn" title="Ù†Ø³Ø® Ø§Ù„Ø¯Ø¹Ø§Ø¡ ÙƒØ§Ù…Ù„Ø§Ù‹">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><rect x="9" y="9" width="10" height="12" rx="2" stroke="currentColor" stroke-width="2"/><rect x="5" y="3" width="10" height="12" rx="2" stroke="currentColor" stroke-width="2"/></svg>
              Ù†Ø³Ø®
            </button>
            <button class="btn" id="printBtn" title="Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¯Ø¹Ø§Ø¡">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M6 9V3h12v6M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2M6 14h12v7H6v-7z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
              Ø·Ø¨Ø§Ø¹Ø©
            </button>
            <span class="range"><label for="fs">Ø­Ø¬Ù… Ø§Ù„Ø®Ø·</label><input id="fs" type="range" min="0.9" max="1.4" step="0.01" value="${state.fontScale}"></span>
          </div>
        </div>
        <hr class="divider"/>
        <article class="dua-body" style="font-size:${state.fontScale}em">
          ${(d.text||[]).map(p=>`<p>${escapeHtml(p)}</p>`).join("")}
        </article>
        <hr class="divider"/>
        <div class="footer-line">
          <span>ğŸ“ Ø±Ø§Ø¨Ø· Ù…Ø¨Ø§Ø´Ø±: <code>${location.href}</code></span>
          <span class="pill">ID: ${d.id}</span>
        </div>
      `;

      document.getElementById("copyBtn").onclick = ()=>{
        const txt = (d.text||[]).join("\n\n");
        navigator.clipboard.writeText(`${d.title}\n\n${txt}`).then(()=>toast("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø¯Ø¹Ø§Ø¡ ÙƒØ§Ù…Ù„Ø§Ù‹"));
      };
      document.getElementById("printBtn").onclick = ()=>window.print();
      document.getElementById("fs").oninput = (e)=>{
        state.fontScale = parseFloat(e.target.value);
        localStorage.setItem("fontScale", String(state.fontScale));
        contentEl.querySelector(".dua-body").style.fontSize = state.fontScale + "em";
      };
    }

    // --- Ø¨Ø­Ø« ---
    function applySearch(q){
      const k = normalizeArabic(q.trim());
      if(!k){ state.filtered=null; renderTOC(); return; }
      state.filtered = state.prayers.filter(d =>
        includesNorm(d.title,k) || includesNorm(d.subtitle||"",k) ||
        (d.text||[]).some(p=>includesNorm(p,k))
      );
      renderTOC();
    }
    document.getElementById("search").addEventListener("input", e=>applySearch(e.target.value));

    // --- Ø§Ø³ØªÙŠØ±Ø§Ø¯/ØªØµØ¯ÙŠØ± ---
    document.getElementById("importBtn").onclick = ()=>document.getElementById("fileInput").click();
    document.getElementById("fileInput").onchange = (e)=>{
      const file = e.target.files?.[0]; if(!file) return;
      const reader = new FileReader();
      reader.onload = ()=>{
        try{
          const data = JSON.parse(reader.result);
          if(!Array.isArray(data)) throw new Error("ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø§Ù„Ù…Ù„Ù Ù…ØµÙÙˆÙØ© Ø£Ø¯Ø¹ÙŠØ©");
          data.forEach((d,i)=>{
            if(typeof d.id!=="number" || !d.title || !Array.isArray(d.text)){
              throw new Error(`Ø¹Ù†ØµØ± ${i+1} Ù„Ø§ ÙŠØ·Ø§Ø¨Ù‚ Ø§Ù„Ø¨Ù†ÙŠØ© {id:number,title:string,text:string[]}`);
            }
          });
          state.prayers = data.sort((a,b)=>a.id-b.id);
          state.filtered=null; renderTOC();
          toast("ØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨Ù†Ø¬Ø§Ø­");
          if(state.prayers[0]) showPrayer(state.prayers[0].id);
        }catch(err){ alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ù„Ù: " + err.message); }
      };
      reader.readAsText(file,"utf-8");
      e.target.value="";
    };

    document.getElementById("exportBtn").onclick = ()=>{
      const blob = new Blob([JSON.stringify(state.prayers,null,2)], {type:"application/json"});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "al-sahifa-al-sajjadiyya.json";
      a.click();
      URL.revokeObjectURL(a.href);
    };

    // --- ÙˆØ¶Ø¹ Ù„ÙŠÙ„ÙŠ/Ù†Ù‡Ø§Ø±ÙŠ ---
    const themeBtn = document.getElementById("themeBtn");
    themeBtn.onclick = ()=>{
      state.theme = state.theme==="dark" ? "light" : "dark";
      root.setAttribute("data-theme", state.theme);
      localStorage.setItem("theme", state.theme);
      document.getElementById("themeIcon").innerHTML =
        state.theme==="dark"
        ? '<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" stroke="currentColor" stroke-width="2"/>'
        : '<circle cx="12" cy="12" r="5" stroke="currentColor" stroke-width="2" fill="none"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2"/>';
    };

    // --- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙÙŠ Ø§Ù„Ø¬ÙˆØ§Ù„ ---
    const sidebar = document.getElementById("sidebar");
    document.getElementById("menuBtn").onclick = ()=>{
      sidebar.style.display = sidebar.style.display === "none" ? "" : "none";
    };
    const mq = window.matchMedia("(max-width: 980px)");
    function handleMQ(e){ sidebar.style.display = e.matches ? "none" : ""; }
    mq.addEventListener("change", handleMQ); handleMQ(mq);

    // --- ØªÙˆØ¬ÙŠÙ‡ Ø¨Ø§Ù„Ø±Ø§Ø¨Ø· ---
    window.addEventListener("hashchange", ()=>{
      const m = location.hash.match(/#dua-(\d+)/);
      if(m) showPrayer(parseInt(m[1],10));
    });

    // --- Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„ ---
    renderTOC();
    const m0 = location.hash.match(/#dua-(\d+)/);
    if(m0){ showPrayer(parseInt(m0[1],10)); }
    if(!state.currentId && state.prayers[0]) showPrayer(state.prayers[0].id);
  </script>
</body>
</html>
