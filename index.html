<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>لوحة البورصة — مباشر</title>
<style>
  :root{
    --gold:#D4AF37; --bg:#fff; --bg-soft:#fbfaf7;
    --text:#151515; --muted:#6b7280; --card:#fff; --border:#eee;
    --pos:#0a7a2f; --neg:#b11a1a; --shadow:0 8px 24px rgba(0,0,0,.08);
  }
  body{margin:0;background:var(--bg);color:var(--text);
       font-family:"Cairo","Tajawal",system-ui,sans-serif;line-height:1.6}
  .container{max-width:1160px;margin:0 auto;padding:14px}
  header{position:sticky;top:0;z-index:50;background:linear-gradient(180deg,rgba(212,175,55,.08),transparent),var(--bg);
          border-bottom:1px solid var(--border);backdrop-filter:blur(6px)}
  .topbar{display:flex;align-items:center;justify-content:space-between;padding:10px 0}
  .brand{display:flex;align-items:center;gap:10px;font-weight:900;font-size:20px}
  .logo{width:28px;height:28px;border-radius:8px;background:conic-gradient(from 0deg,var(--gold),#c9a227,var(--gold))}
  .meta{font-size:13px;color:var(--muted)}
  .grid{display:grid;gap:14px}
  .card{background:var(--card);border:1px solid var(--border);border-radius:14px;box-shadow:var(--shadow)}
  .head{padding:12px 14px;border-bottom:1px solid var(--border);font-weight:700;
        background:linear-gradient(180deg,rgba(212,175,55,.08),transparent)}
  .body{padding:12px}
  table{width:100%;border-collapse:collapse}
  th,td{padding:10px;border-bottom:1px solid var(--border);text-align:center;font-size:14px}
  th{font-size:12px;color:var(--muted)}
  tr:hover td{background:rgba(212,175,55,.06)}
  .pill{display:inline-block;padding:4px 8px;border-radius:999px;font-size:12px;font-weight:700}
  .bull{background:#e6f8ec;color:var(--pos)}
  .bear{background:#fde8e8;color:var(--neg)}
  .neutral{background:#f1f1f1;color:#555}
  .alert{border:1px solid var(--border);border-radius:12px;padding:10px;margin-bottom:10px;background:var(--bg-soft)}
  .empty{text-align:center;color:var(--muted);padding:12px;font-size:14px}
</style>
</head>
<body>
<header>
  <div class="container topbar">
    <div class="brand"><div class="logo"></div>لوحة البورصة</div>
    <div class="meta">آخر تحديث: <span id="lastUpdated">—:—:—</span></div>
  </div>
</header>

<main class="container grid" style="margin-top:12px">

  <section class="card">
    <div class="head">الأسعار الحالية</div>
    <div class="body">
      <table>
        <thead><tr><th>الرمز</th><th>السعر</th><th>التغير %</th><th>الحجم</th></tr></thead>
        <tbody id="pricesTbody"><tr><td colspan="4" class="empty">لا توجد بيانات متاحة حاليًا</td></tr></tbody>
      </table>
    </div>
  </section>

  <section class="card">
    <div class="head">التنبؤات</div>
    <div class="body">
      <table>
        <thead><tr><th>الرمز</th><th>5د</th><th>1س</th><th>1ي</th><th>الثقة</th><th>الإشارة</th></tr></thead>
        <tbody id="forecastTbody"><tr><td colspan="6" class="empty">لا توجد بيانات متاحة حاليًا</td></tr></tbody>
      </table>
    </div>
  </section>

  <section class="card">
    <div class="head">توصيات بالشراء</div>
    <div class="body" id="buyList"><div class="empty">لا توجد توصيات شراء حاليًا</div></div>
  </section>

  <section class="card">
    <div class="head">توصيات بالبيع</div>
    <div class="body" id="sellList"><div class="empty">لا توجد توصيات بيع حاليًا</div></div>
  </section>

  <section class="card">
    <div class="head">التنبيهات</div>
    <div class="body" id="alertsList"><div class="empty">لا توجد تنبيهات حاليًا</div></div>
  </section>

</main>

<script>
const CONFIG={
  BINANCE:{API:"https://api.binance.com/api/v3",SYMBOLS:["BTCUSDT","ETHUSDT","SOLUSDT"]},
  FX:{API:"https://open.er-api.com/v6/latest/USD",PAIRS:["EURUSD","USDJPY","USDBHD","USDSAR"]},
  REFRESH:15000
};
const State={prices:[],forecast:[],reco:{buy:[],sell:[]},alerts:[]};

const $=s=>document.querySelector(s);

function fmt(n,d=2){if(!n)return"—";return Number(n).toLocaleString('en-US',{maximumFractionDigits:d})}
function now(){const d=new Date(),p=n=>String(n).padStart(2,"0");$("#lastUpdated").textContent=`${p(d.getHours())}:${p(d.getMinutes())}:${p(d.getSeconds())}`;}

async function fetchJSON(u){const r=await fetch(u);if(!r.ok)throw 0;return r.json();}

async function loadCrypto(){
  const out=[];
  for(const s of CONFIG.BINANCE.SYMBOLS){
    try{const d=await fetchJSON(`${CONFIG.BINANCE.API}/ticker/24hr?symbol=${s}`);
      out.push({symbol:s.replace("USDT","USD"),last:+d.lastPrice,change:+d.priceChangePercent,vol:+d.volume});}
    catch(e){}
  }
  return out;
}

async function loadFX(){
  try{const d=await fetchJSON(CONFIG.FX.API);if(d.result!=="success")return[];
    const r=d.rates||{},out=[];if(r.EUR)out.push({symbol:"EURUSD",last:1/(r.EUR),change:0,vol:0});
    if(r.JPY)out.push({symbol:"USDJPY",last:r.JPY,change:0,vol:0});
    return out;
  }catch(e){return [];}
}

function buildForecast(prices){
  return prices.map(p=>{
    const m=(p.change||0)/100,conf=Math.min(0.9,Math.abs(m)*3);
    const sig=m>0.002?"bull":m<-0.002?"bear":"neutral";
    return {symbol:p.symbol,f5:p.last*(1+m*0.2),f1h:p.last*(1+m*0.6),f1d:p.last*(1+m*1.2),conf:Math.round(conf*100),sig};
  });
}
function buildReco(prices){
  const buy=[],sell=[];
  for(const p of prices){
    if(p.change>=1.5)buy.push(p);if(p.change<=-1.5)sell.push(p);
  }
  return {buy,sell};
}
function buildAlerts(prices){
  return prices.filter(p=>Math.abs(p.change)>=3).map(p=>({symbol:p.symbol,msg:`تغيّر ${p.change.toFixed(2)}%`}));
}

/* ========== العرض ========== */
function renderPrices(){
  const tb=$("#pricesTbody");tb.innerHTML="";
  if(State.prices.length===0){tb.innerHTML='<tr><td colspan="4" class="empty">لا توجد بيانات متاحة حاليًا</td></tr>';return;}
  for(const p of State.prices){
    const tr=document.createElement("tr");
    tr.innerHTML=`<td><b>${p.symbol}</b></td><td>${fmt(p.last,4)}</td><td style="color:${p.change>=0?'#0a7a2f':'#b11a1a'}">${p.change>=0?'↑':'↓'} ${fmt(Math.abs(p.change),2)}%</td><td>${fmt(p.vol,0)}</td>`;
    tb.appendChild(tr);
  }
}
function renderForecast(){
  const tb=$("#forecastTbody");tb.innerHTML="";
  if(State.forecast.length===0){tb.innerHTML='<tr><td colspan="6" class="empty">لا توجد بيانات متاحة حاليًا</td></tr>';return;}
  for(const f of State.forecast){
    const tr=document.createElement("tr");
    tr.innerHTML=`<td><b>${f.symbol}</b></td><td>${fmt(f.f5,2)}</td><td>${fmt(f.f1h,2)}</td><td>${fmt(f.f1d,2)}</td><td>${f.conf}%</td><td><span class="pill ${f.sig}">${f.sig==="bull"?"صاعد":f.sig==="bear"?"هابط":"محايد"}</span></td>`;
    tb.appendChild(tr);
  }
}
function renderReco(){
  const b=$("#buyList"),s=$("#sellList");b.innerHTML="";s.innerHTML="";
  if(State.reco.buy.length===0)b.innerHTML='<div class="empty">لا توجد توصيات شراء حاليًا</div>';
  else State.reco.buy.forEach(p=>{b.innerHTML+=`<div class="alert"><b>${p.symbol}</b> إشارة شراء</div>`});
  if(State.reco.sell.length===0)s.innerHTML='<div class="empty">لا توجد توصيات بيع حاليًا</div>';
  else State.reco.sell.forEach(p=>{s.innerHTML+=`<div class="alert"><b>${p.symbol}</b> إشارة بيع</div>`});
}
function renderAlerts(){
  const a=$("#alertsList");a.innerHTML="";
  if(State.alerts.length===0)a.innerHTML='<div class="empty">لا توجد تنبيهات حاليًا</div>';
  else State.alerts.forEach(x=>{a.innerHTML+=`<div class="alert"><b>${x.symbol}</b> ${x.msg}</div>`});
}

/* ========== التحديث ========== */
async function loadAll(){
  const [crypto,fx]=await Promise.all([loadCrypto(),loadFX()]);
  const all=[...crypto,...fx];
  State.prices=all;
  State.forecast=buildForecast(all);
  State.reco=buildReco(all);
  State.alerts=buildAlerts(all);
  renderPrices();renderForecast();renderReco();renderAlerts();now();
}
loadAll();setInterval(loadAll,CONFIG.REFRESH);
</script>
</body>
</html>
