<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>CV مولّد | البحرين — ذهبي/أبيض</title>
<style>
  :root{
    --bg:#ffffff; --fg:#0f172a; --muted:#475569; --accent:#C7A046; --accent-2:#EAD9A2;
    --border:#e5e7eb; --chip:#f8fafc; --danger:#dc2626; --ok:#16a34a; --radius:14px;
    --shadow:0 10px 30px rgba(15,23,42,.06);
  }
  html,body{background:var(--bg);color:var(--fg);font-family:"Cairo","Noto Naskh Arabic",system-ui,Arial;line-height:1.5}
  *{box-sizing:border-box}
  a{color:var(--accent);text-decoration:none}
  .container{max-width:1200px;margin:24px auto;padding:0 16px}
  .header{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:16px}
  .brand{display:flex;align-items:center;gap:12px}
  .logo{width:28px;height:28px;border-radius:8px;background:conic-gradient(from 0deg,var(--accent),#d9b96b,var(--accent));box-shadow:var(--shadow)}
  h1{font-size:20px;margin:0}
  .controls{display:flex;gap:8px;flex-wrap:wrap}
  .btn{border:1px solid var(--accent);background:var(--accent);color:#fff;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:700;box-shadow:var(--shadow)}
  .btn.ghost{background:#fff;color:var(--accent)}
  .layout{display:grid;gap:16px}
  @media(min-width:1024px){.layout{grid-template-columns:420px 1fr}}
  .card{background:#fff;border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow)}
  .card .h{padding:14px 16px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}
  .card .h h2{font-size:16px;margin:0;position:relative;padding-bottom:6px}
  .card .h h2:after{content:"";position:absolute;inset-inline:0;bottom:0;height:2px;background:var(--accent)}
  .card .b{padding:16px}

  /* Form */
  form{display:flex;flex-direction:column;gap:16px}
  .grid{display:grid;gap:12px}
  .two{grid-template-columns:1fr}
  @media(min-width:640px){.two{grid-template-columns:1fr 1fr}}
  label{font-weight:700;font-size:13px;color:var(--muted)}
  input[type="text"],input[type="email"],input[type="tel"],input[type="url"],textarea,select{
    width:100%;border:1px solid var(--border);border-radius:10px;padding:11px 12px;background:#fff;outline:none;transition:.2s border
  }
  textarea{min-height:96px;resize:vertical}
  input:focus,textarea:focus,select:focus{border-color:var(--accent)}
  .hint{font-size:12px;color:var(--muted)}
  .inline{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  .chipline{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
  .chip{padding:6px 10px;border:1px solid var(--border);background:var(--chip);border-radius:999px;font-size:12px}

  /* Repeatables */
  .rep{border:1px dashed var(--border);border-radius:12px;padding:12px;margin-top:8px}
  .rep .head{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
  .sm{padding:6px 10px;border-radius:8px;font-size:12px}
  .ghost{background:#fff;color:var(--fg);border:1px solid var(--border)}

  /* Preview CV */
  .cv{background:#fff;border:1px solid var(--border);border-radius:var(--radius);padding:28px;min-height:420px;box-shadow:var(--shadow)}
  .cv header .name{font-size:24px;font-weight:900;margin:0 0 6px}
  .cv header .title{font-size:14px;color:var(--muted);margin:0 0 10px}
  .cv .bar{height:2px;background:var(--accent);margin:10px 0 18px}
  .cv .sec{margin-bottom:18px}
  .cv .sec h3{font-size:15px;margin:0 0 8px;position:relative;padding-bottom:6px}
  .cv .sec h3:after{content:"";position:absolute;inset-inline:0;bottom:0;height:2px;background:var(--accent-2)}
  .cv .item{margin-bottom:10px}
  .cv .pos{display:flex;flex-wrap:wrap;gap:8px;align-items:baseline}
  .cv .pos .role{font-weight:800}
  .cv .pos .company{color:var(--muted)}
  .meta{font-size:12px;color:var(--muted)}
  .cv ul{margin:6px 0 0 18px}
  .cv li{margin:4px 0}

  /* Print A4 */
  @page{size:A4;margin:20mm}
  @media print{
    body{background:#fff}
    .no-print{display:none!important}
    .cv{box-shadow:none;border:none;padding:0}
  }

  /* Accessibility focus */
  :focus-visible{outline:3px solid var(--accent-2);outline-offset:2px}
</style>
</head>
<body>
  <div class="container">
    <div class="header no-print">
      <div class="brand"><div class="logo" aria-hidden="true"></div><h1>مولّد سيرة ذاتية — البحرين</h1></div>
      <div class="controls">
        <button class="btn" id="btnPdf">تحميل PDF</button>
        <button class="btn ghost" id="btnDoc">تحميل Word (.doc)</button>
        <button class="btn ghost" id="btnSave">حفظ JSON</button>
        <label for="jsonFile" class="btn ghost" style="cursor:pointer;">استيراد JSON</label>
        <input id="jsonFile" type="file" accept="application/json" hidden />
        <select id="dirSel" class="btn ghost" title="الاتجاه">
          <option value="rtl" selected>RTL (عربي)</option>
          <option value="ltr">LTR (English)</option>
        </select>
      </div>
    </div>

    <div class="layout">
      <!-- ======= FORM (Simplified, Bahrain-ready) ======= -->
      <div class="card no-print">
        <div class="h"><h2>بيانات التقديم (مبسّطة)</h2></div>
        <div class="b">
          <form id="f" novalidate>
            <div class="grid two">
              <div><label>الاسم الكامل *</label><input id="fullName" type="text" required placeholder="مثال: علي حسن محمد" /></div>
              <div><label>المسمّى المستهدف *</label><input id="targetTitle" type="text" required placeholder="مثال: مطوّر برمجيات" /></div>
              <div><label>البريد الإلكتروني *</label><input id="email" type="email" required placeholder="name@example.com" /></div>
              <div><label>الهاتف (البحرين) *</label><input id="phone" type="tel" required placeholder="+973 3xxxxxxx" /></div>
              <div><label>الموقع *</label><input id="location" type="text" required value="المنامة، البحرين" /></div>
              <div><label>روابط مهنية</label><input id="links" type="url" placeholder="https://linkedin.com/in/username, https://github.com/user" /></div>
            </div>

            <div>
              <label>ملخّص مهني (3–5 جمل)</label>
              <textarea id="summary" maxlength="600" placeholder="ملف تعريفي موجز يبرز القيمة والإنجازات الرقمية"></textarea>
              <div class="hint"><span id="sumCount">0</span> / 600</div>
            </div>

            <div class="grid two">
              <div><label>المهارات (افصل بفواصل)</label><input id="skills" type="text" placeholder="Java, SQL, Agile, تواصل" /></div>
              <div><label>اللغات (مثال: العربية:Native، الإنجليزية:C1)</label><input id="langs" type="text" placeholder="العربية:Native، الإنجليزية:C1" /></div>
            </div>

            <div class="inline" style="justify-content:space-between">
              <label>الخبرة العملية</label>
              <button type="button" class="btn sm ghost" id="addExp">+ إضافة خبرة</button>
            </div>
            <div id="expList"></div>

            <div class="inline" style="justify-content:space-between">
              <label>التعليم</label>
              <button type="button" class="btn sm ghost" id="addEdu">+ إضافة مؤهل</button>
            </div>
            <div id="eduList"></div>

            <div class="inline" style="justify-content:space-between">
              <label>الشهادات</label>
              <button type="button" class="btn sm ghost" id="addCert">+ إضافة شهادة</button>
            </div>
            <div id="certList"></div>

            <!-- حقول اختيارية مصممة لواقع البحرين -->
            <div class="grid two">
              <div><label>الرقم الشخصي (CPR) — اختياري</label><input id="cpr" type="text" placeholder="123456789" /></div>
              <div><label>حالة الإقامة / تصريح العمل — اختياري</label>
                <select id="visa">
                  <option value="">غير محدد</option>
                  <option>مواطن/مقيم</option>
                  <option>تصريح عمل ساري</option>
                  <option>بحاجة إلى نقل الكفالة</option>
                  <option>متاح فوراً</option>
                </select>
              </div>
            </div>

            <div class="grid two">
              <div><label>الراتب المتوقع (BHD) — اختياري</label><input id="salary" type="text" placeholder="مثال: 800" /></div>
              <div><label>رخصة القيادة — اختياري</label><input id="license" type="text" placeholder="سارية / نوع المركبة" /></div>
            </div>
          </form>
          <div class="hint" style="margin-top:8px">* الحقول الأساسية مطلوبة قبل التصدير.</div>
        </div>
      </div>

      <!-- ======= PREVIEW ======= -->
      <div class="card">
        <div class="h"><h2>معاينة سيرة احترافية (ATS)</h2></div>
        <div class="b">
          <article id="cv" class="cv" aria-label="CV Preview">
            <header>
              <h1 class="name" id="v_name">اسم المتقدّم</h1>
              <p class="title" id="v_title">المسمّى المستهدف</p>
              <div class="meta" id="v_contacts">email@example.com · +973 3xxxxxxx · المنامة، البحرين · linkedin.com/in/…</div>
              <div class="bar"></div>
            </header>

            <section class="sec" id="s_summary" hidden>
              <h3>الملخّص</h3><p id="v_summary"></p>
            </section>

            <section class="sec" id="s_exp" hidden>
              <h3>الخبرة العملية</h3><div id="v_exp"></div>
            </section>

            <section class="sec" id="s_edu" hidden>
              <h3>التعليم</h3><div id="v_edu"></div>
            </section>

            <section class="sec" id="s_skills" hidden>
              <h3>المهارات</h3><div class="chipline" id="v_skills"></div>
            </section>

            <section class="sec" id="s_langs" hidden>
              <h3>اللغات</h3><div id="v_langs"></div>
            </section>

            <section class="sec" id="s_certs" hidden>
              <h3>الشهادات</h3><div id="v_certs"></div>
            </section>
          </article>
        </div>
      </div>
    </div>
  </div>

<script>
(()=>{

  const $=(s,r=document)=>r.querySelector(s), $$=(s,r=document)=>Array.from(r.querySelectorAll(s));

  const refs={
    fullName:$('#fullName'), targetTitle:$('#targetTitle'), email:$('#email'),
    phone:$('#phone'), location:$('#location'), links:$('#links'),
    summary:$('#summary'), skills:$('#skills'), langs:$('#langs'),
    expList:$('#expList'), eduList:$('#eduList'), certList:$('#certList'),
    cpr:$('#cpr'), visa:$('#visa'), salary:$('#salary'), license:$('#license'),
    v:{
      name:$('#v_name'), title:$('#v_title'), contacts:$('#v_contacts'),
      s_summary:$('#s_summary'), v_summary:$('#v_summary'),
      s_exp:$('#s_exp'), v_exp:$('#v_exp'),
      s_edu:$('#s_edu'), v_edu:$('#v_edu'),
      s_skills:$('#s_skills'), v_skills:$('#v_skills'),
      s_langs:$('#s_langs'), v_langs:$('#v_langs'),
      s_certs:$('#s_certs'), v_certs:$('#v_certs')
    }
  };

  const state={basics:{}, exp:[], edu:[], certs:[]};

  function sanitize(s){return (s||'').toString().replace(/\s+/g,' ').trim();}
  function splitComma(s){return sanitize(s).split(/[,،]\s*/).filter(Boolean);}

  // Bahrain phone validation: +973 then 8 digits (often starts 3/6/7)
  function validBHPhone(s){
    const x=sanitize(s).replace(/\s+/g,'');
    return /^\+?973\d{8}$/.test(x);
  }

  function updates(){
    const b=state.basics={
      fullName:sanitize(refs.fullName.value),
      targetTitle:sanitize(refs.targetTitle.value),
      email:sanitize(refs.email.value),
      phone:sanitize(refs.phone.value),
      location:sanitize(refs.location.value),
      links:sanitize(refs.links.value),
      summary:sanitize(refs.summary.value),
      skills:sanitize(refs.skills.value),
      langs:sanitize(refs.langs.value),
      cpr:sanitize(refs.cpr.value),
      visa:sanitize(refs.visa.value),
      salary:sanitize(refs.salary.value),
      license:sanitize(refs.license.value),
    };
    render(); saveLocal();
  }

  ['fullName','targetTitle','email','phone','location','links','summary','skills','langs','cpr','visa','salary','license']
    .forEach(id=>{ const el=refs[id]; if(!el) return; el.addEventListener('input', updates); });

  // Summary counter
  $('#summary').addEventListener('input', e=>$('#sumCount').textContent=e.target.value.length);

  // Direction toggle
  $('#dirSel').addEventListener('change', e=>{
    const dir=e.target.value;
    document.documentElement.setAttribute('dir',dir);
    document.documentElement.setAttribute('lang',dir==='rtl'?'ar':'en');
  });

  // Repeatable blocks
  function repExp(data={}){
    const def=Object.assign({role:'',company:'',loc:'المنامة، البحرين',start:'',end:'',bullets:''},data);
    const w=document.createElement('div'); w.className='rep';
    w.innerHTML=`
      <div class="head"><strong>خبرة</strong>
        <div>
          <button type="button" class="btn sm ghost up">▲</button>
          <button type="button" class="btn sm ghost dn">▼</button>
          <button type="button" class="btn sm" style="background:#fff;border:1px solid var(--danger);color:var(--danger)">حذف</button>
        </div>
      </div>
      <div class="grid two">
        <div><label>المسمّى</label><input class="role" type="text" placeholder="مثال: مهندس برمجيات" value="${def.role}"></div>
        <div><label>الشركة</label><input class="company" type="text" placeholder="اسم الشركة" value="${def.company}"></div>
        <div><label>الموقع</label><input class="loc" type="text" value="${def.loc}"></div>
        <div><label>الفترة</label><div class="inline"><input class="start" type="text" placeholder="YYYY-MM" value="${def.start}" style="flex:1"><input class="end" type="text" placeholder="YYYY-MM أو حاضر" value="${def.end}" style="flex:1"></div></div>
        <div class="grid">
          <label>إنجازات (افصل بـ ;)</label>
          <textarea class="bullets" placeholder="رفعت المبيعات 18% ; خفّضت التكاليف 12%">${def.bullets}</textarea>
        </div>
      </div>`;
    hookRep(w, refs.expList);
    return w;
  }
  function repEdu(data={}){
    const def=Object.assign({degree:'',major:'',school:'',loc:'المنامة، البحرين',date:''},data);
    const w=document.createElement('div'); w.className='rep';
    w.innerHTML=`
      <div class="head"><strong>تعليم</strong>
        <div>
          <button type="button" class="btn sm ghost up">▲</button>
          <button type="button" class="btn sm ghost dn">▼</button>
          <button type="button" class="btn sm" style="background:#fff;border:1px solid var(--danger);color:var(--danger)">حذف</button>
        </div>
      </div>
      <div class="grid two">
        <div><label>الدرجة</label><input class="degree" type="text" placeholder="بكالوريوس / ماجستير" value="${def.degree}"></div>
        <div><label>التخصص</label><input class="major" type="text" placeholder="علوم الحاسب" value="${def.major}"></div>
        <div><label>المؤسسة</label><input class="school" type="text" placeholder="جامعة البحرين" value="${def.school}"></div>
        <div><label>الموقع</label><input class="loc" type="text" value="${def.loc}"></div>
        <div><label>تاريخ التخرج</label><input class="date" type="text" placeholder="YYYY-MM" value="${def.date}"></div>
      </div>`;
    hookRep(w, refs.eduList);
    return w;
  }
  function repCert(data={}){
    const def=Object.assign({name:'',issuer:'',date:''},data);
    const w=document.createElement('div'); w.className='rep';
    w.innerHTML=`
      <div class="head"><strong>شهادة</strong>
        <div>
          <button type="button" class="btn sm ghost up">▲</button>
          <button type="button" class="btn sm ghost dn">▼</button>
          <button type="button" class="btn sm" style="background:#fff;border:1px solid var(--danger);color:var(--danger)">حذف</button>
        </div>
      </div>
      <div class="grid two">
        <div><label>اسم الشهادة</label><input class="name" type="text" placeholder="PMP / AWS SAA" value="${def.name}"></div>
        <div><label>الجهة</label><input class="issuer" type="text" placeholder="PMI / AWS" value="${def.issuer}"></div>
        <div><label>التاريخ</label><input class="date" type="text" placeholder="YYYY-MM" value="${def.date}"></div>
      </div>`;
    hookRep(w, refs.certList);
    return w;
  }
  function hookRep(rep, list){
    list.appendChild(rep);
    rep.addEventListener('click',e=>{
      const btn=e.target.closest('button'); if(!btn) return;
      if(btn.textContent.includes('حذف')) rep.remove();
      if(btn.classList.contains('up') && rep.previousElementSibling) list.insertBefore(rep, rep.previousElementSibling);
      if(btn.classList.contains('dn') && rep.nextElementSibling) list.insertBefore(rep.nextElementSibling, rep);
      updates();
    });
    rep.addEventListener('input', updates);
  }

  $('#addExp').addEventListener('click', ()=>{repExp(); updates();});
  $('#addEdu').addEventListener('click', ()=>{repEdu(); updates();});
  $('#addCert').addEventListener('click', ()=>{repCert(); updates();});

  // Render CV
  function render(){
    const b=state.basics;

    $('#v_name').textContent = b.fullName || 'اسم المتقدّم';
    $('#v_title').textContent = b.targetTitle || 'المسمّى المستهدف';

    const contacts = [
      b.email||'',
      b.phone||'',
      b.location||'',
      (b.links? splitComma(b.links).map(x=>{try{const u=new URL(x);return (u.hostname.replace(/^www\./,'')+u.pathname).replace(/\/$/,'')}catch{return x}}).join(' · '):'')
    ].filter(Boolean).join(' · ');
    $('#v_contacts').textContent = contacts || 'email@example.com · +973 3xxxxxxx · المنامة، البحرين';

    // Summary
    $('#s_summary').hidden = !b.summary;
    $('#v_summary').textContent = b.summary||'';

    // Skills
    const skills=splitComma(b.skills);
    $('#s_skills').hidden = skills.length===0;
    const vskills=$('#v_skills'); vskills.innerHTML='';
    skills.forEach(t=>{const s=document.createElement('span');s.className='chip';s.textContent=t;vskills.appendChild(s)});

    // Languages
    const langs=splitComma(b.langs);
    $('#s_langs').hidden = langs.length===0;
    const vlangs=$('#v_langs'); vlangs.innerHTML='';
    langs.forEach(l=>{const p=document.createElement('p');p.className='meta';p.textContent='• '+l;vlangs.appendChild(p)});

    // Experience
    const vexp=$('#v_exp'); vexp.innerHTML='';
    $$('#expList .rep').forEach(rep=>{
      const role=sanitize($('.role',rep).value), company=sanitize($('.company',rep).value),
            loc=sanitize($('.loc',rep).value), start=sanitize($('.start',rep).value),
            end=sanitize($('.end',rep).value), bullets=sanitize($('.bullets',rep).value);
      if(!(role||company||bullets)) return;
      const item=document.createElement('div'); item.className='item';
      const pos=document.createElement('div'); pos.className='pos';
      const r=document.createElement('span'); r.className='role'; r.textContent=role;
      const c=document.createElement('span'); c.className='company'; c.textContent=company?(' — '+company):'';
      pos.append(r,c);
      const meta=document.createElement('div'); meta.className='meta'; meta.textContent=[loc,[start,end].filter(Boolean).join(' – ')].filter(Boolean).join(' · ');
      const ul=document.createElement('ul');
      bullets.split(/\s*;\s*/).filter(Boolean).forEach(bu=>{const li=document.createElement('li');li.textContent=bu;ul.appendChild(li)});
      item.append(pos,meta,ul); vexp.appendChild(item);
    });
    $('#s_exp').hidden = vexp.children.length===0;

    // Education
    const vedu=$('#v_edu'); vedu.innerHTML='';
    $$('#eduList .rep').forEach(rep=>{
      const degree=sanitize($('.degree',rep).value), major=sanitize($('.major',rep).value),
            school=sanitize($('.school',rep).value), loc=sanitize($('.loc',rep).value),
            date=sanitize($('.date',rep).value);
      if(!(degree||school)) return;
      const item=document.createElement('div'); item.className='item';
      const pos=document.createElement('div'); pos.className='pos';
      const d=document.createElement('span'); d.className='role'; d.textContent=degree+(major?(' — '+major):'');
      const s=document.createElement('span'); s.className='company'; s.textContent=school?(' — '+school):'';
      pos.append(d,s);
      const meta=document.createElement('div'); meta.className='meta'; meta.textContent=[loc,date].filter(Boolean).join(' · ');
      item.append(pos,meta); vedu.appendChild(item);
    });
    $('#s_edu').hidden = vedu.children.length===0;

    // Certs
    const vcert=$('#v_certs'); vcert.innerHTML='';
    $$('#certList .rep').forEach(rep=>{
      const name=sanitize($('.name',rep).value), issuer=sanitize($('.issuer',rep).value), date=sanitize($('.date',rep).value);
      if(!(name||issuer)) return;
      const item=document.createElement('div'); item.className='item';
      const pos=document.createElement('div'); pos.className='pos';
      const n=document.createElement('span'); n.className='role'; n.textContent=name;
      const i=document.createElement('span'); i.className='company'; i.textContent=issuer?(' — '+issuer):'';
      pos.append(n,i);
      const meta=document.createElement('div'); meta.className='meta'; meta.textContent=date||'';
      item.append(pos,meta); vcert.appendChild(item);
    });
    $('#s_certs').hidden = vcert.children.length===0;
  }

  // Basic validation before export
  function validate(){
    const b=state.basics;
    const missing=[];
    if(!b.fullName) missing.push('الاسم الكامل');
    if(!b.targetTitle) missing.push('المسمّى المستهدف');
    if(!b.email) missing.push('البريد الإلكتروني');
    if(!b.phone||!validBHPhone(b.phone)) missing.push('الهاتف (صيغة البحرين: +973XXXXXXXX)');
    if(!b.location) missing.push('الموقع');
    if(missing.length){ alert('يرجى إكمال/تصحيح:\n• '+missing.join('\n• ')); return false; }
    return true;
  }

  // Save / Load JSON
  function collect(){
    const basics=state.basics;
    const exp=$$('#expList .rep').map(rep=>({
      role:sanitize($('.role',rep).value),
      company:sanitize($('.company',rep).value),
      loc:sanitize($('.loc',rep).value),
      start:sanitize($('.start',rep).value),
      end:sanitize($('.end',rep).value),
      bullets:sanitize($('.bullets',rep).value),
    }));
    const edu=$$('#eduList .rep').map(rep=>({
      degree:sanitize($('.degree',rep).value),
      major:sanitize($('.major',rep).value),
      school:sanitize($('.school',rep).value),
      loc:sanitize($('.loc',rep).value),
      date:sanitize($('.date',rep).value),
    }));
    const certs=$$('#certList .rep').map(rep=>({
      name:sanitize($('.name',rep).value),
      issuer:sanitize($('.issuer',rep).value),
      date:sanitize($('.date',rep).value),
    }));
    return {basics,exp,edu,certs};
  }
  function saveLocal(){ try{ localStorage.setItem('cv-bh', JSON.stringify(collect())); }catch{} }
  function restoreLocal(){
    try{
      const raw=localStorage.getItem('cv-bh'); if(!raw) return;
      const data=JSON.parse(raw);
      load(data);
    }catch{}
  }
  function load(data){
    const b=data.basics||{};
    for(const k of Object.keys(b)){ if(refs[k]) refs[k].value=b[k]; }
    refs.expList.innerHTML=''; (data.exp||[]).forEach(x=>repExp(x));
    refs.eduList.innerHTML=''; (data.edu||[]).forEach(x=>repEdu(x));
    refs.certList.innerHTML=''; (data.certs||[]).forEach(x=>repCert(x));
    $('#sumCount').textContent = (refs.summary.value||'').length;
    updates();
  }

  $('#btnSave').addEventListener('click', ()=>{
    const blob=new Blob([JSON.stringify(collect(),null,2)],{type:'application/json'});
    const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='cv-bahrain.json'; a.click();
    setTimeout(()=>URL.revokeObjectURL(url),200);
  });
  $('#jsonFile').addEventListener('change', async e=>{
    const f=e.target.files[0]; if(!f) return;
    try{ load(JSON.parse(await f.text())); }catch{ alert('تعذّر استيراد JSON'); }
    e.target.value='';
  });

  // Export PDF (print)
  $('#btnPdf').addEventListener('click', ()=>{ if(validate()) window.print(); });

  // Export Word (.doc as HTML)
  $('#btnDoc').addEventListener('click', ()=>{
    if(!validate()) return;
    const dir=document.documentElement.getAttribute('dir')||'rtl';
    const cv=$('#cv').cloneNode(true);
    const styles=`
      <style>
        body{font-family:"Cairo","Noto Naskh Arabic",Arial;direction:${dir};color:#0F172A}
        h1{margin:0 0 6px;font-size:24px}
        h3{margin:14px 0 6px;font-size:15px}
        .meta{color:#475569;font-size:12px}
        .bar{height:2px;background:#C7A046;margin:10px 0 18px}
        .chip{display:inline-block;margin:2px 4px;padding:3px 8px;border:1px solid #E5E7EB;border-radius:999px;font-size:12px;background:#F8FAFC}
        ul{margin:6px 0 0 18px} li{margin:4px 0}
      </style>`;
    const html=`<!DOCTYPE html><html><head><meta charset="utf-8"><title>CV</title>${styles}</head><body>${cv.outerHTML}</body></html>`;
    const blob=new Blob([html],{type:'application/msword'});
    const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='CV-Bahrain.doc'; a.click();
    setTimeout(()=>URL.revokeObjectURL(url),200);
  });

  // Helper for query inside node
  function $(s,r){return (r||document).querySelector(s)}
  function $$(s,r){return Array.from((r||document).querySelectorAll(s))}

  // Init
  restoreLocal(); render();
  // Add one blank block to ease start
  if(!$('#expList .rep')) repExp();
  if(!$('#eduList .rep')) repEdu();

})();
</script>
</body>
</html>
