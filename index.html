<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CV — منشئ سيرة ذاتية بسيط ومتجاوب (عربي/English)</title>

<!-- خطوط احترافية تدعم العربية والإنجليزية -->
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@400;600;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
  /* ============ تصميم ذهبي/أبيض مع لمسات احترافية ============ */
  :root{
    --gold:#D4AF37;           /* ذهبية أنيقة */
    --gold-2:#c8a23a;         /* درجة أغمق للهوفر */
    --ink:#0f172a;            /* نص أساسي */
    --muted:#6b7280;          /* نص ثانوي */
    --paper:#ffffff;          /* خلفية البطاقات */
    --bg:#faf9f6;             /* خلفية عامة دافئة */
    --border:#ece7da;         /* حد محايد مائل للذهبي */
    --shadow:0 10px 24px rgba(15,23,42,.06);
    --radius:16px;
  }
  *,*::before,*::after{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;background:var(--bg);color:var(--ink);
    font-family:"IBM Plex Sans Arabic","Inter",system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,sans-serif;
    -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  }

  /* ===== تخطيط متجاوب بسيط: عمود واحد على الهاتف، عمودان على الشاشات الأوسع ===== */
  .container{
    max-width:1200px;margin-inline:auto;padding:16px;
    display:grid;gap:16px;grid-template-columns:1fr;
  }
  @media(min-width:992px){
    .container{grid-template-columns:420px 1fr}
  }

  /* ===== لوحة الإدخال (أسهل ما يكون) ===== */
  .panel{
    background:var(--paper);border:1px solid var(--border);border-radius:var(--radius);
    box-shadow:var(--shadow);padding:16px;
  }
  .panel h1{
    margin:0 0 8px;font-weight:700;font-size:1.35rem;
    letter-spacing:.2px
  }
  .sub{
    margin:0 0 12px;color:var(--muted);font-size:.95rem
  }

  /* شريط خطوات بسيط لسهولة التنقل على الهاتف */
  .steps{
    display:flex;gap:6px;flex-wrap:wrap;margin-bottom:10px
  }
  .step{
    flex:1;min-width:120px;text-align:center;padding:.6rem .8rem;cursor:pointer;
    border:1px solid var(--border);border-radius:12px;background:#fff;font-weight:700
  }
  .step.active{border-color:var(--gold);box-shadow:0 0 0 2px #0000, inset 0 0 0 999px rgba(212,175,55,.06)}
  .sections > .section{display:none}
  .sections > .section.active{display:block}

  /* حقول مبسطة بملصق عائم */
  .field{position:relative;margin:12px 0}
  .input, .textarea, .select{
    width:100%;padding:14px 12px;border:1px solid var(--border);border-radius:12px;background:#fff;font-weight:600
  }
  .textarea{min-height:96px;resize:vertical}
  .label{
    position:absolute;inset-inline-start:12px;top:50%;transform:translateY(-50%);
    background:#fff;padding:0 6px;color:#8b8b8b;font-weight:600;pointer-events:none;transition:.15s ease;
  }
  .input:focus + .label, .textarea:focus + .label, .input:not(:placeholder-shown)+.label, .textarea:not(:placeholder-shown)+.label{
    top:-8px;font-size:.78rem;color:var(--gold)
  }

  /* شبكات سهلة */
  .row{display:grid;gap:10px}
  @media(min-width:600px){ .row.cols-2{grid-template-columns:1fr 1fr} }
  @media(min-width:800px){ .row.cols-3{grid-template-columns:1fr 1fr 1fr} }

  /* أزرار كبيرة لمس/محمول */
  .btn{
    border:1px solid var(--border);background:#fff;border-radius:12px;padding:.75rem 1rem;font-weight:800;cursor:pointer
  }
  .btn.gold{background:linear-gradient(180deg,#f9eac0,#f5d774);border-color:#e7c96a}
  .btn.gold:hover{filter:saturate(1.05) brightness(1.01)}
  .btn.ghost{background:#fff}
  .btn.icon{display:inline-flex;align-items:center;gap:8px}

  /* شريط تصدير لاصق أسفل الشاشة على الهاتف */
  .sticky-actions{
    position:sticky;bottom:0;background:#fff;border:1px solid var(--border);
    border-radius:14px;padding:10px;display:flex;gap:8px;flex-wrap:wrap;justify-content:space-between;margin-top:12px
  }
  .hint{color:var(--muted);font-size:.85rem}

  /* ===== معاينة CV متجاوبة ===== */
  .preview{
    background:var(--paper);border:1px solid var(--border);border-radius:var(--radius);
    box-shadow:var(--shadow);padding:0;overflow:hidden
  }
  .cv{
    width:100%;max-width:900px;margin:auto;padding:18px 18px 24px;
  }
  @media(min-width:992px){
    .cv{padding:26px 30px}
  }

  .cv-head{display:grid;gap:14px;grid-template-columns:1fr 120px;align-items:center}
  .cv-name{margin:0;font-size:1.5rem;font-weight:700;letter-spacing:.2px}
  .cv-role{margin:2px 0 6px;font-weight:700;color:#5b4a11}
  .cv-photo{width:120px;height:120px;border-radius:14px;border:2px solid var(--gold);object-fit:cover;background:#f1f1f1;justify-self:end}
  .cv-summary{color:#374151;line-height:1.8;white-space:pre-line}
  .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
  .chip{
    display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border:1px solid var(--border);border-radius:999px;background:#fff;font-weight:700
  }

  .cv-grid{display:grid;gap:16px;margin-top:16px}
  @media(min-width:820px){ .cv-grid{grid-template-columns:1.15fr .85fr} }

  .sec-title{
    font-weight:800;margin:0 0 8px;display:inline-block;padding-bottom:4px;
    border-bottom:3px solid var(--gold);letter-spacing:.3px
  }
  .item{margin:10px 0}
  .item .top{display:flex;justify-content:space-between;font-weight:700}
  .item .meta{color:#6b7280;font-weight:600}
  .item .desc{margin-top:6px;color:#374151;white-space:pre-line}
  .tags{display:flex;flex-wrap:wrap;gap:8px;margin-top:6px}
  .tag{padding:6px 10px;border-radius:999px;background:#fff;border:1px dashed var(--gold);font-weight:700}

  /* طباعة: A4 نظيفة */
  @media print{
    body{background:#fff}
    .container{display:block}
    .panel{display:none}
    .preview{border:none;box-shadow:none}
    .cv{max-width:none;padding:0}
    @page{size:A4;margin:12mm}
  }
</style>
</head>
<body>

<div class="container">
  <!-- ========== لوحة إدخال مبسطة ومتجاوبة ========== -->
  <section class="panel" id="formPanel">
    <h1>منشئ سيرة ذاتية — بسيط ومتجاوب</h1>
    <p class="sub">املأ بياناتك بسرعة. يدعم عربي/English تلقائيًا. الألوان ذهبية/بيضاء مع مظهر احترافي.</p>

    <!-- خطوات للتنقل السريع (سهلة على الهاتف) -->
    <div class="steps" role="tablist" aria-label="خطوات إدخال السيرة">
      <button class="step active" data-step="basic" role="tab">الأساسيات</button>
      <button class="step" data-step="exp" role="tab">الخبرات</button>
      <button class="step" data-step="edu" role="tab">التعليم/المهارات</button>
      <button class="step" data-step="more" role="tab">المزيد</button>
    </div>

    <div class="sections">
      <!-- الأساسيات -->
      <div class="section active" id="sec-basic">
        <div class="row cols-2">
          <div class="field">
            <input class="input" id="name" placeholder=" " />
            <label class="label" for="name">الاسم الكامل / Full Name</label>
          </div>
          <div class="field">
            <input class="input" id="role" placeholder=" " />
            <label class="label" for="role">المسمّى / Title</label>
          </div>
        </div>

        <div class="field">
          <textarea class="textarea" id="summary" placeholder=" "></textarea>
          <label class="label" for="summary">الملخص المهني / Professional Summary (سطرين إلى 4)</label>
        </div>

        <div class="row cols-2">
          <div class="field">
            <input class="input" id="email" placeholder=" " />
            <label class="label" for="email">البريد الإلكتروني / Email</label>
          </div>
          <div class="field">
            <input class="input" id="phone" placeholder=" " />
            <label class="label" for="phone">الهاتف / Phone</label>
          </div>
        </div>

        <div class="row cols-2">
          <div class="field">
            <input class="input" id="location" placeholder=" " />
            <label class="label" for="location">المدينة، الدولة / City, Country</label>
          </div>
          <div class="field">
            <input class="input" id="linkedin" placeholder=" " />
            <label class="label" for="linkedin">LinkedIn</label>
          </div>
        </div>

        <div class="row cols-2">
          <div class="field">
            <input class="input" id="website" placeholder=" " />
            <label class="label" for="website">Website / Portfolio</label>
          </div>
          <div class="field">
            <select class="select" id="uiLang">
              <option value="ar" selected>واجهة عربية (RTL)</option>
              <option value="en">English UI (LTR)</option>
            </select>
          </div>
        </div>

        <div class="row cols-2" style="align-items:center">
          <div class="field">
            <input class="input" id="accent" type="color" value="#D4AF37" />
            <label class="label" for="accent">لون اللمسة (Accent)</label>
          </div>
          <div class="field">
            <input class="input" id="photo" type="file" accept="image/*" />
            <label class="label" for="photo">صورة شخصية (اختياري)</label>
          </div>
        </div>
      </div>

      <!-- الخبرات -->
      <div class="section" id="sec-exp">
        <div id="expList"></div>
        <button class="btn icon gold" type="button" id="addExp">➕ إضافة خبرة</button>
      </div>

      <!-- التعليم والمهارات -->
      <div class="section" id="sec-edu">
        <div id="eduList"></div>
        <button class="btn icon gold" type="button" id="addEdu">➕ إضافة تعليم</button>

        <div class="field" style="margin-top:12px">
          <input class="input" id="skills" placeholder=" " />
          <label class="label" for="skills">المهارات (اكتبها بفواصل) — Skills (comma separated)</label>
        </div>

        <div class="row cols-2">
          <div class="field">
            <input class="input" id="lang1" placeholder=" " />
            <label class="label" for="lang1">اللغة الأولى — Language</label>
          </div>
          <div class="field">
            <input class="input" id="lang1lvl" placeholder=" " />
            <label class="label" for="lang1lvl">المستوى — Level</label>
          </div>
        </div>
        <div class="row cols-2">
          <div class="field">
            <input class="input" id="lang2" placeholder=" " />
            <label class="label" for="lang2">اللغة الثانية — Language</label>
          </div>
          <div class="field">
            <input class="input" id="lang2lvl" placeholder=" " />
            <label class="label" for="lang2lvl">المستوى — Level</label>
          </div>
        </div>
      </div>

      <!-- المزيد: مشاريع/شهادات + تصدير -->
      <div class="section" id="sec-more">
        <div id="projList"></div>
        <button class="btn icon gold" type="button" id="addProj">➕ إضافة مشروع</button>

        <div style="height:8px"></div>

        <div id="certList"></div>
        <button class="btn icon gold" type="button" id="addCert">➕ إضافة شهادة</button>

        <div class="sticky-actions">
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <button class="btn gold" id="pdfAR" type="button">⬇️ PDF (عربي)</button>
            <button class="btn gold" id="pdfEN" type="button">⬇️ PDF (English)</button>
            <button class="btn ghost" id="docAR" type="button">⬇️ Word (AR)</button>
            <button class="btn ghost" id="docEN" type="button">⬇️ Word (EN)</button>
          </div>
          <button class="btn" id="clearAll" type="button">مسح الكل</button>
        </div>
        <div class="hint">نصيحة: على الهاتف، سيظهر شريط التصدير دائمًا أسفل القسم لسهولة الوصول.</div>
      </div>
    </div>
  </section>

  <!-- ========== المعاينة (مرنة على الهاتف) ========== -->
  <section class="preview" aria-label="معاينة السيرة">
    <div class="cv" id="cv">
      <div class="cv-head">
        <div>
          <h2 class="cv-name" id="cvName">اسمك الكامل / Your Name</h2>
          <div class="cv-role" id="cvRole">المسمّى / Title</div>
          <div class="cv-summary" id="cvSummary">اكتب ملخصًا قصيرًا عن خبرتك.\nWrite a brief professional summary.</div>
        </div>
        <img class="cv-photo" id="cvPhoto" alt="" style="display:none"/>
      </div>

      <div class="chips" id="cvChips">
        <span class="chip" id="cEmail" style="display:none">✉️ <b></b></span>
        <span class="chip" id="cPhone" style="display:none">📞 <b></b></span>
        <span class="chip" id="cLoc"   style="display:none">📍 <b></b></span>
        <span class="chip" id="cLn"    style="display:none">🔗 <b>LinkedIn</b></span>
        <span class="chip" id="cWeb"   style="display:none">🌐 <b>Website</b></span>
      </div>

      <div class="cv-grid">
        <div>
          <h3 class="sec-title" id="hExp">الخبرات العملية</h3>
          <div id="cvExp" class="items"></div>

          <h3 class="sec-title" id="hProj" style="margin-top:12px">المشاريع</h3>
          <div id="cvProj" class="items"></div>
        </div>
        <div>
          <h3 class="sec-title" id="hEdu">التعليم</h3>
          <div id="cvEdu" class="items"></div>

          <h3 class="sec-title" id="hSkills" style="margin-top:12px">المهارات</h3>
          <div class="tags" id="cvSkills"><span class="tag">HTML</span><span class="tag">CSS</span></div>

          <h3 class="sec-title" id="hLang" style="margin-top:12px">اللغات</h3>
          <div id="cvLangs" class="items"></div>

          <h3 class="sec-title" id="hCert" style="margin-top:12px">الشهادات</h3>
          <div id="cvCerts" class="items"></div>
        </div>
      </div>
    </div>
  </section>
</div>

<script>
/* ===== أدوات سريعة ===== */
const $=s=>document.querySelector(s);
const $$=s=>Array.from(document.querySelectorAll(s));
const fmtRange=(a,b)=>[a,b].filter(Boolean).join(" — ");
const bullets=t=>(t||'').split(/\r?\n/).filter(x=>x.trim()).map(x=>'• '+x.trim()).join('\n');

/* ===== تبسيط التنقل بين الأقسام (خطوة واحدة كل مرة على الهاتف) ===== */
const sections = {
  basic: $('#sec-basic'),
  exp: $('#sec-exp'),
  edu: $('#sec-edu'),
  more: $('#sec-more')
};
$$('.step').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    $$('.step').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    const key = btn.dataset.step;
    Object.values(sections).forEach(s=>s.classList.remove('active'));
    sections[key].classList.add('active');
    window.scrollTo({top:0, behavior:'smooth'});
  });
});

/* ===== ربط الحقول بالمعاينة (سهل وواضح) ===== */
const state = {
  ui:'ar',
  name:'', role:'', summary:'',
  email:'', phone:'', location:'', linkedin:'', website:'',
  accent:'#D4AF37',
  exp:[], edu:[], proj:[], cert:[],
  langs:[]
};
const bind = (id, key, cb=render)=>$(id).addEventListener('input', e=>{ state[key]=e.target.value; cb(); });

bind('#name','name');
bind('#role','role');
bind('#summary','summary');
bind('#email','email');
bind('#phone','phone');
bind('#location','location');
bind('#linkedin','linkedin');
bind('#website','website');
bind('#accent','accent', ()=>{
  document.documentElement.style.setProperty('--gold', state.accent || '#D4AF37');
  render();
});

$('#uiLang').addEventListener('change', e=>{
  state.ui = e.target.value;
  document.documentElement.dir = state.ui==='ar' ? 'rtl' : 'ltr';
  document.documentElement.lang = state.ui;
  // ترجمات عناوين الأقسام الأساسية فقط (المحتوى يبقى كما كتبه المستخدم)
  const T = state.ui==='ar' ? {
    exp:'الخبرات العملية', proj:'المشاريع', edu:'التعليم', skills:'المهارات', lang:'اللغات', cert:'الشهادات'
  } : {
    exp:'Experience', proj:'Projects', edu:'Education', skills:'Skills', lang:'Languages', cert:'Certificates'
  };
  $('#hExp').textContent=T.exp; $('#hProj').textContent=T.proj; $('#hEdu').textContent=T.edu;
  $('#hSkills').textContent=T.skills; $('#hLang').textContent=T.lang; $('#hCert').textContent=T.cert;
  render();
});

/* ===== صورة شخصية مبسطة ===== */
$('#photo').addEventListener('change', e=>{
  const f = e.target.files?.[0]; if(!f) return;
  const reader = new FileReader();
  reader.onload = ev => {
    $('#cvPhoto').src = ev.target.result;
    $('#cvPhoto').style.display='block';
  };
  reader.readAsDataURL(f);
});

/* ===== عناصر ديناميكية صغيرة وسهلة (بطاقات بسيطة) ===== */
function mkCard(title){
  const wrap = document.createElement('div');
  wrap.className='panel';
  wrap.style.padding='12px';
  wrap.style.margin='8px 0';
  wrap.innerHTML = `
    <div class="row cols-2">
      <div class="field"><input class="input" placeholder=" " /><label class="label">${title} / Title</label></div>
      <div class="field"><input class="input" placeholder=" " /><label class="label">الجهة / Company</label></div>
    </div>
    <div class="row cols-3">
      <div class="field"><input class="input" placeholder=" " /><label class="label">من / From</label></div>
      <div class="field"><input class="input" placeholder=" " /><label class="label">إلى / To</label></div>
      <div class="field"><input class="input" placeholder=" " /><label class="label">الموقع / Location</label></div>
    </div>
    <div class="field"><textarea class="textarea" placeholder=" "></textarea><label class="label">وصف / Description (سطر لكل نقطة)</label></div>
    <div style="display:flex;gap:8px;justify-content:flex-end">
      <button type="button" class="btn">حذف</button>
    </div>`;
  return wrap;
}

function mkSmallCard(title){
  const wrap = document.createElement('div');
  wrap.className='panel';
  wrap.style.padding='12px';
  wrap.style.margin='8px 0';
  wrap.innerHTML = `
    <div class="row cols-2">
      <div class="field"><input class="input" placeholder=" " /><label class="label">${title} / Name</label></div>
      <div class="field"><input class="input" placeholder=" " /><label class="label">الجهة / Issuer</label></div>
    </div>
    <div class="row cols-2">
      <div class="field"><input class="input" placeholder=" " /><label class="label">السنة / Year</label></div>
      <div class="field"><input class="input" placeholder=" " /><label class="label">رابط (اختياري) / Link</label></div>
    </div>
    <div style="display:flex;gap:8px;justify-content:flex-end">
      <button type="button" class="btn">حذف</button>
    </div>`;
  return wrap;
}

const expList = $('#expList');
const eduList = $('#eduList');
const projList = $('#projList');
const certList = $('#certList');

function addHandlers(container, storeArr, renderTo){
  container.addEventListener('click', e=>{
    if(e.target.matches('.btn') && e.target.textContent.includes('حذف')){
      const idx = Array.from(container.children).indexOf(e.target.closest('.panel'));
      container.children[idx]?.remove();
      storeArr.splice(idx,1);
      renderTo();
    }
  });
  container.addEventListener('input', ()=>{
    storeArr.length = 0;
    Array.from(container.children).forEach(card=>{
      const ins = card.querySelectorAll('input,textarea');
      storeArr.push({
        title:ins[0].value, org:ins[1].value, from:ins[2].value, to:ins[3].value, place:ins[4].value, desc:ins[5]?.value || ''
      });
    });
    renderTo();
  });
}

$('#addExp').addEventListener('click', ()=>{
  expList.appendChild(mkCard('المسمّى'));
  state.exp.push({}); render();
});
$('#addEdu').addEventListener('click', ()=>{
  const card = mkCard('الدرجة / Degree'); // نعيد استخدام نفس القالب
  eduList.appendChild(card);
  state.edu.push({}); render();
});
$('#addProj').addEventListener('click', ()=>{
  const card = mkCard('المشروع / Project');
  projList.appendChild(card);
  state.proj.push({}); render();
});
$('#addCert').addEventListener('click', ()=>{
  certList.appendChild(mkSmallCard('الشهادة / Certificate'));
  state.cert.push({}); render();
});

addHandlers(expList, state.exp, render);
addHandlers(eduList, state.edu, render);
addHandlers(projList, state.proj, render);
addHandlers(certList, state.cert, render);

/* ===== ربط لغات بسيطة ===== */
function renderLanguages(){
  const arr=[];
  const l1 = $('#lang1').value?.trim(), l1l = $('#lang1lvl').value?.trim();
  const l2 = $('#lang2').value?.trim(), l2l = $('#lang2lvl').value?.trim();
  if(l1) arr.push([l1,l1l]); if(l2) arr.push([l2,l2l]);
  const box = $('#cvLangs'); box.innerHTML='';
  if(arr.length===0){ box.innerHTML='<div class="item"><div class="meta">—</div></div>'; return; }
  arr.forEach(([n,l])=>{
    box.insertAdjacentHTML('beforeend', `<div class="item"><div class="top"><div>${n}</div><div class="meta">${l||''}</div></div></div>`);
  });
}
$('#lang1').addEventListener('input', renderLanguages);
$('#lang1lvl').addEventListener('input', renderLanguages);
$('#lang2').addEventListener('input', renderLanguages);
$('#lang2lvl').addEventListener('input', renderLanguages);

/* ===== رندر المعاينة (سريع وخفيف) ===== */
function setChip(id, val, label){
  const el=$(id); if(!el) return;
  if(val){ el.style.display='inline-flex'; el.querySelector('b').textContent = label || val; }
  else{ el.style.display='none'; }
}
function render(){
  // أسماء وعناوين
  $('#cvName').textContent = state.name || 'اسمك الكامل / Your Name';
  $('#cvRole').textContent = state.role || 'المسمّى / Title';
  $('#cvSummary').textContent = state.summary || 'اكتب ملخصًا قصيرًا عن خبرتك.\nWrite a brief professional summary.';

  // رقائق تواصل
  setChip('#cEmail', state.email);
  setChip('#cPhone', state.phone);
  setChip('#cLoc',   state.location);
  setChip('#cLn',    state.linkedin, 'LinkedIn');
  setChip('#cWeb',   state.website,  'Website');

  // خبرات
  const cvExp = $('#cvExp'); cvExp.innerHTML='';
  if(state.exp.length===0) cvExp.innerHTML='<div class="item"><div class="meta">—</div></div>';
  state.exp.forEach(x=>{
    cvExp.insertAdjacentHTML('beforeend', `
      <div class="item">
        <div class="top"><div>${x.title||''}${x.org?` — ${x.org}`:''}</div><div class="meta">${fmtRange(x.from||'',x.to||'')}</div></div>
        <div class="meta">${x.place||''}</div>
        <div class="desc">${bullets(x.desc||'')}</div>
      </div>
    `);
  });

  // تعليم
  const cvEdu = $('#cvEdu'); cvEdu.innerHTML='';
  if(state.edu.length===0) cvEdu.innerHTML='<div class="item"><div class="meta">—</div></div>';
  state.edu.forEach(x=>{
    cvEdu.insertAdjacentHTML('beforeend', `
      <div class="item">
        <div class="top"><div>${x.title||''}${x.org?` — ${x.org}`:''}</div><div class="meta">${fmtRange(x.from||'',x.to||'')}</div></div>
        <div class="meta">${x.place||''}</div>
        <div class="desc">${bullets(x.desc||'')}</div>
      </div>
    `);
  });

  // مشاريع
  const cvProj = $('#cvProj'); cvProj.innerHTML='';
  if(state.proj.length===0) cvProj.innerHTML='<div class="item"><div class="meta">—</div></div>';
  state.proj.forEach(x=>{
    const link = (x.place && x.place.startsWith('http')) ? ` — <a href="${x.place}" target="_blank" rel="noopener" style="color:var(--gold);font-weight:800">Link</a>` : '';
    cvProj.insertAdjacentHTML('beforeend', `
      <div class="item">
        <div class="top"><div>${x.title||''}</div><div class="meta">${x.org||''}</div></div>
        <div class="desc">${bullets(x.desc||'')}${link}</div>
      </div>
    `);
  });

  // مهارات
  const tags = ( ($('#skills').value||'').split(',').map(s=>s.trim()).filter(Boolean) );
  const cvSkills = $('#cvSkills'); cvSkills.innerHTML='';
  if(tags.length===0){ cvSkills.innerHTML='<span class="tag">—</span>'; }
  else tags.forEach(t=>cvSkills.insertAdjacentHTML('beforeend', `<span class="tag">${t}</span>`));

  // شهادات
  const cvCerts = $('#cvCerts'); cvCerts.innerHTML='';
  if(state.cert.length===0) cvCerts.innerHTML='<div class="item"><div class="meta">—</div></div>';
  state.cert.forEach(x=>{
    cvCerts.insertAdjacentHTML('beforeend', `
      <div class="item">
        <div class="top"><div>${x.title||''}</div><div class="meta">${x.from||''}</div></div>
        <div class="meta">${x.org||''}</div>
      </div>
    `);
  });
}
render();

/* ===== مزامنة حقول الديناميك ===== */
function syncArray(container, arr){
  arr.length = 0;
  Array.from(container.children).forEach(card=>{
    const ins = card.querySelectorAll('input,textarea');
    arr.push({
      title:ins[0]?.value||'', org:ins[1]?.value||'',
      from:ins[2]?.value||'', to:ins[3]?.value||'',
      place:ins[4]?.value||'', desc:ins[5]?.value||''
    });
  });
  render();
}
[expList,eduList,projList,certList].forEach(c=>{
  c.addEventListener('input', ()=>{
    if(c===expList) syncArray(expList,state.exp);
    if(c===eduList) syncArray(eduList,state.edu);
    if(c===projList) syncArray(projList,state.proj);
    if(c===certList) syncArray(certList,state.cert);
  });
});

/* ===== تصدير PDF/Word (عربي/إنجليزي) ===== */
// نحضر نسخة نظيفة للطباعة/التنزيل
function makeCV(lang='ar'){
  const cv = $('#cv').cloneNode(true);
  cv.setAttribute('lang', lang);
  cv.setAttribute('dir', lang==='ar'?'rtl':'ltr');
  return `
<!DOCTYPE html>
<html lang="${lang}" dir="${lang==='ar'?'rtl':'ltr'}">
<head>
<meta charset="utf-8">
<title>CV</title>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@400;600;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{--gold:${getComputedStyle(document.documentElement).getPropertyValue('--gold').trim()||'#D4AF37'}}
  body{margin:0;font-family:"IBM Plex Sans Arabic","Inter",sans-serif;color:#0f172a}
  a{color:var(--gold)}
  .cv{padding:18px 18px 24px}
  .cv-head{display:grid;gap:14px;grid-template-columns:1fr 120px;align-items:center}
  .cv-name{margin:0;font-size:1.5rem;font-weight:700}
  .cv-role{margin:2px 0 6px;font-weight:700;color:#5b4a11}
  .cv-photo{width:120px;height:120px;border-radius:14px;border:2px solid var(--gold);object-fit:cover}
  .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
  .chip{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border:1px solid #ece7da;border-radius:999px;background:#fff;font-weight:700}
  .cv-grid{display:grid;gap:16px;margin-top:16px}
  @media(min-width:820px){ .cv-grid{grid-template-columns:1.15fr .85fr} }
  .sec-title{font-weight:800;margin:0 0 8px;display:inline-block;padding-bottom:4px;border-bottom:3px solid var(--gold)}
  .item{margin:10px 0}.item .top{display:flex;justify-content:space-between;font-weight:700}
  .item .meta{color:#6b7280;font-weight:600}.item .desc{margin-top:6px;color:#374151;white-space:pre-line}
  .tags{display:flex;flex-wrap:wrap;gap:8px;margin-top:6px}
  .tag{padding:6px 10px;border-radius:999px;background:#fff;border:1px dashed var(--gold);font-weight:700}
  @page{size:A4;margin:12mm}
</style>
</head>
<body>${cv.outerHTML}
<script>window.onload=()=>setTimeout(()=>window.print(),200);<\/script>
</body></html>`;
}

function exportPDF(lang='ar'){
  const w = window.open('', '_blank');
  w.document.open(); w.document.write( makeCV(lang) ); w.document.close();
}

function exportDOC(lang='ar'){
  const html = makeCV(lang).replace(/<script>[^]*<\/script>/,''); // إزالة السكربت الخاص بالطباعة
  const blob = new Blob([html], {type:'application/msword'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  const fname = (state.name || (lang==='ar'?'سيرة_ذاتية':'CV')).replace(/\s+/g,'_');
  a.href=url; a.download=`${fname}-${lang.toUpperCase()}.doc`; document.body.appendChild(a); a.click(); a.remove();
  URL.revokeObjectURL(url);
}

$('#pdfAR').onclick = ()=>exportPDF('ar');
$('#pdfEN').onclick = ()=>exportPDF('en');
$('#docAR').onclick = ()=>exportDOC('ar');
$('#docEN').onclick = ()=>exportDOC('en');

/* مسح سريع */
$('#clearAll').onclick = ()=>{
  if(!confirm('هل تريد مسح جميع البيانات؟')) return;
  ['name','role','summary','email','phone','location','linkedin','website','skills','lang1','lang1lvl','lang2','lang2lvl'].forEach(id=>{
    const el = document.getElementById(id); if(el) el.value='';
  });
  [expList,eduList,projList,certList].forEach(c=>c.innerHTML='');
  Object.assign(state,{name:'',role:'',summary:'',email:'',phone:'',location:'',linkedin:'',website:'',exp:[],edu:[],proj:[],cert:[]});
  $('#cvPhoto').src=''; $('#cvPhoto').style.display='none';
  render(); renderLanguages();
};

/* تعبئة أمثلة خفيفة (تساعدك تبدأ فوراً) */
(function demo(){
  $('#name').value='فاضل الريس / Fadhel Al-Rayes';
  $('#role').value='Frontend Developer / مطوّر واجهات';
  $('#summary').value='مطوّر واجهات يركز على الأداء وتجربة المستخدم.\nFrontend dev focused on UX & performance.';
  $('#email').value='you@example.com';
  $('#phone').value='+973 3x xxx xxx';
  $('#location').value='المنامة، البحرين / Manama, Bahrain';
  $('#linkedin').value='linkedin.com/in/username';
  $('#website').value='your-portfolio.com';
  $('#skills').value='HTML, CSS, JavaScript, React, Git, Figma';

  // إضافة بطاقة خبرة واحدة فقط كبداية
  $('#addExp').click();
  const firstExp = expList.querySelector('.panel');
  const ins = firstExp.querySelectorAll('input,textarea');
  ins[0].value='Frontend Developer';
  ins[1].value='Modern Tech Co.';
  ins[2].value='09/2022';
  ins[3].value='Present';
  ins[4].value='Manama, Bahrain';
  ins[5].value='Built interactive dashboards.\nImproved performance by 35%.';
  syncArray(expList,state.exp);

  // تعليم
  $('#addEdu').click();
  const eIns = eduList.querySelectorAll('input,textarea');
  eIns[0].value='B.Sc. Computer Science';
  eIns[1].value='University of Bahrain';
  eIns[2].value='2018';
  eIns[3].value='2022';
  eIns[4].value='GPA 3.6';
  eIns[5].value='Capstone: Task tracking system.';
  syncArray(eduList,state.edu);

  // لغات
  $('#lang1').value='Arabic'; $('#lang1lvl').value='Fluent';
  $('#lang2').value='English'; $('#lang2lvl').value='Advanced';
  renderLanguages();
  render();
})();
</script>
</body>
</html>
