<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>الخِيرة بالقرآن | آية الاستخارة</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Kufi+Arabic:wght@700&family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
<style>
:root{
  --gold1:#fff4cc; --gold2:#f6d478; --gold3:#e9b84f; --gold4:#cf9a38;
}
*{box-sizing:border-box}
body{margin:0;font-family:"Tajawal",system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:#0e0e0e;color:#fff}
.container{max-width:980px;margin:auto;padding:22px 16px}
header{text-align:center;margin-bottom:16px}
h1{margin:6px 0 10px;font-family:"Noto Kufi Arabic",sans-serif;font-weight:800;font-size:clamp(24px,4.5vw,40px)}
.lead{opacity:.9}

.panel{
  background:linear-gradient(180deg,#1a1a1f,#141419);border:1px solid #262636;border-radius:18px;
  padding:16px;box-shadow:0 12px 30px rgba(0,0,0,.25)
}

.row{display:flex;gap:10px;flex-wrap:wrap;justify-content:center}

input[type="text"]{
  width:min(280px,90vw);padding:12px 14px;border:1px solid #ead79f;border-radius:12px;
  background:#111;color:#fff;font-size:16px;text-align:center
}
.btn{
  padding:12px 18px;border:0;border-radius:14px;cursor:pointer;font-weight:800;
  background:linear-gradient(180deg, rgba(255,255,255,.65), rgba(255,255,255,0) 40%),
            linear-gradient(180deg, var(--gold1), var(--gold2) 30%, var(--gold3) 60%, var(--gold4));
  color:#2b2107;box-shadow:0 12px 26px rgba(185,130,31,.28), inset 0 1px 0 rgba(255,255,255,.78)
}
.btn.dark{background:linear-gradient(180deg,#2a2a2a,#171717);color:#fff;border:1px solid #333}

.result{
  margin-top:16px;background:#fff;color:#111;padding:16px;border-radius:16px;border:1px solid #eee;
  line-height:2;text-align:right
}
.badge{
  display:inline-block;border-radius:999px;padding:6px 12px;margin:4px 6px 8px 0;
  background:linear-gradient(180deg,#fff7د4,#fbe9b1);border:1px solid #edd899;white-space:nowrap
}
#res-text{font-size:clamp(20px,2.6vw,28px);font-weight:700;line-height:2}

/* قائمة نتائج الكلمات */
.verse-card{background:#fafafa;border:1px solid #ddd;padding:10px;border-radius:12px;cursor:pointer;margin:10px 0}
.verse-card:hover{box-shadow:0 10px 24px rgba(0,0,0,.12)}

/* مودال تنبيه */
.app-modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:9999}
.app-modal.hidden{display:none}
.app-backdrop{position:absolute;inset:0;background:rgba(0,0,0,.55);backdrop-filter:blur(2px)}
.app-card{
  position:relative;width:min(92vw,520px);padding:20px;border-radius:22px;text-align:center;
  background:linear-gradient(180deg,#1f1f27, #15151c); color:#fff; border:1px solid #2b2b36; box-shadow:0 20px 44px rgba(0,0,0,.28)
}
.app-ico{width:64px;height:64px;margin:4px auto 8px;border-radius:50%;display:grid;place-items:center;font-size:28px;color:#1b1b22;
  background:linear-gradient(180deg,var(--gold1),var(--gold2))}
.app-ttl{font-family:"Noto Kufi Arabic";font-weight:800;margin:8px 0 6px}
.app-msg{color:#cfcfe3;line-height:1.9;margin-bottom:14px}
.app-btn{padding:10px 16px;width:100%;border:0;border-radius:14px;cursor:pointer;font-weight:800;
  background:linear-gradient(180deg,var(--gold1),var(--gold2) 60%,var(--gold3));color:#1b1b22}
.footer{margin-top:18px;text-align:center;opacity:.8}
</style>
</head>
<body>
<div class="container">
  <header>
    <h1>الخِيرة بالقرآن</h1>
    <div class="lead">اكتب رقم الصفحة (اليمين فقط) أو ابحث بكلمة، وستظهر لك <b>آية الاستخارة</b> (أول آية في الصفحة).</div>
  </header>

  <section class="panel" aria-labelledby="controls">
    <div class="row" id="controls">
      <input id="pageInput" type="text" placeholder="رقم الصفحة (١–٦٠٣ فردي)">
      <button class="btn" id="btnByPage">بحث برقم</button>
    </div>
    <div class="row" style="margin-top:10px">
      <input id="kwInput" type="text" placeholder="ابحث بالكلمة (عربي / English)">
      <button class="btn" id="btnByWord">بحث بالكلمة</button>
      <button class="btn dark" id="btnRandom">استخارة عشوائية</button>
    </div>
  </section>

  <!-- النتيجة الرئيسية: آية فقط -->
  <section id="res-box" class="result" style="display:none">
    <div id="res-tags"></div>
    <div id="res-text">—</div>
  </section>

  <!-- نتائج البحث بالكلمة (قائمة صفحات) -->
  <section id="versesList" class="result" style="display:none">
    <div class="badge">نتائج مطابقة — اضغط على أي نتيجة لعرض آية الصفحة</div>
    <div id="versesWrap"></div>
  </section>

  <div class="footer">برمجة وتطوير: فاضل الريس</div>
</div>

<!-- مودال -->
<div id="appModal" class="app-modal hidden" dir="rtl" role="dialog" aria-modal="true">
  <div class="app-backdrop" data-close></div>
  <div class="app-card">
    <div class="app-ico">!</div>
    <h3 class="app-ttl" id="mTitle">تنبيه</h3>
    <div class="app-msg" id="mMsg">—</div>
    <button class="app-btn" id="mOk" data-close>حسنًا</button>
  </div>
</div>

<script>
/* ===== مودال لطيف ===== */
(function(){
  const modal=document.getElementById('appModal'),
        ttl=document.getElementById('mTitle'),
        msg=document.getElementById('mMsg'),
        ok =document.getElementById('mOk');
  function uiAlert({title='تنبيه لطيف 😊',message='—',okText='حسنًا'}={}){
    ttl.textContent=title;
    msg.innerHTML=message;        // يعرض HTML داخل الرسالة
    ok.textContent=okText;
    modal.classList.remove('hidden');
  }
  function close(){ modal.classList.add('hidden'); }
  modal.querySelectorAll('[data-close]').forEach(el=>el.addEventListener('click',close));
  document.addEventListener('keydown',e=>{ if(e.key==='Escape' && !modal.classList.contains('hidden')) close(); });
  window.uiAlert=uiAlert;
})();

/* ===== أدوات أرقام عربية/إنجليزية ===== */
const toArabicDigits = (x) => String(x ?? "—").replace(/[0-9]/g, d => "٠١٢٣٤٥٦٧٨٩"[d]);
const fromArabicDigits = (str="") => String(str).replace(/[٠-٩]/g, d => "٠١٢٣٤٥٦٧٨٩".indexOf(d));

/* ===== أسماء السور (١–١١٤) ===== */
const SURAH=["",
"الفاتحة","البقرة","آل عمران","النساء","المائدة","الأنعام","الأعراف","الأنفال","التوبة",
"يونس","هود","يوسف","الرعد","إبراهيم","الحجر","النحل","الإسراء","الكهف","مريم",
"طه","الأنبياء","الحج","المؤمنون","النور","الفرقان","الشعراء","النمل","القصص","العنكبوت",
"الروم","لقمان","السجدة","الأحزاب","سبإ","فاطر","يس","الصافات","ص","الزمر",
"غافر","فصلت","الشورى","الزخرف","الدخان","الجاثية","الأحقاف","محمد","الفتح","الحجرات",
"ق","الذاريات","الطور","النجم","القمر","الرحمن","الواقعة","الحديد","المجادلة","الحشر",
"الممتحنة","الصف","الجمعة","المنافقون","التغابن","الطلاق","التحريم","الملك","القلم","الحاقة",
"المعارج","نوح","الجن","المزمل","المدثر","القيامة","الإنسان","المرسلات","النبإ","النازعات",
"عبس","التكوير","الانفطار","المطففين","الانشقاق","البروج","الطارق","الأعلى","الغاشية","الفجر",
"البلد","الشمس","الليل","الضحى","الشرح","التين","العلق","القدر","البينة","الزلزلة",
"العاديات","القارعة","التكاثر","العصر","الهمزة","الفيل","قريش","الماعون","الكوثر","الكافرون",
"النصر","المسد","الإخلاص","الفلق","الناس"
];

/* ===== جدول النتائج (ملخص الخيرة للصفحات الفردية) ===== */
window.PAGE_RESULT={
  51:"غير جيدة والنتيجة فيها ندم وخسارة",53:"فيها لوم وغرور وخسران",55:"ممتازة – فيها بركة وتوفيق وصلاح",
  57:"استجابة وتوفيق، معارضة من العدو",59:"لوم وخسارة",61:"استجابة وتوفيق",63:"فيها صعوبة وملامة",65:"النتيجة فيها تعب وخسارة",
  67:"ممتازة – يفضَّل الإسراع",69:"خسارة وندم",71:"وسط وتحتاج إلى تأمل وفيها رحمة",73:"ممتازة – نعمة قريبة ونجاة",75:"فيها خسران",
  77:"ممتازة – رحمة وخير",79:"وسط – تعديل",81:"نهي – تعب وندم",83:"ممتازة – رحمة وتخفيف",85:"لوم وخسارة",87:"نهي شديد",
  89:"مع العناية والإصرار ممتازة",91:"حفظ وتوفيق",93:"وسط – صلاح لما فات",95:"جيدة مع الحذر",97:"نهي",99:"جيدة – الإتقان مهم",
  101:"نهي – صعوبات",103:"نهي شديد",105:"نهي شديد",107:"نهي تام",109:"نهي – حراسة إلهية",111:"نهي – ملامة",
  127:"جيدة – رزق",133:"جيدة – رحمة",141:"جيدة – انتظار",143:"جيدة – لا مانع",171:"حسنة – نعمة",177:"ممتازة – رحمة ونصر",
  179:"ممتازة – توفيق",185:"جيدة – نجاح",189:"جيدة – فرج",199:"جيدة – نصر المؤمن",203:"ممتازة – فرج سريع",
  205:"ممتازة – خاتمة حسنة",207:"جيدة – تحتاج شدة",217:"جيدة – معارضة",219:"جيدة – توفيق",243:"جيدة – حفظ",
  247:"ممتازة – بشارة",249:"ممتازة – تيسير",253:"ممتازة – ثمار",257:"جيدة – انتظار",259:"ممتازة – نجاح",
  263:"ممتازة – رعاية",265:"ممتازة – حفظ",269:"جيدة – تيسير",271:"وسط – تأخر",279:"وسط – اختيار",281:"جيدة – إصلاح",
  291:"جيدة – نعمة",293:"ممتازة",295:"جيدة – فرج",297:"جيدة – صبر",299:"جيدة – الآخرة",301:"جيدة – تغيّرات",
  303:"ممتازة – فرج متكرر",305:"ممتازة – رحمة كبيرة",307:"ممتازة – استقرار",309:"ممتازة – دعم",313:"ممتازة جدًا",
  317:"ممتازة – فرج",319:"جيدة – استفادة",329:"ممتازة – حفظ",331:"ممتازة – أمان",333:"جيدة – فرج",335:"ممتازة – هداية",
  337:"جيدة – نصر",339:"ممتازة – ممتازة",343:"جيدة – ثمار",355:"ممتازة – صلاح",357:"جيدة – صبر",359:"جيدة – التزام",
  363:"جيدة – موفقة",365:"جيدة – إتقان",367:"حسنة – رحمة",371:"ممتازة – مباركة",375:"وسط – نهاية جيدة",377:"ممتازة – بشارة",
  385:"ممتازة – أمان",387:"ممتازة – حفظ",389:"ممتازة – نصر",391:"جيدة – رحمة",393:"جيدة – يوجد أفضل",397:"ممتازة – إصلاح",
  399:"جيدة – رحمة",405:"وسط – نصر لاحق",407:"وسط – فرج لاحق",411:"حسنة – هداية",413:"جيدة – تيسير",415:"ممتازة – تيسير",
  419:"جيدة – لصالح عام",421:"ممتازة – رضا الله",423:"وسط قريب للجيد",425:"جيدة – تسهيل",427:"وسط – قرب حصول",
  439:"جيدة – معارضة",443:"جيدة – عناد",445:"جيدة – منافع",449:"ممتازة – متتابع",453:"ممتازة – تغلب",459:"وسط – مراحل",
  461:"جيدة – هداية",463:"وسط – تأخر",467:"ممتازة – فرج",469:"جيدة – مرحلية",475:"وسط – انتظار",477:"ممتازة – بشارة",
  481:"ممتازة – ثمار",483:"ممتازة – رحمة",487:"ممتازة – نعم",489:"ممتازة – توفيق",497:"نهي – ثم تغلب",499:"ممتازة – للأفضل",
  511:"ممتازة – فرج",513:"وسط – امتحان",515:"ممتازة – تطور",519:"وسط – غيبي",535:"ممتازة – رزق",537:"ممتازة – حفظ",
  539:"ممتازة – سعة",541:"جيدة – صبر",545:"جيدة – نتيجة طيبة",547:"ممتازة – إصلاح",549:"ممتازة – صبر",551:"جيدة – إتقان",
  553:"ممتازة – تفضيل",559:"جيدة – تيسير",561:"جيدة – نجاة",563:"مخيّر – تيسير",571:"ممتازة – فرج كبير",573:"جيدة – هداية",
  575:"جيدة – نجاح",579:"ممتازة – سعادة",583:"ممتازة – وافرة",585:"حسنة – رحمة",587:"ممتازة – رحمة",589:"ممتازة – سعادة",
  591:"ممتازة – حفظ",593:"ممتازة – هلاك",595:"ممتازة – رحمة",597:"ممتازة – رحمة",599:"ممتازة – رضا",601:"ممتازة – رحمة",
  603:"جيدة – رحمة ونصير"
};

/* ===== أدوات ===== */
const $=id=>document.getElementById(id);
const show = el => el.style.display = '';
const hide = el => el.style.display = 'none';

/* ===== جلب أول آية في الصفحة ===== */
async function firstAyahByPage(page){
  const pg=Number(page);
  // المحاولة الأولى: alquran.cloud
  try{
    const r=await fetch(`https://api.alquran.cloud/v1/page/${pg}/quran-uthmani`,{cache:'no-store'});
    if(r.ok){
      const j=await r.json();
      const ay=j?.data?.ayahs?.[0];
      if(ay) return {text:ay.text,sura:Number(ay.surah.number),ayah:Number(ay.numberInSurah)};
    }
  }catch(_){}
  // بديل: api.quran.com
  try{
    const r2=await fetch(`https://api.quran.com/api/v4/verses/by_page/${pg}?language=ar&fields=text_uthmani,verse_key,chapter_id,page_number`,{cache:'no-store'});
    if(r2.ok){
      const j2=await r2.json();
      const v=j2?.verses?.[0];
      if(v){
        const parts=String(v.verse_key||"").split(":");
        return {text:v.text_uthmani||v.text,sura:Number(v.chapter_id),ayah:Number(parts[1])};
      }
    }
  }catch(_){}
  return {text:"(تعذّر جلب الآية الآن)",sura:0,ayah:0};
}

/* ===== عرض النتيجة: آية فقط + اسم السورة ===== */
function renderAyah(page, ay){
  const sName = SURAH[ay.sura] || `سورة رقم ${toArabicDigits(ay.sura)}`;
  $('res-tags').innerHTML =
    `<span class="badge">صفحة ${toArabicDigits(page)}</span>`+
    ` <span class="badge">${sName}</span>`+
    ` <span class="badge">آية ${toArabicDigits(ay.ayah)}</span>`;
  $('res-text').textContent = ay.text || "(لا نص)";
  show($('res-box'));
  hide($('versesList'));
  $('res-box').scrollIntoView({behavior:'smooth',block:'center'});
}

/* ===== تحقق صفحة ===== */
function normalizePageInput(v){
  const n = Number(fromArabicDigits(String(v).trim()));
  return n;
}
function validateOddPage(n){
  return Number.isInteger(n) && n>=1 && n<=603 && n%2===1;
}

/* ===== بحث برقم الصفحة ===== */
async function lookupByPage(){
  const raw = $('pageInput').value;
  const n = normalizePageInput(raw);
  if(!validateOddPage(n)){
    uiAlert({title:'صفحة البحث',message:'الرجاء إدخال رقم <b>فردي</b> بين <span dir="rtl">١ و٦٠٣</span> (اليمين فقط).'});
    return;
  }
  if(!(String(n) in PAGE_RESULT)){
    uiAlert({title:'صفحة البحث',message:'هذه الصفحة غير موجودة في جدول الاستخارة.'});
    return;
  }
  const ay = await firstAyahByPage(n);
  renderAyah(n, ay);
}

/* ===== بحث بالكلمة (عربي/English) ===== */
function searchByKeyword(){
  const kw = ($('kwInput').value||'').trim().toLowerCase();
  const wrap = $('versesWrap');
  wrap.innerHTML = '';
  if(!kw){
    uiAlert({title:'بحث بالكلمة',message:'اكتب كلمة للبحث (عربي أو English).'});
    return;
  }
  const out=[];
  for(const [k,v] of Object.entries(PAGE_RESULT)){
    if(String(v).toLowerCase().includes(kw)) out.push(Number(k));
  }
  if(!out.length){
    wrap.innerHTML = `<div class="badge">لا توجد نتائج مطابقة.</div>`;
    show($('versesList')); hide($('res-box'));
    $('versesList').scrollIntoView({behavior:'smooth',block:'center'});
    return;
  }
  out.sort((a,b)=>a-b).forEach(p=>{
    const card = document.createElement('div');
    card.className='verse-card';
    card.innerHTML = `<b>صفحة ${toArabicDigits(p)}</b> · ${PAGE_RESULT[p]}`;
    card.onclick = ()=> lookupByPageDirect(p);
    wrap.appendChild(card);
  });
  show($('versesList')); hide($('res-box'));
  $('versesList').scrollIntoView({behavior:'smooth',block:'center'});
}
async function lookupByPageDirect(p){
  const ay = await firstAyahByPage(p);
  renderAyah(p, ay);
}

/* ===== استخارة عشوائية من الجدول ===== */
async function doIstikhara(){
  const keys = Object.keys(PAGE_RESULT).map(Number).filter(n=>validateOddPage(n));
  if(!keys.length){
    uiAlert({title:'استخارة',message:'جدول الصفحات فارغ. أضف عناصر إلى PAGE_RESULT.'});
    return;
  }
  const page = keys[Math.floor(Math.random()*keys.length)];
  const ay = await firstAyahByPage(page);
  renderAyah(page, ay);
}

/* ===== ربط الأزرار ===== */
document.addEventListener('DOMContentLoaded',()=>{
  $('btnByPage').addEventListener('click', lookupByPage);
  $('btnByWord').addEventListener('click', searchByKeyword);
  $('btnRandom').addEventListener('click', doIstikhara);
  // Enter للتسهيل
  $('pageInput').addEventListener('keydown',e=>{ if(e.key==='Enter') lookupByPage(); });
  $('kwInput').addEventListener('keydown',e=>{ if(e.key==='Enter') searchByKeyword(); });
});
</script>
</body>
</html>
