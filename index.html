<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>مواقيت الصلاة</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{
    /* لوحة مضغوطة راقية */
    --ink:#111827; --muted:#6b7280; --bg:#f7f8fb;
    --card:#ffffff; --border:#e5e7eb; --line:#dbe2ea;
    --brand:#0ea5a6; --brand2:#2563eb; --accent:#0ea5a633;
    --chip:#f3f6fb; --chip-ink:#0f3b6a;
    --shadow:0 8px 20px rgba(2,6,23,.06);
    --radius:14px;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:"Cairo", system-ui, -apple-system, Segoe UI, "Noto Kufi Arabic", sans-serif;
    color:var(--ink);
    background:
      radial-gradient(700px 500px at 10% 0%, #eef5ff 0%, transparent 55%),
      radial-gradient(600px 400px at 92% 8%, #e9fbf6 0%, transparent 50%),
      var(--bg);
    min-height:100svh; padding:18px;
  }
  .wrap{width:min(1060px,100%); margin-inline:auto; display:flex; flex-direction:column; gap:14px; animation:fade .4s ease both}
  @keyframes fade{from{opacity:0; transform:translateY(4px)}to{opacity:1; transform:translateY(0)}}

  /* رأس صغير مرتب */
  .header{
    position:relative;
    background:linear-gradient(180deg,#ffffff,#fbfdff);
    border:1px solid var(--border);
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    padding:14px 16px;
    display:grid; grid-template-columns: 1fr auto; gap:10px; align-items:center;
  }
  .title{
    display:flex; flex-direction:column; gap:6px;
  }
  .title h1{margin:0; font-size:1.15rem; font-weight:800; letter-spacing:.1px}
  /* شريط معلومات صغير جداً بدلاً من بطاقات كبيرة */
  .badges{display:flex; gap:8px; flex-wrap:wrap}
  .badge{
    display:inline-flex; align-items:center; gap:6px;
    background:var(--chip); color:var(--chip-ink);
    border:1px solid var(--border); border-radius:999px;
    padding:.28rem .55rem; font-size:.9rem; font-weight:700;
  }
  .badge i{font-style:normal; opacity:.7}

  /* الساعة ثابتة أعلى اليسار ومضغوطة */
  .clock{
    position:absolute; left:10px; top:10px; z-index:3;
    background:#fff; border:1px solid var(--border); border-radius:12px;
    padding:.38rem .6rem; font-variant-numeric:tabular-nums; font-weight:800; color:#0b3a37;
    box-shadow:0 8px 18px rgba(0,0,0,.06); font-size:.98rem;
  }

  /* أدوات اختيار مضغوطة */
  .controls{
    background:#fff; border:1px solid var(--border); border-radius:12px; box-shadow:var(--shadow);
    padding:10px; display:flex; gap:8px; align-items:center; flex-wrap:wrap;
  }
  .controls label{color:var(--muted); font-weight:700; font-size:.9rem}
  select{
    appearance:none; padding:10px 38px 10px 12px; border-radius:10px;
    border:1px solid var(--border); background:
      #fff url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="11" height="11" viewBox="0 0 20 20" fill="none"><path d="M5 7l5 6 5-6" stroke="%236b7280" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>') no-repeat left 10px center/11px;
    color:#0b132b; font-weight:700;
  }

  /* بطاقة الجدول */
  .card{
    background:var(--card); border:1px solid var(--border); border-radius:var(--radius);
    box-shadow:var(--shadow); padding:10px 12px;
  }
  .card h3{margin:0 0 8px; font-size:1rem; font-weight:800; color:#0b213f}

  /* جدول مضغوط وأنيق */
  table{width:100%; border-collapse:separate; border-spacing:0}
  thead th{
    text-align:right; font-weight:700; color:#1f2937; font-size:.92rem; padding:10px 10px;
    background:#f6f8fc; border-bottom:1px solid var(--line);
  }
  tbody tr{transition:.15s background}
  tbody tr:hover{background:#fafcff}
  tbody td{
    padding:10px; border-bottom:1px dashed var(--line); font-size:1rem;
  }
  tbody tr:last-child td{border-bottom:none}
  .row{display:flex; align-items:center; gap:8px; font-weight:700}
  .ico{
    width:24px; height:24px; border-radius:9px; display:grid; place-items:center;
    background:linear-gradient(135deg,#effaff,#ffffff); border:1px solid #d9e9ff; color:#0c5a88; font-size:.95rem;
  }
  .t{font-variant-numeric:tabular-nums; font-weight:800}
  /* تمييز الصلاة القادمة بسطر رفيع ونغمة خفيفة */
  tr.next td{background:linear-gradient(90deg,var(--accent),transparent 40%)}
  tr.next td:first-child{border-inline-start:3px solid var(--brand)}

  /* حديث اليوم صغير */
  .hadith{
    background:#fff; border:1px solid var(--border); border-radius:12px;
    box-shadow:var(--shadow); padding:12px 14px; font-size:.98rem; color:#0b213f;
  }
  .h-meta{color:var(--muted); font-size:.9rem; margin-top:6px}

  footer{ text-align:center; color:var(--muted); font-weight:700; padding:4px 0 }
  .brand{ color:var(--brand); }
</style>
</head>
<body>
  <div class="wrap">
    <section class="header" aria-live="polite">
      <div id="clock" class="clock">--:-- --</div>

      <div class="title">
        <h1>مواقيت الصلاة</h1>
        <div class="badges">
          <span class="badge"><i>🗓</i><span id="hijri">--</span></span>
          <span class="badge"><i>📅</i><span id="greg">--</span></span>
          <span class="badge"><i>📍</i><span id="placeLabel">البحرين – المنامة</span></span>
        </div>
      </div>

      <div class="controls">
        <label for="country">الدولة</label>
        <select id="country" aria-label="اختر الدولة">
          <option value="Bahrain" selected>البحرين</option>
          <option value="Lebanon">لبنان</option>
          <option value="Iraq">العراق</option>
          <option value="Iran">إيران</option>
          <option value="Kuwait">الكويت</option>
          <option value="Saudi Arabia">السعودية</option>
        </select>

        <label for="city">المدينة</label>
        <select id="city" aria-label="اختر المدينة"><!-- يُملأ ديناميكياً --></select>
      </div>
    </section>

    <section class="card">
      <h3>الجدول اليومي</h3>
      <table>
        <thead>
          <tr><th>الوقت</th><th>الساعة (12h)</th></tr>
        </thead>
        <tbody id="times"><!-- يُولّد ديناميكياً --></tbody>
      </table>
    </section>

    <section class="hadith">
      <div id="hadithText"></div>
      <div class="h-meta" id="hadithSource"></div>
    </section>

    <footer>برمجة وتطوير <span class="brand">فاضل الريس</span></footer>
  </div>

<script>
  /* الدول والمدن + المنطقة الزمنية */
  const MAP = {
    "Bahrain": { tz:"Asia/Bahrain", cities:[{en:"Manama",ar:"المنامة"},{en:"Muharraq",ar:"المحرق"},{en:"Isa Town",ar:"مدينة عيسى"},{en:"Hamad Town",ar:"مدينة حمد"},{en:"Sitra",ar:"سترة"},{en:"Saar",ar:"سار"},{en:"Draz",ar:"الدراز"},{en:"Jidhafs",ar:"جدحفص"}]},
    "Lebanon": { tz:"Asia/Beirut",  cities:[{en:"Beirut",ar:"بيروت"},{en:"Tripoli",ar:"طرابلس"},{en:"Sidon",ar:"صيدا"}]},
    "Iraq":    { tz:"Asia/Baghdad", cities:[{en:"Baghdad",ar:"بغداد"},{en:"Basrah",ar:"البصرة"},{en:"Erbil",ar:"أربيل"}]},
    "Iran":    { tz:"Asia/Tehran",  cities:[{en:"Tehran",ar:"طهران"},{en:"Mashhad",ar:"مشهد"},{en:"Isfahan",ar:"أصفهان"}]},
    "Kuwait":  { tz:"Asia/Kuwait",  cities:[{en:"Kuwait City",ar:"مدينة الكويت"},{en:"Hawalli",ar:"حولي"},{en:"Al Ahmadi",ar:"الأحمدي"}]},
    "Saudi Arabia":{ tz:"Asia/Riyadh", cities:[{en:"Riyadh",ar:"الرياض"},{en:"Jeddah",ar:"جدة"},{en:"Dammam",ar:"الدمام"},{en:"Mecca",ar:"مكة"},{en:"Medina",ar:"المدينة"}]}
  };

  /* أحاديث */
  const HADITHS = [
    { text:"قال الإمام الباقر (عليه السلام): إذا استقبل المصلي القبلة استقبل الرحمن بوجهه لا إله غيره.", src:"المصدر: ميزان الحكمة" },
    { text:"قال الإمام علي (عليه السلام): إذا قام الرجل إلى الصلاة أقبل إبليس ينظر إليه حسداً لما يرى من رحمة الله التي تغشاه.", src:"المصدر: ميزان الحكمة" },
    { text:"قال الإمام الرضا (عليه السلام): الصلاة لها أربعة آلاف باب.", src:"المصدر: ميزان الحكمة" },
    { text:"قال الإمام علي (عليه السلام): يا كميل! ليس الشأن أن تصلي وتصوم وتتصدق، إنما الشأن أن تكون الصلاة فعلت بقلب نقي، وعمل عند الله مرضي، وخشوع سوي.", src:"المصدر: ميزان الحكمة" }
  ];
  function setRandomHadith(){
    const h = HADITHS[Math.floor(Math.random()*HADITHS.length)];
    document.getElementById('hadithText').textContent = h.text;
    document.getElementById('hadithSource').textContent = h.src;
  }

  /* 12 ساعة */
  function to12h(t){
    if(!t) return "--:-- --";
    const pure = t.replace(/\s*\(.*?\)\s*/g, "");
    const [H,M] = pure.split(":").map(Number);
    if(Number.isNaN(H)||Number.isNaN(M)) return t;
    let h = H % 12; if(h===0) h = 12;
    const ampm = H < 12 ? "AM" : "PM";
    return `${String(h).padStart(2,"0")}:${String(M).padStart(2,"0")} ${ampm}`;
  }

  /* الوقت والتواريخ */
  function fmtClock(tz){
    return new Intl.DateTimeFormat('en-GB', {timeZone:tz, hour:'2-digit', minute:'2-digit', hour12:true}).format(new Date());
  }
  function fmtGreg(tz){
    return new Intl.DateTimeFormat('ar', {timeZone:tz, weekday:'long', year:'numeric', month:'long', day:'numeric'}).format(new Date());
  }
  function fmtHijri(tz){
    try{
      return new Intl.DateTimeFormat('ar-SA-u-ca-islamic', {timeZone:tz, weekday:'long', year:'numeric', month:'long', day:'numeric'}).format(new Date());
    }catch{ return "التاريخ الهجري (متصفح غير مدعوم)"; }
  }

  /* TR helper */
  function trHTML(label, icon, val, next=false){
    return `<tr class="${next?'next':''}">
      <td><div class="row"><span class="ico">${icon}</span> ${label}</div></td>
      <td class="t">${to12h(val||'')}</td>
    </tr>`;
  }

  /* تحديد الصلاة القادمة */
  function nextPrayerKey(timings, tz){
    const order = ["Imsak","Fajr","Dhuhr","Asr","Maghrib","Isha","Midnight"];
    const nowTZ = new Date(new Date().toLocaleString('en-US',{timeZone:tz}));
    const dstr = new Intl.DateTimeFormat('en-CA', {timeZone:tz, year:'numeric', month:'2-digit', day:'2-digit'}).format(nowTZ);
    const [Y,M,D] = dstr.split('-').map(Number);
    const cand = order.map(k=>{
      const raw = (timings[k]||"").replace(/\s*\(.*?\)\s*/g,"");
      if(!raw.includes(':')) return {k, diff:Infinity};
      const [HH,MM] = raw.split(':').map(Number);
      const dt = new Date(Y, M-1, D, HH, MM, 0);
      return {k, diff: dt - nowTZ};
    });
    let next = cand.filter(x=>x.diff>=0).sort((a,b)=>a.diff-b.diff)[0];
    if(!next) next = cand.sort((a,b)=>Math.abs(a.diff)-Math.abs(b.diff))[0];
    return next?.k || null;
  }

  /* تقدير الإمساك عند غيابه */
  function ensureImsak(t){
    if(!t.Imsak && t.Fajr){
      const pure = t.Fajr.replace(/\s*\(.*?\)\s*/g,"");
      const [H,M] = pure.split(":").map(Number);
      const d = new Date(); d.setHours(H, M-10, 0, 0);
      const hh = String(d.getHours()).padStart(2,"0");
      const mm = String(d.getMinutes()).padStart(2,"0");
      t.Imsak = `${hh}:${mm}`;
    }
    return t;
  }

  /* جلب المواقيت (من المزود – الحساب المناسب) */
  async function fetchTimings(country, city){
    const url = `https://api.aladhan.com/v1/timingsByCity?city=${encodeURIComponent(city)}&country=${encodeURIComponent(country)}&method=0`;
    const res = await fetch(url);
    if(!res.ok) throw new Error("تعذّر الاتصال بمزود المواقيت");
    const json = await res.json();
    return json.data.timings;
  }

  /* بناء الجدول المدمج */
  function renderTimes(timings, tz){
    const t = ensureImsak({...timings});
    const rows = [
      {label:"الإمساك",    key:"Imsak",   icon:"🌙"},
      {label:"أذان الفجر", key:"Fajr",    icon:"🕌"},
      {label:"أذان الظهر", key:"Dhuhr",   icon:"☀️"},
      {label:"أذان العصر", key:"Asr",     icon:"🌤️"},
      {label:"أذان المغرب",key:"Maghrib", icon:"🌆"},
      {label:"أذان العشاء",key:"Isha",    icon:"🌙"},
      {label:"منتصف الليل",key:"Midnight",icon:"🌌"}
    ];
    const nextK = nextPrayerKey(t, tz);
    const tbody = document.getElementById('times');
    tbody.innerHTML = rows.map(r=>trHTML(r.label, r.icon, t[r.key], r.key===nextK)).join("");
  }

  /* تعبئة المدن */
  function populateCities(country){
    const citySel = document.getElementById('city');
    citySel.innerHTML = "";
    (MAP[country]?.cities || []).forEach((c,i)=>{
      const op = document.createElement('option');
      op.value = c.en; op.textContent = c.ar;
      if(i===0) op.selected = true;
      citySel.appendChild(op);
    });
  }

  /* تحديث العلوية (المكان/التواريخ/الساعة) */
  function updateTop(country, city){
    const tz = MAP[country]?.tz || "Asia/Bahrain";
    const cityObj = (MAP[country]?.cities || []).find(x=>x.en===city) || {ar:city};
    document.getElementById('placeLabel').textContent = `${countryAR(country)} – ${cityObj.ar}`;
    document.getElementById('greg').textContent  = fmtGreg(tz);
    document.getElementById('hijri').textContent = fmtHijri(tz);
    clearInterval(window._clk);
    document.getElementById('clock').textContent = fmtClock(tz);
    window._clk = setInterval(()=>{ document.getElementById('clock').textContent = fmtClock(tz); }, 1000);
    return tz;
  }
  function countryAR(c){
    return ({"Bahrain":"البحرين","Lebanon":"لبنان","Iraq":"العراق","Iran":"إيران","Kuwait":"الكويت","Saudi Arabia":"السعودية"})[c] || c;
  }

  /* تحميل كامل */
  async function load(){
    const country = document.getElementById('country').value;
    const city    = document.getElementById('city').value;
    const tz = updateTop(country, city);
    document.getElementById('times').innerHTML = `<tr><td colspan="2">جاري تحميل المواقيت…</td></tr>`;
    try{
      const timings = await fetchTimings(country, city);
      renderTimes(timings, tz);
    }catch(e){
      console.error(e);
      document.getElementById('times').innerHTML = `<tr><td colspan="2" style="color:#b91c1c">تعذّر جلب المواقيت. حاول لاحقًا.</td></tr>`;
    }
  }

  /* تهيئة */
  function init(){
    setRandomHadith();
    const countrySel = document.getElementById('country');
    const citySel = document.getElementById('city');
    populateCities(countrySel.value);
    countrySel.addEventListener('change', ()=>{ populateCities(countrySel.value); load(); });
    citySel.addEventListener('change', load);
    load(); // افتراضي البحرين – المنامة
  }
  init();
</script>
</body>
</html>
