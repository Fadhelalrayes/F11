<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ø§Ù„Ø§Ø¨Ø±Ø§Ø¬ ÙˆØ§Ù„Ø§Ø³ØªØ¨ØµØ§Ø±</title>

<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&family=Tajawal:wght@400;700;800&display=swap" rel="stylesheet">

<style>
  :root{
    --bg:#0b0d12; --fg:#f7f7f7; --muted:#bdbdbd;
    --brand:#ffd54a; --card:#141823; --stroke:#242a36; --accent:#5ad1ff;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:var(--bg); color:var(--fg);
    font-family:"Tajawal","Cairo",system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
    overflow-x:hidden;
  }

  /* Ø®Ù„ÙÙŠØ© Ù†Ø¬ÙˆÙ… */
  body::before, body::after{
    content:""; position:fixed; inset:0; pointer-events:none; z-index:-2;
  }
  body::before{
    background:
      radial-gradient(1200px 600px at 50% -10%, #1b2140 0%, rgba(27,33,64,0) 60%),
      radial-gradient(800px 500px at 80% 120%, #1a2336 0%, rgba(26,35,54,0) 60%),
      linear-gradient(180deg, #0b0d12 0%, #0e1320 55%, #0b0d12 100%);
  }
  body::after{
    background:
      url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="240" height="240" viewBox="0 0 240 240"><g fill="%23ffffff" opacity="0.45"><circle cx="20" cy="30" r="1.2"/><circle cx="80" cy="60" r="0.8"/><circle cx="140" cy="20" r="1"/><circle cx="200" cy="90" r="1.1"/><circle cx="110" cy="140" r="0.9"/><circle cx="40" cy="190" r="1.2"/><circle cx="210" cy="200" r="0.9"/></g></svg>') repeat;
    background-size:240px 240px;
    animation: twinkle 6s ease-in-out infinite;
    opacity:.35;
  }
  @keyframes twinkle { 0%,100%{opacity:.28} 50%{opacity:.42} }

  header{
    position:sticky; top:0; z-index:10; background:rgba(11,13,18,.75);
    backdrop-filter:saturate(140%) blur(6px);
    border-bottom:1px solid var(--stroke); padding:14px 16px;
    display:flex; align-items:center; justify-content:center; text-align:center;
  }
  .brand{display:block}
  .title{
    font-weight:800; letter-spacing:.3px; line-height:1;
    font-size: clamp(28px, 5vw, 48px); color:var(--brand); text-align:center;
  }
  .subtitle{
    color:var(--muted); font-size:14px; margin-top:6px; text-align:center;
  }
  .clear-mini{
    display:block; margin:6px auto 0; width:max-content;
    font-size:12px; color:var(--brand); background:transparent; border:0; cursor:pointer;
    text-decoration:underline; text-underline-offset:3px;
  }

  .container{max-width:980px;margin:0 auto;padding:18px 16px}
  .card{
    background:rgba(20,24,35,.9); border:1px solid var(--stroke); border-radius:18px; padding:22px; margin:16px 0;
    box-shadow:0 18px 40px rgba(0,0,0,.35)
  }
  h1,h2{color:var(--brand); margin:10px 0 8px; text-align:center}
  label{display:block; margin:10px 0 6px; color:#eaeaea; font-size:14px}
  input,select,button{
    width:100%; padding:12px 14px; border-radius:12px; border:1px solid var(--stroke);
    background:#0f1320; color:var(--fg); font-size:16px; outline:none
  }
  input:focus, select:focus{border-color:var(--brand); box-shadow:0 0 0 3px rgba(255,213,74,.15)}
  .grid{display:grid; grid-template-columns:1fr 1fr; gap:12px}
  @media (max-width:640px){ .grid{grid-template-columns:1fr} }
  .btn{
    border:0; background:linear-gradient(135deg, var(--brand), #ffb300);
    color:#221; font-weight:800; cursor:pointer; transition:transform .08s ease, filter .2s ease; letter-spacing:.2px
  }
  .btn:active{transform:scale(.99)}
  .ghost{background:transparent; border:1px solid var(--brand); color:var(--brand)}
  .center{display:grid; place-items:center; text-align:center}
  .hidden{display:none !important}
  .topic-grid{display:grid; grid-template-columns:repeat(2,1fr); gap:14px}
  @media (max-width:640px){ .topic-grid{grid-template-columns:1fr} }
  .topic{padding:18px; border:1px dashed var(--brand); border-radius:14px; background:#0f1320; cursor:pointer}
  .topic:hover{background:#12172a}
  .topic span{display:block; color:var(--muted); font-size:14px; margin-top:4px}
  .result{line-height:1.95}
  .tag{display:inline-flex; align-items:center; gap:8px; padding:6px 12px; border-radius:999px; border:1px solid var(--stroke); color:#fff; font-size:14px; background:#0f1320}
  .z-emoji{font-size:20px}
  .stars{position:relative; overflow:hidden; border-radius:16px}
  .quota{margin-top:8px; font-size:13px; color:#cfd8dc; text-align:center}

  footer{
    padding:24px 16px; text-align:center; color:var(--muted);
    border-top:1px solid var(--stroke); display:flex; flex-direction:column; gap:10px; align-items:center
  }
  .socials{display:flex; gap:12px; flex-wrap:wrap; justify-content:center}
  .socials button{
    width:34px; height:34px; display:inline-grid; place-items:center; border-radius:10px;
    border:1px solid var(--stroke); background:#0f1320; transition:transform .1s ease, border-color .2s ease; cursor:pointer
  }
  .socials button:hover{transform:translateY(-1px); border-color:var(--accent)}
  .socials svg{width:18px;height:18px; fill:#cfd8dc}

  /* Ø­Ù„Ù‚Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± */
  .ring-wrap{height:260px; display:grid; place-items:center}
  .ring{
    width:130px; height:130px; border-radius:50%;
    border:6px solid rgba(255,255,255,.08); border-top-color:var(--brand);
    animation:spin 1.2s linear infinite; position:relative
  }
  .ring:after{
    content:""; position:absolute; inset:16px; border-radius:50%;
    border:4px dashed rgba(255,255,255,.12)
  }
  @keyframes spin{to{transform:rotate(360deg)}}
  ul{margin:8px 0 0 0; padding:0 18px}

  /* Ù…Ù†Ø¹ Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø¸Ø± */
  .overlay{
    position:fixed; inset:0; background:rgba(0,0,0,.7); display:none; justify-content:center; align-items:center; z-index:20;
  }
  .overlay .modal{
    background:var(--card); border:1px solid var(--stroke); border-radius:14px; padding:18px; max-width:420px; margin:16px; text-align:center;
  }
</style>
</head>
<body>

<header>
  <div class="brand">
    <div class="title">Ø§Ù„Ø§Ø¨Ø±Ø§Ø¬ ÙˆØ§Ù„Ø§Ø³ØªØ¨ØµØ§Ø±</div>
    <div class="subtitle">Ù‚Ø±Ø§Ø¡Ø§Øª ÙÙ„ÙƒÙŠØ© ØªÙ†Ø¨Ø¤ÙŠØ© Ù…ÙˆØ¬Ø²Ø© â€” Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ§Øª ÙˆØªØ­Ø°ÙŠØ±Ø§Øª ØªØªØºÙŠØ± ÙÙŠ ÙƒÙ„ Ù…Ø±Ø©</div>
    <button class="clear-mini" id="clearBtn" title="Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©">Ø­Ø°Ù Ø¨ÙŠØ§Ù†Ø§ØªÙŠ</button>
  </div>
</header>

<main class="container">

  <!-- Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
  <section id="step1" class="card stars center">
    <h1 style="margin-bottom:6px">Ø§Ø¨Ø¯Ø£ Ù‚Ø±Ø§Ø¡ØªÙƒ</h1>

    <div class="grid" style="max-width:680px; margin:10px auto 0;">
      <div>
        <label>Ø§Ù„Ø¬Ù†Ø³</label>
        <select id="gender">
          <option value="">Ø§Ø®ØªØ±</option>
          <option>Ø°ÙƒØ±</option>
          <option>Ø£Ù†Ø«Ù‰</option>
        </select>
      </div>
      <div>
        <label>Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©</label>
        <select id="status">
          <option value="">Ø§Ø®ØªØ±</option>
          <option>Ø£Ø¹Ø²Ø¨/Ø¹Ø²Ø¨Ø§Ø¡</option>
          <option>Ù…ØªØ²ÙˆØ¬/Ù…ØªØ²ÙˆØ¬Ø©</option>
          <option>Ù…Ù†ÙØµÙ„/Ù…Ù†ÙØµÙ„Ø©</option>
          <option>Ù…Ø®Ø·ÙˆØ¨/Ù…Ø®Ø·ÙˆØ¨Ø©</option>
        </select>
      </div>
      <div style="grid-column:1 / -1">
        <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</label>
        <input id="birthdate" type="date">
      </div>
    </div>

    <div style="margin-top:16px;">
      <button class="btn" id="startBtn" style="min-width:220px">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©</button>
    </div>
    <div class="quota" id="quotaInfo"></div>
  </section>

  <!-- Ø§Ù„Ø®Ø·ÙˆØ© 2: Ø´Ø§Ø´Ø© Ø§Ù†ØªØ¸Ø§Ø± -->
  <section id="stepLoading" class="card hidden center stars">
    <div>
      <div class="ring-wrap"><div class="ring" aria-hidden="true"></div></div>
      <h2>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø³ØªØ¨ØµØ§Ø±â€¦</h2>
      <p class="muted">Ø«ÙˆØ§Ù†Ù Ù‚Ù„ÙŠÙ„Ø© ÙˆØªØ¸Ù‡Ø± Ø§Ù„Ø¥Ø´Ø§Ø±Ø§Øª.</p>
    </div>
  </section>

  <!-- Ø§Ù„Ø®Ø·ÙˆØ© 3: Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ -->
  <section id="stepTopics" class="card hidden stars center">
    <h2>Ø§Ø®ØªØ± Ù…ÙˆØ¶ÙˆØ¹ Ù‚Ø±Ø§Ø¡ØªÙƒ</h2>
    <div id="zodiacBadge" style="margin:8px 0 14px"></div>
    <div class="topic-grid" style="max-width:700px; margin:10px auto 0;">
      <button class="topic" data-topic="love">Ø§Ù„Ø­Ø¨ â¤ï¸<span>Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§ØªØŒ Ø§Ù„Ø§Ù†Ø¬Ø°Ø§Ø¨ØŒ Ø§Ù„Ù…ØµØ§Ù„Ø­Ø§Øª</span></button>
      <button class="topic" data-topic="health">Ø§Ù„ØµØ­Ø© ğŸ’Š<span>Ø§Ù„Ø·Ø§Ù‚Ø©ØŒ Ø§Ù„Ø¹Ø§Ø¯Ø§ØªØŒ Ø§Ù„ØªÙˆØ§Ø²Ù†</span></button>
      <button class="topic" data-topic="career">Ø§Ù„Ù…Ù‡Ù†Ø©/Ø§Ù„Ø«Ø±ÙˆØ© ğŸ’¼<span>Ø§Ù„ÙØ±ØµØŒ Ø§Ù„Ù‚Ø±Ø§Ø±Ø§ØªØŒ Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±Ø§Øª</span></button>
      <button class="topic" data-topic="general">Ø¹Ø§Ù… âœ¨<span>Ø±Ø¤ÙŠØ© Ø´Ø§Ù…Ù„Ø© Ù„Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ù‚Ø¨Ù„Ø©</span></button>
    </div>
    <div class="quota" id="quotaInfoTopics"></div>
  </section>

  <!-- Ø§Ù„Ø®Ø·ÙˆØ© 4: Ø§Ù„Ù†ØªÙŠØ¬Ø© -->
  <section id="stepResult" class="card hidden stars">
    <div style="display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap">
      <h2 style="margin:0">Ø§Ù„Ø¥Ø´Ø§Ø±Ø§Øª Ø§Ù„Ø¸Ø§Ù‡Ø±Ø©</h2>
      <div class="tag" id="userEcho">
        <span class="z-emoji" id="zEmoji">â™ˆï¸</span>
        <span id="zName">Ø§Ù„Ø­Ù…Ù„</span>
      </div>
    </div>

    <div id="resultText" class="result" style="margin-top:10px"></div>
    <div id="omen" class="muted" style="margin-top:12px; font-size:15px"></div>

    <div style="display:flex; gap:10px; margin-top:16px; flex-wrap:wrap; justify-content:center">
      <button class="btn" id="againBtn">Ø¥Ø´Ø§Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø© (Ù†ÙØ³ Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹)</button>
      <button class="ghost" id="topicsBtn">Ø§Ø®ØªÙŠØ§Ø± Ù…ÙˆØ¶ÙˆØ¹ Ø¢Ø®Ø±</button>
      <button class="ghost" id="restartBtn">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¨Ø¯Ø¡</button>
    </div>
    <div class="quota" id="quotaInfoResult" style="margin-top:10px"></div>
  </section>

</main>

<footer>
  <div>Ø´Ø§Ø±Ùƒ Ø§Ù„ØµÙØ­Ø©</div>
  <div class="socials" aria-label="Ù…Ø´Ø§Ø±ÙƒØ©">
    <button id="shareNative" title="Ù…Ø´Ø§Ø±ÙƒØ©"><svg viewBox="0 0 24 24"><path d="M18 8a3 3 0 1 0-2.83-3.99L8.91 7.1a3.02 3.02 0 0 0-2.01-.78A3 3 0 1 0 9.9 9l6.26-3.08A3.02 3.02 0 0 0 18 8Zm-9 7a3 3 0 1 0-3 3 3 3 0 0 0 3-3Zm12-1a3 3 0 1 0-3 3 3 3 0 0 0 3-3Z"/></svg></button>
    <button id="shareX" title="X / Twitter"><svg viewBox="0 0 24 24"><path d="M18.244 2H21l-6.56 7.51L22.5 22h-6.79l-4.87-6.37L4.94 22H2l7.02-8.03L1.5 2h6.87l4.39 5.86L18.244 2Zm-2.38 18h1.84L8.23 4h-1.9l9.534 16Z"/></svg></button>
    <button id="shareWA" title="WhatsApp"><svg viewBox="0 0 24 24"><path d="M12.04 2A10 10 0 0 0 2 12.04C2 17.55 6.46 22 11.97 22c1.76 0 3.43-.43 4.9-1.2l3.13.82-.84-3.06A9.93 9.93 0 0 0 22 12.04 10 10 0 0 0 12.04 2Zm5.86 14.57c-.25.71-1.47 1.35-2.03 1.38-.56.03-1.28.18-4.35-1.42-3.69-1.82-6.06-6.4-6.25-6.69-.19-.29-1.5-2-1.5-3.83 0-1.83.96-2.73 1.3-3.11.34-.38.74-.48.99-.48.25 0 .5 0 .72.01.23.01.55-.09.86.66.31.76 1.06 2.6 1.15 2.79.09.19.16.41.03.66-.13.24-.2.39-.4.6-.19.21-.42.47-.6.63-.19.16-.39.34-.17.72.22.38.97 1.6 2.09 2.6 1.44 1.26 2.66 1.65 3.04 1.84.38.19.6.16.83-.1.23-.25.96-1.12 1.22-1.5.25-.38.51-.32.86-.19.34.13 2.16 1.02 2.54 1.21.38.19.63.28.72.44.09.16.09.94-.16 1.65Z"/></svg></button>
    <button id="shareFB" title="Facebook"><svg viewBox="0 0 24 24"><path d="M13 22v-8h3l1-4h-4V7.5A1.5 1.5 0 0 1 14.5 6H17V2h-3.5A4.5 4.5 0 0 0 9 6.5V10H6v4h3v8h4Z"/></svg></button>
  </div>
  <div>Â© <span id="year"></span> Ø§Ù„Ø§Ø¨Ø±Ø§Ø¬ ÙˆØ§Ù„Ø§Ø³ØªØ¨ØµØ§Ø±</div>
</footer>

<!-- Ø­Ø¸Ø± Ø¹Ù†Ø¯ Ù†ÙØ§Ø¯ Ø§Ù„Ø­ØµÙ‘Ø© -->
<div class="overlay" id="overlay">
  <div class="modal">
    <h3 style="color:var(--brand); margin-top:0">ÙˆØµÙ„Øª Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø¯ Ø§Ù„ÙŠÙˆÙ…ÙŠ</h3>
    <p>Ø§Ù„Ù…ØªØ§Ø­: 4 Ù‚Ø±Ø§Ø¡Ø§Øª ÙƒÙ„ 24 Ø³Ø§Ø¹Ø©. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø­ØªÙ‰ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ù„Ø¥ØªØ§Ø­Ø© Ù‚Ø±Ø§Ø¡Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©.</p>
    <p class="quota"><span id="countdown">00:00:00</span> Ø­ØªÙ‰ Ø§Ù„ØªØ¬Ø¯ÙŠØ¯</p>
    <button class="ghost" id="closeOverlay">Ø­Ø³Ù†Ù‹Ø§</button>
  </div>
</div>

<script>
  /* ====== Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø¨Ø±Ø§Ø¬ ====== */
  const ZODIAC = [
    {name:"Ø§Ù„Ø­Ù…Ù„",   emoji:"â™ˆï¸", from:[3,21],  to:[4,19]},
    {name:"Ø§Ù„Ø«ÙˆØ±",   emoji:"â™‰ï¸", from:[4,20],  to:[5,20]},
    {name:"Ø§Ù„Ø¬ÙˆØ²Ø§Ø¡", emoji:"â™Šï¸", from:[5,21],  to:[6,20]},
    {name:"Ø§Ù„Ø³Ø±Ø·Ø§Ù†", emoji:"â™‹ï¸", from:[6,21],  to:[7,22]},
    {name:"Ø§Ù„Ø£Ø³Ø¯",   emoji:"â™Œï¸", from:[7,23],  to:[8,22]},
    {name:"Ø§Ù„Ø¹Ø°Ø±Ø§Ø¡", emoji:"â™ï¸", from:[8,23],  to:[9,22]},
    {name:"Ø§Ù„Ù…ÙŠØ²Ø§Ù†", emoji:"â™ï¸", from:[9,23],  to:[10,22]},
    {name:"Ø§Ù„Ø¹Ù‚Ø±Ø¨",  emoji:"â™ï¸", from:[10,23], to:[11,21]},
    {name:"Ø§Ù„Ù‚ÙˆØ³",   emoji:"â™ï¸", from:[11,22], to:[12,21]},
    {name:"Ø§Ù„Ø¬Ø¯ÙŠ",   emoji:"â™‘ï¸", from:[12,22], to:[1,19]},
    {name:"Ø§Ù„Ø¯Ù„Ùˆ",   emoji:"â™’ï¸", from:[1,20],  to:[2,18]},
    {name:"Ø§Ù„Ø­ÙˆØª",   emoji:"â™“ï¸", from:[2,19],  to:[3,20]}
  ];
  function getZodiac(dt){
    if(!dt) return {name:"ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ", emoji:"â˜†"};
    const d = new Date(dt);
    const m = d.getMonth()+1, day = d.getDate();
    for(const z of ZODIAC){
      const [fm,fd]=z.from, [tm,td]=z.to;
      const inSame = (m===fm && day>=fd) || (m===tm && day<=td);
      const inWrap = (fm>tm) && ((m===fm && day>=fd) || (m===tm && day<=td) || (m>fm || m<tm));
      if((fm<tm && inSame) || (fm>tm && inWrap)) return z;
    }
    return {name:"ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ", emoji:"â˜†"};
  }

  /* ====== Ù†ØµÙˆØµ Ø¹Ø§Ù…Ø© (Ø¥ÙŠØ¬Ø§Ø¨ÙŠ/ØªØ­Ø°ÙŠØ±ÙŠ) + Ø­Ø³Ø¨ Ø§Ù„Ø¨Ø±Ø¬ + Ù…ÙˆØ¶ÙˆØ¹ ====== */
  const BASE_POS = [
    "Ù…Ø¤Ø´Ø± Ø¥ÙŠØ¬Ø§Ø¨ÙŠ ÙŠÙ„Ù…Ø¹ ÙÙŠ Ù…Ø­ÙŠØ·Ùƒ Ø§Ù„Ù‚Ø±ÙŠØ¨Ø› Ø¨Ø§Ø¨ ØµØºÙŠØ± ÙŠÙÙØªØ­ Ø¨ØªÙˆÙ‚ÙŠØª Ù…ÙØ§Ø¬Ø¦.",
    "Ø±Ø³Ø§Ù„Ø© Ù…ÙˆØ¬Ø²Ø© ØªØºÙŠÙ‘Ø± Ø¥ÙŠÙ‚Ø§Ø¹ ÙŠÙˆÙ…Ùƒ Ù†Ø­Ùˆ Ø§Ù†ÙØªØ§Ø­ Ø£Ø³Ø±Ø¹ Ù…Ù…Ø§ ØªÙˆÙ‚Ø¹Øª.",
    "Ù‡Ù…Ø³ Ø§Ù†Ø³Ø¬Ø§Ù… ÙŠØ¹Ø¨Ø± Ø¹Ù„Ø§Ù‚Ø§ØªÙƒØ› Ø§Ù„ØªÙØ§Ø¤Ù„ ÙŠØ³Ø¨Ù‚ Ø§Ù„Ø®Ø·ÙˆØ§Øª Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø±Ø©.",
    "Ø®Ø¨Ø± Ø³Ø§Ø± ÙŠØ£ØªÙŠ Ù…Ù† Ø¬Ù‡Ø© Ù„Ù… ØªÙƒÙ† ÙÙŠ Ø§Ù„Ø­Ø³Ø¨Ø§Ù†ØŒ ÙƒØ£Ù†Ù‡ ÙˆØ¹Ø¯ Ù‚Ø¯ÙŠÙ… Ø¹Ø§Ø¯ Ø§Ù„Ø¢Ù†."
  ];
  const BASE_WARN = [
    "ØªØ°Ø¨Ø°Ø¨ Ù‚ØµÙŠØ± Ù‚Ø¯ ÙŠØ±Ø¨Ùƒ Ù‚Ø±Ø§Ø¡ØªÙƒ Ù„Ù„Ù…Ø´Ù‡Ø¯Ø› Ù„Ø§ ØªÙ†Ø¬Ø±Ù Ù…Ø¹ Ø£ÙˆÙ„ Ø§Ù†ÙØ¹Ø§Ù„.",
    "ØªÙØµÙŠÙ„ Ù†Ø§Ù‚Øµ ÙÙŠ Ù‚ØµØ© Ù…ØªØ¯Ø§ÙˆÙ„Ø© Ø­ÙˆÙ„ÙƒØ› Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„ØºØ§Ø¦Ø¨ ÙŠÙØ¨Ø¯Ù‘Ù„ Ø§Ù„Ù…Ø¹Ù†Ù‰.",
    "Ø³Ø·ÙˆØ¹ Ù…ÙØ§Ø¬Ø¦ ÙÙŠ Ø¹Ø±Ø¶Ù Ù…Ø§ Ù‚Ø¯ ÙŠØ®ÙÙŠ Ø¸Ù„Ø§Ù„Ù‹Ø§ Ù„Ø§Ø­Ù‚Ø©Ø› Ø§Ù„Ù„Ù…Ø¹Ø§Ù† Ù„ÙŠØ³ Ù…Ø¹ÙŠØ§Ø±Ù‹Ø§.",
    "Ù†Ø§ÙØ°Ø© Ø§Ø±ØªØ¨Ø§Ùƒ Ø¹Ø§Ø¨Ø±Ø© ØªÙ„ÙˆÙ‘Ø­Ø› Ø¥Ù† Ø§Ø³ØªØ³Ù„Ù…Øª Ù„Ù‡Ø§ ØªØ¤Ø®Ø± ÙˆØµÙˆÙ„ Ø§Ù„ÙØ±Ø¬ Ù‚Ù„ÙŠÙ„Ù‹Ø§."
  ];

  const TOPICS = {
    love: {
      title:"Ø§Ù„Ø­Ø¨",
      pos:[
        "Ù‚Ù„Ø¨Ùƒ ÙŠÙ„ØªÙ‚Ø· ØªØ±Ø¯Ù‘Ø¯Ù‹Ø§ Ø¯Ø§ÙØ¦Ù‹Ø§Ø› Ù…ØµØ§Ø¯ÙØ© Ù‚ØµÙŠØ±Ø© ØªØ¹ÙŠØ¯ Ø¨Ø±ÙŠÙ‚Ù‹Ø§ Ù‚Ø¯ÙŠÙ…Ù‹Ø§.",
        "Ø¥Ø´Ø§Ø±Ø© Ø§Ù†Ø¬Ø°Ø§Ø¨ ØªØ¸Ù‡Ø± Ø­ÙŠÙ† ÙŠØªÙ‚Ø§Ø·Ø¹ Ø§Ù„ØµØ¯Ù‚ Ù…Ø¹ Ø§Ù„Ø·Ù…Ø£Ù†ÙŠÙ†Ø©.",
        "Ø­Ø§Ù„Ø© ØµÙÙ„Ø­ Ù…Ø­ØªÙ…Ù„Ø© Ø¨Ø¹Ø¯ ÙØªÙˆØ±ØŒ ÙˆØªÙ„Ø§Ù‚ÙŠ Ø¹Ù„Ù‰ Ù†ÙŠØ©Ù ÙˆØ§Ø¶Ø­Ø©."
      ],
      warn:[
        "ÙˆØ¹Ø¯ÙŒ Ø³Ø±ÙŠØ¹ ÙŠØ¨Ù‡Ø±Ùƒ Ø«Ù… ÙŠØ®ÙØª.",
        "Ø­Ø¨ÙŠØ¨ÙŒ ØªÙØ­ÙŠØ· Ø¨Ù‡ Ø¹Ù„Ø§Ù…Ø§Øª Ø´ÙƒØ› Ø±Ø§Ù‚Ø¨ Ø¥Ø´Ø§Ø±Ø§Øª Ø§Ù„ØºÙŠØ§Ø¨ ÙˆØ§Ù„ØªØ±Ø¯Ø¯.",
        "Ø´Ø®Øµ Ø¬Ø¯ÙŠØ¯ ÙŠØ¯Ø®Ù„ Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© ÙŠØ¨Ø¯Ø£ Ø§Ø³Ù…Ù‡ Ø¨Ø­Ø±Ù: <LETTER> â€” Ø­Ø¶ÙˆØ±Ù‡ Ù„Ø§ÙØª Ù„ÙƒÙ†Ù‡ ÙŠÙ…ØªØ­Ù† Ø«Ù‚ØªÙƒ."
      ]
    },
    health: {
      title:"Ø§Ù„ØµØ­Ø©",
      pos:[
        "ØµÙØ§Ø¡ Ø¯Ø§Ø®Ù„ÙŠ ÙŠÙ…Ø± ÙƒÙ†Ø³Ù…Ø©Ø› Ø§Ù„Ø¬Ø³Ø¯ ÙŠØ³ØªØ¬ÙŠØ¨ Ù„Ø¥ÙŠÙ‚Ø§Ø¹Ù Ø£Ù‡Ø¯Ø£.",
        "ÙŠÙ‚Ø¸Ø© Ø®ÙÙŠÙØ© ØªØ¹ÙŠØ¯ Ø§Ù„Ø§Ù†Ø³Ø¬Ø§Ù… Ø¨ÙŠÙ† Ø§Ù„Ù…Ø²Ø§Ø¬ ÙˆØ§Ù„Ø­Ø±ÙƒØ©."
      ],
      warn:[
        "Ø«ÙÙ‚Ù„ Ø®ÙÙŠ ÙŠØªØ±Ø§ÙƒÙ… Ø¥Ù† ØªØ¬Ø§Ù‡Ù„Øª Ù‡Ù…Ø³ Ø§Ù„Ø¥Ø±Ù‡Ø§Ù‚.",
        "Ù‚Ù„Ù‚ Ø¹Ø§Ø¨Ø± ÙŠØªØ¬Ù„Ù‰ ÙÙŠ ØªÙˆØªØ± Ø¹Ø¶Ù„ÙŠØ› Ø§Ù†ØªØ¨Ù‡ Ù„Ø¥Ø´Ø§Ø±Ø§Øª Ø§Ù„Ø¬Ø³Ø¯."
      ]
    },
    career: {
      title:"Ø§Ù„Ù…Ù‡Ù†Ø©/Ø§Ù„Ø«Ø±ÙˆØ©",
      pos:[
        "Ù†Ø§ÙØ°Ø© Ø¹Ù…Ù„ Ø¬Ø§Ù†Ø¨ÙŠØ© ØªØ­Ù…Ù„ ØªÙˆÙ‚ÙŠØ¹Ù‹Ø§ ØµØºÙŠØ±Ù‹Ø§ ÙˆØªØ£Ø«ÙŠØ±Ù‹Ø§ ÙƒØ¨ÙŠØ±Ù‹Ø§.",
        "ÙˆØ§Ø±Ø¯ Ù…Ø§Ù„ÙŠ Ù…Ù†ØªØ¸Ø± ÙŠØ£ØªÙŠ ÙƒØªØ¹ÙˆÙŠØ¶ Ø£Ùˆ Ù…ÙƒØ§ÙØ£Ø© Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø¥Ù†Ø¬Ø§Ø² Ø³Ø§Ø¨Ù‚."
      ],
      warn:[
        "Ø¨Ù†Ø¯ÙŒ Ù…Ø®ÙÙŠ ÙŠÙ‚Ù„Ø¨ Ø§Ù„Ù…ÙŠØ²Ø§Ù† Ø¥Ù† Ù„Ù… ÙŠÙÙ‚Ø±Ø£ Ø¬ÙŠØ¯Ù‹Ø§.",
        "Ø§Ø­ØªÙ…Ø§Ù„ Ø£Ø²Ù…Ø© Ù…Ø§Ù„ÙŠØ© Ø­Ø§Ø¯Ø© Ø¥Ù† Ø§Ù†Ø³Ù‚Øª ÙˆØ±Ø§Ø¡ Ø¥ØºØ±Ø§Ø¡ Ø¥Ù†ÙØ§Ù‚ Ù…ÙØ§Ø¬Ø¦."
      ]
    },
    general: {
      title:"Ø¹Ø§Ù…",
      pos:[
        "Ø®Ø¨Ø± Ø³Ø§Ø± ÙŠØ£ØªÙŠ Ù…Ù† Ø¬Ù‡Ø© Ø¨Ø¹ÙŠØ¯Ø© ÙƒÙ‡Ø¯ÙŠØ© Ù…Ø¤Ø¬Ù‘Ù„Ø©.",
        "Ø¨ÙˆØ§Ø¯Ø± ØµÙÙ„Ø­ Ø¹Ø§Ø¦Ù„ÙŠ ØªÙØ·ÙØ¦ Ø´Ø±Ø§Ø±Ø© Ø®Ù„Ø§Ù Ù‚Ø¯ÙŠÙ…."
      ],
      warn:[
        "ØªÙˆØªÙ‘Ø± Ø¹Ø§Ø¦Ù„ÙŠ Ù‚ØµÙŠØ± ÙŠÙØ®ØªØ¨Ø± ÙÙŠÙ‡ ØµØ¨Ø±Ùƒ Ù‚Ø¨Ù„ Ø£Ù† ÙŠÙ‡Ø¯Ø£.",
        "Ø­Ø¯ÙŠØ«ÙŒ Ù…ÙÙ„ØªØ¨Ø³ ÙÙŠ Ù…Ø­ÙŠØ·Ùƒ Ù‚Ø¯ ÙŠÙÙÙ‡Ù… Ø¹Ù„Ù‰ ØºÙŠØ± Ù…Ù‚ØµØ¯Ù‡."
      ]
    }
  };

  const SIGN_SNIPPETS = {
    "Ø§Ù„Ø­Ù…Ù„":   {pos:["Ø§Ù†Ø¯ÙØ§Ø¹Ø© Ù…ÙˆÙÙ‚Ø© ØªØ¹ÙŠØ¯ Ø§Ù„Ø­ÙŠØ§Ø© Ù„Ù…Ø´Ø±ÙˆØ¹ ØºÙØ§."], warn:["Ø­Ø¯Ø© Ø³Ø±ÙŠØ¹Ø© Ù‚Ø¯ ØªØµÙ†Ø¹ Ø³ÙˆØ¡ ÙÙ‡Ù…."]},
    "Ø§Ù„Ø«ÙˆØ±":   {pos:["Ø«Ø¨Ø§ØªÙƒ ÙŠØ«Ù…Ø± Ù…Ø±Ø¯ÙˆØ¯Ù‹Ø§ Ù…Ù„Ù…ÙˆØ³Ù‹Ø§."], warn:["Ø¹Ù†Ø§Ø¯ÙŒ Ø¨Ø³ÙŠØ· ÙŠØ­Ø¬Ø¨ Ù…Ø±ÙˆÙ†Ø© Ù…Ø·Ù„ÙˆØ¨Ø©."]},
    "Ø§Ù„Ø¬ÙˆØ²Ø§Ø¡": {pos:["ÙØ·Ù†Ø© Ø­ÙˆØ§Ø±ÙŠØ© ØªÙ‚ØªÙ†Øµ ÙØ±ØµØ©."], warn:["ØªØ´Ø¹Ù‘Ø¨ Ø§Ù„Ù…ÙˆØ§Ø¶ÙŠØ¹ ÙŠØ¨Ø¯Ø¯ ØªØ±ÙƒÙŠØ²Ùƒ."]},
    "Ø§Ù„Ø³Ø±Ø·Ø§Ù†": {pos:["Ø¯ÙØ¡ Ø¹Ø§Ø¦Ù„ÙŠ ÙŠØ±Ù…Ù… Ù…Ø§ ØªØµØ¯Ù‘Ø¹."], warn:["Ø­Ø³Ø§Ø³ÙŠØ© Ø²Ø§Ø¦Ø¯Ø© ØªÙ‚Ø±Ø£ Ù…Ø§ Ù„ÙŠØ³ Ù…Ù‚ØµÙˆØ¯Ù‹Ø§."]},
    "Ø§Ù„Ø£Ø³Ø¯":   {pos:["Ø¸Ù‡ÙˆØ± Ù„Ø§ÙØª ÙŠØ«Ø¨Øª Ù…ÙƒØ§Ù†ØªÙƒ."], warn:["ØªÙˆÙ‚Ø¹Ø§Øª Ø¹Ø§Ù„ÙŠØ© ØªÙØ«Ù‚ÙÙ„ Ø§Ù„Ù„Ø­Ø¸Ø©."]},
    "Ø§Ù„Ø¹Ø°Ø±Ø§Ø¡": {pos:["ØªÙØµÙŠÙ„ ØµØºÙŠØ± ÙŠØµØ­Ù‘Ø­ Ù…Ø³Ø§Ø±Ù‹Ø§."], warn:["Ù…Ø«Ø§Ù„ÙŠØ© Ù…ÙØ±Ø·Ø© ØªØ¤Ø®Ø± Ø§Ù„Ø§Ù†Ø·Ù„Ø§Ù‚."]},
    "Ø§Ù„Ù…ÙŠØ²Ø§Ù†": {pos:["Ø§ØªØ²Ø§Ù† ÙŠØ¬Ù„Ø¨ ØªÙØ§Ù‡Ù…Ù‹Ø§ Ø³Ø±ÙŠØ¹Ù‹Ø§."], warn:["Ù…ÙŠÙ„ Ù„Ø¥Ø±Ø¶Ø§Ø¡ Ø§Ù„Ø¬Ù…ÙŠØ¹ ÙŠØ°ÙŠØ¨ Ø­Ù‚Ùƒ."]},
    "Ø§Ù„Ø¹Ù‚Ø±Ø¨":  {pos:["Ø­Ø¯Ø³Ùƒ ÙŠØµÙŠØ¨ Ø§Ù„Ù‡Ø¯Ù."], warn:["Ø´ÙƒÙ‘ Ø²Ø§Ø¦Ø¯ ÙŠØ·ÙØ¦ Ø¨Ø±ÙŠÙ‚ Ø¥Ù†Ø¬Ø§Ø²."]},
    "Ø§Ù„Ù‚ÙˆØ³":   {pos:["Ù†ÙÙÙØ³ Ù…ØºØ§Ù…Ø±Ø© ÙŠÙØªØ­ Ø¨Ø§Ø¨Ù‹Ø§."], warn:["Ø­Ù…Ø§Ø³ Ø²Ø§Ø¦Ø¯ ÙŠÙ‚ÙØ² ÙÙˆÙ‚ Ø®Ø·ÙˆØ© Ø£Ø³Ø§Ø³ÙŠØ©."]},
    "Ø§Ù„Ø¬Ø¯ÙŠ":   {pos:["Ø§Ù†Ø¶Ø¨Ø§Ø· ÙŠØ¶Ø¹ Ø­Ø¬Ø± Ø£Ø³Ø§Ø³ Ù„Ø±Ø¨Ø­."], warn:["ØµØ±Ø§Ù…Ø© ØªÙÙÙ‡Ù… ÙƒØ¨Ø±ÙˆØ¯."]},
    "Ø§Ù„Ø¯Ù„Ùˆ":   {pos:["ÙÙƒØ±Ø© Ù…Ø¨ØªÙƒØ±Ø© ØªØ¬Ø¯ Ø¢Ø°Ø§Ù†Ù‹Ø§ Ù…ØµØºÙŠØ©."], warn:["Ù…Ø²Ø§Ø¬ Ù…ØªÙ‚Ù„Ø¨ ÙŠØ´ØªØªÙ‡ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ù…Ø³ØªÙ…Ø±." ]},
    "Ø§Ù„Ø­ÙˆØª":   {pos:["Ø±Ù‡Ø§ÙØ© Ø´Ø¹ÙˆØ± ØªÙ‚ÙˆØ¯ Ù„Ø§Ø®ØªÙŠØ§Ø± Ù…ÙÙ„Ù‡ÙÙ…."], warn:["Ø¶Ø¨Ø§Ø¨ Ø¹Ø§Ø·ÙÙŠ ÙŠØ®ØªØ¨Ø± ÙˆØ¶ÙˆØ­ Ù‚Ø±Ø§Ø±Ùƒ."]},
    "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ":{pos:["Ø¥Ø´Ø§Ø±Ø© Ø¹Ø§Ù…Ø© Ù†Ø­Ùˆ Ø§Ù†ÙØ±Ø§Ø¬."], warn:["Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø´Ù‡Ø¯ ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø© Ø¨Ø¹Ø¯."]}
  };

  const OMENS = [
    "ÙˆÙ…Ø¶Ø©: Ø¨Ø§Ø¨ ÙŠÙÙØªØ­ Ù…Ø±ØªÙŠÙ†Ø› Ø§Ù„Ø£ÙˆÙ„Ù‰ Ø§Ù…ØªØ­Ø§Ù†ØŒ ÙˆØ§Ù„Ø«Ø§Ù†ÙŠØ© ÙØ±Ø¬.",
    "ÙˆÙ…Ø¶Ø©: Ø±Ø³Ø§Ù„Ø© Ù…Ù‚ØªØ¶Ø¨Ø© ØªØºÙŠÙ‘Ø± Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹.",
    "ÙˆÙ…Ø¶Ø©: Ù„Ù‚Ø§Ø¡ Ø¹Ø§Ø¨Ø± ÙŠØªØ±Ùƒ Ø£Ø«Ø±Ù‹Ø§ Ø£Ø·ÙˆÙ„ Ù…Ù† Ø²Ù…Ù†Ù‡."
  ];

  /* ====== Ø¹Ù†Ø§ØµØ± DOM ====== */
  const $ = sel => document.querySelector(sel);
  const step1 = $("#step1"), stepLoading = $("#stepLoading"), stepTopics = $("#stepTopics"), stepResult = $("#stepResult");
  const userEcho = $("#userEcho"), resultText = $("#resultText"), omenEl = $("#omen");
  const startBtn = $("#startBtn"), againBtn = $("#againBtn"), topicsBtn = $("#topicsBtn"), restartBtn = $("#restartBtn");
  const clearBtn = $("#clearBtn");
  const zBadge = $("#zodiacBadge"), zEmojiEl = $("#zEmoji"), zNameEl = $("#zName");
  const quotaInfo = $("#quotaInfo"), quotaInfoTopics = $("#quotaInfoTopics"), quotaInfoResult = $("#quotaInfoResult");
  const overlay = $("#overlay"), countdownEl = $("#countdown"), closeOverlay = $("#closeOverlay");
  const yearEl = $("#year"); yearEl.textContent = new Date().getFullYear();

  /* ====== Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„ØµÙØ­Ø© ====== */
  function shareData(){
    const data = {
      title: "Ø§Ù„Ø§Ø¨Ø±Ø§Ø¬ ÙˆØ§Ù„Ø§Ø³ØªØ¨ØµØ§Ø±",
      text: "Ø¬Ø±Ù‘Ø¨ Ù‚Ø±Ø§Ø¡Ø§Øª ÙÙ„ÙƒÙŠØ© ØªÙ†Ø¨Ø¤ÙŠØ© Ù…ÙˆØ¬Ø²Ø© â€” Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ§Øª ÙˆØªØ­Ø°ÙŠØ±Ø§Øª ØªØªØºÙŠØ± ÙÙŠ ÙƒÙ„ Ù…Ø±Ø©.",
      url: location.href
    };
    if(navigator.share){ navigator.share(data).catch(()=>{}); }
    else { window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(location.href)}`,'_blank'); }
  }
  $("#shareNative").addEventListener("click", shareData);
  $("#shareFB").addEventListener("click", ()=>window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(location.href)}`,'_blank'));
  $("#shareX").addEventListener("click", ()=>window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent("Ù‚Ø±Ø§Ø¡Ø§Øª ÙÙ„ÙƒÙŠØ© ØªÙ†Ø¨Ø¤ÙŠØ© Ù…ÙˆØ¬Ø²Ø© â€” Ø§Ù„Ø§Ø¨Ø±Ø§Ø¬ ÙˆØ§Ù„Ø§Ø³ØªØ¨ØµØ§Ø±")}&url=${encodeURIComponent(location.href)}`,'_blank'));
  $("#shareWA").addEventListener("click", ()=>window.open(`https://wa.me/?text=${encodeURIComponent("Ù‚Ø±Ø§Ø¡Ø§Øª ÙÙ„ÙƒÙŠØ© ØªÙ†Ø¨Ø¤ÙŠØ© â€” Ø§Ù„Ø§Ø¨Ø±Ø§Ø¬ ÙˆØ§Ù„Ø§Ø³ØªØ¨ØµØ§Ø±: "+location.href)}`,'_blank'));

  /* ====== Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù„ÙŠÙ‹Ø§ ====== */
  function saveForm(){
    const data = {
      gender: $("#gender").value || "",
      status: $("#status").value || "",
      birthdate: $("#birthdate").value || ""
    };
    localStorage.setItem("istibsar_form", JSON.stringify(data));
  }
  function loadForm(){
    try{
      const data = JSON.parse(localStorage.getItem("istibsar_form")||"{}");
      if(data.gender) $("#gender").value = data.gender;
      if(data.status) $("#status").value = data.status;
      if(data.birthdate) $("#birthdate").value = data.birthdate;
    }catch(e){}
  }
  function clearForm(){
    localStorage.removeItem("istibsar_form");
    $("#gender").value=""; $("#status").value=""; $("#birthdate").value="";
  }
  ["gender","status","birthdate"].forEach(id=>{
    const el = document.getElementById(id);
    el.addEventListener("input", saveForm);
    el.addEventListener("change", saveForm);
  });
  clearBtn.addEventListener("click", ()=>{ clearForm(); alert("ØªÙ… Ø­Ø°Ù Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­."); });

  /* ====== Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© + Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ø±Ø¬ ====== */
  function seeded(seed){ let x = seed ^ Date.now(); return function(){ x ^= x<<13; x ^= x>>>17; x ^= x<<5; return ((x>>>0)/4294967296); } }
  function strHash(s){ let h=2166136261>>>0; for(let i=0;i<s.length;i++){ h^=s.charCodeAt(i); h=Math.imul(h,16777619);} return h>>>0; }
  function pick(rand, arr){ return arr[Math.floor(rand()*arr.length)] }
  function getRandomLetterArabic(){
    const letters = "Ø£Ø¨ØªØ«Ø¬Ø­Ø®Ø¯Ø°Ø±Ø²Ø³Ø´ØµØ¶Ø·Ø¸Ø¹ØºÙÙ‚ÙƒÙ„Ù…Ù†Ù‡ÙˆÙŠ";
    return letters[Math.floor(Math.random()*letters.length)];
  }

  let currentTopic = "general";
  let currentRand = seeded(123);
  let currentSign = {name:"ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ", emoji:"â˜†"};

  function formSeed(){
    const g = $("#gender").value || "";
    const s = $("#status").value || "";
    const b = $("#birthdate").value || "";
    const key = `${g}|${s}|${b}`;
    return key ? strHash(key) : Math.floor(Math.random()*1e9);
  }

  function updateZodiacUI(){
    currentSign = getZodiac($("#birthdate").value);
    zEmojiEl.textContent = currentSign.emoji;
    zNameEl.textContent = currentSign.name;
    zBadge.innerHTML = `<div class="tag"><span class="z-emoji">${currentSign.emoji}</span> Ø¨Ø±Ø¬Ùƒ: ${currentSign.name}</div>`;
  }

  function echoUser(){
    const g = $("#gender").value || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
    const s = $("#status").value || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©";
    const b = $("#birthdate").value || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
    userEcho.innerHTML = `<span class="z-emoji">${currentSign.emoji}</span> ${currentSign.name} â€¢ ${g} â€¢ ${s} â€¢ ${b}`;
  }

  /* ====== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­ØµÙ‘Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© (4 Ù‚Ø±Ø§Ø¡Ø§Øª / 24 Ø³Ø§Ø¹Ø©) ====== */
  const MAX_READS = 4;
  function getQuota(){
    const raw = localStorage.getItem("istibsar_quota");
    const now = Date.now();
    if(!raw) return {count:0, resetAt:null};
    try{
      const data = JSON.parse(raw);
      if(data.resetAt && now > data.resetAt) return {count:0, resetAt:null};
      return data;
    }catch(e){ return {count:0, resetAt:null}; }
  }
  function setQuota(q){ localStorage.setItem("istibsar_quota", JSON.stringify(q)); }
  function incQuota(){
    const q = getQuota();
    const now = Date.now();
    const resetAt = q.resetAt || (now + 24*60*60*1000);
    const next = {count: (q.count||0)+1, resetAt};
    setQuota(next);
    return next;
  }
  function remainingQuota(){ const q=getQuota(); return Math.max(0, MAX_READS - (q.count||0)); }
  function updateQuotaUI(){
    const rem = remainingQuota();
    const q = getQuota();
    const base = `Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø§Ù„ÙŠÙˆÙ…: ${rem} / ${MAX_READS}` + (q.resetAt ? ` â€” ØªØ¬Ø¯ÙŠØ¯ Ø®Ù„Ø§Ù„ ${fmtRemaining(q.resetAt - Date.now())}` : "");
    [quotaInfo, quotaInfoTopics, quotaInfoResult].forEach(el=>{ if(el) el.textContent = base; });
  }
  function fmtRemaining(ms){
    if(ms<=0) return "00:00:00";
    const s = Math.floor(ms/1000);
    const h = String(Math.floor(s/3600)).padStart(2,"0");
    const m = String(Math.floor((s%3600)/60)).padStart(2,"0");
    const sec = String(s%60).padStart(2,"0");
    return `${h}:${m}:${sec}`;
  }
  function showOverlayCountdown(){
    const q = getQuota();
    if(!q.resetAt) return;
    overlay.style.display = "flex";
    function tick(){
      const left = q.resetAt - Date.now();
      countdownEl.textContent = fmtRemaining(left);
      if(left<=0){
        overlay.style.display="none";
        setQuota({count:0, resetAt:null});
        updateQuotaUI();
      } else {
        requestAnimationFrame(tick);
      }
    }
    tick();
  }
  closeOverlay.addEventListener("click", ()=>overlay.style.display="none");

  /* ====== ØªØ¯ÙÙ‚ Ø§Ù„ØµÙØ­Ø§Øª ====== */
  function show(el){ el.classList.remove("hidden") }
  function hide(el){ el.classList.add("hidden") }

  function startFlow(){
    hide(step1); show(stepLoading);
    setTimeout(()=>{ hide(stepLoading); show(stepTopics); updateZodiacUI(); updateQuotaUI(); }, 2200);
  }

  /* ====== Ø¥Ù†ØªØ§Ø¬ Ø§Ù„ØªÙ‚Ø±ÙŠØ± ====== */
  function buildBlock(title, items){
    return `<h3 style="text-align:center">${title}</h3><ul>${items.map(i=>`<li>${i}</li>`).join("")}</ul>`;
  }

  function buildReport(topic){
    const bank = TOPICS[topic] || TOPICS.general;
    const pack = SIGN_SNIPPETS[currentSign.name] || SIGN_SNIPPETS["ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"];
    const r = seeded(Math.floor(currentRand()*1e9));

    const letter = getRandomLetterArabic();
    const posBase = pick(r, BASE_POS), posTopic = pick(r, bank.pos), posSign = pick(r, pack.pos);
    let warnTopic = pick(r, bank.warn);
    warnTopic = warnTopic.replace("<LETTER>", letter);
    const warnBase = pick(r, BASE_WARN), warnSign = pick(r, pack.warn);

    // Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù‚ Ø£Ø­Ø¯Ø§Ø« Ù…Ø­Ø¯Ø¯Ø© ÙƒÙ…Ø§ Ø·Ù„Ø¨Øª (Ø®Ù„Ø§Ù/ØµÙ„Ø­/Ù…Ø§Ù„/Ø£Ø²Ù…Ø©/Ø­Ø¨ÙŠØ¨ Ù…Ø´ÙƒÙˆÙƒâ€¦)
    const deepPos = pick(r, [
      "Ø¨ÙˆØ§Ø¯Ø± ØµÙÙ„Ø­ Ø£Ø³Ø±ÙŠ ØªÙØ·ÙØ¦ Ø´Ø±Ø§Ø±Ø© Ø®Ù„Ø§Ù Ù‚Ø¯ÙŠÙ…ØŒ ÙˆØªÙØªØ­ Ø¨Ø§Ø¨ Ø§Ù„ØªÙ‚Ø§Ø±Ø¨.",
      "Ù…Ø¨Ù„ÙØº Ù…Ø§Ù„ÙŠ ÙŠØµÙ„ Ø¨Ø´ÙƒÙ„ Ù…ÙØ§Ø¬Ø¦ (ØªØ¹ÙˆÙŠØ¶/Ù‡Ø¨Ø©/ÙØ±ØµØ© Ø¹Ø§Ø¨Ø±Ø©) ÙŠØ®ÙÙ Ø¹Ø¨Ø¦Ù‹Ø§ Ø³Ø§Ø¨Ù‚Ù‹Ø§."
    ]);
    const deepWarn = pick(r, [
      "Ø§Ø­ØªÙ…Ø§Ù„ Ø®Ù„Ø§Ù Ø¹Ø§Ø¦Ù„ÙŠ Ù‚ØµÙŠØ± Ù„ÙƒÙ† Ø­Ø§Ø¯Ù‘ Ù‚Ø¨Ù„ Ø£Ù† ÙŠÙ‡Ø¯Ø£ Ø³Ø±ÙŠØ¹Ù‹Ø§.",
      "Ø¨ÙˆØ§Ø¯Ø± Ø£Ø²Ù…Ø© Ù…Ø§Ø¯ÙŠØ© Ø¥Ù† ØªÙ… Ø§ØªØ®Ø§Ø° Ø®Ø·ÙˆØ© Ø¥Ù†ÙØ§Ù‚ Ø·Ø§Ø¦Ø´Ø© Ø®Ù„Ø§Ù„ Ø£ÙŠØ§Ù…."
    ]);

    const intro = `<p style="text-align:center"><strong>${bank.title}:</strong> Ø§Ù„Ø¥Ø´Ø§Ø±Ø§Øª ØªÙ…ÙŠÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø¸Ù‡ÙˆØ± Ø¨ÙˆØ¶ÙˆØ­Ø› Ø¨Ø¹Ø¶Ù‡Ø§ ÙŠÙ‚ÙˆØ¯ Ù„ÙØ±Ø¬Ù Ù‚Ø±ÙŠØ¨ ÙˆØ¨Ø¹Ø¶Ù‡Ø§ ÙŠØ­Ø°Ù‘Ø± Ù…Ù† Ø®Ø·ÙˆØ© Ø®Ø§Ø·ÙØ©.</p>`;
    const positives = buildBlock("ØªÙˆÙ‚Ø¹Ø§Øª Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ©", [posBase, posTopic, posSign, deepPos]);
    const warnings  = buildBlock("ØªØ­Ø°ÙŠØ±Ø§Øª Ù…Ø­ØªÙ…Ù„Ø©", [warnBase, warnTopic, warnSign, deepWarn]);

    return `${intro}${positives}${warnings}`;
  }

  function genReading(topic){
    // ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­ØµÙ‘Ø©
    const q = getQuota();
    if((q.count||0) >= MAX_READS){
      updateQuotaUI();
      showOverlayCountdown();
      return;
    }
    // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¹Ø¯Ù‘Ø§Ø¯ ÙˆØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø­ØµÙ‘Ø©
    const newQ = incQuota();
    updateQuotaUI();

    const html = buildReport(topic);
    resultText.innerHTML = html;
    omenEl.textContent = pick(seeded(Date.now()), OMENS);
  }

  /* ====== Ø£Ø­Ø¯Ø§Ø« ====== */
  document.getElementById("startBtn").addEventListener("click", ()=>{
    currentRand = seeded(formSeed());
    updateZodiacUI();
    startFlow();
  });

  document.querySelectorAll(".topic").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      // Ù…Ù†Ø¹ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ø°Ø§ Ø§Ù„Ø­ØµÙ‘Ø© ØµÙØ± Ù‚Ø¨Ù„ Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©
      if(remainingQuota()<=0){ showOverlayCountdown(); return; }
      currentTopic = btn.dataset.topic;
      hide(stepTopics); show(stepResult);
      echoUser(); genReading(currentTopic);
    });
  });

  document.getElementById("againBtn").addEventListener("click", ()=>{
    currentRand = seeded(formSeed()); genReading(currentTopic);
  });
  document.getElementById("topicsBtn").addEventListener("click", ()=>{
    hide(stepResult); show(stepTopics); updateQuotaUI();
  });
  document.getElementById("restartBtn").addEventListener("click", ()=>{
    hide(stepResult); hide(stepTopics); show(step1); window.scrollTo({top:0, behavior:"smooth"});
    updateQuotaUI();
  });

  // ØªÙ‡ÙŠØ¦Ø©
  (function init(){
    loadForm();
    updateZodiacUI();
    updateQuotaUI();
    // ØªØ­Ø¯Ù‘Ø« Ø§Ù„Ø¹Ø¯Ù‘Ø§Ø¯ ÙƒÙ„ Ø«Ø§Ù†ÙŠØ© Ø¹Ù†Ø¯ ÙˆØ¬ÙˆØ¯ resetAt
    setInterval(()=>{ updateQuotaUI(); }, 1000);
  })();
</script>
</body>
</html>
